{"version":3,"file":"Map.js","sourceRoot":"","sources":["../../../../../../../../browser/src/map/Map.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * L.Map is the central class of the API - it is used to create a map.\n */\n\nfunction isAnyVexDialogActive() {\n\tvar res = false;\n\tfor (var vexId in vex.getAll()) {\n\t\tres = res || vex.getById(vexId).isOpen;\n\t}\n\treturn res;\n}\n\n/* global app vex $ _ Cursor */\nL.Map = L.Evented.extend({\n\n\tstatics: {\n\t\tTHIS : undefined\n\t},\n\n\toptions: {\n\t\tcrs: L.CRS.Simple,\n\t\tcenter: [0, 0],\n\t\tdocParams: {},\n\t\t// Default zoom level in which the document will be loaded.\n\t\tzoom: 10,\n\t\t// These zoom values are on a logarithmic scale. Each step away from the default 10\n\t\t// (meaning 1 = 100%) is a multiplication by or division with pow(2,1/4). pow(2,1/4)\n\t\t// is approximately 1.2. Thus 4 corresponds to six steps of division by pow(2,1/4) =\n\t\t// 35%. 18 corresponds to 8 steps of multiplication by pow(2,1/4) = 400%. The\n\t\t// percentages available are then rounded to the nearest five percent.\n\t\tminZoom: 1,\n\t\tmaxZoom: 18,\n\t\tmaxBounds: L.latLngBounds([0, 0], [-100, 100]),\n\t\tfadeAnimation: false, // Not useful for typing.\n\t\ttrackResize: true,\n\t\tmarkerZoomAnimation: true,\n\t\t// defaultZoom:\n\t\t// The zoom level at which the tile size in twips equals the default size (3840 x 3840).\n\t\t// Unless you know what you are doing, this should not be modified.\n\t\tdefaultZoom: 10,\n\t\t// 15 = 1440 twips-per-inch / 96 dpi.\n\t\t// Chosen to match previous hardcoded value of 3840 for\n\t\t// the current tile pixel size of 256.\n\t\t// Default tile width in twips (how much of the document is covered horizontally in a\n\t\t// 256x256 pixels tile). Unless you know what you are doing, this should not be modified;\n\t\t// this means twips value for 256 pixels at 96dpi.\n\t\ttileWidthTwips: window.tileSize * 15,\n\t\t// tileHeightTwips :\n\t\t// Default tile height in twips (how much of the document is covered vertically in a\n\t\t// 256x256 pixels tile).Unless you know what you are doing, this should not be modified;\n\t\t// this means twips value for 256 pixels at 96dpi.\n\t\ttileHeightTwips: window.tileSize * 15,\n\t\turlPrefix: 'cool',\n\t\twopiSrc: '',\n\t\tcursorURL: L.LOUtil.getURL('cursors'),\n\t\t// cursorURL\n\t\t// The path (local to the server) where custom cursor files are stored.\n\t},\n\n\t// Control.UIManager instance, set in main.js\n\tuiManager: null,\n\n\t// Control.LokDialog instance, is set in Control.UIManager.js\n\tdialog: null,\n\n\t// Control.JSDialog instance, is set in Control.UIManager.js\n\tjsdialog: null,\n\n\tcontext: {context: ''},\n\n\tlastActiveTime: Date.now(),\n\n\tinitialize: function (id, options) { // (HTMLElement or String, Object)\n\t\toptions = L.setOptions(this, options);\n\n\t\tif (this.options.documentContainer) {\n\t\t\t// have it as DOM object\n\t\t\tthis.options.documentContainer = L.DomUtil.get(this.options.documentContainer);\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && !window.ThisIsTheAndroidApp)\n\t\t\tthis._clip = L.clipboard(this);\n\t\tthis._initContainer(id);\n\t\tthis._initLayout();\n\n\t\t// hack for https://github.com/Leaflet/Leaflet/issues/1980\n\t\tthis._onResize = L.bind(this._onResize, this);\n\n\t\t// Start with readonly toolbars on desktop\n\t\tif (window.mode.isDesktop()) {\n\t\t\tL.DomUtil.addClass(L.DomUtil.get('toolbar-wrapper'), 'readonly');\n\t\t}\n\n\t\tthis._initEvents();\n\t\tthis._cacheSVG = [];\n\n\t\tif (options.maxBounds) {\n\t\t\tthis.setMaxBounds(options.maxBounds);\n\t\t}\n\n\t\tif (options.zoom !== undefined) {\n\t\t\tthis._zoom = this._limitZoom(options.zoom);\n\t\t}\n\n\t\tif (options.center && options.zoom !== undefined) {\n\t\t\tthis.setView(L.latLng(options.center), options.zoom, {reset: true});\n\t\t}\n\n\t\tCursor.imagePath = options.cursorURL;\n\n\t\t/* private members */\n\t\tthis._handlers = [];\n\t\tthis._layers = {};\n\t\tthis._zoomBoundLayers = {};\n\t\tthis._sizeChanged = true;\n\t\tthis._bDisableKeyboard = false;\n\t\tthis._active = true;\n\t\tthis._fatal = false;\n\t\tthis._enabled = true;\n\t\tthis._debugAlwaysActive = false; // disables the dimming / document inactivity when true\n\t\tthis._serverRecycling = false;\n\t\tthis._documentIdle = false;\n\t\tthis._disableDefaultAction = {}; // The events for which the default handler is disabled and only issues postMessage.\n\t\tthis.showSidebar = false;\n\t\tthis._previewQueue = [];\n\t\tthis._previewRequestsOnFly = 0;\n\t\tthis._timeToEmptyQueue = new Date();\n\t\tthis._partsDirection = 1; // For pre-fetching the slides in the direction of travel.\n\t\t// Focusing:\n\t\t//\n\t\t// Cursor is visible or hidden (e.g. for graphic selection).\n\t\tthis._isCursorVisible = true;\n\t\t// The ID of the window with focus. 0 for the document.\n\t\tthis._winId = 0;\n\t\t// The object of the dialog, if any (must have .focus callable).\n\t\tthis._activeDialog = null;\n\t\t// True only when searching within the doc, as we need to use winId==0.\n\t\tthis._isSearching = false;\n\n\n\t\tvex.dialogID = -1;\n\n\t\tthis.callInitHooks();\n\n\t\tthis.addHandler('keyboard', L.Map.Keyboard);\n\t\tthis.addHandler('dragging', L.Map.Drag);\n\t\tif ((L.Browser.touch && !L.Browser.pointer) || (L.Browser.cypressTest && (window.mode.isMobile() || window.mode.isTablet()))) {\n\t\t\tthis.dragging.disable();\n\t\t\tthis.dragging._draggable._manualDrag = true;\n\t\t\tthis._mainEvents('off');\n\t\t\tthis.addHandler('touchGesture', L.Map.TouchGesture);\n\t\t} else {\n\t\t\tthis.addHandler('mouse', L.Map.Mouse);\n\t\t\tthis.addHandler('boxZoom', L.Map.BoxZoom);\n\t\t\tthis.addHandler('scrollHandler', L.Map.Scroll);\n\t\t\tthis.addHandler('doubleClickZoom', L.Map.DoubleClickZoom);\n\t\t}\n\n\t\tif (this.options.imagePath) {\n\t\t\tL.Icon.Default.imagePath = this.options.imagePath;\n\t\t}\n\t\tthis._addLayers(this.options.layers);\n\t\tapp.socket = new app.definitions.Socket(this);\n\n\t\tthis._progressBar = L.progressOverlay(new L.point(150, 25));\n\n\t\tthis._textInput = L.textInput();\n\t\tthis.addLayer(this._textInput);\n\n\t\t// When all these conditions are met, fire statusindicator:initializationcomplete\n\t\tthis.initConditions = {\n\t\t\t'doclayerinit': false,\n\t\t\t'statusindicatorfinish': false,\n\t\t\t'StyleApply': false,\n\t\t\t'CharFontName': false,\n\t\t\t'updatepermission': false\n\t\t};\n\t\tthis.initComplete = false;\n\n\t\tthis.on('updatepermission', function(e) {\n\t\t\tif (!this.initComplete) {\n\t\t\t\tthis._fireInitComplete('updatepermission');\n\t\t\t}\n\n\t\t\tif (e.perm === 'readonly') {\n\t\t\t\tL.DomUtil.addClass(this._container.parentElement, 'readonly');\n\t\t\t\tif (window.mode.isDesktop() || window.mode.isTablet()) {\n\t\t\t\t\tL.DomUtil.addClass(L.DomUtil.get('toolbar-wrapper'), 'readonly');\n\t\t\t\t}\n\t\t\t\tL.DomUtil.addClass(L.DomUtil.get('main-menu'), 'readonly');\n\t\t\t\tL.DomUtil.addClass(L.DomUtil.get('presentation-controls-wrapper'), 'readonly');\n\t\t\t} else {\n\t\t\t\tL.DomUtil.removeClass(this._container.parentElement, 'readonly');\n\t\t\t\tif (window.mode.isDesktop() || window.mode.isTablet()) {\n\t\t\t\t\tL.DomUtil.removeClass(L.DomUtil.get('toolbar-wrapper'), 'readonly');\n\t\t\t\t}\n\t\t\t\tL.DomUtil.removeClass(L.DomUtil.get('main-menu'), 'readonly');\n\t\t\t\tL.DomUtil.removeClass(L.DomUtil.get('presentation-controls-wrapper'), 'readonly');\n\t\t\t}\n\t\t}, this);\n\t\tthis.on('doclayerinit', function() {\n\t\t\tif (!this.initComplete) {\n\t\t\t\tthis._fireInitComplete('doclayerinit');\n\t\t\t}\n\n\t\t\t// We need core's knowledge of whether it is a mobile phone\n\t\t\t// or not to be in sync with the test in _onJSDialogMsg in TileLayer.js.\n\t\t\tif (window.mode.isMobile())\n\t\t\t{\n\t\t\t\tdocument.getElementById('document-container').classList.add('mobile');\n\t\t\t\tthis._size = new L.Point(0,0);\n\t\t\t\tthis._onResize();\n\t\t\t}\n\t\t});\n\t\tthis.on('updatetoolbarcommandvalues', function(e) {\n\t\t\tif (this.initComplete) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (e.commandName === '.uno:StyleApply') {\n\t\t\t\tthis._fireInitComplete('StyleApply');\n\t\t\t}\n\t\t\telse if (e.commandName === '.uno:CharFontName') {\n\t\t\t\tthis._fireInitComplete('CharFontName');\n\t\t\t}\n\t\t});\n\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\tthis.on('readonlymode', function() {\n\t\t\t\tthis.setPermission('edit');\n\t\t\t});\n\t\t}\n\n\t\tthis.showBusy(_('Initializing...'), false);\n\t\tthis.on('statusindicator', this._onUpdateProgress, this);\n\n\t\tthis.on('editorgotfocus', this._onEditorGotFocus, this);\n\n\t\t// Fired to signal that the input focus is being changed.\n\t\tthis.on('changefocuswidget', this._onChangeFocusWidget, this);\n\n\t\tthis.on('searchstart', this._onSearchStart, this);\n\n\t\t// View info (user names and view ids)\n\t\tthis._viewInfo = {};\n\t\tthis._viewInfoByUserName = {};\n\n\t\t// View color map\n\t\tthis._viewColors = {};\n\n\t\t// This becomes true if document was ever modified by the user\n\t\tthis._everModified = false;\n\n\t\t// This is the new file name, if the document is renamed, which is used on uno:Save's result.\n\t\tthis._renameFilename = '';\n\n\t\t// Document is completely loaded or not\n\t\tthis._docLoaded = false;\n\n\t\t// Unlike _docLoaded, this is flagged only once,\n\t\t// after we receive status for the first time.\n\t\tthis._docLoadedOnce = false;\n\n\t\tthis._isNotebookbarLoadedOnCore = false;\n\n\t\tthis.on('commandstatechanged', function(e) {\n\t\t\tif (e.commandName === '.uno:ModifiedStatus') {\n\t\t\t\tthis._everModified = this._everModified || (e.state === 'true');\n\n\t\t\t\t// Fire an event to let the client know whether the document needs saving or not.\n\t\t\t\tthis.fire('postMessage', {msgId: 'Doc_ModifiedStatus', args: { Modified: e.state === 'true' }});\n\t\t\t}\n\t\t}, this);\n\n\t\tthis.on('docloaded', function(e) {\n\t\t\tthis._docLoaded = e.status;\n\t\t\tif (this._docLoaded) {\n\t\t\t\tapp.socket.sendMessage('blockingcommandstatus isRestrictedUser=' + this.Restriction.isRestrictedUser + ' isLockedUser=' + this.Locking.isLockedUser);\n\t\t\t\tthis.notifyActive();\n\t\t\t\tif (!document.hasFocus()) {\n\t\t\t\t\tthis.fire('editorgotfocus');\n\t\t\t\t\tthis.focus();\n\t\t\t\t}\n\t\t\t\tthis._activate();\n\t\t\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\t\t\twindow.postMobileMessage('hideProgressbar');\n\t\t\t\t}\n\t\t\t} else if (this._docLayer) {\n\t\t\t\t// remove the comments and changes\n\t\t\t\tvar commentSection = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\t\t\tif (commentSection)\n\t\t\t\t\tcommentSection.clearList();\n\t\t\t}\n\n\t\t\tthis.initializeModificationIndicator();\n\n\t\t\t// Show sidebar.\n\t\t\tif (this._docLayer && !this._docLoadedOnce) {\n\t\t\t\t// Let the first page finish loading then load the sidebar.\n\t\t\t\tsetTimeout(this.uiManager.initializeSidebar.bind(this.uiManager), 200);\n\t\t\t}\n\n\t\t\t// We have loaded.\n\t\t\tif (!this._docLoadedOnce) {\n\t\t\t\tthis._docLoadedOnce = this._docLoaded;\n\t\t\t}\n\t\t}, this);\n\t},\n\n\tloadDocument: function(socket) {\n\t\tapp.socket.connect(socket);\n\t\tif (this._clip)\n\t\t\tthis._clip.clearSelection();\n\t\tthis.removeObjectFocusDarkOverlay();\n\t},\n\n\tsendInitUNOCommands: function() {\n\t\t// TODO: remove duplicated init code\n\t\tapp.socket.sendMessage('commandvalues command=.uno:LanguageStatus');\n\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\t\tif (this._docLayer._docType === 'spreadsheet') {\n\t\t\tthis._docLayer.refreshViewData();\n\t\t}\n\t\tthis._docLayer._getToolbarCommandsValues();\n\t},\n\n\t// public methods that modify map state\n\n\tgetViewId: function (username) {\n\t\tfor (var idx in this._viewInfo) {\n\t\t\tif (this._viewInfo[idx].username === username) {\n\t\t\t\treturn this._viewInfo[idx].id;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t},\n\n\taddView: function(viewInfo) {\n\t\tthis._viewInfo[viewInfo.id] = viewInfo;\n\t\tif (viewInfo.userextrainfo !== undefined && viewInfo.userextrainfo.avatar !== undefined) {\n\t\t\tthis._viewInfoByUserName[viewInfo.username] = viewInfo;\n\t\t}\n\t\tthis.fire('postMessage', {msgId: 'View_Added', args: {Deprecated: true, ViewId: viewInfo.id, UserId: viewInfo.userid, UserName: viewInfo.username, UserExtraInfo: viewInfo.userextrainfo, Color: L.LOUtil.rgbToHex(viewInfo.color), ReadOnly: viewInfo.readonly}});\n\n\t\t// Fire last, otherwise not all events are handled correctly.\n\t\tthis.fire('addview', {viewId: viewInfo.id, username: viewInfo.username, extraInfo: viewInfo.userextrainfo, readonly: this.isViewReadOnly(viewInfo.id)});\n\n\t\tthis.updateAvatars();\n\t},\n\n\tremoveView: function(viewid) {\n\t\tvar username = this._viewInfo[viewid].username;\n\t\tdelete this._viewInfoByUserName[this._viewInfo[viewid].username];\n\t\tdelete this._viewInfo[viewid];\n\t\tthis.fire('postMessage', {msgId: 'View_Removed', args: {Deprecated: true, ViewId: viewid}});\n\n\t\t// Fire last, otherwise not all events are handled correctly.\n\t\tthis.fire('removeview', {viewId: viewid, username: username});\n\t},\n\n\n\t// replaced by animation-powered implementation in Map.PanAnimation.js\n\tsetView: function (center, zoom) {\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\n\t\tthis._resetView(L.latLng(center), this._limitZoom(zoom));\n\t\treturn this;\n\t},\n\n\tupdateAvatars: function() {\n\t\tif (this._docLayer && this._docLayer._annotations && this._docLayer._annotations._items) {\n\t\t\tfor (var idxAnno in this._docLayer._annotations._items) {\n\t\t\t\tvar annotation = this._docLayer._annotations._items[idxAnno];\n\t\t\t\tvar username = annotation._data.author;\n\t\t\t\tif (this._viewInfoByUserName[username])\n\t\t\t\t\tannotation._data.avatar = this._viewInfoByUserName[username].userextrainfo.avatar;\n\t\t\t\tannotation._updateContent();\n\t\t\t}\n\t\t}\n\t},\n\n\tinitializeModificationIndicator: function() {\n\t\tvar lastModButton = L.DomUtil.get('menu-last-mod');\n\t\tif (lastModButton !== null && lastModButton !== undefined\n\t\t\t&& lastModButton.firstChild.innerHTML !== null\n\t\t\t&& lastModButton.firstChild.childElementCount == 0) {\n\t\t\tif (this._lastmodtime == null) {\n\t\t\t\t// No modification time -> hide the indicator\n\t\t\t\tL.DomUtil.setStyle(lastModButton, 'display', 'none');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar mainSpan = document.createElement('span');\n\t\t\tthis.lastModIndicator = document.createElement('span');\n\t\t\tmainSpan.appendChild(this.lastModIndicator);\n\n\t\t\tthis.updateModificationIndicator(this._lastmodtime);\n\n\t\t\t// Replace menu button body with new content\n\t\t\tlastModButton.firstChild.innerHTML = '';\n\t\t\tlastModButton.firstChild.appendChild(mainSpan);\n\n\t\t\tif (L.Params.revHistoryEnabled) {\n\t\t\t\tL.DomUtil.setStyle(lastModButton, 'cursor', 'pointer');\n\t\t\t}\n\t\t}\n\t},\n\n\tupdateModificationIndicator: function(newModificationTime) {\n\t\tvar timeout;\n\n\t\tif (typeof newModificationTime === 'string') {\n\t\t\tthis._lastmodtime = newModificationTime;\n\t\t}\n\n\t\tclearTimeout(this._modTimeout);\n\n\t\tif (this.lastModIndicator !== null && this.lastModIndicator !== undefined) {\n\t\t\tvar dateTime = new Date(this._lastmodtime.replace(/,.*/, 'Z'));\n\t\t\tvar dateValue;\n\n\t\t\tvar elapsed = Date.now() - dateTime;\n\t\t\tvar rtf1 = new Intl.RelativeTimeFormat(String.locale, { style: 'narrow' });\n\t\t\tif (elapsed < 60000) {\n\t\t\t\tdateValue = _('Last saved:') + ' ' + rtf1.format(-Math.round(elapsed / 1000), 'second');\n\t\t\t\ttimeout = 6000;\n\t\t\t} else if (elapsed < 3600000) {\n\t\t\t\tdateValue = _('Last saved:') + ' ' + rtf1.format(-Math.round(elapsed / 60000), 'minute');\n\t\t\t\ttimeout = 60000;\n\t\t\t} else if (elapsed < 3600000 * 24) {\n\t\t\t\tdateValue = _('Last saved:') + ' ' + rtf1.format(-Math.round(elapsed / 3600000), 'hour');\n\t\t\t\ttimeout = 60000;\n\t\t\t} else {\n\t\t\t\tdateValue = _('Last saved:') + ' ' + dateTime.toLocaleDateString(String.locale,\n\t\t\t\t\t{ year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });\n\t\t\t\ttimeout = 60000;\n\t\t\t}\n\n\t\t\tthis.lastModIndicator.innerHTML = dateValue;\n\n\t\t\tif (timeout) {\n\t\t\t\tthis._modTimeout = setTimeout(L.bind(this.updateModificationIndicator, this, -1), timeout);\n\t\t\t}\n\t\t}\n\t},\n\n\tshowBusy: function(label, bar) {\n\t\tif (window.ThisIsTheAndroidApp)\n\t\t\treturn;\n\n\t\t// If document is already loaded, ask the toolbar widget to show busy\n\t\t// status on the bottom statusbar\n\t\tif (this._docLayer) {\n\t\t\tthis.fire('showbusy', {label: label});\n\t\t\treturn;\n\t\t}\n\t\tthis._progressBar.delayedStart(this, label, bar);\n\t},\n\n\thideBusy: function () {\n\t\tif (window.ThisIsTheAndroidApp)\n\t\t\treturn;\n\n\t\tthis.fire('hidebusy');\n\t\tthis._progressBar.end(this);\n\t},\n\n\tzoomToFactor: function (zoom) {\n\t\treturn Math.pow(1.2, (zoom - this.options.zoom));\n\t},\n\n\tsetDesktopCalcViewOnZoom: function (zoom, animate) {\n\t\tvar calcLayer = this._docLayer;\n\t\tif (!calcLayer.options.sheetGeometryDataEnabled || !calcLayer.sheetGeometry)\n\t\t\treturn false;\n\n\t\tvar sheetGeom = calcLayer.sheetGeometry;\n\t\tvar zoomScaleAbs = this.zoomToFactor(zoom);\n\n\t\tvar cssBounds = this.getPixelBounds();\n\t\tvar cssBoundsSize = cssBounds.getSize();\n\n\t\tvar topLeftCell = sheetGeom.getCellFromPos(\n\t\t\tcssBounds.getTopLeft().multiplyBy(app.dpiScale), 'corepixels');\n\t\t// top-left w.r.t current zoom.\n\t\tvar topLeftPx = sheetGeom.getCellRect(topLeftCell.x, topLeftCell.y)\n\t\t\t.getTopLeft().divideBy(window.devicePixelRatio);\n\t\t// top-left w.r.t new zoom.\n\t\tvar newTopLeftPx = sheetGeom.getCellRect(topLeftCell.x, topLeftCell.y, zoomScaleAbs)\n\t\t\t.getTopLeft().divideBy(app.dpiScale);\n\n\t\tvar cursorInBounds = calcLayer._cursorCorePixels ?\n\t\t\tcssBounds.contains(\n\t\t\t\tL.point(calcLayer._cursorCorePixels.getTopLeft().divideBy(app.dpiScale))) : false;\n\n\t\tvar cursorActive = calcLayer.isCursorVisible();\n\t\tif (cursorActive && cursorInBounds) {\n\t\t\tvar cursorBounds = calcLayer._cursorCorePixels;\n\t\t\tvar cursorCenter = calcLayer._corePixelsToTwips(cursorBounds.getCenter());\n\t\t\tvar newCursorCenter = sheetGeom.getTileTwipsAtZoom(cursorCenter, zoomScaleAbs);\n\t\t\t// convert to css pixels at zoomScale.\n\t\t\tnewCursorCenter._multiplyBy(zoomScaleAbs / 15 / app.dpiScale)._round();\n\t\t\tvar newBounds = new L.Bounds(newTopLeftPx, newTopLeftPx.add(cssBoundsSize));\n\n\t\t\tif (!newBounds.contains(newCursorCenter)) {\n\t\t\t\tvar margin = 10;\n\t\t\t\tvar diffX = 0;\n\t\t\t\tvar diffY = 0;\n\t\t\t\tvar docSize = sheetGeom.getSize('corepixels').divideBy(app.dpiScale);\n\t\t\t\tif (newCursorCenter.x < newBounds.min.x) {\n\t\t\t\t\tdiffX = Math.max(0, newCursorCenter.x - margin) - newBounds.min.x;\n\t\t\t\t} else if (newCursorCenter.x > newBounds.max.x) {\n\t\t\t\t\tdiffX = Math.min(docSize.x, newCursorCenter.x + margin) - newBounds.max.x;\n\t\t\t\t}\n\n\t\t\t\tif (newCursorCenter.y < newBounds.min.y) {\n\t\t\t\t\tdiffY = Math.max(0, newCursorCenter.y - margin) - newBounds.min.y;\n\t\t\t\t} else if (newCursorCenter.y > newBounds.max.y) {\n\t\t\t\t\tdiffY = Math.min(docSize.y, newCursorCenter.y + margin) - newBounds.max.y;\n\t\t\t\t}\n\n\t\t\t\tnewTopLeftPx._add(new L.Point(diffX, diffY));\n\t\t\t\ttopLeftPx._add(new L.Point(diffX / zoomScaleAbs, diffY / zoomScaleAbs));\n\t\t\t\t// FIXME: pan to topLeftPx before the animation ?\n\t\t\t}\n\t\t}\n\n\t\tvar newHalfSize = cssBoundsSize.divideBy(2);\n\t\tvar newCenter = newTopLeftPx.add(newHalfSize);\n\t\tvar newCenterLatLng = this.unproject(newCenter, zoom);\n\t\t// pinch center w.r.t current zoom scale.\n\t\tvar newPinchCenterLatLng = this.unproject(topLeftPx, this.getZoom());\n\n\t\tthis._ignoreCursorUpdate = true;\n\t\tvar thisObj = this;\n\t\tvar mapUpdater = function() {\n\t\t\tthisObj._resetView(L.latLng(newCenterLatLng), thisObj._limitZoom(zoom));\n\t\t};\n\t\tvar runAtFinish = function() {\n\t\t\tthisObj._ignoreCursorUpdate = false;\n\t\t\tif (cursorActive) {\n\t\t\t\tcalcLayer.activateCursor();\n\t\t\t}\n\t\t};\n\n\t\tif (animate) {\n\t\t\tthis._docLayer.runZoomAnimation(zoom, newPinchCenterLatLng,\n\t\t\t\tmapUpdater,\n\t\t\t\trunAtFinish);\n\t\t} else {\n\t\t\tmapUpdater();\n\t\t\trunAtFinish();\n\t\t}\n\t},\n\n\tignoreCursorUpdate: function () {\n\t\treturn this._ignoreCursorUpdate;\n\t},\n\n\tenableTextInput: function () {\n\t\tthis._setTextInputState(true /* enable? */);\n\t},\n\n\tdisableTextInput: function () {\n\t\tthis._setTextInputState(false /* enable? */);\n\t},\n\n\t_setTextInputState: function (enable) {\n\t\tvar docLayer = this._docLayer;\n\t\tif (!docLayer)\n\t\t\treturn;\n\t\tthis._ignoreCursorUpdate = !enable;\n\n\t\tif (!docLayer.isCursorVisible())\n\t\t\treturn;\n\n\t\tif (!enable) {\n\t\t\tthis._textInput.disable();\n\t\t} else {\n\t\t\tthis._textInput.enable();\n\t\t\tdocLayer._updateCursorPos();\n\t\t}\n\t},\n\n\tsetZoom: function (zoom, options, animate) {\n\n\t\t// do not animate zoom when in a cypress test.\n\t\tif (animate && L.Browser.cypressTest)\n\t\t\tanimate = false;\n\n\t\tif (this._docLayer instanceof L.CanvasTileLayer) {\n\t\t\tif (!zoom)\n\t\t\t\tzoom = this._clientZoom || this.options.zoom;\n\t\t\telse\n\t\t\t\tthis._clientZoom = zoom;\n\t\t}\n\n\t\tif (!this._loaded) {\n\t\t\tthis._zoom = this._limitZoom(zoom);\n\t\t\treturn this;\n\t\t}\n\n\t\tvar curCenter = this.getCenter();\n\t\tif (this._docLayer && this._docLayer._docType === 'spreadsheet') {\n\t\t\t// for spreadsheets, when the document is smaller than the viewing area\n\t\t\t// we want it to be glued to the row/column headers instead of being centered\n\t\t\tthis._docLayer._checkSpreadSheetBounds(zoom);\n\t\t\tif (window.mode.isDesktop()) {\n\t\t\t\treturn this.setDesktopCalcViewOnZoom(zoom, animate);\n\t\t\t}\n\t\t}\n\n\t\tthis._docLayer.setZoomChanged(true);\n\t\tvar thisObj = this;\n\t\tvar cssBounds = this.getPixelBounds();\n\t\tvar mapUpdater;\n\t\tvar runAtFinish;\n\t\tif (this._docLayer && this._docLayer._visibleCursor && this.getBounds().contains(this._docLayer._visibleCursor.getCenter())) {\n\t\t\t// Calculate new center after zoom. The intent is that the caret\n\t\t\t// position stays the same.\n\t\t\tvar zoomScale = 1.0 / this.getZoomScale(zoom, this._zoom);\n\t\t\tvar caretPos = this._docLayer._visibleCursor.getCenter();\n\t\t\tvar newCenter = new L.LatLng(curCenter.lat + (caretPos.lat - curCenter.lat) * (1.0 - zoomScale),\n\t\t\t\t\t\t     curCenter.lng + (caretPos.lng - curCenter.lng) * (1.0 - zoomScale));\n\n\t\t\tmapUpdater = function() {\n\t\t\t\tthisObj.setView(newCenter, zoom, {zoom: options});\n\t\t\t};\n\t\t\trunAtFinish = function() {\n\t\t\t\tthisObj._docLayer.setZoomChanged(false);\n\t\t\t};\n\n\t\t\tif (animate) {\n\t\t\t\tthis._docLayer.runZoomAnimation(zoom,\n\t\t\t\t\t// pinchCenter\n\t\t\t\t\tnew L.LatLng(\n\t\t\t\t\t\t// Use the current y-center if there is a top margin.\n\t\t\t\t\t\tcssBounds.min.y < 0 ? curCenter.lat : caretPos.lat,\n\t\t\t\t\t\t// Use the current x-center if there is a left margin.\n\t\t\t\t\t\tcssBounds.min.x < 0 ? curCenter.lng : caretPos.lng),\n\t\t\t\t\tmapUpdater,\n\t\t\t\t\trunAtFinish);\n\t\t\t} else {\n\t\t\t\tmapUpdater();\n\t\t\t\trunAtFinish();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tmapUpdater = function() {\n\t\t\tthisObj.setView(curCenter, zoom, {zoom: options});\n\t\t};\n\n\t\trunAtFinish = function() {\n\t\t\tthisObj._docLayer.setZoomChanged(false);\n\t\t};\n\n\t\tif (animate) {\n\t\t\tthis._docLayer.runZoomAnimation(zoom,\n\t\t\t\t// pinchCenter\n\t\t\t\tcurCenter,\n\t\t\t\tmapUpdater,\n\t\t\t\trunAtFinish);\n\t\t} else {\n\t\t\tmapUpdater();\n\t\t\trunAtFinish();\n\t\t}\n\t},\n\n\tzoomIn: function (delta, options, animate) {\n\t\treturn this.setZoom(this._zoom + (delta || 1), options, animate);\n\t},\n\n\tzoomOut: function (delta, options, animate) {\n\t\treturn this.setZoom(this._zoom - (delta || 1), options, animate);\n\t},\n\n\tsetZoomAround: function (latlng, zoom, options) {\n\t\tvar scale = this.getZoomScale(zoom),\n\t\t    viewHalf = this.getSize().divideBy(2),\n\t\t    containerPoint = latlng instanceof L.Point ? latlng : this.latLngToContainerPointIgnoreSplits(latlng),\n\n\t\t    centerOffset = containerPoint.subtract(viewHalf).multiplyBy(1 - 1 / scale),\n\t\t    newCenter = this.containerPointToLatLngIgnoreSplits(viewHalf.add(centerOffset));\n\n\t\treturn this.setView(newCenter, zoom, {zoom: options});\n\t},\n\n\tpanTo: function (center, options) { // (LatLng)\n\t\treturn this.setView(center, this._zoom, {pan: options});\n\t},\n\n\tpanBy: function (offset) { // (Point)\n\t\t// replaced with animated panBy in Map.PanAnimation.js\n\t\tthis.fire('movestart');\n\n\t\tthis._rawPanBy(L.point(offset));\n\n\t\tthis.fire('move');\n\t\treturn this.fire('moveend');\n\t},\n\n\tsetMaxBounds: function (bounds) {\n\t\tbounds = L.latLngBounds(bounds);\n\n\t\tthis.options.maxBounds = bounds;\n\n\t\tif (this._loaded) {\n\t\t\tthis.panInsideBounds(this.options.maxBounds);\n\t\t}\n\t},\n\n\tsetDocBounds: function (bounds) {\n\t\tbounds = L.latLngBounds(bounds);\n\t\tthis.options.docBounds = bounds;\n\t},\n\n\tgetCorePxDocBounds: function () {\n\t\tvar topleft = this.project(this.options.docBounds.getNorthWest());\n\t\tvar bottomRight = this.project(this.options.docBounds.getSouthEast());\n\t\treturn new L.Bounds(this._docLayer._cssPixelsToCore(topleft),\n\t\t\tthis._docLayer._cssPixelsToCore(bottomRight));\n\t},\n\n\tpanInsideBounds: function (bounds, options) {\n\t\tvar center = this.getCenter(),\n\t\t    newCenter = this._limitCenter(center, this._zoom, bounds);\n\n\t\tif (center.equals(newCenter)) { return this; }\n\n\t\treturn this.panTo(newCenter, options);\n\t},\n\n\tinvalidateSize: function (options) {\n\t\tif (!this._loaded) { return this; }\n\n\t\toptions = L.extend({\n\t\t\tanimate: false,\n\t\t\tpan: false\n\t\t}, options === true ? {animate: true} : options);\n\n\t\tvar oldSize = this.getSize();\n\t\tthis._sizeChanged = true;\n\n\t\tvar newSize = this.getSize(),\n\t\t    oldCenter = oldSize.divideBy(2).round(),\n\t\t    newCenter = newSize.divideBy(2).round(),\n\t\t    offset = oldCenter.subtract(newCenter);\n\n\t\tif (!offset.x && !offset.y) { return this; }\n\n\t\tif (options.animate && options.pan) {\n\t\t\tthis.panBy(offset);\n\n\t\t} else {\n\t\t\tif (options.pan) {\n\t\t\t\tthis._rawPanBy(offset);\n\t\t\t}\n\n\t\t\tthis.fire('move');\n\n\t\t\tif (options.debounceMoveend) {\n\t\t\t\tclearTimeout(this._sizeTimer);\n\t\t\t\tthis._sizeTimer = setTimeout(L.bind(this.fire, this, 'moveend'), 200);\n\t\t\t} else {\n\t\t\t\tthis.fire('moveend');\n\t\t\t}\n\t\t}\n\n\t\treturn this.fire('resize', {\n\t\t\toldSize: oldSize,\n\t\t\tnewSize: newSize\n\t\t});\n\t},\n\n\tstop: function () {\n\t\tL.Util.cancelAnimFrame(this._flyToFrame);\n\t\tif (this._panAnim) {\n\t\t\tthis._panAnim.stop();\n\t\t}\n\t\treturn this;\n\t},\n\n\t// TODO handler.addTo\n\taddHandler: function (name, HandlerClass) {\n\t\tif (!HandlerClass) { return this; }\n\n\t\tvar handler = this[name] = new HandlerClass(this);\n\n\t\tthis._handlers.push(handler);\n\n\t\tif (this.options[name]) {\n\t\t\thandler.enable();\n\t\t}\n\n\t\t// Check for the special proof-of-concept case where no WOPI is involved but we\n\t\t// still run COOL in an iframe of its own and thus need to receive the\n\t\t// postMessage things.\n\t\tif (name === 'wopi' && this.options['notWopiButIframe']) {\n\t\t\thandler.addHooks();\n\t\t}\n\n\t\treturn this;\n\t},\n\n\tremove: function () {\n\n\t\tthis._initEvents(true);\n\n\t\ttry {\n\t\t\t// throws error in IE6-8\n\t\t\tdelete this._container._leaflet;\n\t\t} catch (e) {\n\t\t\tthis._container._leaflet = undefined;\n\t\t}\n\n\t\tL.DomUtil.remove(this._mapPane);\n\n\t\tif (this._clearControlPos) {\n\t\t\tthis._clearControlPos();\n\t\t}\n\n\t\tthis._clearHandlers();\n\n\t\tif (this._loaded) {\n\t\t\tthis.fire('unload');\n\t\t}\n\n\t\tif (this._docLayer) {\n\t\t\tthis.removeLayer(this._docLayer);\n\t\t}\n\t\tapp.socket.close();\n\t\treturn this;\n\t},\n\n\tcreatePane: function (name, container) {\n\t\tvar className = 'leaflet-pane' + (name ? ' leaflet-' + name.replace('Pane', '') + '-pane' : ''),\n\t\t    pane = L.DomUtil.create('div', className, container || this._mapPane);\n\n\t\tif (name) {\n\t\t\tthis._panes[name] = pane;\n\t\t}\n\t\treturn pane;\n\t},\n\n\n\t// public methods for getting map state\n\n\thasInfoForView: function(viewid)  {\n\t\treturn (viewid in this._viewInfo);\n\t},\n\n\tgetViewName: function(viewid) {\n\t\treturn this._viewInfo[viewid].username;\n\t},\n\n\tgetViewColor: function(viewid) {\n\t\treturn this._viewInfo[viewid].color;\n\t},\n\n\tisViewReadOnly: function(viewid) {\n\t\treturn this._viewInfo[viewid].readonly !== '0';\n\t},\n\n\tgetCenter: function () { // (Boolean) -> LatLng\n\t\tthis._checkIfLoaded();\n\t\treturn this.layerPointToLatLng(this._getCenterLayerPoint());\n\t},\n\n\tgetZoom: function () {\n\t\treturn this._zoom;\n\t},\n\n\tgetBounds: function () {\n\t\tvar bounds = this.getPixelBounds(),\n\t\t    sw = this.unproject(bounds.getBottomLeft()),\n\t\t    ne = this.unproject(bounds.getTopRight());\n\n\t\treturn new L.LatLngBounds(sw, ne);\n\t},\n\n\tgetMinZoom: function () {\n\t\treturn this.options.minZoom === undefined ? this._layersMinZoom || 0 : this.options.minZoom;\n\t},\n\n\tgetMaxZoom: function () {\n\t\treturn this.options.maxZoom === undefined ?\n\t\t\t(this._layersMaxZoom === undefined ? Infinity : this._layersMaxZoom) :\n\t\t\tthis.options.maxZoom;\n\t},\n\n\tgetLayerMaxBounds: function () {\n\t\treturn L.bounds(this.latLngToLayerPoint(this.options.maxBounds.getNorthWest()),\n\t\t\tthis.latLngToLayerPoint(this.options.maxBounds.getSouthEast()));\n\t},\n\n\tgetLayerDocBounds: function () {\n\t\treturn L.bounds(this.latLngToLayerPoint(this.options.docBounds.getNorthWest()),\n\t\t\tthis.latLngToLayerPoint(this.options.docBounds.getSouthEast()));\n\t},\n\n\tgetSize: function () {\n\t\tif (!this._size || this._sizeChanged) {\n\t\t\tthis._size = new L.Point(\n\t\t\t\tthis._container.clientWidth,\n\t\t\t\tthis._container.clientHeight);\n\n\t\t\tthis._sizeChanged = false;\n\t\t}\n\t\treturn this._size.clone();\n\t},\n\n\tgetPixelBounds: function (center, zoom) {\n\t\tvar topLeftPoint = this._getTopLeftPoint(center, zoom);\n\t\treturn new L.Bounds(topLeftPoint, topLeftPoint.add(this.getSize()));\n\t},\n\n\tgetPixelBoundsCore: function (center, zoom) {\n\t\tvar bounds = this.getPixelBounds(center, zoom);\n\t\tbounds.min = bounds.min.multiplyBy(app.dpiScale);\n\t\tbounds.max = bounds.max.multiplyBy(app.dpiScale);\n\t\treturn bounds;\n\t},\n\n\tgetPixelOrigin: function () {\n\t\tthis._checkIfLoaded();\n\t\treturn this._pixelOrigin;\n\t},\n\n\tgetPixelWorldBounds: function (zoom) {\n\t\treturn this.options.crs.getProjectedBounds(zoom === undefined ? this.getZoom() : zoom);\n\t},\n\n\tgetPane: function (pane) {\n\t\treturn typeof pane === 'string' ? this._panes[pane] : pane;\n\t},\n\n\tgetContainer: function () {\n\t\treturn this._container;\n\t},\n\n\t// We have one global winId that controls what window (dialog, sidebar, or\n\t// the main document) has the actual focus.  0 means the document.\n\tsetWinId: function (id) {\n\t\t// window.app.console.log('winId set to: ' + id);\n\t\tif (typeof id === 'string')\n\t\t\tid = parseInt(id);\n\t\tthis._winId = id;\n\t},\n\n\t// Getter for the winId, see setWinId() for more.\n\tgetWinId: function () {\n\t\treturn this._winId;\n\t},\n\n\t// Returns true iff the document has input focus,\n\t// as opposed to a dialog, sidebar, formula bar, etc.\n\teditorHasFocus: function () {\n\t\treturn this.getWinId() === 0;\n\t},\n\n\t// Returns true iff the formula-bar has the focus.\n\tcalcInputBarHasFocus: function () {\n\t\treturn !this.editorHasFocus() && this.formulabar.hasFocus();\n\t},\n\n\t// TODO replace with universal implementation after refactoring projections\n\n\tgetZoomScale: function (toZoom, fromZoom) {\n\t\tvar crs = this.options.crs;\n\t\tfromZoom = fromZoom === undefined ? this.getZoom() : fromZoom;\n\t\treturn crs.scale(toZoom) / crs.scale(fromZoom);\n\t},\n\n\tgetScaleZoom: function (scale, fromZoom) {\n\t\tfromZoom = fromZoom === undefined ? this.getZoom() : fromZoom;\n\t\treturn fromZoom + (Math.log(scale) / Math.log(1.2));\n\t},\n\n\n\t// conversion methods\n\n\tproject: function (latlng, zoom) { // (LatLng[, Number]) -> Point\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\n\t\tvar projectedPoint = this.options.crs.latLngToPoint(L.latLng(latlng), zoom);\n\t\treturn new L.Point(L.round(projectedPoint.x, 1e-6), L.round(projectedPoint.y, 1e-6));\n\t},\n\n\tunproject: function (point, zoom) { // (Point[, Number]) -> LatLng\n\t\tzoom = zoom === undefined ? this.getZoom() : zoom;\n\t\treturn this.options.crs.pointToLatLng(L.point(point), zoom);\n\t},\n\n\t/**\n\t * Get LatLng coordinates after negating the X cartesian-coordinate.\n\t * This is useful in Calc RTL mode as mouse events have regular document\n\t * coordinates(latlng) but draw-objects(shapes) have negative document\n\t * X coordinates.\n\t */\n\tnegateLatLng: function (latlng, zoom) { // (LatLng[, Number]) -> LatLng\n\t\tvar docPos = this.project(latlng, zoom);\n\t\tdocPos.x = -docPos.x;\n\t\treturn this.unproject(docPos, zoom);\n\t},\n\n\tlayerPointToLatLng: function (point) { // (Point)\n\t\tvar projectedPoint = L.point(point).add(this.getPixelOrigin());\n\t\treturn this.unproject(projectedPoint);\n\t},\n\n\tlatLngToLayerPoint: function (latlng) { // (LatLng)\n\t\tvar projectedPoint = this.project(L.latLng(latlng))._round();\n\t\treturn projectedPoint._subtract(this.getPixelOrigin());\n\t},\n\n\twrapLatLng: function (latlng) {\n\t\treturn this.options.crs.wrapLatLng(L.latLng(latlng));\n\t},\n\n\tdistance: function (latlng1, latlng2) {\n\t\treturn this.options.crs.distance(L.latLng(latlng1), L.latLng(latlng2));\n\t},\n\n\tcontainerPointToLayerPoint: function (point) { // (Point)\n\t\tvar splitPanesContext = this.getSplitPanesContext();\n\t\tif (!splitPanesContext) {\n\t\t\treturn this.containerPointToLayerPointIgnoreSplits(point);\n\t\t}\n\t\tvar splitPos = splitPanesContext.getSplitPos();\n\t\tvar pixelOrigin = this.getPixelOrigin();\n\t\tvar mapPanePos = this._getMapPanePos();\n\t\tvar result = L.point(point).clone();\n\t\tvar pointX = point.x;\n\t\tif (this._docLayer.isCalcRTL && this._docLayer.isCalcRTL()) {\n\t\t\tpointX = this._container.clientWidth - pointX;\n\t\t\tresult.x = pointX;\n\t\t}\n\n\t\tif (pointX <= splitPos.x) {\n\t\t\tresult.x -= pixelOrigin.x;\n\t\t}\n\t\telse {\n\t\t\tresult.x -= mapPanePos.x;\n\t\t}\n\n\t\tif (point.y <= splitPos.y) {\n\t\t\tresult.y -= pixelOrigin.y;\n\t\t}\n\t\telse {\n\t\t\tresult.y -= mapPanePos.y;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tcontainerPointToLayerPointIgnoreSplits: function (point) { // (Point)\n\t\treturn L.point(point).subtract(this._getMapPanePos());\n\t},\n\n\tlayerPointToContainerPoint: function (point) { // (Point)\n\t\tvar splitPanesContext = this.getSplitPanesContext();\n\t\tif (!splitPanesContext) {\n\t\t\treturn this.layerPointToContainerPointIgnoreSplits(point);\n\t\t}\n\n\t\tvar splitPos = splitPanesContext.getSplitPos();\n\t\tvar pixelOrigin = this.getPixelOrigin();\n\t\tvar mapPanePos = this._getMapPanePos();\n\t\tvar result = L.point(point).add(pixelOrigin);\n\n\t\tif (result.x > splitPos.x) {\n\t\t\tresult.x -= (pixelOrigin.x - mapPanePos.x);\n\t\t}\n\n\t\tif (result.y > splitPos.y) {\n\t\t\tresult.y -= (pixelOrigin.y - mapPanePos.y);\n\t\t}\n\n\t\treturn result;\n\t},\n\n\tlayerPointToContainerPointIgnoreSplits: function (point) { // (Point)\n\t\treturn L.point(point).add(this._getMapPanePos());\n\t},\n\n\tcontainerPointToLatLngIgnoreSplits: function (point) {\n\t\tvar layerPoint = this.containerPointToLayerPointIgnoreSplits(L.point(point));\n\t\treturn this.layerPointToLatLng(layerPoint);\n\t},\n\n\tlatLngToContainerPointIgnoreSplits: function (latlng) {\n\t\treturn this.layerPointToContainerPointIgnoreSplits(this.latLngToLayerPoint(L.latLng(latlng)));\n\t},\n\n\tlatLngToContainerPoint: function (latlng) {\n\t\treturn this.layerPointToContainerPoint(this.latLngToLayerPoint(L.latLng(latlng)));\n\t},\n\n\tmouseEventToContainerPoint: function (e) { // (MouseEvent)\n\t\treturn L.DomEvent.getMousePosition(e, this._container);\n\t},\n\n\tmouseEventToLayerPoint: function (e) { // (MouseEvent)\n\t\treturn this.containerPointToLayerPoint(this.mouseEventToContainerPoint(e));\n\t},\n\n\tmouseEventToLatLng: function (e) { // (MouseEvent)\n\t\treturn this.layerPointToLatLng(this.mouseEventToLayerPoint(e));\n\t},\n\n\t// Give the focus to the text input.\n\t// @acceptInput (only on \"mobile\" (= mobile phone) or on iOS and Android in general) true if we want to\n\t// accept key input, and show the virtual keyboard.\n\tfocus: function (acceptInput) {\n\t\tthis._textInput.focus(acceptInput);\n\t},\n\n\t// just set the keyboard state for mobile\n\t// we dont want to change the focus, we know that keyboard is closed\n\t// and we are just setting the state here\n\tsetAcceptInput: function (acceptInput) {\n\t\tthis._textInput._setAcceptInput(acceptInput);\n\t},\n\n\t// Lose focus to stop accepting keyboard input.\n\t// On mobile, it will hide the virtual keyboard.\n\tblur: function () {\n\t\tthis._textInput.blur();\n\t},\n\n\thasFocus: function () {\n\t\treturn document.activeElement === this._textInput.activeElement();\n\t},\n\n\t// Returns true iff the textarea is enabled and we focused on it.\n\t// On mobile, this signifies that the keyboard should be visible.\n\tcanAcceptKeyboardInput: function() {\n\t\treturn this._textInput.canAcceptKeyboardInput();\n\t},\n\n\tisSearching: function() {\n\t\treturn this._isSearching;\n\t},\n\n\t_fireInitComplete: function (condition) {\n\t\tif (this.initComplete) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.initConditions[condition] = true;\n\t\tfor (var key in this.initConditions) {\n\t\t\tif (!this.initConditions[key]) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tthis.fire('statusindicator', {statusType: 'initializationcomplete'});\n\t\tthis.initComplete = true;\n\t},\n\n\t_initContainer: function (id) {\n\t\tvar container = this._container = L.DomUtil.get(id);\n\n\t\tif (!container) {\n\t\t\tthrow new Error('Map container not found.');\n\t\t} else if (container._leaflet) {\n\t\t\tthrow new Error('Map container is already initialized.');\n\t\t}\n\n\t\tif (window.mode.isDesktop()) {\n\t\t\tthis._resizeDetector = L.DomUtil.create('iframe', 'resize-detector', container);\n\t\t\tthis._resizeDetector.title = 'Intentionally blank';\n\t\t\tthis._resizeDetector.setAttribute('aria-hidden', 'true');\n\t\t\tthis._resizeDetector.contentWindow.addEventListener('touchstart', L.DomEvent.preventDefault, {passive: false});\n\t\t\tL.DomEvent.on(this._resizeDetector.contentWindow, 'contextmenu', L.DomEvent.preventDefault);\n\t\t}\n\n\t\tthis._fileDownloader = L.DomUtil.create('iframe', '', container);\n\t\tL.DomUtil.setStyle(this._fileDownloader, 'display', 'none');\n\n\t\tL.DomEvent.on(this._fileDownloader.contentWindow, 'contextmenu', L.DomEvent.preventDefault);\n\t\tL.DomEvent.addListener(container, 'scroll', this._onScroll, this);\n\t\tcontainer._leaflet = true;\n\t},\n\n\t_onScroll: function() {\n\t\tthis._container.scrollTop = 0;\n\t\tthis._container.scrollLeft = 0;\n\t},\n\n\t_initLayout: function () {\n\t\tvar container = this._container;\n\n\t\tthis._fadeAnimated = this.options.fadeAnimation && L.Browser.any3d;\n\n\t\tL.DomUtil.addClass(container, 'leaflet-container' +\n\t\t\t(L.Browser.touch ? ' leaflet-touch' : '') +\n\t\t\t(L.Browser.retina ? ' leaflet-retina' : '') +\n\t\t\t(L.Browser.ielt9 ? ' leaflet-oldie' : '') +\n\t\t\t(L.Browser.safari ? ' leaflet-safari' : '') +\n\t\t\t(this._fadeAnimated ? ' leaflet-fade-anim' : ''));\n\n\t\tvar position = L.DomUtil.getStyle(container, 'position');\n\n\t\tif (position !== 'absolute' && position !== 'relative' && position !== 'fixed') {\n\t\t\tcontainer.style.position = 'absolute';\n\t\t}\n\n\t\tthis._initPanes();\n\n\t\tif (this._initControlPos) {\n\t\t\tthis._initControlPos();\n\t\t}\n\t},\n\n\t_initPanes: function () {\n\t\tvar panes = this._panes = {};\n\t\tthis._paneRenderers = {};\n\n\t\tthis._mapPane = this.createPane('mapPane', this._container);\n\n\t\tthis.createPane('tilePane');\n\t\tthis.createPane('shadowPane');\n\t\tthis.createPane('overlayPane');\n\t\tthis.createPane('markerPane');\n\t\tthis.createPane('popupPane');\n\t\tthis.createPane('formfieldPane');\n\n\t\tif (!this.options.markerZoomAnimation) {\n\t\t\tL.DomUtil.addClass(panes.markerPane, 'leaflet-zoom-hide');\n\t\t\tL.DomUtil.addClass(panes.shadowPane, 'leaflet-zoom-hide');\n\t\t}\n\t},\n\n\n\t// private methods that modify map state\n\n\t_resetView: function (center, zoom, preserveMapOffset, afterZoomAnim) {\n\n\t\tvar zoomChanged = (this._zoom !== zoom);\n\n\t\tif (!afterZoomAnim) {\n\t\t\tthis.fire('movestart');\n\n\t\t\tif (zoomChanged) {\n\t\t\t\tthis.fire('zoomstart');\n\t\t\t}\n\t\t}\n\n\t\tthis._zoom = zoom;\n\n\t\tif (!preserveMapOffset) {\n\t\t\tL.DomUtil.setPosition(this._mapPane, new L.Point(0, 0));\n\t\t}\n\n\t\tthis._pixelOrigin = this._getNewPixelOrigin(center);\n\n\t\tvar loading = !this._loaded;\n\t\tthis._loaded = true;\n\n\t\tthis.fire('viewreset', {hard: !preserveMapOffset});\n\n\t\tif (loading) {\n\t\t\tthis.fire('load');\n\t\t}\n\n\t\tthis.fire('move');\n\n\t\tif (zoomChanged || afterZoomAnim) {\n\t\t\tthis.fire('zoomend');\n\t\t\tthis.fire('zoomlevelschange');\n\t\t}\n\n\t\tthis.fire('moveend', {hard: !preserveMapOffset});\n\t},\n\n\t_rawPanBy: function (offset) {\n\t\tL.DomUtil.setPosition(this._mapPane, this._getMapPanePos().subtract(offset));\n\t},\n\n\t_getZoomSpan: function () {\n\t\treturn this.getMaxZoom() - this.getMinZoom();\n\t},\n\n\t_checkIfLoaded: function () {\n\t\tif (!this._loaded) {\n\t\t\tthrow new Error('Set map center and zoom first.');\n\t\t}\n\t},\n\n\t// DOM event handling\n\t_mainEvents: function (onOff) {\n\t\tL.DomEvent[onOff](this._container, 'click dblclick mousedown mouseup ' +\n\t\t\t'mouseover mouseout mousemove dragover drop ' +\n\t\t\t'trplclick qdrplclick', this._handleDOMEvent, this);\n\t},\n\n\t_initEvents: function (remove) {\n\t\tif (!L.DomEvent) { return; }\n\n\t\tthis._targets = {};\n\n\t\tthis._mouseOut = false;\n\n\t\tvar onOff = remove ? 'off' : 'on';\n\n\t\tthis._mainEvents(onOff);\n\n\t\tif (this.options.trackResize) {\n\t\t\tvar winTarget = this._resizeDetector && this._resizeDetector.contentWindow ? this._resizeDetector.contentWindow :\n\t\t\t\twindow;\n\t\t\tL.DomEvent[onOff](winTarget, 'resize', this._onResize, this);\n\t\t}\n\n\t\tL.DomEvent[onOff](window, 'blur', this._onLostFocus, this);\n\t\tL.DomEvent[onOff](window, 'focus', this._onGotFocus, this);\n\t},\n\n\t_onResize: function () {\n\t\tL.Util.cancelAnimFrame(this._resizeRequest);\n\t\tthis._resizeRequest = L.Util.requestAnimFrame(\n\t\t\tfunction () { this.invalidateSize({debounceMoveend: true}); }, this, false, this._container);\n\n\t\tif (this.sidebar)\n\t\t\tthis.sidebar.onResize();\n\n\t\tthis.showCalcInputBar();\n\t},\n\n\tshowCalcInputBar: function() {\n\t\tvar wrapper = document.getElementById('calc-inputbar-wrapper');\n\t\tif (wrapper)\n\t\t\twrapper.style.display = 'block';\n\t},\n\n\tmakeActive: function() {\n\t\t// window.app.console.log('Force active');\n\t\tthis.lastActiveTime = Date.now();\n\t\treturn this._activate();\n\t},\n\n\t_activate: function () {\n\t\tif (this._serverRecycling || this._documentIdle) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// window.app.console.debug('_activate:');\n\t\tclearTimeout(vex.timer);\n\n\t\tif (!this._active) {\n\t\t\t// Only activate when we are connected.\n\t\t\tif (app.socket.connected()) {\n\t\t\t\t// window.app.console.debug('sending useractive');\n\t\t\t\tapp.socket.sendMessage('useractive');\n\t\t\t\tthis._active = true;\n\t\t\t\tvar docLayer = this._docLayer;\n\t\t\t\tif (docLayer.isCalc && docLayer.isCalc() && docLayer.options.sheetGeometryDataEnabled) {\n\t\t\t\t\tdocLayer.requestSheetGeometryData();\n\t\t\t\t}\n\t\t\t\tapp.socket.sendMessage('commandvalues command=.uno:ViewAnnotations');\n\n\t\t\t\tif (isAnyVexDialogActive()) {\n\t\t\t\t\tfor (var vexId in vex.getAll()) {\n\t\t\t\t\t\tvar opts = vex.getById(vexId).options;\n\t\t\t\t\t\tif (!opts.overlayClosesOnClick || !opts.escapeButtonCloses) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._startInactiveTimer();\n\t\t\t\t\tif (window.mode.isDesktop()) {\n\t\t\t\t\t\tthis.focus();\n\t\t\t\t\t}\n\t\t\t\t\treturn vex.closeAll();\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.loadDocument();\n\t\t\t}\n\t\t}\n\n\t\tthis._startInactiveTimer();\n\t\tif (window.mode.isDesktop() && !isAnyVexDialogActive()) {\n\t\t\tthis.focus();\n\t\t}\n\t\treturn false;\n\t},\n\n\tdocumentHidden: function(unknownValue) {\n\t\tvar hidden = unknownValue;\n\t\tif (typeof document.hidden !== 'undefined') {\n\t\t\thidden = document.hidden;\n\t\t} else if (typeof document.msHidden !== 'undefined') {\n\t\t\thidden = document.msHidden;\n\t\t} else if (typeof document.webkitHidden !== 'undefined') {\n\t\t\thidden = document.webkitHidden;\n\t\t} else {\n\t\t\twindow.app.console.debug('Unusual browser, cant determine if hidden');\n\t\t}\n\t\treturn hidden;\n\t},\n\n\t_dim: function() {\n\t\tif (this.options.alwaysActive || this._debugAlwaysActive === true) {\n\t\t\treturn;\n\t\t}\n\n\t\t// window.app.console.debug('_dim:');\n\t\tif (!app.socket.connected() || isAnyVexDialogActive()) {\n\t\t\treturn;\n\t\t}\n\n\t\tclearTimeout(vex.timer);\n\n\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\twindow.postMobileMessage('DIM_SCREEN');\n\t\t\treturn;\n\t\t}\n\n\t\tvar map = this;\n\t\tvar inactiveMs = Date.now() - this.lastActiveTime;\n\t\tvar multiplier = 1;\n\t\tif (!this.documentHidden(true))\n\t\t{\n\t\t\t// window.app.console.debug('document visible');\n\t\t\tmultiplier = 4; // quadruple the grace period\n\t\t}\n\t\tif (inactiveMs <= this.options.outOfFocusTimeoutSecs * 1000 * multiplier) {\n\t\t\t// window.app.console.debug('had activity ' + inactiveMs + 'ms ago vs. threshold ' +\n\t\t\t//\t      (this.options.outOfFocusTimeoutSecs * 1000 * multiplier) +\n\t\t\t//\t      ' - so fending off the dim');\n\t\t\tvex.timer = setTimeout(function() {\n\t\t\t\tmap._dim();\n\t\t\t}, map.options.outOfFocusTimeoutSecs * 1000);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._active = false;\n\n\t\tvar message = '';\n\t\tif (!map['wopi'].DisableInactiveMessages) {\n\t\t\tmessage = '<h3 class=\"title\">' + vex._escapeHtml(_('Inactive document')) + '</h3>';\n\t\t\tmessage += '<p class=\"content\">' + vex._escapeHtml(_('Please click to resume editing')) + '</p>';\n\t\t}\n\n\t\tvex.open({\n\t\t\tunsafeContent: message,\n\t\t\tcontentClassName: 'cool-user-idle',\n\t\t\tafterOpen: function() {\n\t\t\t\tvar $vexContent = $(this.contentEl);\n\t\t\t\t$vexContent.bind('click.vex', function() {\n\t\t\t\t\t// window.app.console.debug('_dim: click.vex function');\n\t\t\t\t\treturn map._activate();\n\t\t\t\t});\n\t\t\t},\n\t\t\tshowCloseButton: false\n\t\t});\n\n\t\t$('.vex-overlay').addClass('cool-user-idle-overlay');\n\t\tif (message === '')\n\t\t\t$('.cool-user-idle').css('display', 'none');\n\n\t\tthis._doclayer && this._docLayer._onMessage('textselection:', null);\n\t\t// window.app.console.debug('_dim: sending userinactive');\n\t\tmap.fire('postMessage', {msgId: 'User_Idle'});\n\t\tapp.socket.sendMessage('userinactive');\n\t},\n\n\tnotifyActive : function() {\n\t\tthis.lastActiveTime = Date.now();\n\t\tif (window.ThisIsTheAndroidApp) {\n\t\t\twindow.postMobileMessage('LIGHT_SCREEN');\n\t\t}\n\t},\n\n\t_dimIfInactive: function () {\n\t\t// window.app.console.debug('_dimIfInactive: diff=' + (Date.now() - this.lastActiveTime));\n\t\tif (this._docLoaded && // don't dim if document hasn't been loaded yet\n\t\t    (Date.now() - this.lastActiveTime) >= this.options.idleTimeoutSecs * 1000) {\n\t\t\tthis._dim();\n\t\t} else {\n\t\t\tthis._startInactiveTimer();\n\t\t}\n\t},\n\n\t_startInactiveTimer: function () {\n\t\tif (this._serverRecycling || this._documentIdle || !this._docLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\t// window.app.console.debug('_startInactiveTimer:');\n\t\tclearTimeout(vex.timer);\n\t\tvar map = this;\n\t\tvex.timer = setTimeout(function() {\n\t\t\tmap._dimIfInactive();\n\t\t}, 1 * 60 * 1000); // Check once a minute\n\t},\n\n\t_deactivate: function () {\n\t\tif (this._serverRecycling || this._documentIdle || !this._docLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\t// window.app.console.debug('_deactivate:');\n\t\tclearTimeout(vex.timer);\n\n\t\tif (!this._active || isAnyVexDialogActive()) {\n\t\t\t// A dialog is already dimming the screen and probably\n\t\t\t// shows an error message. Leave it alone.\n\t\t\tthis._active = false;\n\t\t\tthis._docLayer && this._docLayer._onMessage('textselection:', null);\n\t\t\tif (app.socket.connected()) {\n\t\t\t\t// window.app.console.debug('_deactivate: sending userinactive');\n\t\t\t\tapp.socket.sendMessage('userinactive');\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tvar map = this;\n\t\tvex.timer = setTimeout(function() {\n\t\t\tmap._dim();\n\t\t}, map.options.outOfFocusTimeoutSecs * 1000);\n\t},\n\n\t// Change the focus to a dialog or editor.\n\t// @dialog is the instance of the dialog class.\n\t// @winId is the ID of the dialog/sidebar, or 0 for the editor.\n\t// @acceptInput iff defined, map.focus is called and passed to it.\n\t_changeFocusWidget: function (dialog, winId, acceptInput) {\n\t\tif (!this._loaded) { return; }\n\n\t\tthis.setWinId(winId);\n\t\tthis._activeDialog = dialog;\n\t\tthis._isSearching = false;\n\n\t\tif (this.editorHasFocus()) {\n\t\t\t// The document has the focus.\n\t\t\tvar doclayer = this._docLayer;\n\t\t\tif (doclayer)\n\t\t\t\tdoclayer._updateCursorAndOverlay();\n\t\t} else if (acceptInput !== undefined) {\n\t\t\t// A dialog has the focus.\n\t\t\tthis.focus(acceptInput);\n\t\t\tthis._textInput.hideCursor(); // The cursor is in the dialog.\n\t\t}\n\t},\n\n\t// Our browser tab lost focus.\n\t_onLostFocus: function () {\n\t\tthis._deactivate();\n\t},\n\n\t// The editor got focus (probably a dialog closed or user clicked to edit).\n\t_onEditorGotFocus: function() {\n\t\tthis._changeFocusWidget(null, 0);\n\t\tif (this.formulabar)\n\t\t\tthis.onFormulaBarBlur();\n\t},\n\n\t// Our browser tab got focus.\n\t_onGotFocus: function () {\n\t\tif (this.editorHasFocus()) {\n\t\t\tthis.fire('editorgotfocus');\n\t\t}\n\t\telse if (this._activeDialog) {\n\t\t\tthis._activeDialog.focus(this.getWinId());\n\t\t}\n\n\t\tthis._activate();\n\t},\n\n\t// Event to change the focus to dialog or editor.\n\t_onChangeFocusWidget: function (e) {\n\t\tif (e.winId === 0) {\n\t\t\tthis._onEditorGotFocus();\n\t\t} else {\n\t\t\tthis._changeFocusWidget(e.dialog, e.winId, e.acceptInput);\n\t\t}\n\t},\n\n\t_onSearchStart: function () {\n\t\tthis._isSearching = true;\n\t},\n\n\t_onUpdateProgress: function (e) {\n\t\tif (e.statusType === 'start') {\n\t\t\tif (e.text) {\n\t\t\t\t// e.text translated by Core\n\t\t\t\tthis.showBusy(e.text);\n\t\t\t}\n\t\t}\n\t\telse if (e.statusType === 'setvalue') {\n\t\t\tthis._progressBar.setValue(e.value);\n\t\t}\n\t\telse if (e.statusType === 'finish' || e.statusType === 'coolloaded' || e.statusType === 'reconnected') {\n\t\t\tthis.hideBusy();\n\t\t}\n\t},\n\n\t_isMouseEnteringLeaving: function (e) {\n\t\tvar target = e.target || e.srcElement,\n\t\t    related = e.relatedTarget;\n\n\t\tif (!target) { return false; }\n\n\t\treturn (L.DomUtil.hasClass(target, 'leaflet-tile')\n\t\t\t&& !(related && (L.DomUtil.hasClass(related, 'leaflet-tile')\n\t\t\t\t|| L.DomUtil.hasClass(related, 'leaflet-cursor'))));\n\t},\n\n\t_handleDOMEvent: function (e) {\n\t\tthis.notifyActive();\n\n\t\tif (!this._docLayer || !this._loaded || !this._enabled || L.DomEvent._skipped(e)) { return; }\n\n\t\t// find the layer the event is propagating from\n\t\tvar target = this._targets[L.stamp(e.target || e.srcElement)],\n\t\t    //type = e.type === 'keypress' && e.keyCode === 13 ? 'click' : e.type;\n\t\t    type = e.type;\n\n\t\t// For touch devices, to pop-up the keyboard, it is required to call\n\t\t// .focus() method on hidden input within actual 'click' event here\n\t\t// Calling from some other place with no real 'click' event doesn't work.\n\n\t\tif (type === 'click' || type === 'dblclick') {\n\t\t\tif (this.isPermissionEdit()) {\n\t\t\t\tthis.fire('editorgotfocus');\n\t\t\t\tthis.focus();\n\t\t\t}\n\n\t\t\t// unselect if anything is selected already\n\t\t\tif (app.sectionContainer.doesSectionExist(L.CSections.CommentList.name)) {\n\t\t\t\tapp.sectionContainer.getSectionWithName(L.CSections.CommentList.name).unselect();\n\t\t\t}\n\t\t}\n\n\t\t// we need to keep track about the last action, this\n\t\t// will help us to avoid wrongly removing the editor\n\t\tif (type === 'keypress') {\n\t\t\tthis.lastActionByUser = true;\n\t\t}\n\n\t\t// we need to keep track if we have entered/left the map\n\t\tthis._mouseEnteringLeaving = false;\n\t\t// mouse leaving the map ?\n\t\tif (!target && !this._mouseOut && type === 'mouseout') {\n\t\t\tthis._mouseEnteringLeaving = this._isMouseEnteringLeaving(e);\n\t\t\tthis._mouseOut = this._mouseEnteringLeaving; // event type == mouseout\n\t\t}\n\t\t// mouse entering the map ?\n\t\tif (!target && this._mouseOut && type === 'mouseover') {\n\t\t\tthis._mouseEnteringLeaving = this._isMouseEnteringLeaving(e);\n\t\t\tthis._mouseOut = !this._mouseEnteringLeaving; // event type == mouseover\n\t\t}\n\n\t\t// special case for map mouseover/mouseout events so that they're actually mouseenter/mouseleave\n\t\tif (!target && !this._mouseEnteringLeaving && (type === 'mouseover' || type === 'mouseout') &&\n\t\t\t\t!L.DomEvent._checkMouse(this._container, e)) { return; }\n\n\t\t// prevents outline when clicking on keyboard-focusable element\n\t\tif (type === 'mousedown') {\n\t\t\tL.DomUtil.preventOutline(e.target || e.srcElement);\n\t\t\t// Prevents image dragging on Mozilla when map's dragging\n\t\t\t// option is set to false\n\t\t\te.preventDefault();\n\t\t}\n\n\t\t// workaround for drawing shapes, without this shapes cannot be shrunken\n\t\tif (target !== undefined && target._path !== undefined && type === 'mousemove') {\n\t\t\ttarget = undefined;\n\t\t}\n\t\tthis._fireDOMEvent(target || this, e, type);\n\t},\n\n\t_fireDOMEvent: function (target, e, type) {\n\t\tif (this.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (!target.listens(type, true) && (type !== 'click' || !target.listens('preclick', true))) { return; }\n\n\t\tif (type === 'contextmenu') {\n\t\t\tL.DomEvent.preventDefault(e);\n\t\t}\n\n\t\t// prevents firing click after you just dragged an object\n\t\tif (e.type === 'click' && !e._simulated && this._draggableMoved(target)) { return; }\n\n\t\tvar data = {\n\t\t\toriginalEvent: e\n\t\t};\n\t\tif (e.type !== 'keypress' && e.type !== 'keyup' && e.type !== 'keydown' &&\n\t\t\te.type !== 'copy' && e.type !== 'cut' && e.type !== 'paste' &&\n\t\t    e.type !== 'compositionstart' && e.type !== 'compositionupdate' && e.type !== 'compositionend' && e.type !== 'textInput') {\n\t\t\tdata.containerPoint = target instanceof L.Marker ?\n\t\t\t\tthis.latLngToContainerPoint(target.getLatLng()) : this.mouseEventToContainerPoint(e);\n\t\t\tdata.layerPoint = this.containerPointToLayerPoint(data.containerPoint);\n\t\t\tdata.latlng = this.layerPointToLatLng(data.layerPoint);\n\t\t}\n\t\tif (type === 'click') {\n\t\t\ttarget.fire('preclick', data, true);\n\t\t}\n\t\ttarget.fire(type, data, true);\n\t},\n\n\t_draggableMoved: function (obj) {\n\t\tobj = obj.options.draggable ? obj : this;\n\t\treturn (obj.dragging && obj.dragging.moved()) || (this.boxZoom && this.boxZoom.moved());\n\t},\n\n\t_clearHandlers: function () {\n\t\tfor (var i = 0, len = this._handlers.length; i < len; i++) {\n\t\t\tthis._handlers[i].disable();\n\t\t}\n\t},\n\n\twhenReady: function (callback, context) {\n\t\tif (this._loaded) {\n\t\t\tcallback.call(context || this, {target: this});\n\t\t} else {\n\t\t\tthis.on('load', callback, context);\n\t\t}\n\t\treturn this;\n\t},\n\n\n\t// private methods for getting map state\n\n\t_getMapPanePos: function () {\n\t\treturn L.DomUtil.getPosition(this._mapPane) || new L.Point(0, 0);\n\t},\n\n\t_moved: function () {\n\t\tvar pos = this._getMapPanePos();\n\t\treturn pos && !pos.equals([0, 0]);\n\t},\n\n\t_getTopLeftPoint: function (center, zoom) {\n\t\tvar pixelOrigin = center && zoom !== undefined ?\n\t\t\tthis._getNewPixelOrigin(center, zoom) :\n\t\t\tthis.getPixelOrigin();\n\n\t\treturn pixelOrigin.subtract(this._getMapPanePos());\n\t},\n\n\t_getNewPixelOrigin: function (center, zoom) {\n\t\tvar viewHalf = this.getSize()._divideBy(2);\n\t\treturn this.project(center, zoom)._subtract(viewHalf)._add(this._getMapPanePos())._floor();\n\t},\n\n\t// layer point of the current center\n\t_getCenterLayerPoint: function () {\n\t\treturn this.containerPointToLayerPointIgnoreSplits(this.getSize()._divideBy(2));\n\t},\n\n\t// offset of the specified place to the current center in pixels\n\t_getCenterOffset: function (latlng) {\n\t\treturn this.latLngToLayerPoint(latlng).subtract(this._getCenterLayerPoint());\n\t},\n\n\t// adjust center for view to get inside bounds\n\t_limitCenter: function (center, zoom, bounds) {\n\n\t\tif (!bounds) { return center; }\n\n\t\tvar centerPoint = this.project(center, zoom),\n\t\t    viewHalf = this.getSize().divideBy(2),\n\t\t    viewBounds = new L.Bounds(centerPoint.subtract(viewHalf), centerPoint.add(viewHalf)),\n\t\t    offset = this._getBoundsOffset(viewBounds, bounds, zoom);\n\n\t\treturn this.unproject(centerPoint.add(offset), zoom);\n\t},\n\n\t// returns offset needed for pxBounds to get inside maxBounds at a specified zoom\n\t_getBoundsOffset: function (pxBounds, maxBounds, zoom) {\n\t\tvar nwOffset = this.project(maxBounds.getNorthWest(), zoom).subtract(pxBounds.min),\n\t\t    seOffset = this.project(maxBounds.getSouthEast(), zoom).subtract(pxBounds.max),\n\n\t\t    dx = this._rebound(nwOffset.x, -seOffset.x),\n\t\t    dy = this._rebound(nwOffset.y, -seOffset.y);\n\n\t\treturn new L.Point(dx, dy);\n\t},\n\n\t_rebound: function (left, right) {\n\t\treturn left + right > 0 ?\n\t\t\tMath.round(left - right) / 2 :\n\t\t\tMath.max(0, Math.ceil(left)) - Math.max(0, Math.floor(right));\n\t\t// TODO: do we really need ceil and floor ?\n\t\t// for spreadsheets it can cause one pixel alignment offset btw grid and row/column header\n\t\t// and a one pixel horizontal auto-scrolling issue;\n\t\t// both issues have been fixed by rounding the projection: see Map.project above;\n\t\t// anyway in case of similar problems, this code needs to be checked\n\t},\n\n\t_limitZoom: function (zoom) {\n\t\tvar min = this.getMinZoom(),\n\t\t    max = this.getMaxZoom();\n\n\t\treturn Math.max(min, Math.min(max, zoom));\n\t},\n\n\t_goToViewId: function(id) {\n\t\tif (id === -1)\n\t\t\treturn;\n\n\t\tif (this.getDocType() === 'spreadsheet') {\n\t\t\tthis._docLayer.goToCellViewCursor(id);\n\t\t} else if (this.getDocType() === 'text' || this.getDocType() === 'presentation') {\n\t\t\tthis._docLayer.goToViewCursor(id);\n\t\t}\n\t},\n\n\t_setFollowing: function(followingState, viewId) {\n\t\tvar userDefined = viewId !== null && viewId !== undefined;\n\t\tvar followDefined = followingState !== null && followingState !== undefined;\n\n\t\tvar followEditor = true;\n\t\tvar followUser = false;\n\n\t\tif (userDefined && viewId !== -1 && viewId !== this._docLayer.viewId) {\n\t\t\tfollowUser = true;\n\t\t\tfollowEditor = false;\n\t\t}\n\n\t\tif (followDefined && followingState === false) {\n\t\t\tfollowEditor = false;\n\t\t\tfollowUser = false;\n\t\t}\n\n\t\tthis._docLayer._followUser = followUser;\n\t\tthis._docLayer._followEditor = followEditor;\n\n\t\tif (followUser) {\n\t\t\tthis._goToViewId(viewId);\n\t\t\tthis._docLayer._followThis = viewId;\n\t\t}\n\t\telse if (followEditor) {\n\t\t\tvar editorId = this._docLayer._editorId;\n\t\t\tif (editorId !== -1 && editorId !== this._docLayer.viewId) {\n\t\t\t\tthis._goToViewId(editorId);\n\t\t\t\tthis._docLayer._followThis = editorId;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.fire('deselectuser', {viewId: this._docLayer._followThis});\n\t\t\tthis._docLayer._followThis = -1;\n\t\t}\n\n\t\t// Notify about changes\n\t\tthis.fire('postMessage', {msgId: 'FollowUser_Changed',\n\t\t\targs: {FollowedViewId: this._docLayer._followThis,\n\t\t\t\tIsFollowUser: followUser,\n\t\t\t\tIsFollowEditor: followEditor}});\n\t},\n\n\thasObjectFocusDarkOverlay: function() {\n\t\treturn !!this.focusLayer;\n\t},\n\n\taddObjectFocusDarkOverlay: function(xTwips, yTwips, wTwips, hTwips) {\n\t\tif (!this.hasObjectFocusDarkOverlay()) {\n\t\t\tthis.focusLayer = new L.ObjectFocusDarkOverlay().addTo(this);\n\t\t\tthis.focusLayer.show({x: xTwips, y: yTwips, w: wTwips, h: hTwips});\n\t\t}\n\t},\n\n\tremoveObjectFocusDarkOverlay: function() {\n\t\tif (this.hasObjectFocusDarkOverlay()) {\n\t\t\tthis.removeLayer(this.focusLayer);\n\t\t\tthis.focusLayer = null;\n\t\t}\n\t},\n\n\tgetSplitPanesContext: function () {\n\t\tvar docLayer = this._docLayer;\n\t\tif (docLayer) {\n\t\t\treturn docLayer.getSplitPanesContext();\n\t\t}\n\n\t\treturn undefined;\n\t},\n\n\t_setPaneOpacity: function(paneClassString, opacity) {\n\t\tvar panes = document.getElementsByClassName(paneClassString);\n\t\tif (panes.length)\n\t\t\tpanes[0].style.opacity = opacity;\n\t},\n\n\tsetOverlaysOpacity: function(opacity) {\n\t\tthis._setPaneOpacity('leaflet-pane leaflet-overlay-pane', opacity);\n\t},\n\n\tsetMarkersOpacity: function(opacity) {\n\t\tthis._setPaneOpacity('leaflet-pane leaflet-marker-pane', opacity);\n\t},\n\n\tgetTileSectionMgr: function() {\n\t\tif (this._docLayer)\n\t\t\treturn this._docLayer._painter;\n\t\treturn undefined;\n\t},\n\n\tgetCursorOverlayContainer: function() {\n\t\tif (this._docLayer)\n\t\t\treturn this._docLayer._cursorOverlayDiv;\n\t\treturn undefined;\n\t}\n});\n\nL.map = function (id, options) {\n\treturn new L.Map(id, options);\n};\n"]}
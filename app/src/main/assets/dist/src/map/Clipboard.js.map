{"version":3,"file":"Clipboard.js","sourceRoot":"","sources":["../../../../../../../../browser/src/map/Clipboard.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Clipboard is used to abstract our storage and management of\n * local & remote clipboard data.\n */\n/* global app _ vex brandProductName isAnyVexDialogActive $ */\n\n// Get all interesting clipboard related events here, and handle\n// download logic in one place ...\n// We keep track of the current selection content if it is simple\n// So we can do synchronous copy/paste in the callback if possible.\nL.Clipboard = L.Class.extend({\n\tinitialize: function(map) {\n\t\tthis._map = map;\n\t\tthis._selectionContent = '';\n\t\tthis._selectionType = null;\n\t\tthis._accessKey = [ '', '' ];\n\t\tthis._clipboardSerial = 0; // incremented on each operation\n\t\tthis._failedTimer = null;\n\t\tthis._dummyDivName = 'copy-paste-container';\n\t\tthis._unoCommandForCopyCutPaste = null;\n\n\t\tvar div = document.createElement('div');\n\t\tthis._dummyDiv = div;\n\n\t\tdiv.setAttribute('id', this._dummyDivName);\n\t\tdiv.setAttribute('style', 'user-select: text !important');\n\t\tdiv.style.opacity = '0';\n\t\tdiv.setAttribute('contenteditable', 'true');\n\t\tdiv.setAttribute('type', 'text');\n\t\tdiv.setAttribute('style', 'position: fixed; left: 0px; top: -200px; width: 15000px; height: 200px; ' +\n\t\t\t\t 'overflow: hidden; z-index: -1000, -webkit-user-select: text !important; display: block; ' +\n\t\t\t\t 'font-size: 6pt\">');\n\n\t\t// so we get events to where we want them.\n\t\tvar parent = document.getElementById('map');\n\t\tparent.appendChild(div);\n\n\t\t// sensible default content.\n\t\tthis._resetDiv();\n\n\t\tvar that = this;\n\t\tvar beforeSelect = function(ev) { return that._beforeSelect(ev); };\n\n\t\tdocument.oncut = function(ev)   { return that.cut(ev); };\n\t\tdocument.oncopy = function(ev)  { return that.copy(ev); };\n\t\tdocument.onpaste = function(ev) { return that.paste(ev); };\n\t\tdocument.onbeforecut = beforeSelect;\n\t\tdocument.onbeforecopy = beforeSelect;\n\t\tdocument.onbeforepaste = beforeSelect;\n\t},\n\n\t// We can do a much better job when we fetch text/plain too.\n\tstripHTML: function(html) {\n\t\tvar tmp = document.createElement('div');\n\t\ttmp.innerHTML = html;\n\t\t// attempt to cleanup unwanted elements\n\t\tvar styles = tmp.querySelectorAll('style');\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tstyles[i].parentNode.removeChild(styles[i]);\n\t\t}\n\t\treturn tmp.textContent.trim() || tmp.innerText.trim() || '';\n\t},\n\n\tsetKey: function(key) {\n\t\tif (this._accessKey[0] === key)\n\t\t\treturn;\n\t\tthis._accessKey[1] = this._accessKey[0];\n\t\tthis._accessKey[0] = key;\n\t},\n\n\tgetMetaBase: function() {\n\t\treturn window.makeHttpUrl('');\n\t},\n\n\tgetMetaPath: function(idx) {\n\t\tif (!idx)\n\t\t\tidx = 0;\n\t\treturn '/cool/clipboard?WOPISrc=' + encodeURIComponent(this._map.options.doc) +\n\t\t\t'&ServerId=' + app.socket.WSDServer.Id +\n\t\t\t'&ViewId=' + this._map._docLayer._viewId +\n\t\t\t'&Tag=' + this._accessKey[idx];\n\t},\n\n\tgetMetaURL: function(idx) {\n\t\treturn this.getMetaBase() + this.getMetaPath(idx);\n\t},\n\n\t// Returns the marker used to identify stub messages.\n\t_getHtmlStubMarker: function() {\n\t\treturn '<title>Stub HTML Message</title>';\n\t},\n\n\t// Returns true if the argument is a stub html.\n\t_isStubHtml: function(text) {\n\t\treturn text.indexOf(this._getHtmlStubMarker()) > 0;\n\t},\n\n\t// wrap some content with our stub magic\n\t_originWrapBody: function(body, isStub) {\n\t\tvar encodedOrigin = encodeURIComponent(this.getMetaURL());\n\t\tvar text =  '<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 4.0 Transitional//EN\">\\n' +\n\t\t            '<html>\\n' +\n\t\t            '  <head>\\n';\n\t\tif (isStub)\n\t\t\ttext += '    ' + this._getHtmlStubMarker() + '\\n';\n\t\ttext +=     '    <meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\"/>\\n' +\n\t\t\t    '    <meta name=\"origin\" content=\"' + encodedOrigin + '\"/>\\n' +\n\t\t\t    '  </head>\\n'\n\t\t\t    + body +\n\t\t\t'</html>';\n\t\treturn text;\n\t},\n\n\t// what an empty clipboard has on it\n\t_getStubHtml: function() {\n\t\tvar lang = 'en_US'; // FIXME: l10n\n\t\treturn this._substProductName(this._originWrapBody(\n\t\t    '  <body lang=\"' + lang + '\" dir=\"ltr\">\\n' +\n\t\t    '    <p>' + _('To paste outside %productName, please first click the \\'download\\' button') + '</p>\\n' +\n\t\t    '  </body>\\n', true\n\t\t));\n\t},\n\n\t// used for DisableCopy mode to fill the clipboard\n\t_getDisabledCopyStubHtml: function() {\n\t\tvar lang = 'en_US'; // FIXME: l10n\n\t\treturn this._substProductName(this._originWrapBody(\n\t\t    '  <body lang=\"' + lang + '\" dir=\"ltr\">\\n' +\n\t\t    '    <p>' + _('Copying from the document disabled') + '</p>\\n' +\n\t\t    '  </body>\\n', true\n\t\t));\n\t},\n\n\t_getMetaOrigin: function (html) {\n\t\tvar match = '<meta name=\"origin\" content=\"';\n\t\tvar start = html.indexOf(match);\n\t\tif (start < 0) {\n\t\t\treturn '';\n\t\t}\n\t\tvar end = html.indexOf('\"', start + match.length);\n\t\tif (end < 0) {\n\t\t\treturn '';\n\t\t}\n\t\tvar meta = html.substring(start + match.length, end);\n\n\t\t// quick sanity checks that it one of ours.\n\t\tif (meta.indexOf('%2Fclipboard%3FWOPISrc%3D') >= 0 &&\n\t\t    meta.indexOf('%26ServerId%3D') > 0 &&\n\t\t    meta.indexOf('%26ViewId%3D') > 0 &&\n\t\t    meta.indexOf('%26Tag%3D') > 0)\n\t\t\treturn decodeURIComponent(meta);\n\t\telse\n\t\t\twindow.app.console.log('Mis-understood foreign origin: \"' + meta + '\"');\n\t\treturn '';\n\t},\n\n\t_encodeHtmlToBlob: function(text) {\n\t\tvar content = [];\n\t\tvar data = new Blob([text]);\n\t\tcontent.push('text/html\\n');\n\t\tcontent.push(data.size.toString(16) + '\\n');\n\t\tcontent.push(data);\n\t\tcontent.push('\\n');\n\t\treturn new Blob(content);\n\t},\n\n\t_readContentSyncToBlob: function(dataTransfer) {\n\t\tvar content = [];\n\t\tvar types = dataTransfer.types;\n\t\tfor (var t = 0; t < types.length; ++t) {\n\t\t\tif (types[t] === 'Files')\n\t\t\t\tcontinue; // images handled elsewhere.\n\t\t\tvar dataStr = dataTransfer.getData(types[t]);\n\t\t\t// Avoid types that has no content.\n\t\t\tif (!dataStr.length)\n\t\t\t\tcontinue;\n\t\t\tvar data = new Blob([dataStr]);\n\t\t\twindow.app.console.log('type ' + types[t] + ' length ' + data.size +\n\t\t\t\t    ' -> 0x' + data.size.toString(16) + '\\n');\n\t\t\tcontent.push((types[t] === 'text' ? 'text/plain' : types[t]) + '\\n');\n\t\t\tcontent.push(data.size.toString(16) + '\\n');\n\t\t\tcontent.push(data);\n\t\t\tcontent.push('\\n');\n\t\t}\n\t\tif (content.length > 0)\n\t\t\treturn new Blob(content, {type : 'application/octet-stream', endings: 'transparent'});\n\t\telse\n\t\t\treturn null;\n\t},\n\n\t// Abstract async post & download for our progress wrappers\n\t// type: GET or POST\n\t// url:  where to get / send the data\n\t// optionalFormData: used for POST for form data\n\t// forClipboard: a boolean telling if we need the \"Confirm copy to clipboard\" link in the end\n\t// completeFn: called on completion - with response.\n\t// progressFn: allows splitting the progress bar up.\n\t_doAsyncDownload: function(type,url,optionalFormData,forClipboard,completeFn,progressFn,onErrorFn) {\n\t\ttry {\n\t\t\tvar that = this;\n\t\t\tvar request = new XMLHttpRequest();\n\n\t\t\t// avoid to invoke the following code if the download widget depends on user interaction\n\t\t\tif (!that._downloadProgress || !that._downloadProgress.isVisible()) {\n\t\t\t\tthat._startProgress();\n\t\t\t\tthat._downloadProgress.startProgressMode();\n\t\t\t}\n\t\t\trequest.onload = function() {\n\t\t\t\tthat._downloadProgress._onComplete();\n\t\t\t\tif (!forClipboard) {\n\t\t\t\t\tthat._downloadProgress._onClose();\n\t\t\t\t}\n\n\t\t\t\t// For some reason 400 error from the server doesn't\n\t\t\t\t// invoke onerror callback, but we do get here with\n\t\t\t\t// size==0, which signifies no response from the server.\n\t\t\t\t// So we check the status code instead.\n\t\t\t\tif (this.status == 200) {\n\t\t\t\t\tcompleteFn(this.response);\n\t\t\t\t} else if (onErrorFn) {\n\t\t\t\t\tonErrorFn(this.response);\n\t\t\t\t}\n\t\t\t};\n\t\t\trequest.onerror = function() {\n\t\t\t\tif (onErrorFn)\n\t\t\t\t\tonErrorFn();\n\t\t\t\tthat._downloadProgress._onComplete();\n\t\t\t\tthat._downloadProgress._onClose();\n\t\t\t};\n\n\t\t\trequest.upload.addEventListener('progress', function (e) {\n\t\t\t\tif (e.lengthComputable) {\n\t\t\t\t\tvar percent = progressFn(e.loaded / e.total * 100);\n\t\t\t\t\tvar progress = { statusType: 'setvalue', value: percent };\n\t\t\t\t\tthat._downloadProgress._onUpdateProgress(progress);\n\t\t\t\t}\n\t\t\t}, false);\n\n\t\t\tif ('processCoolUrl' in window) {\n\t\t\t\turl = window.processCoolUrl({ url: url, type: 'clipboard' });\n\t\t\t}\n\n\t\t\trequest.open(type, url, true /* isAsync */);\n\t\t\trequest.timeout = 20 * 1000; // 20 secs ...\n\t\t\trequest.responseType = 'blob';\n\t\t\tif (optionalFormData !== null)\n\t\t\t\trequest.send(optionalFormData);\n\t\t\telse\n\t\t\t\trequest.send();\n\t\t} catch (error) {\n\t\t\tif (onErrorFn)\n\t\t\t\tonErrorFn();\n\t\t}\n\t},\n\n\t// Suck the data from one server to another asynchronously ...\n\t_dataTransferDownloadAndPasteAsync: function(src, dest, fallbackHtml) {\n\t\tvar that = this;\n\t\t// FIXME: add a timestamp in the links (?) ignore old / un-responsive servers (?)\n\t\tthat._doAsyncDownload(\n\t\t\t'GET', src, null, false,\n\t\t\tfunction(response) {\n\t\t\t\twindow.app.console.log('download done - response ' + response);\n\t\t\t\tvar formData = new FormData();\n\t\t\t\tformData.append('data', response, 'clipboard');\n\t\t\t\tthat._doAsyncDownload(\n\t\t\t\t\t'POST', dest, formData, false,\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tif (this.pasteSpecialVex && this.pasteSpecialVex.isOpen) {\n\t\t\t\t\t\t\tvex.close(this.pasteSpecialVex);\n\t\t\t\t\t\t\twindow.app.console.log('up-load done, now paste special');\n\t\t\t\t\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.app.console.log('up-load done, now paste');\n\t\t\t\t\t\t\tapp.socket.sendMessage('uno .uno:Paste');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tfunction(progress) { return 50 + progress/2; }\n\t\t\t\t);\n\t\t\t},\n\t\t\tfunction(progress) { return progress/2; },\n\t\t\tfunction() {\n\t\t\t\twindow.app.console.log('failed to download clipboard using fallback html');\n\n\t\t\t\t// If it's the stub, avoid pasting.\n\t\t\t\tif (that._isStubHtml(fallbackHtml))\n\t\t\t\t{\n\t\t\t\t\t// Let the user know they haven't really copied document content.\n\t\t\t\t\tvex.dialog.alert({\n\t\t\t\t\t\tmessage: _('Failed to download clipboard, please re-copy'),\n\t\t\t\t\t\tcallback: function () {\n\t\t\t\t\t\t\tthat._map.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar formData = new FormData();\n\t\t\t\tformData.append('data', new Blob([fallbackHtml]), 'clipboard');\n\t\t\t\tthat._doAsyncDownload(\n\t\t\t\t\t'POST', dest, formData, false,\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tif (this.pasteSpecialVex && this.pasteSpecialVex.isOpen) {\n\t\t\t\t\t\t\tvex.close(this.pasteSpecialVex);\n\t\t\t\t\t\t\twindow.app.console.log('up-load of fallback done, now paste special');\n\t\t\t\t\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\twindow.app.console.log('up-load of fallback done, now paste');\n\t\t\t\t\t\t\tapp.socket.sendMessage('uno .uno:Paste');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t},\n\t\t\t\t\tfunction(progress) { return 50 + progress/2; },\n\t\t\t\t\tfunction() {\n\t\t\t\t\t\tthat.dataTransferToDocumentFallback(null, fallbackHtml);\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t}\n\t\t);\n\t},\n\n\t_onFileLoadFunc: function(file) {\n\t\tvar socket = app.socket;\n\t\treturn function(e) {\n\t\t\tvar blob = new Blob(['paste mimetype=' + file.type + '\\n', e.target.result]);\n\t\t\tsocket.sendMessage(blob);\n\t\t};\n\t},\n\n\t_asyncReadPasteImage: function(file) {\n\t\tif (file.type.match(/image.*/)) {\n\t\t\tvar reader = new FileReader();\n\t\t\treader.onload = this._onFileLoadFunc(file);\n\t\t\treader.readAsArrayBuffer(file);\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\t// Returns true if it finished synchronously, and false if it have started an async operation\n\t// that will likely end at a later time (required to avoid closing progress bar in paste(ev))\n\tdataTransferToDocument: function (dataTransfer, preferInternal, htmlText, usePasteKeyEvent) {\n\t\t// Look for our HTML meta magic.\n\t\t//   cf. ClientSession.cpp /textselectioncontent:/\n\n\t\tvar meta = this._getMetaOrigin(htmlText);\n\t\tvar id = this.getMetaPath(0);\n\t\tvar idOld = this.getMetaPath(1);\n\n\t\t// for the paste, we always prefer the internal LOK's copy/paste\n\t\tif (preferInternal === true &&\n\t\t    (meta.indexOf(id) >= 0 || meta.indexOf(idOld) >= 0))\n\t\t{\n\t\t\t// Home from home: short-circuit internally.\n\t\t\twindow.app.console.log('short-circuit, internal paste');\n\t\t\tthis._doInternalPaste(this._map, usePasteKeyEvent);\n\t\t\treturn true;\n\t\t}\n\n\t\t// Do we have a remote Online we can suck rich data from ?\n\t\tif (meta !== '')\n\t\t{\n\t\t\twindow.app.console.log('Transfer between servers\\n\\t\"' + meta + '\" vs. \\n\\t\"' + id + '\"');\n\t\t\tthis._dataTransferDownloadAndPasteAsync(meta, this.getMetaURL(), htmlText);\n\t\t\treturn false; // just started async operation - did not finish yet\n\t\t}\n\n\t\t// Fallback.\n\t\tthis.dataTransferToDocumentFallback(dataTransfer, htmlText, usePasteKeyEvent);\n\t\treturn true;\n\t},\n\n\tdataTransferToDocumentFallback: function(dataTransfer, htmlText, usePasteKeyEvent) {\n\n\t\tvar content;\n\t\tif (dataTransfer) {\n\t\t\t// Suck HTML content out of dataTransfer now while it feels like working.\n\t\t\tcontent = this._readContentSyncToBlob(dataTransfer);\n\t\t}\n\n\t\t// Fallback on the html.\n\t\tif (!content && htmlText != '') {\n\t\t\tcontent = this._encodeHtmlToBlob(htmlText);\n\t\t}\n\n\t\t// FIXME: do we want this section ?\n\n\t\t// Images get a look in only if we have no content and are async\n\t\tvar htmlImage = htmlText.substring(0, 4) === '<img';\n\t\tif (((content == null && htmlText === '') || htmlImage) && dataTransfer != null)\n\t\t{\n\t\t\tvar types = dataTransfer.types;\n\n\t\t\twindow.app.console.log('Attempting to paste image(s)');\n\n\t\t\t// first try to transfer images\n\t\t\t// TODO if we have both Files and a normal mimetype, should we handle\n\t\t\t// both, or prefer one or the other?\n\t\t\tfor (var t = 0; t < types.length; ++t) {\n\t\t\t\twindow.app.console.log('\\ttype' + types[t]);\n\t\t\t\tif (types[t] === 'Files') {\n\t\t\t\t\tvar files = dataTransfer.files;\n\t\t\t\t\tif (files !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (var f = 0; f < files.length; ++f)\n\t\t\t\t\t\t\tthis._asyncReadPasteImage(files[f]);\n\t\t\t\t\t}\n\t\t\t\t\telse // IE / Edge\n\t\t\t\t\t\tthis._asyncReadPasteImage(dataTransfer.items[t].getAsFile());\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (content != null) {\n\t\t\twindow.app.console.log('Normal HTML, so smart paste not possible');\n\n\t\t\tvar formData = new FormData();\n\t\t\tformData.append('file', content);\n\n\t\t\tvar that = this;\n\t\t\tthis._doAsyncDownload('POST', this.getMetaURL(), formData, false,\n\t\t\t\tfunction() {\n\t\t\t\t\twindow.app.console.log('Posted ' + content.size + ' bytes successfully');\n\t\t\t\t\tthat._doInternalPaste(that._map, usePasteKeyEvent);\n\t\t\t\t},\n\t\t\t\tfunction(progress) { return progress; }\n\t\t\t\t\t    );\n\t\t} else {\n\t\t\twindow.app.console.log('Nothing we can paste on the clipboard');\n\t\t}\n\t},\n\n\t_checkSelection: function() {\n\t\tvar checkSelect = document.getSelection();\n\t\tif (checkSelect && checkSelect.isCollapsed)\n\t\t\twindow.app.console.log('Error: collapsed selection - cannot copy/paste');\n\t},\n\n\t_getHtmlForClipboard: function() {\n\t\tvar text;\n\n\t\tif ($('.ui-edit').is(':focus'))\n\t\t\treturn $('.ui-edit').value();\n\n\t\tif ($('.w2ui-input').is(':focus'))\n\t\t\treturn $('.w2ui-input').value();\n\n\t\tif (this._selectionType === 'complex' ||\n\t\t    this._map._docLayer.hasGraphicSelection()) {\n\t\t\twindow.app.console.log('Copy/Cut with complex/graphical selection');\n\t\t\tif (this._selectionType === 'text' && this._selectionContent !== '')\n\t\t\t{ // back here again having downloaded it ...\n\t\t\t\ttext = this._selectionContent;\n\t\t\t\twindow.app.console.log('Use downloaded selection.');\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.app.console.log('Downloaded that selection.');\n\t\t\t\ttext = this._getStubHtml();\n\t\t\t\tthis._onDownloadOnLargeCopyPaste();\n\t\t\t\tthis._downloadProgress.setURI( // richer, bigger HTML ...\n\t\t\t\t\tthis.getMetaURL() + '&MimeType=text/html');\n\t\t\t}\n\t\t} else if (this._selectionType === null) {\n\t\t\twindow.app.console.log('Copy/Cut with no selection!');\n\t\t\ttext = this._getStubHtml();\n\t\t} else {\n\t\t\twindow.app.console.log('Copy/Cut with simple text selection');\n\t\t\ttext = this._selectionContent;\n\t\t}\n\t\treturn text;\n\t},\n\n\t// returns whether we shold stop processing the event\n\tpopulateClipboard: function(ev) {\n\t\tthis._checkSelection();\n\n\t\tvar text = this._getHtmlForClipboard();\n\t\t//this._stopHideDownload(); - this confuses the browser ruins copy/cut on iOS\n\n\t\tvar plainText = this.stripHTML(text);\n\t\tif (ev.clipboardData) { // Standard\n\t\t\tif (this._unoCommandForCopyCutPaste === '.uno:CopyHyperlinkLocation') {\n\t\t\t\tvar ess = 's';\n\t\t\t\tvar re = new RegExp('^(.*)(<a href=\")([^\"]+)(\">.*</a>)(</p>\\n</body>\\n</html>)$', ess);\n\t\t\t\tvar match = re.exec(text);\n\t\t\t\tif (match !== null && match.length === 6) {\n\t\t\t\t\ttext = match[1] + match[3] + match[5];\n\t\t\t\t\tplainText = this.stripHTML(text);\n\t\t\t\t}\n\t\t\t}\n\t\t\t// if copied content is graphical then plainText is null and it does not work on mobile.\n\t\t\tev.clipboardData.setData('text/plain', plainText ? plainText: ' ');\n\t\t\tev.clipboardData.setData('text/html', text);\n\t\t\twindow.app.console.log('Put \"' + text + '\" on the clipboard');\n\t\t\tthis._clipboardSerial++;\n\t\t}\n\n\t\treturn true; // prevent default\n\t},\n\n\t_isAnyInputFieldSelected: function() {\n\t\tif ($('#search-input').is(':focus'))\n\t\t\treturn true;\n\n\t\tif ($('.ui-edit').is(':focus'))\n\t\t\treturn true;\n\n\t\tif ($('.w2ui-input').is(':focus'))\n\t\t\treturn true;\n\n\t\tif (isAnyVexDialogActive() && !(this.pasteSpecialVex && this.pasteSpecialVex.isOpen))\n\t\t\treturn true;\n\n\t\tif ($('.annotation-active').length)\n\t\t    return true;\n\n\t\treturn false;\n\t},\n\n\t// Does the selection of text before an event comes in\n\t_beforeSelect: function(ev) {\n\t\twindow.app.console.log('Got event ' + ev.type + ' setting up selection');\n\n\t\tif (this._isAnyInputFieldSelected())\n\t\t\treturn;\n\n\t\tthis._beforeSelectImpl();\n\t},\n\n\t_beforeSelectImpl: function() {\n\t\t// We need some spaces in there ...\n\t\tthis._resetDiv();\n\n\t\tvar sel = document.getSelection();\n\t\tif (!sel)\n\t\t\treturn;\n\n\t\tvar selected = false;\n\t\tvar selectRange;\n\n\t\tif (!selected)\n\t\t{\n\t\t\tsel.removeAllRanges();\n\t\t\tselectRange = document.createRange();\n\t\t\tselectRange.selectNodeContents(this._dummyDiv);\n\t\t\tsel.addRange(selectRange);\n\n\t\t\tvar checkSelect = document.getSelection();\n\t\t\tif (checkSelect.isCollapsed)\n\t\t\t\twindow.app.console.log('Error: failed to select - cannot copy/paste');\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_resetDiv: function() {\n\t\t// cleanup the content:\n\t\tthis._dummyDiv.innerHTML =\n\t\t\t'<b style=\"font-weight:normal; background-color: transparent; color: transparent;\"><span>&nbsp;&nbsp;</span></b>';\n\t},\n\n\t// Try-harder fallbacks for emitting cut/copy/paste events.\n\t_execOnElement: function(operation) {\n\t\tvar serial = this._clipboardSerial;\n\n\t\tthis._resetDiv();\n\n\t\tvar success = false;\n\t\tvar active = null;\n\n\t\t// selection can change focus.\n\t\tactive = document.activeElement;\n\n\t\tsuccess = (document.execCommand(operation) &&\n\t\t\t   serial !== this._clipboardSerial);\n\n\t\t// try to restore focus if we need to.\n\t\tif (active !== null && active !== document.activeElement)\n\t\t\tactive.focus();\n\n\t\twindow.app.console.log('fallback ' + operation + ' ' + (success?'success':'fail'));\n\n\t\treturn success;\n\t},\n\n\t// Encourage browser(s) to actually execute the command\n\t_execCopyCutPaste: function(operation, cmd) {\n\t\tvar serial = this._clipboardSerial;\n\n\t\tthis._unoCommandForCopyCutPaste = cmd;\n\t\tif (document.execCommand(operation) &&\n\t\t    serial !== this._clipboardSerial) {\n\t\t\twindow.app.console.log('copied successfully');\n\t\t\tthis._unoCommandForCopyCutPaste = null;\n\t\t\treturn;\n\t\t}\n\t\tthis._unoCommandForCopyCutPaste = null;\n\n\t\t// try a hidden div\n\t\tif (this._execOnElement(operation)) {\n\t\t\twindow.app.console.log('copied on element successfully');\n\t\t\treturn;\n\t\t}\n\n\t\t// see if we have help for paste\n\t\tif (operation === 'paste')\n\t\t{\n\t\t\ttry {\n\t\t\t\twindow.app.console.warn('Asked parent for a paste event');\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'UI_Paste'});\n\t\t\t} catch (error) {\n\t\t\t\twindow.app.console.warn('Failed to post-message: ' + error);\n\t\t\t}\n\t\t}\n\n\t\t// wait and see if we get some help\n\t\tvar that = this;\n\t\tclearTimeout(this._failedTimer);\n\t\tsetTimeout(function() {\n\t\t\tif (that._clipboardSerial !== serial)\n\t\t\t{\n\t\t\t\twindow.app.console.log('successful ' + operation);\n\t\t\t\tif (operation === 'paste')\n\t\t\t\t\tthat._stopHideDownload();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.app.console.log('help did not arrive for ' + operation);\n\t\t\t\tthat._warnCopyPaste();\n\t\t\t}\n\t\t}, 150 /* ms */);\n\t},\n\n\t// Pull UNO clipboard commands out from menus and normal user input.\n\t// We try to massage and re-emit these, to get good security event / credentials.\n\tfilterExecCopyPaste: function(cmd) {\n\t\tif (window.ThisIsAMobileApp) {\n\t\t\t// We do native copy/paste in the iOS and Android cases\n\t\t\treturn false;\n\t\t}\n\n\t\tif (this._map['wopi'].DisableCopy && (cmd === '.uno:Copy' || cmd === '.uno:Cut')) {\n\t\t\t// perform internal operations\n\t\t\tapp.socket.sendMessage('uno ' + cmd);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (cmd === '.uno:Copy' || (L.Browser.mobile && L.Browser.safari && cmd === '.uno:CopyHyperlinkLocation')) {\n\t\t\tthis._execCopyCutPaste('copy', cmd);\n\t\t} else if (cmd === '.uno:Cut') {\n\t\t\tthis._execCopyCutPaste('cut', cmd);\n\t\t} else if (cmd === '.uno:Paste') {\n\t\t\tthis._execCopyCutPaste('paste', cmd);\n\t\t} else if (cmd === '.uno:PasteSpecial') {\n\t\t\tthis._openPasteSpecialPopup();\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\twindow.app.console.log('filtered uno command ' + cmd);\n\t\treturn true;\n\t},\n\n\t_doCopyCut: function(ev, unoName) {\n\t\twindow.app.console.log(unoName);\n\n\t\tif (this._isAnyInputFieldSelected())\n\t\t\treturn;\n\n\t\tif (this._downloadProgressStatus() === 'downloadButton')\n\t\t\tthis._stopHideDownload(); // Terminate pending confirmation\n\n\t\tvar preventDefault = true;\n\n\t\tif (this._map['wopi'].DisableCopy === true)\n\t\t{\n\t\t\tvar text = this._getDisabledCopyStubHtml();\n\t\t\tvar plainText = this.stripHTML(text);\n\t\t\tif (ev.clipboardData) {\n\t\t\t\twindow.app.console.log('Copying disabled: put stub message on the clipboard');\n\t\t\t\tev.clipboardData.setData('text/plain', plainText ? plainText: ' ');\n\t\t\t\tev.clipboardData.setData('text/html', text);\n\t\t\t\tthis._clipboardSerial++;\n\t\t\t}\n\t\t} else {\n\t\t\tpreventDefault = this.populateClipboard(ev);\n\t\t}\n\n\t\tapp.socket.sendMessage('uno .uno:' + unoName);\n\t\tif (preventDefault) {\n\t\t\tev.preventDefault();\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t_doInternalPaste: function(map, usePasteKeyEvent) {\n\t\tif (usePasteKeyEvent) {\n\t\t\t// paste into dialog\n\t\t\tvar KEY_PASTE = 1299;\n\t\t\tmap._textInput._sendKeyEvent(0, KEY_PASTE);\n\t\t} else if (this.pasteSpecialVex && this.pasteSpecialVex.isOpen) {\n\t\t\tthis.pasteSpecialVex.close();\n\t\t\tapp.socket.sendMessage('uno .uno:PasteSpecial');\n\t\t} else {\n\t\t\t// paste into document\n\t\t\tapp.socket.sendMessage('uno .uno:Paste');\n\t\t}\n\t},\n\n\tcut:  function(ev) { return this._doCopyCut(ev, 'Cut'); },\n\n\tcopy: function(ev) { return this._doCopyCut(ev, 'Copy'); },\n\n\tpaste: function(ev) {\n\t\twindow.app.console.log('Paste');\n\n\t\tif (this._isAnyInputFieldSelected())\n\t\t\treturn;\n\n\t\t// If the focus is in the search box, paste there.\n\t\tif (this._map.isSearching())\n\t\t\treturn;\n\n\t\tif (this._downloadProgressStatus() === 'downloadButton')\n\t\t\tthis._stopHideDownload(); // Terminate pending confirmation\n\n\t\tif (this._map._activeDialog)\n\t\t\tev.usePasteKeyEvent = true;\n\n\t\tif (ev.clipboardData) {\n\t\t\tev.preventDefault();\n\t\t\tvar usePasteKeyEvent = ev.usePasteKeyEvent;\n\t\t\t// Always capture the html content separate as we may lose it when we\n\t\t\t// pass the clipboard data to a different context (async calls, f.e.).\n\t\t\tvar htmlText = ev.clipboardData.getData('text/html');\n\t\t\tvar hasFinished = this.dataTransferToDocument(ev.clipboardData, /* preferInternal = */ true, htmlText, usePasteKeyEvent);\n\t\t\tthis._map._textInput._abortComposition(ev);\n\t\t\tthis._clipboardSerial++;\n\t\t\tif (hasFinished)\n\t\t\t\tthis._stopHideDownload();\n\t\t}\n\t\treturn false;\n\t},\n\n\tclearSelection: function() {\n\t\tthis._selectionContent = '';\n\t\tthis._selectionType = null;\n\t\tthis._scheduleHideDownload(15);\n\t},\n\n\t// textselectioncontent: message\n\tsetTextSelectionHTML: function(html) {\n\t\tthis._selectionType = 'text';\n\t\tthis._selectionContent = html;\n\t\tif (L.Browser.cypressTest) {\n\t\t\tthis._dummyDiv.innerHTML = html;\n\t\t}\n\t\tthis._scheduleHideDownload(15);\n\t},\n\n\t// sets the selection to some (cell formula) text)\n\tsetTextSelectionText: function(text) {\n\t\tthis._selectionType = 'text';\n\t\tthis._selectionContent = this._originWrapBody(\n\t\t\t'<body>' + text + '</body>');\n\t\tthis._scheduleHideDownload(15);\n\t},\n\n\t// complexselection: message\n\tonComplexSelection: function (/*text*/) {\n\t\t// Mark this selection as complex.\n\t\tthis._selectionType = 'complex';\n\t\tthis._scheduleHideDownload(15);\n\t},\n\n\t_startProgress: function() {\n\t\tif (!this._downloadProgress) {\n\t\t\tthis._downloadProgress = L.control.downloadProgress();\n\t\t}\n\t\tif (!this._downloadProgress.isVisible()) {\n\t\t\tthis._downloadProgress.addTo(this._map);\n\t\t}\n\t\tthis._downloadProgress.show();\n\t},\n\n\t_onDownloadOnLargeCopyPaste: function () {\n\t\tif (!this._downloadProgress || this._downloadProgress.isClosed()) {\n\t\t\tthis._warnFirstLargeCopyPaste();\n\t\t\tthis._startProgress();\n\t\t}\n\t\telse if (this._downloadProgress.isStarted()) {\n\t\t\t// Need to show this only when a download is really in progress and we block it.\n\t\t\t// Otherwise, it's easier to flash the widget or something.\n\t\t\tthis._warnLargeCopyPasteAlreadyStarted();\n\t\t}\n\t},\n\n\t_downloadProgressStatus: function() {\n\t\tif (this._downloadProgress && this._downloadProgress.isVisible())\n\t\t\treturn this._downloadProgress.currentStatus();\n\t},\n\n\t// Download button is still shown after selection changed -> user has changed their mind...\n\t_scheduleHideDownload: function(s) {\n\t\tif (!this._downloadProgress || !this._downloadProgress.isVisible())\n\t\t\treturn;\n\n\t\t// If no other copy/paste things occurred then ...\n\t\tvar that = this;\n\t\tvar serial = this._clipboardSerial;\n\t\tif (!this._hideDownloadTimer)\n\t\t\tthis._hideDownloadTimer = setTimeout(function() {\n\t\t\t\tthat._hideDownloadTimer = null;\n\t\t\t\tif (serial == that._clipboardSerial && that._downloadProgressStatus() === 'downloadButton')\n\t\t\t\t\tthat._stopHideDownload();\n\t\t\t}, 1000 * s);\n\t},\n\n\t// useful if we did an internal paste already and don't want that.\n\t_stopHideDownload: function() {\n\t\tclearTimeout(this._hideDownloadTimer);\n\t\tthis._hideDownloadTimer = null;\n\n\t\tif (!this._downloadProgress ||\n\t\t    !this._downloadProgress.isVisible() ||\n\t\t    this._downloadProgress.isClosed())\n\t\t\treturn;\n\t\tthis._downloadProgress._onClose();\n\t},\n\n\t_userAlreadyWarned: function (warning) {\n\t\tvar itemKey = warning;\n\t\tvar storage = localStorage;\n\t\tif (storage && !storage.getItem(itemKey)) {\n\t\t\tstorage.setItem(itemKey, '1');\n\t\t\treturn false;\n\t\t} else if (!storage)\n\t\t\treturn false;\n\n\t\treturn true;\n\t},\n\n\t_warnCopyPaste: function() {\n\t\tvar self = this;\n\t\tvar msg;\n\t\tif (window.mode.isMobile() || window.mode.isTablet()) {\n\t\t\tmsg = _('<p>Please use the copy/paste buttons on your on-screen keyboard.</p>');\n\t\t} else {\n\t\t\tmsg = _('<p>Your browser has very limited access to the clipboard, so use these keyboard shortcuts:</p><table class=\"warn-copy-paste\"><tr><td><kbd>Ctrl</kbd><span class=\"kbd--plus\">+</span><kbd>C</kbd></td><td><kbd>Ctrl</kbd><span class=\"kbd--plus\">+</span><kbd>X</kbd></td><td><kbd>Ctrl</kbd><span class=\"kbd--plus\">+</span><kbd>V</kbd></td></tr><tr><td>Copy</td><td>Cut</td><td>Paste</td></tr></table>');\n\t\t\tmsg = L.Util.replaceCtrlAltInMac(msg);\n\t\t}\n\t\tvex.dialog.alert({\n\t\t\tunsafeMessage: msg,\n\t\t\tcallback: function () {\n\t\t\t\tself._map.focus();\n\t\t\t}\n\t\t});\n\t},\n\n\t_substProductName: function (msg) {\n\t\tvar productName = (typeof brandProductName !== 'undefined') ? brandProductName : 'Collabora Online Development Edition';\n\t\treturn msg.replace('%productName', productName);\n\t},\n\n\t_warnFirstLargeCopyPaste: function () {\n\t\tif (this._userAlreadyWarned('warnedAboutLargeCopy'))\n\t\t\treturn;\n\n\t\tvar self = this;\n\t\tvar msg = _('<p>If you would like to share larger elements of your document with other applications ' +\n\t\t\t    'it is necessary to first download them onto your device. To do that press the ' +\n\t\t\t    '\"Start download\" button below, and when complete click \"Confirm copy to clipboard\".</p>' +\n\t\t\t    '<p>If you are copy and pasting between documents inside %productName, ' +\n\t\t\t    'there is no need to download.</p>');\n\t\tvex.dialog.alert({\n\t\t\tunsafeMessage: this._substProductName(msg),\n\t\t\tcallback: function () {\n\t\t\t\tself._map.focus();\n\t\t\t}\n\t\t});\n\t},\n\n\t_warnLargeCopyPasteAlreadyStarted: function () {\n\t\tvar self = this;\n\t\tvex.dialog.alert({\n\t\t\tunsafeMessage: _('<p>A download due to a large copy/paste operation has already started. ' +\n\t\t\t\t   'Please, wait for the current download or cancel it before starting a new one</p>'),\n\t\t\tcallback: function () {\n\t\t\t\tself._map.focus();\n\t\t\t}\n\t\t});\n\t},\n\n\t_openPasteSpecialPopup: function () {\n\t\tvar self = this;\n\t\tvar msg = _('<p>Your browser has very limited access to the clipboard</p><p>Please press now: <kbd>Ctrl</kbd><span class=\"kbd--plus\">+</span><kbd>V</kbd> to see more options</p><p class=\"vex-footnote\">Close popup to ignore paste special</p>');\n\t\tmsg = L.Util.replaceCtrlAltInMac(msg);\n\t\tself._map._clip.pasteSpecialVex = vex.open({\n\t\t\tunsafeContent: msg,\n\t\t\tshowCloseButton: true,\n\t\t\tescapeButtonCloses: true,\n\t\t\toverlayClosesOnClick: false,\n\t\t\tbuttons: {},\n\t\t\tafterOpen: function() {\n\t\t\t\tself._map.focus();\n\t\t\t}\n\t\t});\n\t},\n});\n\nL.clipboard = function(map) {\n\tif (window.ThisIsAMobileApp)\n\t\twindow.app.console.log('======> Assertion failed!? No L.Clipboard object should be needed in a mobile app');\n\treturn new L.Clipboard(map);\n};\n"]}
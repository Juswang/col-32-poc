{"version":3,"file":"Map.SlideShow.js","sourceRoot":"","sources":["../../../../../../../../../browser/src/map/handler/Map.SlideShow.js"],"names":[],"mappings":"AAAA,gCAAgC;AAChC;;GAEG;AAEH,CAAC,CAAC,GAAG,CAAC,YAAY,CAAC;IAClB,SAAS,EAAE,IAAI;CACf,CAAC,CAAC;AAEH,CAAC,CAAC,GAAG,CAAC,SAAS,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC;IAElC,SAAS,EAAE,EAAE;IACb,2BAA2B,EAAE,KAAK;IAElC,UAAU,EAAE,UAAU,GAAG;QACxB,IAAI,CAAC,IAAI,GAAG,GAAG,CAAC;QAChB,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,sCAAsC,GAAG,CAAC,SAAS,IAAI,MAAM,CAAC,CAAC,CAAC;QACvF,IAAI,CAAC,2BAA2B;YAC/B,CAAC,CAAC,OAAO,CAAC,WAAW,IAAI,SAAS,IAAI,MAAM;mBACzC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,KAAK,yCAAyC,CAAC;IAC5E,CAAC;IAED,QAAQ,EAAE;QACT,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACrD,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,oBAAoB,EAAE,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,CAAC;IACtE,CAAC;IAED,WAAW,EAAE;QACZ,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE,IAAI,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACtD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,oBAAoB,EAAE,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,CAAC;IACvE,CAAC;IAED,aAAa,EAAE,UAAU,CAAC;QACzB,IAAI,MAAM,CAAC,eAAe,IAAI,MAAM,CAAC,mBAAmB,EAAE;YACzD,MAAM,CAAC,iBAAiB,CAAC,WAAW,CAAC,CAAC;YACtC,OAAO;SACP;QAED,IAAI,CAAC,IAAI,CAAC,2BAA2B,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,qBAAqB,EAAE;YAClF,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,QAAQ,EAAE,mBAAmB,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACxF,IAAI,IAAI,CAAC,UAAU,CAAC,iBAAiB,EAAE;gBACtC,IAAI,CAAC,UAAU,CAAC,iBAAiB,EAAE,CAAC;aACpC;iBACI,IAAI,IAAI,CAAC,UAAU,CAAC,mBAAmB,EAAE;gBAC7C,IAAI,CAAC,UAAU,CAAC,mBAAmB,EAAE,CAAC;aACtC;iBACI,IAAI,IAAI,CAAC,UAAU,CAAC,oBAAoB,EAAE;gBAC9C,IAAI,CAAC,UAAU,CAAC,oBAAoB,EAAE,CAAC;aACvC;iBACI,IAAI,IAAI,CAAC,UAAU,CAAC,uBAAuB,EAAE;gBACjD,IAAI,CAAC,UAAU,CAAC,uBAAuB,EAAE,CAAC;aAC1C;YAED,CAAC,CAAC,QAAQ,CAAC,EAAE,CAAC,QAAQ,EAAE,gFAAgF,EACvG,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,CAAC,6BAA6B;QACzD,IAAI,CAAC,CAAC,gBAAgB,KAAK,SAAS,EAAE;YACrC,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,gBAAgB,CAAC;SAC5C;QACD,IAAI,CAAC,UAAU,GAAG,CAAC,IAAI,CAAC,2BAA2B,CAAC;QACpD,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,eAAe,EAAE,KAAK,EAAE,IAAI,EAAE,WAAW,CAAC,CAAC;IACjE,CAAC;IAED,mBAAmB,EAAE;QACpB,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,qBAAqB,EAAE;YAC5C,OAAO;SACP;QAED,IAAI,CAAC,UAAU,GAAG,QAAQ,CAAC,iBAAiB;YAC3C,QAAQ,CAAC,kBAAkB;YAC3B,QAAQ,CAAC,aAAa;YACtB,QAAQ,CAAC,mBAAmB,CAAC;QAC9B,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YACrB,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;SAClC;IACF,CAAC;IAED,qBAAqB,EAAE,UAAU,CAAC;QACjC,IAAI,gBAAgB,IAAI,MAAM,EAAE;YAC/B,CAAC,CAAC,GAAG,GAAG,MAAM,CAAC,cAAc,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,EAAE,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;SACjE;QAED,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,GAAG,CAAC;QACvB,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,mBAAmB,EAAE,IAAI,CAAC,SAAS,CAAC,CAAC;QAE9D,IAAI,gBAAgB,IAAI,MAAM,EAAE;YAC/B,IAAI,CAAC,sBAAsB,EAAE,CAAC;SAC9B;QAED,IAAI,CAAC,aAAa,EAAE,CAAC;IACtB,CAAC;IAED,aAAa,EAAE;QACd,IAAI,IAAI,CAAC,2BAA2B,EAAE;YACrC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;YACrC,OAAO;SACP;QACD,IAAI,SAAS,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC;QACjE,IAAI,CAAC,UAAU,CAAC,GAAG,GAAG,IAAI,CAAC,SAAS,GAAG,SAAS,GAAG,mBAAmB,GAAG,IAAI,CAAC,iBAAiB,CAAC;QAChG,IAAI,CAAC,UAAU,CAAC,aAAa,CAAC,KAAK,EAAE,CAAC;IACvC,CAAC;IAED,sBAAsB,EAAE;QACvB,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,UAAU,CAAC,MAAM,GAAG,SAAS,eAAe;YAChD,IAAI,YAAY,GAAG,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,eAAe,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;iBACrF,MAAM,CAAC,UAAS,EAAE;gBAClB,OAAO,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;YACjE,CAAC,CAAC;iBACD,GAAG,CAAC,UAAS,EAAE;gBACf,OAAO;oBACN,EAAE,EAAE,EAAE;oBACN,IAAI,EAAE,EAAE,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,YAAY,CAAC,YAAY,CAAC;oBAC9D,MAAM,EAAE,EAAE,CAAC,UAAU;iBACrB,CAAC;YACH,CAAC,CAAC,CAAC;YAEJ,IAAI,cAAc,GAAG,UAAS,EAAE,EAAE,IAAI;gBACrC,IAAI,GAAG,MAAM,CAAC,cAAc,CAAC,EAAE,GAAG,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC,CAAC;gBAE3D,EAAE,CAAC,cAAc,CAAC,8BAA8B,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC;gBAChE,EAAE,CAAC,YAAY,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;YACrC,CAAC,CAAC;YAEF,YAAY,CAAC,OAAO,CAAC,UAAS,IAAI;gBACjC,cAAc,CAAC,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;gBAEnC,IAAI,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC,YAAY,CAAC,CAAC;gBAExD,IAAI,UAAU,EAAE;oBACf,cAAc,CAAC,IAAI,CAAC,MAAM,EAAE,UAAU,CAAC,CAAC;iBACxC;gBAED,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;gBAC1F,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,WAAW,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACjD,CAAC,CAAC,CAAC;QACJ,CAAC,CAAC;IACH,CAAC;CACD,CAAC,CAAC;AAEH,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,YAAY,EAAE,WAAW,EAAE,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Map.SlideShow is handling the slideShow action\n */\n\nL.Map.mergeOptions({\n\tslideShow: true\n});\n\nL.Map.SlideShow = L.Handler.extend({\n\n\t_slideURL: '', // store the URL for svg\n\t_cypressSVGPresentationTest: false,\n\n\tinitialize: function (map) {\n\t\tthis._map = map;\n\t\twindow.app.console.log('L.Map.SlideShow: Cypress in window: ' + ('Cypress' in window));\n\t\tthis._cypressSVGPresentationTest =\n\t\t\tL.Browser.cypressTest && 'Cypress' in window\n\t\t\t&& window.Cypress.spec.name === 'impress/fullscreen_presentation_spec.js';\n\t},\n\n\taddHooks: function () {\n\t\tthis._map.on('fullscreen', this._onFullScreen, this);\n\t\tthis._map.on('slidedownloadready', this._onSlideDownloadReady, this);\n\t},\n\n\tremoveHooks: function () {\n\t\tthis._map.off('fullscreen', this._onFullScreen, this);\n\t\tthis._map.off('slidedownloadready', this._onSlideDownloadReady, this);\n\t},\n\n\t_onFullScreen: function (e) {\n\t\tif (window.ThisIsTheiOSApp || window.ThisIsTheAndroidApp) {\n\t\t\twindow.postMobileMessage('SLIDESHOW');\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._cypressSVGPresentationTest && !this._map['wopi'].DownloadAsPostMessage) {\n\t\t\tthis._slideShow = L.DomUtil.create('iframe', 'leaflet-slideshow', this._map._container);\n\t\t\tif (this._slideShow.requestFullscreen) {\n\t\t\t\tthis._slideShow.requestFullscreen();\n\t\t\t}\n\t\t\telse if (this._slideShow.msRequestFullscreen) {\n\t\t\t\tthis._slideShow.msRequestFullscreen();\n\t\t\t}\n\t\t\telse if (this._slideShow.mozRequestFullScreen) {\n\t\t\t\tthis._slideShow.mozRequestFullScreen();\n\t\t\t}\n\t\t\telse if (this._slideShow.webkitRequestFullscreen) {\n\t\t\t\tthis._slideShow.webkitRequestFullscreen();\n\t\t\t}\n\n\t\t\tL.DomEvent.on(document, 'fullscreenchange webkitfullscreenchange mozfullscreenchange msfullscreenchange',\n\t\t\t\tthis._onFullScreenChange, this);\n\t\t}\n\n\t\tthis._startSlideNumber = 0; // Default: start from page 0\n\t\tif (e.startSlideNumber !== undefined) {\n\t\t\tthis._startSlideNumber = e.startSlideNumber;\n\t\t}\n\t\tthis.fullscreen = !this._cypressSVGPresentationTest;\n\t\tthis._map.downloadAs('slideshow.svg', 'svg', null, 'slideshow');\n\t},\n\n\t_onFullScreenChange: function () {\n\t\tif (this._map['wopi'].DownloadAsPostMessage) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.fullscreen = document.fullscreenElement ||\n\t\t\tdocument.webkitIsFullScreen ||\n\t\t\tdocument.mozFullScreen ||\n\t\t\tdocument.msFullscreenElement;\n\t\tif (!this.fullscreen) {\n\t\t\tL.DomUtil.remove(this._slideShow);\n\t\t}\n\t},\n\n\t_onSlideDownloadReady: function (e) {\n\t\tif ('processCoolUrl' in window) {\n\t\t\te.url = window.processCoolUrl({ url: e.url, type: 'slideshow' });\n\t\t}\n\n\t\tthis._slideURL = e.url;\n\t\twindow.app.console.debug('slide file url : ', this._slideURL);\n\n\t\tif ('processCoolUrl' in window) {\n\t\t\tthis._processSlideshowLinks();\n\t\t}\n\n\t\tthis._startPlaying();\n\t},\n\n\t_startPlaying: function() {\n\t\tif (this._cypressSVGPresentationTest) {\n\t\t\twindow.open(this._slideURL, '_self');\n\t\t\treturn;\n\t\t}\n\t\tvar separator = (this._slideURL.indexOf('?') === -1) ? '?' : '&';\n\t\tthis._slideShow.src = this._slideURL + separator + 'StartSlideNumber=' + this._startSlideNumber;\n\t\tthis._slideShow.contentWindow.focus();\n\t},\n\n\t_processSlideshowLinks: function() {\n\t\tvar that = this;\n\t\tthis._slideShow.onload = function onLoadSlideshow() {\n\t\t\tvar linkElements = [].slice.call(that._slideShow.contentDocument.querySelectorAll('a'))\n\t\t\t\t.filter(function(el) {\n\t\t\t\t\treturn el.getAttribute('href') || el.getAttribute('xlink:href');\n\t\t\t\t})\n\t\t\t\t.map(function(el) {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tel: el,\n\t\t\t\t\t\tlink: el.getAttribute('href') || el.getAttribute('xlink:href'),\n\t\t\t\t\t\tparent: el.parentNode\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\tvar setAttributeNs = function(el, link) {\n\t\t\t\tlink = window.processCoolUrl({ url: link, type: 'slide' });\n\n\t\t\t\tel.setAttributeNS('http://www.w3.org/1999/xlink', 'href', link);\n\t\t\t\tel.setAttribute('target', '_blank');\n\t\t\t};\n\n\t\t\tlinkElements.forEach(function(item) {\n\t\t\t\tsetAttributeNs(item.el, item.link);\n\n\t\t\t\tvar parentLink = item.parent.getAttribute('xlink:href');\n\n\t\t\t\tif (parentLink) {\n\t\t\t\t\tsetAttributeNs(item.parent, parentLink);\n\t\t\t\t}\n\n\t\t\t\titem.parent.parentNode.insertBefore(item.parent.cloneNode(true), item.parent.nextSibling);\n\t\t\t\titem.parent.parentNode.removeChild(item.parent);\n\t\t\t});\n\t\t};\n\t}\n});\n\nL.Map.addInitHook('addHandler', 'slideShow', L.Map.SlideShow);\n"]}
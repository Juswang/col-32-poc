{"version":3,"file":"Map.WOPI.js","sourceRoot":"","sources":["../../../../../../../../../browser/src/map/handler/Map.WOPI.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.WOPI contains WOPI related logic\n */\n\n/* global w2ui _ app */\nL.Map.WOPI = L.Handler.extend({\n\t// If the CheckFileInfo call fails on server side, we won't have any PostMessageOrigin.\n\t// So use '*' because we still needs to send 'close' message to the parent frame which\n\t// wouldn't be possible otherwise.\n\tPostMessageOrigin: window.postmessageOriginExt || '*',\n\tBaseFileName: '',\n\tBreadcrumbDocName: '',\n\tDocumentLoadedTime: false,\n\tHidePrintOption: false,\n\tHideSaveOption: false,\n\tHideExportOption: false,\n\tHideChangeTrackingControls: false,\n\tDisablePrint: false,\n\tDisableExport: false,\n\tDisableCopy: false,\n\tDisableInactiveMessages: false,\n\tDownloadAsPostMessage: false,\n\tUserCanNotWriteRelative: true,\n\tEnableInsertRemoteImage: false,\n\tEnableShare: false,\n\tHideUserList: null,\n\tCallPythonScriptSource: null,\n\tSupportsRename: false,\n\tUserCanRename: false,\n\n\t_appLoadedConditions: {\n\t\tdocloaded: false,\n\t\tupdatepermission: false,\n\t\tviewinfo: false /* Whether view information has already arrived */\n\t},\n\n\t_appLoaded: false,\n\n\tinitialize: function(map) {\n\t\tthis._map = map;\n\t},\n\n\taddHooks: function() {\n\t\tthis._map.on('postMessage', this._postMessage, this);\n\n\t\t// init messages\n\t\tthis._map.on('docloaded', this._postLoaded, this);\n\t\tthis._map.on('updatepermission', this._postLoaded, this);\n\t\t// This indicates that 'viewinfo' message has already arrived\n\t\tthis._map.on('viewinfo', this._postLoaded, this);\n\n\t\tthis._map.on('wopiprops', this._setWopiProps, this);\n\t\tL.DomEvent.on(window, 'message', this._postMessageListener, this);\n\n\t\tthis._map.on('updateviewslist', function() { this._postViewsMessage('Views_List'); }, this);\n\n\t\tif (!window.ThisIsAMobileApp) {\n\t\t\t// override the window.open to issue a postMessage, so that\n\t\t\t// it is possible to handle the hyperlink in the integration\n\t\t\tvar that = this;\n\t\t\twindow.open = function (open) {\n\t\t\t\treturn function (url, name, features) {\n\t\t\t\t\tthat._map.fire('postMessage', {\n\t\t\t\t\t\tmsgId: 'UI_Hyperlink',\n\t\t\t\t\t\targs: {\n\t\t\t\t\t\t\tUrl: url,\n\t\t\t\t\t\t\tName: name,\n\t\t\t\t\t\t\tFeatures: features\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tif (!that._map._disableDefaultAction['UI_Hyperlink'])\n\t\t\t\t\t\treturn open.call(window, url, name, features);\n\t\t\t\t\telse\n\t\t\t\t\t\treturn null;\n\t\t\t\t};\n\t\t\t}(window.open);\n\t\t}\n\t},\n\n\tremoveHooks: function() {\n\t\tthis._map.off('postMessage', this._postMessage, this);\n\n\t\t// init messages\n\t\tthis._map.off('docloaded', this._postLoaded, this);\n\t\tthis._map.off('updatepermission', this._postLoaded, this);\n\t\tthis._map.off('viewinfo', this._postLoaded, this);\n\n\t\tthis._map.off('wopiprops', this._setWopiProps, this);\n\t\tL.DomEvent.off(window, 'message', this._postMessageListener, this);\n\n\t\tthis._map.off('updateviewslist');\n\t},\n\n\t_setWopiProps: function(wopiInfo) {\n\t\t// Store postmessageorigin property, if it exists\n\t\tif (wopiInfo['PostMessageOrigin']) {\n\t\t\tthis.PostMessageOrigin = wopiInfo['PostMessageOrigin'];\n\t\t}\n\n\t\tthis.BaseFileName = wopiInfo['BaseFileName'];\n\t\tthis.BreadcrumbDocName = wopiInfo['BreadcrumbDocName'];\n\t\tif (this.BreadcrumbDocName === undefined)\n\t\t\tthis.BreadcrumbDocName = this.BaseFileName;\n\t\tthis.HidePrintOption = !!wopiInfo['HidePrintOption'];\n\t\tthis.HideSaveOption = !!wopiInfo['HideSaveOption'];\n\t\tthis.HideExportOption = !!wopiInfo['HideExportOption'];\n\t\tthis.HideChangeTrackingControls = !!wopiInfo['HideChangeTrackingControls'];\n\t\tthis.DisablePrint = !!wopiInfo['DisablePrint'];\n\t\tthis.DisableExport = !!wopiInfo['DisableExport'];\n\t\tthis.DisableCopy = !!wopiInfo['DisableCopy'];\n\t\tthis.DisableInactiveMessages = !!wopiInfo['DisableInactiveMessages'];\n\t\tthis.DownloadAsPostMessage = !!wopiInfo['DownloadAsPostMessage'];\n\t\tthis.UserCanNotWriteRelative = !!wopiInfo['UserCanNotWriteRelative'];\n\t\tthis.EnableInsertRemoteImage = !!wopiInfo['EnableInsertRemoteImage'];\n\t\tthis.SupportsRename = !!wopiInfo['SupportsRename'];\n\t\tthis.UserCanRename = !!wopiInfo['UserCanRename'];\n\t\tthis.EnableShare = !!wopiInfo['EnableShare'];\n\t\tif (wopiInfo['HideUserList'])\n\t\t\tthis.HideUserList = wopiInfo['HideUserList'].split(',');\n\n\t\tthis._map.fire('postMessage', {\n\t\t\tmsgId: 'App_LoadingStatus',\n\t\t\targs: {\n\t\t\t\tStatus: 'Frame_Ready',\n\t\t\t\tFeatures: {\n\t\t\t\t\tVersionStates: true\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif ('TemplateSaveAs' in wopiInfo) {\n\t\t\tthis._map.showBusy(_('Creating new file from template...'), false);\n\t\t\tthis._map.saveAs(wopiInfo['TemplateSaveAs']);\n\t\t}\n\t},\n\n\tresetAppLoaded: function() {\n\t\tthis._appLoaded = false;\n\t\tfor (var key in this._appLoadedConditions) {\n\t\t\tthis._appLoadedConditions[key] = false;\n\t\t}\n\t},\n\n\t_postLoaded: function(e) {\n\t\tif (this._appLoaded) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (e.type === 'docloaded') {\n\t\t\t// doc unloaded\n\t\t\tif (!e.status)\n\t\t\t{\n\t\t\t\tthis._appLoadedConditions[e.type] = false;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.DocumentLoadedTime = Date.now();\n\t\t}\n\t\tthis._appLoadedConditions[e.type] = true;\n\t\tfor (var key in this._appLoadedConditions) {\n\t\t\tif (!this._appLoadedConditions[key])\n\t\t\t\treturn;\n\t\t}\n\n\t\tthis._appLoaded = true;\n\t\tthis._map.fire('postMessage', {msgId: 'App_LoadingStatus', args: {Status: 'Document_Loaded', DocumentLoadedTime: this.DocumentLoadedTime}});\n\t},\n\n\t// Naturally we set a CSP to catch badness, but check here as well.\n\t// Checking whether a message came from our iframe's parents is\n\t// un-necessarily difficult.\n\t_allowMessageOrigin: function(e) {\n\t\t// cache - to avoid regexps.\n\t\tif (this._cachedGoodOrigin && this._cachedGoodOrigin === e.origin)\n\t\t\treturn true;\n\n\t\t// e.origin === 'null' when sandboxed (i.e. when the parent is a file on local filesystem).\n\t\tif (e.origin === 'null')\n\t\t\treturn true;\n\t\ttry {\n\t\t\tif (e.origin === window.parent.origin)\n\t\t\t\treturn true;\n\t\t} catch (secErr) { // security error de-referencing window.parent.origin.\n\t\t}\n\n\t\t// sent from the server\n\t\tvar i;\n\t\tif (!this._allowedOrigins && window.frameAncestors)\n\t\t{\n\t\t\tvar ancestors = window.frameAncestors.trim().split(' ');\n\t\t\tthis._allowedOrigins = ancestors;\n\t\t\t// convert to JS regexps from localhost:* to https*://localhost:.*\n\t\t\tfor (i = 0; i < ancestors.length; i++) {\n\t\t\t\tthis._allowedOrigins[i] = '(http|https)://' + ancestors[i].replace(/:\\*/, ':?.*');\n\t\t\t}\n\t\t}\n\n\t\tif (this._allowedOrigins)\n\t\t{\n\t\t\tfor (i = 0; i < this._allowedOrigins.length; i++) {\n\t\t\t\tif (e.origin.match(this._allowedOrigins[i]))\n\t\t\t\t{\n\t\t\t\t\tthis._cachedGoodOrigin = e.origin;\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// chrome only\n\t\tif (window.location.ancestorOrigins &&\n\t\t    window.location.ancestorOrigins.contains(e.origin))\n\t\t{\n\t\t\tthis._cachedGoodOrigin = e.origin;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t},\n\n\t_postMessageListener: function(e) {\n\t\tif (!this._allowMessageOrigin(e))\n\t\t\treturn;\n\n\t\tvar msg;\n\n\t\tif (('data' in e) && Object.hasOwnProperty.call(e.data, 'MessageId')) {\n\t\t\t// when e.data already contains the right props, but isn't JSON (a blob is passed for ex)\n\t\t\tmsg = e.data;\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tmsg = JSON.parse(e.data);\n\t\t\t} catch (e) {\n\t\t\t\twindow.app.console.error(e);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// allow closing documents before they are completely loaded\n\t\tif (msg.MessageId === 'Close_Session') {\n\t\t\tapp.socket.sendMessage('closedocument');\n\t\t\treturn;\n\t\t}\n\n\t\t// Exception: UI modification can be done before WOPIPostmessageReady was fullfiled\n\t\tif (msg.MessageId === 'Show_Button' || msg.MessageId === 'Hide_Button' || msg.MessageId === 'Remove_Button') {\n\t\t\tif (!msg.Values) {\n\t\t\t\twindow.app.console.error('Property \"Values\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!msg.Values.id) {\n\t\t\t\twindow.app.console.error('Property \"Values.id\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar show = msg.MessageId === 'Show_Button';\n\t\t\tthis._map.uiManager.showButton(msg.Values.id, show);\n\t\t}\n\t\telse if (msg.MessageId === 'Remove_Statusbar_Element') {\n\t\t\tif (!msg.Values) {\n\t\t\t\twindow.app.console.error('Property \"Values\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!msg.Values.id) {\n\t\t\t\twindow.app.console.error('Property \"Values.id\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!w2ui['actionbar'].get(msg.Values.id)) {\n\t\t\t\twindow.app.console.error('Statusbar element with id \"' + msg.Values.id + '\" not found.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tw2ui['actionbar'].remove(msg.Values.id);\n\t\t}\n\t\telse if (msg.MessageId === 'Show_Menubar') {\n\t\t\tthis._map.uiManager.showMenubar();\n\t\t}\n\t\telse if (msg.MessageId === 'Hide_Menubar') {\n\t\t\tthis._map.uiManager.hideMenubar();\n\t\t}\n\t\telse if (msg.MessageId === 'Show_Ruler') {\n\t\t\tthis._map.uiManager.showRuler();\n\t\t}\n\t\telse if (msg.MessageId === 'Hide_Ruler') {\n\t\t\tthis._map.uiManager.hideRuler();\n\t\t}\n\t\telse if (msg.MessageId === 'Show_Menu_Item' || msg.MessageId === 'Hide_Menu_Item') {\n\t\t\tif (!msg.Values) {\n\t\t\t\twindow.app.console.error('Property \"Values\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!msg.Values.id) {\n\t\t\t\twindow.app.console.error('Property \"Values.id\" not set');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!this._map.menubar || !this._map.menubar.hasItem(msg.Values.id)) {\n\t\t\t\twindow.app.console.error('Menu item with id \"' + msg.Values.id + '\" not found.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (msg.MessageId === 'Show_Menu_Item') {\n\t\t\t\tthis._map.menubar.showItem(msg.Values.id);\n\t\t\t} else {\n\t\t\t\tthis._map.menubar.hideItem(msg.Values.id);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Insert_Button' &&\n\t\t\tmsg.Values && msg.Values.id && msg.Values.imgurl) {\n\t\t\tthis._map.uiManager.insertButton(msg.Values);\n\t\t}\n\t\telse if (msg.MessageId === 'Disable_Default_UIAction') {\n\t\t\t// Disable the default handler and action for a UI command.\n\t\t\t// When set to true, the given UI command will issue a postmessage\n\t\t\t// only. For example, UI_Save will be issued for invoking the save\n\t\t\t// command (from the menu, toolbar, or keyboard shortcut) and no\n\t\t\t// action will take place if 'UI_Save' is disabled via\n\t\t\t// the Disable_Default_UIAction command.\n\t\t\tif (msg.Values && msg.Values.action && msg.Values.disable !== undefined) {\n\t\t\t\tthis._map._disableDefaultAction[msg.Values.action] = msg.Values.disable;\n\t\t\t}\n\t\t}\n\n\t\t// All following actions must be done after initialization is completed.\n\t\tif (!window.WOPIPostmessageReady) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (msg.MessageId === 'Host_PostmessageReady') {\n\t\t\t// We already have a listener for this in cool.html, so ignore it here\n\t\t\treturn;\n\t\t}\n\n\t\tif (msg.MessageId === 'Grab_Focus') {\n\t\t\tthis._map.makeActive();\n\t\t\treturn;\n\t\t}\n\n\t\t// allow closing documents before they are completely loaded\n\t\tif (msg.MessageId === 'Close_Session') {\n\t\t\tapp.socket.sendMessage('closedocument');\n\t\t\treturn;\n\t\t}\n\n\t\t// For all other messages, warn if trying to interact before we are completely loaded\n\t\tif (!this._appLoaded) {\n\t\t\twindow.app.console.error('Collabora Online not loaded yet. Listen for App_LoadingStatus (Document_Loaded) event before using PostMessage API. Ignoring post message \\'' + msg.MessageId + '\\'.');\n\t\t\treturn;\n\t\t}\n\n\t\tif (msg.MessageId === 'Set_Settings') {\n\t\t\tif (msg.Values) {\n\t\t\t\tvar alwaysActive = msg.Values.AlwaysActive;\n\t\t\t\tthis._map.options.alwaysActive = !!alwaysActive;\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Get_Views') {\n\t\t\tthis._postViewsMessage('Get_Views_Resp');\n\t\t}\n\t\telse if (msg.MessageId === 'Action_Save') {\n\t\t\tvar dontTerminateEdit = msg.Values && msg.Values['DontTerminateEdit'];\n\t\t\tvar dontSaveIfUnmodified = msg.Values && msg.Values['DontSaveIfUnmodified'];\n\t\t\tvar extendedData = msg.Values && msg.Values['ExtendedData'];\n\t\t\textendedData = encodeURIComponent(extendedData);\n\t\t\tthis._notifySave = msg.Values && msg.Values['Notify'];\n\n\t\t\tthis._map.save(dontTerminateEdit, dontSaveIfUnmodified, extendedData);\n\t\t}\n\t\telse if (msg.MessageId === 'Action_Close') {\n\t\t\tthis._map.remove();\n\t\t}\n\t\telse if (msg.MessageId === 'Action_Print') {\n\t\t\tthis._map.print();\n\t\t}\n\t\telse if (msg.MessageId === 'Action_Export') {\n\t\t\tif (msg.Values) {\n\t\t\t\tvar format = msg.Values.Format;\n\t\t\t\tvar fileName = this._map['wopi'].BaseFileName;\n\t\t\t\tfileName = fileName.substr(0, fileName.lastIndexOf('.'));\n\t\t\t\tfileName = fileName === '' ? 'document' : fileName;\n\t\t\t\tthis._map.downloadAs(fileName + '.' + format, format);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId == 'Action_InsertGraphic') {\n\t\t\tif (msg.Values) {\n\t\t\t\tthis._map.insertURL(msg.Values.url);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Action_InsertFile') {\n\t\t\tif (msg.Values && (msg.Values.File instanceof Blob)) {\n\t\t\t\tthis._map.fire('insertfile', {file: msg.Values.File});\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId == 'Action_Paste') {\n\t\t\tif (msg.Values && msg.Values.Mimetype && msg.Values.Data) {\n\t\t\t\tvar blob = new Blob(['paste mimetype=' + msg.Values.Mimetype + '\\n', msg.Values.Data]);\n\t\t\t\tapp.socket.sendMessage(blob);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Action_ShowBusy') {\n\t\t\tif (msg.Values && msg.Values.Label) {\n\t\t\t\tthis._map.fire('showbusy', {label: msg.Values.Label});\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Action_HideBusy') {\n\t\t\tthis._map.fire('hidebusy');\n\t\t}\n\t\telse if (msg.MessageId === 'Get_Export_Formats') {\n\t\t\tvar exportFormatsResp = [];\n\t\t\tfor (var index in this._map._docLayer._exportFormats) {\n\t\t\t\texportFormatsResp.push({\n\t\t\t\t\tLabel: this._map._docLayer._exportFormats[index].label,\n\t\t\t\t\tFormat: this._map._docLayer._exportFormats[index].format\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._postMessage({msgId: 'Get_Export_Formats_Resp', args: exportFormatsResp});\n\t\t}\n\t\telse if (msg.MessageId === 'Action_SaveAs') {\n\t\t\tif (msg.Values) {\n\t\t\t\tif (msg.Values.Filename !== null && msg.Values.Filename !== undefined) {\n\t\t\t\t\tthis._notifySave = msg.Values['Notify'];\n\t\t\t\t\tthis._map.showBusy(_('Creating copy...'), false);\n\t\t\t\t\tthis._map.saveAs(msg.Values.Filename);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Action_FollowUser') {\n\t\t\tif (msg.Values) {\n\t\t\t\tthis._map._setFollowing(msg.Values.Follow, msg.Values.ViewId);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._map._setFollowing(true, null);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Host_VersionRestore') {\n\t\t\tif (msg.Values.Status === 'Pre_Restore') {\n\t\t\t\tapp.socket.sendMessage('versionrestore prerestore');\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'CallPythonScript' &&\n\t\t\t Object.prototype.hasOwnProperty.call(msg, 'ScriptFile') &&\n\t\t\t Object.prototype.hasOwnProperty.call(msg, 'Function')) {\n\t\t\tthis._map.CallPythonScriptSource = e.source;\n\t\t\tthis._map.sendUnoCommand('vnd.sun.star.script:' + msg.ScriptFile + '$' + msg.Function + '?language=Python&location=share', msg.Values);\n\t\t}\n\t\telse if (msg.MessageId === 'Action_RemoveView') {\n\t\t\tif (msg.Values && msg.Values.ViewId !== null && msg.Values.ViewId !== undefined) {\n\t\t\t\tapp.socket.sendMessage('removesession ' + msg.Values.ViewId);\n\t\t\t}\n\t\t}\n\t\telse if (msg.MessageId === 'Action_ChangeUIMode') {\n\t\t\tif (msg.Values && msg.Values.Mode !== null && msg.Values.Mode !== undefined) {\n\t\t\t\tthis._map.fire('changeuimode', {mode: msg.Values.Mode, force: false});\n\t\t\t}\n\t\t}\n\t},\n\n\t_postMessage: function(e) {\n\t\tif (!this.enabled) { return; }\n\t\tvar msgId = e.msgId;\n\t\tvar values = e.args || {};\n\t\tif (!!this.PostMessageOrigin && window.parent !== window.self) {\n\t\t\t// Filter out unwanted save request response\n\t\t\tif (msgId === 'Action_Save_Resp') {\n\t\t\t\tif (!this._notifySave)\n\t\t\t\t\treturn;\n\n\t\t\t\tthis._notifySave = false;\n\t\t\t}\n\n\t\t\tvar msg = {\n\t\t\t\t'MessageId': msgId,\n\t\t\t\t'SendTime': Date.now(),\n\t\t\t\t'Values': values\n\t\t\t};\n\t\t\twindow.parent.postMessage(JSON.stringify(msg), this.PostMessageOrigin);\n\t\t}\n\t},\n\n\t_postViewsMessage: function(messageId) {\n\t\tvar getMembersRespVal = [];\n\t\tfor (var viewInfoIdx in this._map._viewInfo) {\n\t\t\tgetMembersRespVal.push({\n\t\t\t\tViewId: viewInfoIdx,\n\t\t\t\tUserName: this._map._viewInfo[viewInfoIdx].username,\n\t\t\t\tUserId: this._map._viewInfo[viewInfoIdx].userid,\n\t\t\t\tUserExtraInfo: this._map._viewInfo[viewInfoIdx].userextrainfo,\n\t\t\t\tColor: this._map._viewInfo[viewInfoIdx].color,\n\t\t\t\tReadOnly: this._map._viewInfo[viewInfoIdx].readonly,\n\t\t\t\tIsCurrentView: this._map._docLayer._viewId === parseInt(viewInfoIdx, 10)\n\t\t\t});\n\t\t}\n\n\t\tthis._postMessage({msgId: messageId, args: getMembersRespVal});\n\t}\n});\n\n// This handler would only get 'enabled' by map if map.options.wopi = true\nL.Map.addInitHook('addHandler', 'wopi', L.Map.WOPI);\n"]}
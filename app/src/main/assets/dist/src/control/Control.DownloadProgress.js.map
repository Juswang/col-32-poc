{"version":3,"file":"Control.DownloadProgress.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.DownloadProgress.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.DownloadProgress.\n */\n/* global _ $ */\nL.Control.DownloadProgress = L.Control.extend({\n\toptions: {\n\t\tposition: 'bottomright'\n\t},\n\n\tinitialize: function (options) {\n\t\tL.setOptions(this, options);\n\t},\n\n\tonAdd: function () {\n\t\tthis._initLayout();\n\t\treturn this._container;\n\t},\n\n\t// we really don't want mouse and other events propagating\n\t// to the parent map - since they affect the context.\n\t_ignoreEvents: function(elem) {\n\t\tL.DomEvent.on(elem, 'mousedown mouseup mouseover mouseout mousemove',\n\t\t\t      function(e) {\n\t\t\t\t      L.DomEvent.stopPropagation(e);\n\t\t\t\t      return false;\n\t\t\t      }, this);\n\t},\n\n\t_initLayout: function () {\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-layers');\n\t\tthis._container.style.visibility = 'hidden';\n\t\tthis._ignoreEvents(this._container);\n\n\t\tvar closeButton = L.DomUtil.create('a', 'leaflet-popup-close-button', this._container);\n\t\tcloseButton.href = '#close';\n\t\tcloseButton.innerHTML = '&#215;';\n\t\tL.DomEvent.on(closeButton, 'click', this._onClose, this);\n\n\t\tvar wrapper = L.DomUtil.create('div', 'leaflet-popup-content-wrapper', this._container);\n\t\tvar content = this._content = L.DomUtil.create('div', 'leaflet-popup-content', wrapper);\n\t\tcontent.style.width  = '100px';\n\n\t\t// start download button\n\t\tvar startDownload = this._downloadButton = document.createElement('a');\n\t\tstartDownload.href = '#start';\n\t\tstartDownload.innerHTML = _('Start download');\n\t\tstartDownload.style.font = '13px/11px Tahoma, Verdana, sans-serif';\n\t\tstartDownload.style.alignment = 'center';\n\t\tstartDownload.style.height = 20 + 'px';\n\t\tL.DomEvent.on(startDownload, 'click', this._onStartDownload, this);\n\n\t\t// download progress bar\n\t\tthis._progress = L.DomUtil.create('div', 'leaflet-paste-progress', null);\n\t\tthis._bar = L.DomUtil.create('span', '', this._progress);\n\t\tthis._value = L.DomUtil.create('span', '', this._bar);\n\t\tL.DomUtil.setStyle(this._value, 'line-height', '14px');\n\n\t\t// confirm button\n\t\tvar confirmCopy = this._confirmPasteButton = document.createElement('a');\n\t\tconfirmCopy.href = '#complete';\n\t\tconfirmCopy.innerHTML = _('Confirm copy to clipboard');\n\t\tconfirmCopy.style.font = '13px/11px Tahoma, Verdana, sans-serif';\n\t\tconfirmCopy.style.alignment = 'center';\n\t\tconfirmCopy.style.height = 20 + 'px';\n\t\tL.DomEvent.on(confirmCopy, 'click', this._onConfirmCopyAction, this);\n\t},\n\n\tshow: function () {\n\t\twindow.app.console.log('DownloadProgress.show');\n\t\t// better to init the following state variables here,\n\t\t// since the widget could be re-used without having been destroyed\n\t\tthis._started = false;\n\t\tthis._complete = false;\n\t\tthis._closed = false;\n\t\tthis._content.appendChild(this._downloadButton);\n\t\tthis._container.style.visibility = '';\n\t},\n\n\tisClosed: function () {\n\t\treturn this._closed;\n\t},\n\n\tisStarted: function () {\n\t\treturn this._started;\n\t},\n\n\tcurrentStatus: function () {\n\t\tif (this._closed)\n\t\t\treturn 'closed';\n\t\tif (this._content.contains(this._downloadButton))\n\t\t\treturn 'downloadButton';\n\t\tif (this._content.contains(this._progress))\n\t\t\treturn 'progress';\n\t\tif (this._content.contains(this._confirmPasteButton))\n\t\t\treturn 'confirmPasteButton';\n\t},\n\n\tsetURI: function (uri) {\n\t\t// set up data uri to be downloaded\n\t\tthis._uri = uri;\n\t},\n\n\tsetValue: function (value) {\n\t\tthis._bar.style.width = value + '%';\n\t\tthis._value.innerHTML = value + '%';\n\t},\n\n\t_setProgressCursor: function() {\n\t\t$('#map').css('cursor', 'progress');\n\t},\n\n\t_setNormalCursor: function() {\n\t\t$('#map').css('cursor', 'default');\n\t},\n\n\tstartProgressMode: function() {\n\t\tthis._setProgressCursor();\n\t\tthis._started = true;\n\t\tthis.setValue(0);\n\t\tthis._content.removeChild(this._downloadButton);\n\t\tthis._content.appendChild(this._progress);\n\t},\n\n\t_onStartDownload: function () {\n\t\tif (!this._uri)\n\t\t\treturn;\n\t\tthis.startProgressMode();\n\t\tthis._download();\n\t},\n\n\t_onUpdateProgress: function (e) {\n\t\tif (e.statusType === 'setvalue') {\n\t\t\tthis.setValue(e.value);\n\t\t}\n\t\telse if (e.statusType === 'finish') {\n\t\t\tthis._onComplete();\n\t\t}\n\t},\n\n\t_onComplete: function () {\n\t\tif (this._complete)\n\t\t\treturn;\n\t\tthis._setNormalCursor();\n\t\tthis._complete = true;\n\t\tif (this._content.contains(this._progress))\n\t\t\tthis._content.removeChild(this._progress);\n\t\tthis._content.style.width  = '150px';\n\t\tthis._content.appendChild(this._confirmPasteButton);\n\t},\n\n\t_onConfirmCopyAction: function () {\n\t\tthis._map._clip.filterExecCopyPaste('.uno:Copy');\n\t\tthis._onClose();\n\t},\n\n\t_onClose: function () {\n\t\tthis._setNormalCursor();\n\t\tthis._cancelDownload();\n\t\tif (this._content.contains(this._confirmPasteButton))\n\t\t\tthis._content.removeChild(this._confirmPasteButton);\n\t\tif (this._content.contains(this._progress))\n\t\t\tthis._content.removeChild(this._progress);\n\t\tif (this._map)\n\t\t\tthis._map.focus();\n\t\tthis.remove();\n\t\tthis._closed = true;\n\t},\n\n\t_download: function () {\n\t\tvar that = this;\n\t\tthis._map._clip._doAsyncDownload(\n\t\t\t'GET', that._uri, null, true,\n\t\t\tfunction(response) {\n\t\t\t\twindow.app.console.log('clipboard async download done');\n\t\t\t\t// annoying async parse of the blob ...\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\treader.onload = function() {\n\t\t\t\t\tvar text = reader.result;\n\t\t\t\t\twindow.app.console.log('async clipboard parse done: ' + text.substring(0, 256));\n\t\t\t\t\tvar idx = text.indexOf('<!DOCTYPE HTML');\n\t\t\t\t\tif (idx > 0)\n\t\t\t\t\t\ttext = text.substring(idx, text.length);\n\t\t\t\t\tthat._map._clip.setTextSelectionHTML(text);\n\t\t\t\t};\n\t\t\t\t// TODO: failure to parse ? ...\n\t\t\t\treader.readAsText(response);\n\t\t\t},\n\t\t\tfunction(progress) { return progress/2; }\n\t\t);\n\t},\n\n\t_cancelDownload: function () {\n\t\tthis._setNormalCursor();\n\t\tif (!this._started || this._complete)\n\t\t\treturn;\n\t\t// TODO: insert code for cancelling an async download\n\t}\n});\n\nL.control.downloadProgress = function (options) {\n\treturn new L.Control.DownloadProgress(options);\n};\n"]}
{"version":3,"file":"Control.UIManager.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.UIManager.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.UIManager - initializes the UI elements like toolbars, menubar or ruler\n\t\t\t and allows to controll them (show/hide)\n */\n\n/* global app $ setupToolbar w2ui toolbarUpMobileItems _ Hammer */\nL.Control.UIManager = L.Control.extend({\n\tmobileWizard: null,\n\tblockedUI: false,\n\tbusyPopupTimer: null,\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\t\tthis.notebookbar = null;\n\t\t// Every time the UI mode changes from 'classic' to 'notebookbar'\n\t\t// the two below elements will be destroyed.\n\t\t// Here we save the original state of the elements, as provided\n\t\t// by server, in order to apply to them the same initialization\n\t\t// code when activating the 'classic' mode as if the elements are\n\t\t// initialized for the first time since the start of the application.\n\t\t// It is important to use the same initial structure provided by server\n\t\t// in order to keep a single place (server) of initial properties setting.\n\t\tthis.map.toolbarUpTemplate = $('#toolbar-up')[0].cloneNode(true);\n\t\tthis.map.mainMenuTemplate = $('#main-menu')[0].cloneNode(true);\n\n\t\tmap.on('updatepermission', this.onUpdatePermission, this);\n\n\t\tif (window.mode.isMobile()) {\n\t\t\twindow.addEventListener('popstate', this.onGoBack.bind(this));\n\n\t\t\t// provide entries in the history we can catch to close the app\n\t\t\thistory.pushState({context: 'app-started'}, 'app-started');\n\t\t\thistory.pushState({context: 'app-started'}, 'app-started');\n\t\t}\n\n\t\tmap.on('blockUI', this.blockUI, this);\n\t\tmap.on('unblockUI', this.unblockUI, this);\n\t},\n\n\t// UI initialization\n\n\tgetCurrentMode: function() {\n\t\treturn this.shouldUseNotebookbarMode() ? 'notebookbar' : 'classic';\n\t},\n\n\tshouldUseNotebookbarMode: function() {\n\t\tvar forceCompact = this.getSavedStateOrDefault('CompactMode', null);\n\t\treturn (window.userInterfaceMode === 'notebookbar' && forceCompact === null)\n\t\t\t|| forceCompact === false;\n\t},\n\n\tinitializeBasicUI: function() {\n\t\tvar enableNotebookbar = this.shouldUseNotebookbarMode();\n\t\tvar that = this;\n\n\t\tif (window.mode.isMobile() || !enableNotebookbar) {\n\t\t\tvar menubar = L.control.menubar();\n\t\t\tthis.map.menubar = menubar;\n\t\t\tthis.map.addControl(menubar);\n\t\t}\n\n\t\tif (window.mode.isMobile()) {\n\t\t\t$('#toolbar-mobile-back').on('click', function() {\n\t\t\t\tthat.enterReadonlyOrClose();\n\t\t\t});\n\t\t}\n\n\t\tif (!window.mode.isMobile()) {\n\t\t\tif (!enableNotebookbar) {\n\t\t\t\tthis.map.topToolbar = L.control.topToolbar();\n\t\t\t\tthis.map.addControl(this.map.topToolbar);\n\t\t\t}\n\n\t\t\tthis.map.addControl(L.control.signingBar());\n\t\t\tthis.map.addControl(L.control.statusBar());\n\n\t\t\tthis.map.jsdialog = L.control.jsDialog();\n\t\t\tthis.map.addControl(this.map.jsdialog);\n\n\t\t\tthis.map.sidebar = L.control.sidebar({animSpeed: 200});\n\t\t\tthis.map.addControl(this.map.sidebar);\n\n\t\t\tthis.map.addControl(L.control.mobileWizardPopup());\n\t\t}\n\n\t\tsetupToolbar(this.map);\n\n\t\tthis.map.addControl(L.control.documentNameInput());\n\t\tthis.map.addControl(L.control.alertDialog());\n\t\tthis.mobileWizard = L.control.mobileWizard();\n\t\tthis.map.addControl(this.mobileWizard);\n\t\tthis.map.addControl(L.control.languageDialog());\n\t\tthis.map.dialog = L.control.lokDialog();\n\t\tthis.map.addControl(this.map.dialog);\n\t\tthis.map.addControl(L.control.contextMenu());\n\t\tthis.map.addControl(L.control.infobar());\n\t\tthis.map.addControl(L.control.userList());\n\n\t\tvar openBusyPopup = function(label) {\n\t\t\tthis.busyPopupTimer = setTimeout(function() {\n\t\t\t\tvar json = {\n\t\t\t\t\tid: 'busypopup',\n\t\t\t\t\tjsontype: 'dialog',\n\t\t\t\t\ttype: 'modalpopup',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'busycontainer',\n\t\t\t\t\t\t\ttype: 'container',\n\t\t\t\t\t\t\tvertical: 'true',\n\t\t\t\t\t\t\tchildren: [\n\t\t\t\t\t\t\t\t{id: 'busyspinner', type: 'spinnerimg'},\n\t\t\t\t\t\t\t\t{id: 'busylabel', type: 'fixedtext', text: label}\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t]\n\t\t\t\t};\n\t\t\t\tif (app.socket)\n\t\t\t\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json)});\n\t\t\t}, 700);\n\t\t};\n\n\t\tvar fadeoutBusyPopup = function() {\n\t\t\tclearTimeout(this.busyPopupTimer);\n\t\t\tvar json = {\n\t\t\t\tid: 'busypopup',\n\t\t\t\tjsontype: 'dialog',\n\t\t\t\ttype: 'modalpopup',\n\t\t\t\taction: 'fadeout'\n\t\t\t};\n\t\t\tif (app.socket)\n\t\t\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json)});\n\t\t};\n\n\t\tthis.map.on('showbusy', function(e) {\n\t\t\tfadeoutBusyPopup();\n\t\t\topenBusyPopup(e.label);\n\t\t});\n\n\t\tthis.map.on('hidebusy', function() {\n\t\t\tfadeoutBusyPopup();\n\t\t});\n\t},\n\n\tinitializeSpecializedUI: function(docType) {\n\t\tvar isDesktop = window.mode.isDesktop();\n\t\tvar currentMode = this.getCurrentMode();\n\t\tvar enableNotebookbar = currentMode === 'notebookbar';\n\n\t\tdocument.body.setAttribute('data-userInterfaceMode', currentMode);\n\n\t\tif (window.mode.isMobile()) {\n\t\t\t$('#mobile-edit-button').show();\n\t\t\tthis.map.addControl(L.control.mobileBottomBar(docType));\n\t\t\tthis.map.addControl(L.control.mobileTopBar(docType));\n\t\t\tthis.map.addControl(L.control.searchBar());\n\t\t} else if (enableNotebookbar) {\n\t\t\tthis.createNotebookbarControl(docType);\n\t\t\t// makeSpaceForNotebookbar call in onUpdatePermission\n\t\t}\n\n\t\tif (docType === 'spreadsheet') {\n\t\t\tthis.map.addControl(L.control.sheetsBar({shownavigation: isDesktop || window.mode.isTablet()}));\n\t\t\tthis.map.addControl(L.control.formulaBar());\n\t\t\tvar formulabar = L.control.formulaBarJSDialog();\n\t\t\tthis.map.formulabar = formulabar;\n\t\t\tthis.map.addControl(formulabar);\n\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('presentation-controls-wrapper'));\n\t\t\tdocument.getElementById('selectbackground').parentNode.removeChild(document.getElementById('selectbackground'));\n\t\t}\n\n\t\tif (this.map.isPresentationOrDrawing()) {\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('spreadsheet-toolbar'));\n\t\t\t$('#presentation-controls-wrapper').show();\n\t\t}\n\n\t\tif (docType === 'text') {\n\t\t\t// remove unused elements\n\t\t\tL.DomUtil.remove(L.DomUtil.get('spreadsheet-toolbar'));\n\t\t\tL.DomUtil.remove(L.DomUtil.get('presentation-controls-wrapper'));\n\t\t\tdocument.getElementById('selectbackground').parentNode.removeChild(document.getElementById('selectbackground'));\n\n\t\t\tif ((window.mode.isTablet() || window.mode.isDesktop()) && window.docPermission === 'edit') {\n\t\t\t\tvar showRuler = this.getSavedStateOrDefault('ShowRuler');\n\t\t\t\tvar interactiveRuler = this.map.isPermissionEdit();\n\t\t\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\t\t\t\tL.control.ruler({position: (isRTL ? 'topright' : 'topleft'), interactive:interactiveRuler, showruler: showRuler}).addTo(this.map);\n\t\t\t\tthis.map.fire('rulerchanged');\n\t\t\t}\n\n\t\t\tvar showResolved = this.getSavedStateOrDefault('ShowResolved');\n\t\t\tif (showResolved === false || showResolved === 'false')\n\t\t\t\tthis.map.sendUnoCommand('.uno:ShowResolvedAnnotations');\n\t\t}\n\n\t\tif (this.map.isPresentationOrDrawing() && (isDesktop || window.mode.isTablet())) {\n\t\t\tthis.map.addControl(L.control.presentationBar());\n\t\t}\n\n\t\tif (window.mode.isMobile() || (window.mode.isTablet() && !enableNotebookbar)) {\n\t\t\tthis.map.on('updatetoolbarcommandvalues', function() {\n\t\t\t\tw2ui['editbar'].refresh();\n\t\t\t});\n\t\t}\n\n\t\tthis.map.on('changeuimode', this.onChangeUIMode, this);\n\t},\n\n\tinitializeSidebar: function() {\n\t\t// Hide the sidebar on start if saved state or UIDefault is set.\n\t\tif (window.mode.isDesktop() && !window.ThisIsAMobileApp) {\n\t\t\tvar showSidebar = this.getSavedStateOrDefault('ShowSidebar');\n\n\t\t\tif (showSidebar === false)\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t}\n\t\telse if (window.mode.isChromebook()) {\n\t\t\t// HACK - currently the sidebar shows when loaded,\n\t\t\t// with the exception of mobile phones & tablets - but\n\t\t\t// there, it does not show only because they start\n\t\t\t// with read/only mode which hits an early exit in\n\t\t\t// _launchSidebar() in Control.LokDialog.js\n\t\t\t// So for the moment, let's just hide it on\n\t\t\t// Chromebooks early\n\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t}\n\t},\n\n\tremoveClassicUI: function() {\n\t\tif (this.map.menubar)\n\t\t{\n\t\t\tthis.map.removeControl(this.map.menubar);\n\t\t\tthis.map.menubar = null;\n\t\t}\n\t\tif (this.map.topToolbar)\n\t\t{\n\t\t\tthis.map.removeControl(this.map.topToolbar);\n\t\t\tthis.map.topToolbar = null;\n\t\t}\n\t},\n\n\taddClassicUI: function() {\n\t\tthis.map.menubar = L.control.menubar();\n\t\tthis.map.addControl(this.map.menubar);\n\t\tthis.map.topToolbar = L.control.topToolbar();\n\t\tthis.map.addControl(this.map.topToolbar);\n\n\t\tthis.map.menubar._onDocLayerInit();\n\t\tthis.map.topToolbar.onDocLayerInit();\n\t\tthis.map.sendInitUNOCommands();\n\t\tthis.map._docLayer._resetClientVisArea();\n\t\tthis.map._docLayer._requestNewTiles();\n\n\t\tthis.map.topToolbar.updateControlsState();\n\t},\n\n\tcreateNotebookbarControl: function(docType) {\n\t\tif (docType === 'spreadsheet') {\n\t\t\tvar notebookbar = L.control.notebookbarCalc();\n\t\t} else if (docType === 'presentation') {\n\t\t\tnotebookbar = L.control.notebookbarImpress();\n\t\t} else if (docType === 'drawing') {\n\t\t\tnotebookbar = L.control.notebookbarDraw();\n\t\t} else {\n\t\t\tnotebookbar = L.control.notebookbarWriter();\n\t\t}\n\n\t\tthis.notebookbar = notebookbar;\n\t\tthis.map.addControl(notebookbar);\n\t},\n\n\taddNotebookbarUI: function() {\n\t\tthis.createNotebookbarControl(this.map.getDocType());\n\n\t\tthis.notebookbar._showNotebookbar = true;\n\t\tthis.notebookbar.showTabs();\n\t\t$('.main-nav').removeClass('readonly');\n\n\t\t$('#map').addClass('notebookbar-opened');\n\n\t\tthis.map.sendInitUNOCommands();\n\t\tthis.map._docLayer._resetClientVisArea();\n\t\tthis.map._docLayer._requestNewTiles();\n\t},\n\n\tremoveNotebookbarUI: function() {\n\t\tif (this.notebookbar) {\n\t\t\tthis.map.removeControl(this.notebookbar);\n\t\t\tthis.notebookbar = null;\n\t\t}\n\t\t$('#map').removeClass('notebookbar-opened');\n\t},\n\n\tonChangeUIMode: function(uiMode) {\n\t\tif (window.mode.isMobile())\n\t\t\treturn;\n\n\t\tvar currentMode = this.getCurrentMode();\n\n\t\tif (uiMode.mode === currentMode && !uiMode.force)\n\t\t\treturn;\n\n\t\tif (uiMode.mode !== 'classic' && uiMode.mode !== 'notebookbar')\n\t\t\treturn;\n\n\t\tdocument.body.setAttribute('data-userInterfaceMode', uiMode.mode);\n\n\t\tthis.map.fire('postMessage', {msgId: 'Action_ChangeUIMode_Resp', args: {Mode: uiMode}});\n\n\t\tswitch (currentMode) {\n\t\tcase 'classic':\n\t\t\tthis.removeClassicUI();\n\t\t\tbreak;\n\n\t\tcase 'notebookbar':\n\t\t\tthis.removeNotebookbarUI();\n\t\t\tbreak;\n\t\t}\n\n\t\twindow.userInterfaceMode = uiMode.mode;\n\n\t\tswitch (uiMode.mode) {\n\t\tcase 'classic':\n\t\t\tthis.addClassicUI();\n\t\t\tbreak;\n\n\t\tcase 'notebookbar':\n\t\t\tthis.addNotebookbarUI();\n\t\t\tbreak;\n\t\t}\n\n\t\tthis.setSavedState('CompactMode', uiMode.mode === 'classic');\n\t\tthis.initializeSidebar();\n\t},\n\n\t// UI modification\n\n\tinsertButtonToClassicToolbar: function(button) {\n\t\tif (!w2ui['editbar'].get(button.id)) {\n\t\t\tif (this.map.isPermissionEdit()) {\n\t\t\t\t// add the css rule for the image\n\t\t\t\tvar style = $('html > head > style');\n\t\t\t\tif (style.length == 0)\n\t\t\t\t\t$('html > head').append('<style/>');\n\t\t\t\t$('html > head > style').append('.w2ui-icon.' + button.id + '{background: url(' + button.imgurl + ') no-repeat center !important; }');\n\n\t\t\t\t// Position: Either specified by the caller, or defaulting to first position (before save)\n\t\t\t\tvar insertBefore = button.insertBefore || 'save';\n\t\t\t\t// add the item to the toolbar\n\t\t\t\tw2ui['editbar'].insert(insertBefore, [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'button',\n\t\t\t\t\t\tuno: button.unoCommand,\n\t\t\t\t\t\tid: button.id,\n\t\t\t\t\t\timg: button.id,\n\t\t\t\t\t\thint: _(button.hint), /* \"Try\" to localize ! */\n\t\t\t\t\t\t/* Notify the host back when button is clicked (only when unoCommand is not set) */\n\t\t\t\t\t\tpostmessage: !Object.prototype.hasOwnProperty.call(button, 'unoCommand')\n\t\t\t\t\t}\n\t\t\t\t]);\n\t\t\t\tif (button.mobile)\n\t\t\t\t{\n\t\t\t\t\t// Add to our list of items to preserve when in mobile mode\n\t\t\t\t\t// FIXME: Wrap the toolbar in a class so that we don't make use\n\t\t\t\t\t// global variables and functions like this\n\t\t\t\t\tvar idx = toolbarUpMobileItems.indexOf(insertBefore);\n\t\t\t\t\ttoolbarUpMobileItems.splice(idx, 0, button.id);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (this.map.isPermissionReadOnly()) {\n\t\t\t\t// Just add a menu entry for it\n\t\t\t\tthis.map.fire('addmenu', {id: button.id, label: button.hint});\n\t\t\t}\n\t\t}\n\t},\n\n\tinsertButton: function(button) {\n\t\tif (!this.notebookbar)\n\t\t\tthis.insertButtonToClassicToolbar(button);\n\t\telse\n\t\t\tthis.notebookbar.insertButtonToShortcuts(button);\n\t},\n\n\tshowButtonInClassicToolbar: function(buttonId, show) {\n\t\tvar toolbars = [w2ui['toolbar-up'], w2ui['actionbar'], w2ui['editbar']];\n\t\tvar found = false;\n\n\t\ttoolbars.forEach(function(toolbar) {\n\t\t\tif (toolbar && toolbar.get(buttonId)) {\n\t\t\t\tfound = true;\n\t\t\t\tif (show) {\n\t\t\t\t\ttoolbar.show(buttonId);\n\t\t\t\t} else {\n\t\t\t\t\ttoolbar.hide(buttonId);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif (!found) {\n\t\t\twindow.app.console.error('Toolbar button with id \"' + buttonId + '\" not found.');\n\t\t\treturn;\n\t\t}\n\t},\n\n\tshowButton: function(buttonId, show) {\n\t\tif (!this.notebookbar)\n\t\t\tthis.showButtonInClassicToolbar(buttonId, show);\n\t\telse\n\t\t\tthis.notebookbar.showShortcutsButton(buttonId, show);\n\t},\n\n\t// Menubar\n\n\tshowMenubar: function() {\n\t\tif (!this.isMenubarHidden())\n\t\t\treturn;\n\t\t$('.main-nav').show();\n\t\tif (L.Params.closeButtonEnabled && !window.mode.isTablet()) {\n\t\t\t$('#closebuttonwrapper').show();\n\t\t}\n\n\t\tvar obj = $('.unfold');\n\t\tobj.removeClass('w2ui-icon unfold');\n\t\tobj.addClass('w2ui-icon fold');\n\t},\n\n\thideMenubar: function() {\n\t\tif (this.isMenubarHidden())\n\t\t\treturn;\n\t\t$('.main-nav').hide();\n\t\tif (L.Params.closeButtonEnabled) {\n\t\t\t$('#closebuttonwrapper').hide();\n\t\t}\n\n\t\tvar obj = $('.fold');\n\t\tobj.removeClass('w2ui-icon fold');\n\t\tobj.addClass('w2ui-icon unfold');\n\t},\n\n\tisMenubarHidden: function() {\n\t\treturn $('.main-nav').css('display') === 'none';\n\t},\n\n\ttoggleMenubar: function() {\n\t\tif (this.isMenubarHidden())\n\t\t\tthis.showMenubar();\n\t\telse\n\t\t\tthis.hideMenubar();\n\t},\n\n\t// Ruler\n\n\tshowRuler: function() {\n\t\t$('.cool-ruler').show();\n\t\t$('#map').addClass('hasruler');\n\t\tthis.setSavedState('ShowRuler', true);\n\t\tthis.map.fire('rulerchanged');\n\t},\n\n\thideRuler: function() {\n\t\t$('.cool-ruler').hide();\n\t\t$('#map').removeClass('hasruler');\n\t\tthis.setSavedState('ShowRuler', false);\n\t\tthis.map.fire('rulerchanged');\n\t},\n\n\ttoggleRuler: function() {\n\t\tif (this.isRulerVisible())\n\t\t\tthis.hideRuler();\n\t\telse\n\t\t\tthis.showRuler();\n\t},\n\n\tisRulerVisible: function() {\n\t\treturn $('.cool-ruler').is(':visible');\n\t},\n\n\tisFullscreen: function() {\n\t\tif (!document.fullscreenElement &&\n\t\t\t!document.mozFullscreenElement &&\n\t\t\t!document.msFullscreenElement &&\n\t\t\t!document.webkitFullscreenElement)\n\t\t\treturn false;\n\t\telse\n\t\t\treturn true;\n\t},\n\n\t// Notebookbar helpers\n\n\thasNotebookbarShown: function() {\n\t\treturn $('#map').hasClass('notebookbar-opened');\n\t},\n\n\tmakeSpaceForNotebookbar: function() {\n\t\tif (this.hasNotebookbarShown())\n\t\t\treturn;\n\n\t\t$('#map').addClass('notebookbar-opened');\n\t},\n\n\tcollapseNotebookbar: function() {\n\t\tif (this.isNotebookbarCollapsed())\n\t\t\treturn;\n\n\t\tthis.moveObjectVertically($('#formulabar'), -1);\n\t\t$('#toolbar-wrapper').css('display', 'none');\n\n\t\t$('#document-container').addClass('tabs-collapsed');\n\n\t\tthis.map._docLayer._syncTileContainerSize();\n\t},\n\n\textendNotebookbar: function() {\n\t\tif (!this.isNotebookbarCollapsed())\n\t\t\treturn;\n\n\t\tthis.moveObjectVertically($('#formulabar'), 1);\n\t\t$('#toolbar-wrapper').css('display', '');\n\n\t\t$('#document-container').removeClass('tabs-collapsed');\n\n\t\tthis.map._docLayer._syncTileContainerSize();\n\t},\n\n\tisNotebookbarCollapsed: function() {\n\t\treturn $('#document-container').hasClass('tabs-collapsed');\n\t},\n\n\t// UI Defaults functions\n\n\tshowStatusBar: function() {\n\t\t$('#document-container').css('bottom', this.documentBottom);\n\t\t$('#toolbar-down').show();\n\t\tthis.setSavedState('ShowStatusbar', true);\n\t\tthis.map.fire('statusbarchanged');\n\t},\n\n\thideStatusBar: function(firstStart) {\n\t\tif (!firstStart && !this.isStatusBarVisible())\n\t\t\treturn;\n\n\t\tthis.documentBottom = $('#document-container').css('bottom');\n\t\t$('#document-container').css('bottom', '0px');\n\t\t$('#toolbar-down').hide();\n\t\tif (!firstStart)\n\t\t\tthis.setSavedState('ShowStatusbar', false);\n\t\tthis.map.fire('statusbarchanged');\n\t},\n\n\ttoggleStatusBar: function() {\n\t\tif (this.isStatusBarVisible())\n\t\t\tthis.hideStatusBar();\n\t\telse\n\t\t\tthis.showStatusBar();\n\t},\n\n\tisStatusBarVisible: function() {\n\t\treturn $('#toolbar-down').is(':visible');\n\t},\n\n\t// Event handlers\n\n\tonUpdatePermission: function(e) {\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (e.perm === 'edit') {\n\t\t\t\thistory.pushState({context: 'app-started'}, 'edit-mode');\n\t\t\t\t$('#toolbar-down').show();\n\t\t\t}\n\t\t\telse {\n\t\t\t\thistory.pushState({context: 'app-started'}, 'readonly-mode');\n\t\t\t\t$('#toolbar-down').hide();\n\t\t\t}\n\t\t}\n\n\t\tvar enableNotebookbar = this.shouldUseNotebookbarMode();\n\t\tif (enableNotebookbar && !window.mode.isMobile()) {\n\t\t\tif (e.perm === 'edit') {\n\t\t\t\tif (this.map.menubar) {\n\t\t\t\t\tthis.map.removeControl(this.map.menubar);\n\t\t\t\t\tthis.map.menubar = null;\n\t\t\t\t}\n\t\t\t\tthis.makeSpaceForNotebookbar();\n\t\t\t} else if (e.perm === 'readonly') {\n\t\t\t\tif (!this.map.menubar) {\n\t\t\t\t\tvar menubar = L.control.menubar();\n\t\t\t\t\tthis.map.menubar = menubar;\n\t\t\t\t\tthis.map.addControl(menubar);\n\t\t\t\t}\n\n\t\t\t\tif (this.notebookbar && $('#mobile-edit-button').is(':hidden')) {\n\t\t\t\t\tthis.map.removeControl(this.notebookbar);\n\t\t\t\t\tthis.notebookbar = null;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tapp.socket.sendMessage('uno .uno:SidebarHide');\n\t\t\t}\n\t\t}\n\n\t\t// We've resized the document container.\n\t\tthis.map.invalidateSize();\n\t},\n\n\tenterReadonlyOrClose: function() {\n\t\tif (this.map.isPermissionEdit()) {\n\t\t\t// in edit mode, passing 'edit' actually enters readonly mode\n\t\t\t// and bring the blue circle editmode button back\n\t\t\tthis.map.setPermission('edit');\n\t\t\tvar toolbar = w2ui['actionbar'];\n\t\t\tif (toolbar) {\n\t\t\t\ttoolbar.uncheck('closemobile');\n\t\t\t\ttoolbar.uncheck('close');\n\t\t\t}\n\t\t} else {\n\t\t\twindow.onClose();\n\t\t}\n\t},\n\n\tonGoBack: function(popStateEvent) {\n\t\tif (popStateEvent.state && popStateEvent.state.context) {\n\t\t\tif (popStateEvent.state.context === 'mobile-wizard' && this.mobileWizard) {\n\t\t\t\tif (this.mobileWizard.isOpen()) {\n\t\t\t\t\tthis.mobileWizard.goLevelUp(true);\n\t\t\t\t} else {\n\t\t\t\t\tthis.enterReadonlyOrClose();\n\t\t\t\t}\n\t\t\t} else if (popStateEvent.state.context === 'app-started') {\n\t\t\t\tthis.enterReadonlyOrClose();\n\t\t\t}\n\t\t}\n\t},\n\n\t// Blocking UI\n\n\tisUIBlocked: function() {\n\t\treturn this.blockedUI;\n\t},\n\n\tblockUI: function(event) {\n\t\tthis.blockedUI = true;\n\t\tthis.map.fire('showbusy', {label: event ? event.message : null});\n\t},\n\n\tunblockUI: function() {\n\t\tthis.blockedUI = false;\n\t\tthis.map.fire('hidebusy');\n\t},\n\n\t// Snack bar\n\n\tshowSnackbar: function(label, action, callback) {\n\t\tif (!app.socket)\n\t\t\treturn;\n\n\t\tvar closeJson = {\n\t\t\tid: 'snackbar',\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'snackbar',\n\t\t\taction: 'fadeout'\n\t\t};\n\n\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(closeJson)});\n\n\t\tvar json = {\n\t\t\tid: 'snackbar',\n\t\t\tjsontype: 'dialog',\n\t\t\ttype: 'snackbar',\n\t\t\tchildren: [\n\t\t\t\t{\n\t\t\t\t\ttype: 'container',\n\t\t\t\t\tchildren: [\n\t\t\t\t\t\taction ? {id: 'label', type: 'fixedtext', text: label} : {id: 'label-no-action', type: 'fixedtext', text: label},\n\t\t\t\t\t\taction ? {id: 'button', type: 'pushbutton', text: action} : {}\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t]\n\t\t};\n\n\t\tvar builderCallback = function(objectType, eventType, object, data) {\n\t\t\twindow.app.console.debug('control: \\'' + objectType + '\\' id:\\'' + object.id + '\\' event: \\'' + eventType + '\\' state: \\'' + data + '\\'');\n\n\t\t\tif (object.id === 'button' && objectType === 'pushbutton' && eventType === 'click') {\n\t\t\t\tif (callback)\n\t\t\t\t\tcallback();\n\t\t\t}\n\t\t};\n\n\t\tapp.socket._onMessage({textMsg: 'jsdialog: ' + JSON.stringify(json), callback: builderCallback});\n\t},\n\n\t// Helper functions\n\n\tmoveObjectVertically: function(obj, diff) {\n\t\tif (obj) {\n\t\t\tvar prevTop = obj.css('top');\n\t\t\tif (prevTop) {\n\t\t\t\tprevTop = parseInt(prevTop.slice(0, -2)) + diff;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tprevTop = 0 + diff;\n\t\t\t}\n\t\t\tobj.css({'top': String(prevTop) + 'px'});\n\t\t}\n\t},\n\n\tsetSavedState: function(name, state) {\n\t\tvar docType = (name === 'CompactMode') ? null : this.map.getDocType();\n\t\tif (window.isLocalStorageAllowed)\n\t\t\tlocalStorage.setItem('UIDefaults_' + docType + '_' + name, state);\n\t},\n\n\tgetSavedStateOrDefault: function(name, forcedDefault) {\n\t\tvar retval = forcedDefault !== undefined ? forcedDefault : true;\n\t\t// we request CompactMode very early, no info about doctype so unify all the calls\n\t\tvar docType = (name === 'CompactMode') ? null : this.map.getDocType();\n\t\tvar state = null;\n\t\tif (window.isLocalStorageAllowed)\n\t\t\tstate = localStorage.getItem('UIDefaults_' + docType + '_' + name);\n\t\tswitch (state) {\n\t\tcase 'true':\n\t\t\treturn true;\n\t\tcase 'false':\n\t\t\treturn false;\n\t\tdefault:\n\t\t\t// no saved state; must check the UIDefaults\n\t\t\tif (window.uiDefaults && window.uiDefaults[docType])\n\t\t\t\tretval = window.uiDefaults[docType][name];\n\n\t\t\tif (retval === undefined || retval === null) {\n\t\t\t\tif (forcedDefault !== undefined)\n\t\t\t\t\treturn forcedDefault;\n\t\t\t\telse\n\t\t\t\t\treturn true;\n\t\t\t} else\n\t\t\t\treturn retval;\n\t\t}\n\t},\n\n\tenableTooltip: function(element) {\n\t\tvar elem = $(element);\n\t\tif (window.mode.isDesktop()) {\n\t\t\telem.tooltip();\n\t\t\telem.click(function() {\n\t\t\t\t$('.ui-tooltip').fadeOut(function() {\n\t\t\t\t\t$(this).remove();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t\telse {\n\t\t\telem.tooltip({disabled: true});\n\t\t\t(new Hammer(elem.get(0), {recognizers: [[Hammer.Press]]}))\n\t\t\t\t.on('press', function () {\n\t\t\t\t\telem.tooltip('enable');\n\t\t\t\t\telem.tooltip('open');\n\t\t\t\t\tdocument.addEventListener('touchstart', function closeTooltip () {\n\t\t\t\t\t\telem.tooltip('close');\n\t\t\t\t\t\telem.tooltip('disable');\n\t\t\t\t\t\tdocument.removeEventListener('touchstart', closeTooltip);\n\t\t\t\t\t});\n\t\t\t\t}.bind(this));\n\n\t\t}\n\t}\n});\n\nL.control.uiManager = function () {\n\treturn new L.Control.UIManager();\n};\n"]}
{"version":3,"file":"Control.FormulaBarJSDialog.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.FormulaBarJSDialog.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.FormulaBarJSDialog\n */\n\n/* global _ _UNO UNOKey */\nL.Control.FormulaBarJSDialog = L.Control.extend({\n\tcontainer: null,\n\tbuilder: null,\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\n\t\tthis.map.on('formulabar', this.onFormulaBar, this);\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\n\t\tthis.builder = new L.control.jsDialogBuilder(\n\t\t\t{\n\t\t\t\tmobileWizard: this,\n\t\t\t\tmap: this.map,\n\t\t\t\tcssClass: 'formulabar jsdialog',\n\t\t\t\tcallback: this.callback.bind(this)\n\t\t\t});\n\t},\n\n\tonRemove: function() {\n\t\tthis.map.off('formulabar', this.onFormulaBar, this);\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\t},\n\n\tcreateFormulabar: function(text) {\n\t\tvar data = [\n\t\t\t{\n\t\t\t\ttype: 'toolbox',\n\t\t\t\tchildren: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'functiondialog',\n\t\t\t\t\t\ttype: 'toolitem',\n\t\t\t\t\t\ttext: _('Function Wizard'),\n\t\t\t\t\t\tcommand: '.uno:FunctionDialog'\n\t\t\t\t\t},\n\t\t\t\t\t// on mobile we show other buttons on the top bar\n\t\t\t\t\t(!window.mode.isMobile()) ? (\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'acceptformula',\n\t\t\t\t\t\t\ttype: 'customtoolitem',\n\t\t\t\t\t\t\ttext: _('Accept'),\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t}\n\t\t\t\t\t) : {},\n\t\t\t\t\t(!window.mode.isMobile()) ? (\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tid: 'cancelformula',\n\t\t\t\t\t\t\ttype: 'customtoolitem',\n\t\t\t\t\t\t\ttext: _UNO('.uno:Cancel', 'spreadsheet'),\n\t\t\t\t\t\t\tvisible: false\n\t\t\t\t\t\t}\n\t\t\t\t\t) : {},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: 'sc_input_window',\n\t\t\t\t\t\ttype: 'multilineedit',\n\t\t\t\t\t\ttext: text ? text : '',\n\t\t\t\t\t\trawKeyEvents: true\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t];\n\n\t\tvar wrapper = document.getElementById('calc-inputbar-wrapper');\n\t\twrapper.style.display = 'block';\n\n\t\tvar parent = document.getElementById('calc-inputbar');\n\t\tparent.innerHTML = '';\n\t\tthis.container = L.DomUtil.create('div', 'inputbar_container', parent);\n\t\tthis.container.style.width = '100%';\n\n\t\tthis.builder.build(this.container, data);\n\t},\n\n\tcallback: function(objectType, eventType, object, data, builder) {\n\t\t// in the core we have DrawingArea not TextView\n\t\tif (object.id.indexOf('sc_input_window') === 0) {\n\t\t\tobjectType = 'drawingarea';\n\t\t\tif (eventType === 'keypress' && data === UNOKey.RETURN || data === UNOKey.ESCAPE)\n\t\t\t\tbuilder.map.focus();\n\t\t}\n\n\t\tbuilder._defaultCallbackHandler(objectType, eventType, object, data, builder);\n\t},\n\n\tfocus: function() {\n\t\tsetTimeout(function() {\n\t\t\tvar input = document.getElementById('sc_input_window');\n\t\t\tif (document.activeElement !== input)\n\t\t\t\tinput.focus();\n\t\t}, 0);\n\t},\n\n\thasFocus: function() {\n\t\tvar input = document.getElementById('sc_input_window');\n\t\treturn document.activeElement === input;\n\t},\n\n\tshow: function(action) {\n\t\tthis.showButton(action, true);\n\t},\n\n\thide: function(action) {\n\t\tthis.showButton(action, false);\n\t},\n\n\tshowButton: function(action, show) {\n\t\tthis.onJSAction(\n\t\t\t{\n\t\t\t\tdata: {\n\t\t\t\t\tjsontype: 'formulabar',\n\t\t\t\t\tid: this.builder.windowId,\n\t\t\t\t\tdata: {\n\t\t\t\t\t\t'control_id': action,\n\t\t\t\t\t\t'action_type': show ? 'show' : 'hide'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t},\n\n\tonFormulaBar: function(e) {\n\t\tvar data = e.data;\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tconsole.warn('formulabar: old style formulabar full update - to fix in core');\n\t\treturn;\n\t},\n\n\tonJSUpdate: function (e) {\n\t\tvar data = e.data;\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tconsole.warn('formulabar: old style formulabar update - to fix in core');\n\t\treturn;\n\t},\n\n\tonJSAction: function (e) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== 'formulabar')\n\t\t\treturn;\n\n\t\tif (!this.builder)\n\t\t\treturn;\n\n\t\tthis.builder.setWindowId(data.id);\n\n\t\tif (this.container) {\n\t\t\tvar keepFocus = this.hasFocus();\n\n\t\t\tthis.builder.executeAction(this.container, data.data);\n\n\t\t\tif (keepFocus)\n\t\t\t\tthis.focus();\n\t\t} else\n\t\t\tthis.createFormulabar(data.data.text);\n\t},\n});\n\nL.control.formulaBarJSDialog = function (options) {\n\treturn new L.Control.FormulaBarJSDialog(options);\n};\n"]}
{"version":3,"file":"Control.DocumentRepair.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.DocumentRepair.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.DocumentRepair.\n */\n/* global _ _UNO */\nL.Control.DocumentRepair = L.Control.extend({\n\toptions: {\n\t\tposition: 'topright'\n\t},\n\n\tinitialize: function (options) {\n\t\tL.setOptions(this, options);\n\t},\n\n\tonAdd: function () {\n\t\tthis._initLayout();\n\n\t\treturn this._container;\n\t},\n\n\t_initLayout: function () {\n\t\tthis._container = L.DomUtil.create('div', 'leaflet-control-layers');\n\t\tthis._container.style.visibility = 'hidden';\n\n\t\tvar closeButton = L.DomUtil.create('a', 'leaflet-popup-close-button', this._container);\n\t\tcloseButton.href = '#close';\n\t\tcloseButton.innerHTML = '&#215;';\n\t\tL.DomEvent.on(closeButton, 'click', this._onCloseClick, this);\n\n\t\tvar wrapper = L.DomUtil.create('div', 'leaflet-popup-content-wrapper', this._container);\n\t\tvar content = L.DomUtil.create('div', 'leaflet-popup-content', wrapper);\n\t\tvar labelTitle = document.createElement('span');\n\t\tlabelTitle.innerHTML = '<b>' + _('Repair Document') + '</b>';\n\t\tcontent.appendChild(labelTitle);\n\t\tcontent.appendChild(document.createElement('br'));\n\t\tcontent.appendChild(document.createElement('br'));\n\t\tvar table = L.DomUtil.create('table', '', content);\n\t\tvar tbody = this._tbody = L.DomUtil.create('tbody', '', table);\n\t\tvar tr = L.DomUtil.create('tr', '', tbody);\n\t\tvar th = L.DomUtil.create('th', '', tr);\n\t\tL.DomUtil.setStyle(th, 'display', 'none');\n\t\tth.appendChild(document.createTextNode(''));\n\t\tth = L.DomUtil.create('th', '', tr);\n\t\tth.appendChild(document.createTextNode(_('Type')));\n\t\tth = L.DomUtil.create('th', '', tr);\n\t\tth.appendChild(document.createTextNode(_('Index')));\n\t\tth = L.DomUtil.create('th', '', tr);\n\t\tth.appendChild(document.createTextNode(_('Comment')));\n\t\tth = L.DomUtil.create('th', '', tr);\n\t\tth.appendChild(document.createTextNode(_('User name')));\n\t\tth = L.DomUtil.create('th', '', tr);\n\t\tth.appendChild(document.createTextNode(_('Timestamp')));\n\n\t\tvar inputButton = document.createElement('input');\n\t\tinputButton.type = 'button';\n\t\tinputButton.value = _('Jump to state');\n\t\tL.DomEvent.on(inputButton, 'click', this._onJumpClick, this);\n\t\tcontent.appendChild(document.createElement('br'));\n\t\tcontent.appendChild(document.createElement('br'));\n\t\tcontent.appendChild(inputButton);\n\t},\n\n\tcreateAction: function (type, index, comment, viewId, dateTime) {\n\t\tvar row = L.DomUtil.create('tr', '', this._tbody);\n\t\tvar td = L.DomUtil.create('td', '', row);\n\t\tL.DomUtil.setStyle(td, 'display', 'none');\n\t\ttd.appendChild(document.createTextNode(type));\n\t\ttd = L.DomUtil.create('td', '', row);\n\t\ttd.appendChild(document.createTextNode(_UNO('.uno:'+type)));\n\t\ttd = L.DomUtil.create('td', '', row);\n\t\ttd.appendChild(document.createTextNode(index));\n\t\ttd = L.DomUtil.create('td', '', row);\n\t\ttd.appendChild(document.createTextNode(comment));\n\t\ttd = L.DomUtil.create('td', '', row);\n\t\ttd.appendChild(document.createTextNode(viewId));\n\n\t\t// Show relative date by default, absolute one as tooltip.\n\t\ttd = L.DomUtil.create('td', '', row);\n\t\tvar d = new Date(dateTime.replace(/,.*/, 'Z'));\n\t\tvar dateOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };\n\t\tvar span = document.createElement('span');\n\t\tspan.title = dateTime;\n\t\tspan.appendChild(document.createTextNode(d.toLocaleDateString(String.locale, dateOptions)));\n\t\ttd.appendChild(span);\n\n\t\tL.DomEvent.on(row, 'click', this._onRowClick, this);\n\t\tL.DomEvent.on(row, 'dblclick', this._onJumpClick, this);\n\t},\n\n\tfillAction: function (actions, type) {\n\t\tfor (var iterator = 0; iterator < actions.length; ++iterator) {\n\t\t\t// No user name if the user in question is already disconnected.\n\t\t\tvar userName = actions[iterator].userName ? actions[iterator].userName : '';\n\t\t\tif (parseInt(actions[iterator].viewId) === this._map._docLayer._viewId) {\n\t\t\t\tuserName = _('You');\n\t\t\t}\n\t\t\tthis.createAction(type, actions[iterator].index, actions[iterator].comment, userName, actions[iterator].dateTime);\n\t\t}\n\t},\n\n\tfillActions: function (data) {\n\t\tthis.fillAction(data.Redo.actions, 'Redo');\n\t\tthis.fillAction(data.Undo.actions, 'Undo');\n\t},\n\n\tshow: function () {\n\t\tthis._tbody.setAttribute('style', 'max-height:' + this._map.getSize().y / 2 + 'px');\n\t\tthis._container.style.visibility = '';\n\t},\n\n\n\t_selectRow: function (row) {\n\t\tif (this._selected) {\n\t\t\tL.DomUtil.removeClass(this._selected, 'leaflet-popup-selected');\n\t\t}\n\n\t\tthis._selected = row;\n\t\tL.DomUtil.addClass(this._selected, 'leaflet-popup-selected');\n\t},\n\n\t_onCloseClick: function () {\n\t\tthis._map.focus();\n\t\tthis.remove();\n\t},\n\n\t_onRowClick: function (e) {\n\t\tif (e.currentTarget && this._selected !== e.currentTarget) {\n\t\t\tthis._selectRow(e.currentTarget);\n\t\t}\n\t},\n\n\t_onJumpClick: function () {\n\t\tif (this._selected) {\n\t\t\tvar action = this._selected.childNodes[0].innerHTML;\n\t\t\tvar index = parseInt(this._selected.childNodes[2].innerHTML);\n\t\t\tvar command = {\n\t\t\t\tRepair: {\n\t\t\t\t\ttype: 'boolean',\n\t\t\t\t\tvalue: true\n\t\t\t\t}\n\t\t\t};\n\t\t\tcommand[action] = {\n\t\t\t\ttype: 'unsigned short',\n\t\t\t\tvalue: index + 1\n\t\t\t};\n\t\t\tthis._map.sendUnoCommand('.uno:' + action, command);\n\t\t\tthis._onCloseClick();\n\t\t}\n\t}\n});\n\nL.control.documentRepair = function (options) {\n\treturn new L.Control.DocumentRepair(options);\n};\n"]}
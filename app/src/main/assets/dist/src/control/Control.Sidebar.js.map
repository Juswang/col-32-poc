{"version":3,"file":"Control.Sidebar.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.Sidebar.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.Sidebar\n */\n\n/* global $ */\nL.Control.Sidebar = L.Control.extend({\n\n\toptions: {\n\t\tanimSpeed: 1000 /* Default speed: to be used on load */\n\t},\n\n\tcontainer: null,\n\tbuilder: null,\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\n\t\tthis.builder = new L.control.jsDialogBuilder({mobileWizard: this, map: map, cssClass: 'jsdialog sidebar'});\n\t\tthis.container = L.DomUtil.create('div', 'sidebar-container', $('#sidebar-panel').get(0));\n\n\t\tthis.map.on('sidebar', this.onSidebar, this);\n\t\tthis.map.on('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.on('jsdialogaction', this.onJSAction, this);\n\t},\n\n\tonRemove: function() {\n\t\tthis.map.off('sidebar');\n\t\tthis.map.off('jsdialogupdate', this.onJSUpdate, this);\n\t\tthis.map.off('jsdialogaction', this.onJSAction, this);\n\t},\n\n\tcloseSidebar: function() {\n\t\t$('#sidebar-dock-wrapper').hide();\n\t\tthis.map._onResize();\n\n\t\tif (!this.map.editorHasFocus()) {\n\t\t\tthis.map.fire('editorgotfocus');\n\t\t\tthis.map.focus();\n\t\t}\n\n\t\tif (window.initSidebarState) {\n\t\t\tthis.map.uiManager.setSavedState('ShowSidebar', false);\n\t\t\twindow.initSidebarState = false;\n\t\t}\n\t},\n\n\tonJSUpdate: function (e) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== 'sidebar')\n\t\t\treturn;\n\n\t\tif (!this.container)\n\t\t\treturn;\n\n\t\tvar controlId = data.control.id;\n\t\tvar control = this.container.querySelector('[id=\\'' + controlId + '\\']');\n\t\tif (!control) {\n\t\t\twindow.app.console.warn('jsdialogupdate: not found control with id: \"' + data.control.id + '\"');\n\t\t\treturn;\n\t\t}\n\n\t\tvar parent = control.parentNode;\n\t\tif (!parent)\n\t\t\treturn;\n\n\t\tif (!this.builder)\n\t\t\treturn;\n\n\t\tvar scrollTop = control.scrollTop;\n\t\tvar focusedElement = document.activeElement;\n\t\tvar focusedElementInDialog = focusedElement ? this.container.querySelector('[id=\\'' + focusedElement.id + '\\']') : null;\n\t\tvar focusedId = focusedElementInDialog ? focusedElementInDialog.id : null;\n\t\tcontrol.style.visibility = 'hidden';\n\n\t\tvar temporaryParent = L.DomUtil.create('div');\n\t\tthis.builder.build(temporaryParent, [data.control], false);\n\t\tparent.insertBefore(temporaryParent.querySelector('[id=\\'' + controlId + '\\']'), control.nextSibling);\n\t\tL.DomUtil.remove(control);\n\n\t\tvar newControl = this.container.querySelector('[id=\\'' + controlId + '\\']');\n\t\tif (newControl)\n\t\t\tnewControl.scrollTop = scrollTop;\n\n\t\tif (focusedId)\n\t\t\tthis.container.querySelector('[id=\\'' + focusedId + '\\']').focus();\n\t},\n\n\tonJSAction: function (e) {\n\t\tvar data = e.data;\n\n\t\tif (data.jsontype !== 'sidebar')\n\t\t\treturn;\n\n\t\tif (!this.builder)\n\t\t\treturn;\n\n\t\tif (!this.container)\n\t\t\treturn;\n\n\t\t// Panels share the same name for main containers, do not execute actions for them\n\t\t// if panel has to be shown or hidden, full update will appear\n\t\tif (data.data && (data.data.control_id === 'contents' ||\n\t\t\tdata.data.control_id === 'Panel' ||\n\t\t\tdata.data.control_id === 'titlebar')) {\n\t\t\twindow.app.console.log('Ignored action: ' + data.data.action_type + ' for control: ' + data.data.control_id);\n\t\t\treturn;\n\t\t}\n\n\t\tthis.builder.executeAction(this.container, data.data);\n\t},\n\n\tonResize: function() {\n\t\tvar wrapper = document.getElementById('sidebar-dock-wrapper');\n\t\twrapper.style.maxHeight = document.getElementById('document-container').getBoundingClientRect().height + 'px';\n\t},\n\n\tonSidebar: function(data) {\n\t\tvar sidebarData = data.data;\n\t\tthis.builder.setWindowId(sidebarData.id);\n\t\t$(this.container).empty();\n\n\t\tif (sidebarData.action === 'close' || window.app.file.disableSidebar || this.map.isPermissionReadOnly()) {\n\t\t\tthis.closeSidebar();\n\t\t} else if (sidebarData.children) {\n\t\t\tfor (var i = sidebarData.children.length - 1; i >= 0; i--) {\n\t\t\t\tif (sidebarData.children[i].type !== 'deck' || sidebarData.children[i].visible === false)\n\t\t\t\t\tsidebarData.children.splice(i, 1);\n\t\t\t}\n\n\t\t\tif (sidebarData.children.length) {\n\t\t\t\tvar wrapper = document.getElementById('sidebar-dock-wrapper');\n\n\t\t\t\tthis.onResize();\n\n\t\t\t\tthis.builder.build(this.container, [sidebarData]);\n\t\t\t\tif (wrapper.style.display === 'none')\n\t\t\t\t\t$('#sidebar-dock-wrapper').show(this.options.animSpeed);\n\n\t\t\t\tif (window.initSidebarState) {\n\t\t\t\t\tthis.map.uiManager.setSavedState('ShowSidebar', true);\n\t\t\t\t\twindow.initSidebarState = false;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.closeSidebar();\n\t\t\t}\n\t\t}\n\t},\n\n\tsetTabs: function(/*tabs*/) {\n\t},\n\n\tselectedTab: function() {\n\t\t// implement in child classes\n\t},\n});\n\nL.control.sidebar = function (options) {\n\treturn new L.Control.Sidebar(options);\n};"]}
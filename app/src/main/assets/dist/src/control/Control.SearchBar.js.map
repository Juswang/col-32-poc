{"version":3,"file":"Control.SearchBar.js","sourceRoot":"","sources":["../../../../../../../../browser/src/control/Control.SearchBar.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * L.Control.SearchBar\n */\n\n/* global $ w2ui _ _UNO */\nL.Control.SearchBar = L.Control.extend({\n\n\tonAdd: function (map) {\n\t\tthis.map = map;\n\t\tthis.create();\n\t},\n\n\tcreate: function() {\n\t\tvar that = this;\n\t\tvar toolbar = $('#toolbar-search');\n\t\ttoolbar.w2toolbar({\n\t\t\tname: 'searchbar',\n\t\t\titems: [\n\t\t\t\t{type: 'button', id: 'hidesearchbar', img: 'unfold', hint: _('Hide the search bar')},\n\t\t\t\t{\n\t\t\t\t\ttype: 'html', id: 'search',\n\t\t\t\t\thtml: '<div id=\"search-input-group\" style=\"padding: 3px 10px;\" class=\"cool-font\">' +\n\t\t\t\t\t\t'    <label for=\"search-input\">Search:</label>' +\n\t\t\t\t\t\t'    <input size=\"10\" id=\"search-input\"' +\n\t\t\t\t\t\t'style=\"padding: 2px; border-radius: var(--border-radius); border: 1px solid var(--color-border)\"/>' +\n\t\t\t\t\t\t'</div>'\n\t\t\t\t},\n\t\t\t\t{type: 'button', id: 'searchprev', img: 'prev', hint: _UNO('.uno:UpSearch'), disabled: true},\n\t\t\t\t{type: 'button', id: 'searchnext', img: 'next', hint: _UNO('.uno:DownSearch'), disabled: true},\n\t\t\t\t{type: 'button', id: 'cancelsearch', img: 'cancel', hint: _('Clear the search field'), hidden: true},\n\t\t\t\t{type: 'html', id: 'left'}\n\t\t\t],\n\t\t\tonClick: function (e) {\n\t\t\t\tthat.onClick(e, e.target, e.item, e.subItem);\n\t\t\t},\n\t\t\tonRefresh: function () {\n\t\t\t\twindow.setupSearchInput();\n\t\t\t}\n\t\t});\n\t\tthis.map.uiManager.enableTooltip(toolbar);\n\n\t\ttoolbar.bind('touchstart', function(e) {\n\t\t\tw2ui['searchbar'].touchStarted = true;\n\t\t\tvar touchEvent = e.originalEvent;\n\t\t\tif (touchEvent && touchEvent.touches.length > 1) {\n\t\t\t\tL.DomEvent.preventDefault(e);\n\t\t\t}\n\t\t});\n\n\t\t$(w2ui.searchbar.box).find('.w2ui-scroll-left, .w2ui-scroll-right').hide();\n\t\tw2ui.searchbar.on('resize', function(target, e) {\n\t\t\te.isCancelled = true;\n\t\t});\n\t},\n\n\tonClick: function(e, id, item) {\n\t\tif (w2ui['searchbar'].get(id) !== null) {\n\t\t\tvar toolbar = w2ui['searchbar'];\n\t\t\titem = toolbar.get(id);\n\t\t}\n\n\t\t// In the iOS app we don't want clicking on the toolbar to pop up the keyboard.\n\t\tif (!window.ThisIsTheiOSApp && id !== 'zoomin' && id !== 'zoomout' && id !== 'mobile_wizard' && id !== 'insertion_mobile_wizard') {\n\t\t\tthis.map.focus(this.map.canAcceptKeyboardInput()); // Maintain same keyboard state.\n\t\t}\n\n\t\tif (item.disabled) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (id === 'searchprev') {\n\t\t\tthis.map.search(L.DomUtil.get('search-input').value, true);\n\t\t}\n\t\telse if (id === 'searchnext') {\n\t\t\tthis.map.search(L.DomUtil.get('search-input').value);\n\t\t}\n\t\telse if (id === 'cancelsearch') {\n\t\t\tthis._cancelSearch();\n\t\t}\n\t\telse if (id === 'hidesearchbar') {\n\t\t\t$('#toolbar-search').hide();\n\t\t\tif (this.map.isPermissionEdit())\n\t\t\t\t$('#toolbar-down').show();\n\t\t\t/** show edit button if only we are able to edit but in readonly mode */\n\t\t\tif (window.docPermission  === 'edit' && this.map.isPermissionReadOnly())\n\t\t\t\t$('#mobile-edit-button').show();\n\t\t}\n\t},\n\n\t_cancelSearch: function() {\n\t\tvar toolbar = window.mode.isMobile() ? w2ui['searchbar'] : w2ui['actionbar'];\n\t\tvar searchInput = L.DomUtil.get('search-input');\n\t\tthis.map.resetSelection();\n\t\ttoolbar.hide('cancelsearch');\n\t\ttoolbar.disable('searchprev');\n\t\ttoolbar.disable('searchnext');\n\t\tsearchInput.value = '';\n\t\tif (window.mode.isMobile()) {\n\t\t\tsearchInput.focus();\n\t\t\t// odd, but on mobile we need to invoke it twice\n\t\t\ttoolbar.hide('cancelsearch');\n\t\t}\n\n\t\tthis.map._onGotFocus();\n\t}\n});\n\nL.control.searchBar = function () {\n\treturn new L.Control.SearchBar();\n};\n"]}
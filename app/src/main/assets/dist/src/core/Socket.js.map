{"version":3,"file":"Socket.js","sourceRoot":"","sources":["../../../../../../../../browser/src/core/Socket.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * L.Socket contains methods for the communication with the server\n */\n\n/* global app _ vex $ errorMessages Uint8Array brandProductName brandProductFAQURL */\n\napp.definitions.Socket = L.Class.extend({\n\tProtocolVersionNumber: '0.1',\n\tReconnectCount: 0,\n\tWasShownLimitDialog: false,\n\tWSDServer: {},\n\n\t/// Whether Trace Event recording is enabled or not. (\"Enabled\" here means whether it can be\n\t/// turned on (and off again), not whether it is on.)\n\tenableTraceEventLogging: false,\n\n\t// Will be set from lokitversion message\n\tTunnelledDialogImageCacheSize: 0,\n\n\tgetParameterValue: function (s) {\n\t\tvar i = s.indexOf('=');\n\t\tif (i === -1)\n\t\t\treturn undefined;\n\t\treturn s.substring(i+1);\n\t},\n\n\tinitialize: function (map) {\n\t\twindow.app.console.debug('socket.initialize:');\n\t\tthis._map = map;\n\t\tthis._msgQueue = [];\n\t\tthis._delayedMessages = [];\n\t\tthis._handlingDelayedMessages = false;\n\t},\n\n\tgetWebSocketBaseURI: function(map) {\n\t\treturn window.makeWsUrlWopiSrc('/cool/', map.options.doc + '?' + $.param(map.options.docParams));\n\t},\n\n\tconnect: function(socket) {\n\t\tvar map = this._map;\n\t\tif (map.options.permission) {\n\t\t\tmap.options.docParams['permission'] = map.options.permission;\n\t\t}\n\t\tif (this.socket) {\n\t\t\tthis.close();\n\t\t}\n\t\tif (socket && (socket.readyState === 1 || socket.readyState === 0)) {\n\t\t\tthis.socket = socket;\n\t\t} else if (window.ThisIsAMobileApp) {\n\t\t\t// We have already opened the FakeWebSocket over in global.js\n\t\t} else\t{\n\t\t\ttry {\n\t\t\t\tthis.socket = window.createWebSocket(this.getWebSocketBaseURI(map));\n\t\t\t} catch (e) {\n\t\t\t\tthis._map.fire('error', {msg: _('Oops, there is a problem connecting to %productName: ').replace('%productName', (typeof brandProductName !== 'undefined' ? brandProductName : 'Collabora Online Development Edition')) + e, cmd: 'socket', kind: 'failed', id: 3});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.socket.onerror = L.bind(this._onSocketError, this);\n\t\tthis.socket.onclose = L.bind(this._onSocketClose, this);\n\t\tthis.socket.onopen = L.bind(this._onSocketOpen, this);\n\t\tthis.socket.onmessage = L.bind(this._slurpMessage, this);\n\t\tthis.socket.binaryType = 'arraybuffer';\n\t\tif (map.options.docParams.access_token && parseInt(map.options.docParams.access_token_ttl)) {\n\t\t\tvar tokenExpiryWarning = 900 * 1000; // Warn when 15 minutes remain\n\t\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t\t\tthis._accessTokenExpireTimeout = setTimeout(L.bind(this._sessionExpiredWarning, this),\n\t\t\t                                            parseInt(map.options.docParams.access_token_ttl) - Date.now() - tokenExpiryWarning);\n\t\t}\n\n\t\t// process messages for early socket connection\n\t\tthis._emptyQueue();\n\t},\n\n\t_emptyQueue: function () {\n\t\tif (window.queueMsg && window.queueMsg.length > 0) {\n\t\t\tfor (var it = 0; it < window.queueMsg.length; it++) {\n\t\t\t\tthis._slurpMessage({data: window.queueMsg[it], textMsg: window.queueMsg[it]});\n\t\t\t}\n\t\t\twindow.queueMsg = [];\n\t\t}\n\t},\n\n\t_sessionExpiredWarning: function() {\n\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t\tvar expirymsg = errorMessages.sessionexpiry;\n\t\tif (parseInt(this._map.options.docParams.access_token_ttl) - Date.now() <= 0) {\n\t\t\texpirymsg = errorMessages.sessionexpired;\n\t\t}\n\t\tvar dateTime = new Date(parseInt(this._map.options.docParams.access_token_ttl));\n\t\tvar dateOptions = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };\n\t\tvar timerepr = dateTime.toLocaleDateString(String.locale, dateOptions);\n\t\tthis._map.fire('warn', {msg: expirymsg.replace('%time', timerepr)});\n\n\t\t// If user still doesn't refresh the session, warn again periodically\n\t\tthis._accessTokenExpireTimeout = setTimeout(L.bind(this._sessionExpiredWarning, this),\n\t\t                                            120 * 1000);\n\t},\n\n\tsetUnloading: function() {\n\t\tif (this.socket.setUnloading)\n\t\t\tthis.socket.setUnloading();\n\t},\n\n\tclose: function () {\n\t\tthis.socket.onerror = function () {};\n\t\tthis.socket.onclose = function () {};\n\t\tthis.socket.onmessage = function () {};\n\t\tthis.socket.close();\n\n\t\t// Reset wopi's app loaded so that reconnecting again informs outerframe about initialization\n\t\tthis._map['wopi'].resetAppLoaded();\n\t\tthis._map.fire('docloaded', {status: false});\n\t\tclearTimeout(this._accessTokenExpireTimeout);\n\t},\n\n\tconnected: function() {\n\t\treturn this.socket && this.socket.readyState === 1;\n\t},\n\n\tsendMessage: function (msg) {\n\t\tif (this._map._fatal) {\n\t\t\t// Avoid communicating when we're in fatal state\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._map._active) {\n\t\t\t// Avoid communicating when we're inactive.\n\t\t\tif (typeof msg !== 'string')\n\t\t\t\treturn;\n\n\t\t\tif (!msg.startsWith('useractive') && !msg.startsWith('userinactive'))\n\t\t\t\treturn;\n\t\t}\n\n\t\tif (this._map.uiManager && this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tvar socketState = this.socket.readyState;\n\t\tif (socketState === 2 || socketState === 3) {\n\t\t\tthis._map.loadDocument();\n\t\t}\n\n\t\tif (socketState === 1) {\n\t\t\tthis._doSend(msg);\n\t\t}\n\t\telse {\n\t\t\t// push message while trying to connect socket again.\n\t\t\tthis._msgQueue.push(msg);\n\t\t}\n\t},\n\n\t_doSend: function(msg) {\n\t\t// Only attempt to log text frames, not binary ones.\n\t\tif (typeof msg === 'string')\n\t\t\tthis._logSocket('OUTGOING', msg);\n\n\t\tthis.socket.send(msg);\n\t},\n\n\t_getParameterByName: function(url, name) {\n\t\tname = name.replace(/[\\[]/, '\\\\[').replace(/[\\]]/, '\\\\]');\n\t\tvar regex = new RegExp('[\\\\?&]' + name + '=([^&#]*)'), results = regex.exec(url);\n\t\treturn results === null ? '' : results[1].replace(/\\+/g, ' ');\n\t},\n\n\t_onSocketOpen: function () {\n\t\twindow.app.console.debug('_onSocketOpen:');\n\t\tthis._map._serverRecycling = false;\n\t\tthis._map._documentIdle = false;\n\n\t\t// Always send the protocol version number.\n\t\t// TODO: Move the version number somewhere sensible.\n\n\t\t// Also send information about our performance timer epoch\n\t\tvar now0 = Date.now();\n\t\tvar now1 = performance.now();\n\t\tvar now2 = Date.now();\n\t\tthis._doSend('coolclient ' + this.ProtocolVersionNumber + ' ' + ((now0 + now2) / 2) + ' ' + now1);\n\n\t\tvar msg = 'load url=' + encodeURIComponent(this._map.options.doc);\n\t\tif (this._map._docLayer) {\n\t\t\tthis._reconnecting = true;\n\t\t\t// we are reconnecting after a lost connection\n\t\t\tmsg += ' part=' + this._map.getCurrentPartNumber();\n\t\t}\n\t\tif (this._map.options.timestamp) {\n\t\t\tmsg += ' timestamp=' + this._map.options.timestamp;\n\t\t}\n\t\tif (this._map._docPassword) {\n\t\t\tmsg += ' password=' + this._map._docPassword;\n\t\t}\n\t\tif (String.locale) {\n\t\t\tmsg += ' lang=' + String.locale;\n\t\t}\n\t\tif (window.deviceFormFactor) {\n\t\t\tmsg += ' deviceFormFactor=' + window.deviceFormFactor;\n\t\t}\n\t\tif (this._map.options.renderingOptions) {\n\t\t\tvar options = {\n\t\t\t\t'rendering': this._map.options.renderingOptions\n\t\t\t};\n\t\t\tmsg += ' options=' + JSON.stringify(options);\n\t\t}\n\t\tif (window.isLocalStorageAllowed) {\n\t\t\tvar spellOnline = window.localStorage.getItem('SpellOnline');\n\t\t\tif (spellOnline) {\n\t\t\t\tmsg += ' spellOnline=' + spellOnline;\n\t\t\t}\n\t\t}\n\n\t\tthis._doSend(msg);\n\t\tfor (var i = 0; i < this._msgQueue.length; i++) {\n\t\t\tthis._doSend(this._msgQueue[i]);\n\t\t}\n\t\tthis._msgQueue = [];\n\n\t\tthis._map._activate();\n\t},\n\n\t_utf8ToString: function (data) {\n\t\tvar strBytes = '';\n\t\tfor (var it = 0; it < data.length; it++) {\n\t\t\tstrBytes += String.fromCharCode(data[it]);\n\t\t}\n\t\treturn strBytes;\n\t},\n\n\t// Returns true if, and only if, we are ready to start loading\n\t// the tiles and rendering the document.\n\t_isReady: function() {\n\t\tif (window.bundlejsLoaded == false || window.fullyLoadedAndReady == false) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (typeof this._map == 'undefined' ||\n\t\t\tisNaN(this._map.options.tileWidthTwips) ||\n\t\t\tisNaN(this._map.options.tileHeightTwips)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar center = this._map.getCenter();\n\t\tif (isNaN(center.lat) || isNaN(center.lng) || isNaN(this._map.getZoom())) {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t},\n\n\t_logSocket: function(type, msg) {\n\t\tvar fullDebug = this._map._docLayer && this._map._docLayer._debug;\n\n\t\tif (fullDebug)\n\t\t\tthis._map._docLayer._debugSetPostMessage(type,msg);\n\n\t\tif (!window.protocolDebug && !fullDebug)\n\t\t\treturn;\n\n\t\tif (!fullDebug && msg.length > 256) // for reasonable performance.\n\t\t\tmsg = msg.substring(0,256) + '<truncated ' + (msg.length - 256) + 'chars>';\n\n\t\tvar status = '';\n\t\tif (!window.fullyLoadedAndReady)\n\t\t\tstatus += '[!fullyLoadedAndReady]';\n\t\tif (!window.bundlejsLoaded)\n\t\t\tstatus += '[!bundlejsLoaded]';\n\n\t\tvar color = type === 'OUTGOING' ? 'color:red' : 'color:blue';\n\t\twindow.app.console.log(+new Date() + ' %c' + type + status + '%c: ' + msg.concat(' ').replace(' ', '%c '),\n\t\t\t     'background:#ddf;color:black', color, 'color:black');\n\t},\n\n\t_queueSlurpEventEmission: function() {\n\t\tvar that = this;\n\t\tif (!that._slurpTimer)\n\t\t{\n\t\t\tthat._slurpTimer = setTimeout(function () {\n\t\t\t\tthat._slurpTimer = undefined;\n\t\t\t\tthat._emitSlurpedEvents();\n\t\t\t}, 1 /* ms */);\n\t\t}\n\t},\n\n\t_emitSlurpedEvents: function() {\n\t\tvar queueLength = this._slurpQueue.length;\n\t\tvar completeEventWholeFunction = this.createCompleteTraceEvent('emitSlurped-' + String(queueLength),\n\t\t\t\t\t\t\t\t\t       {'_slurpQueue.length' : String(queueLength)});\n\t\tif (this._map && this._map._docLayer) {\n\t\t\tthis._map._docLayer.pauseDrawing();\n\n\t\t\t// Queue an instant timeout early to try to measure the\n\t\t\t// re-rendering delay before we get back to the main-loop.\n\t\t\tif (this.traceEventRecordingToggle)\n\t\t\t{\n\t\t\t\tvar that = this;\n\t\t\t\tif (!that._renderEventTimer)\n\t\t\t\t\tthat._renderEventTimer = setTimeout(function() {\n\t\t\t\t\t\tvar now = performance.now();\n\t\t\t\t\t\tvar delta = now - that._renderEventTimerStart;\n\t\t\t\t\t\tif (delta >= 2 /* ms */) // significant\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.sendMessage('TRACEEVENT name=browser-render' +\n\t\t\t\t\t\t\t\t\t ' ph=X ts=' + Math.round(that._renderEventTimerStart * 1000) +\n\t\t\t\t\t\t\t\t\t ' dur=' + Math.round((now - that._renderEventTimerStart) * 1000));\n\t\t\t\t\t\t\tthat._renderEventTimerStart = undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthat._renderEventTimer = undefined;\n\t\t\t\t\t}, 0);\n\t\t\t}\n\t\t}\n\t\t// window.app.console.log('Slurp events ' + that._slurpQueue.length);\n\t\tvar complete = true;\n\t\ttry {\n\t\t\tfor (var i = 0; i < queueLength; ++i) {\n\t\t\t\tvar evt = this._slurpQueue[i];\n\n\t\t\t\tif (evt.isComplete()) {\n\t\t\t\t\tvar textMsg;\n\t\t\t\t\tif (typeof (evt.data) === 'string') {\n\t\t\t\t\t\ttextMsg = evt.data.replace(/\\s+/g, '.');\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof (evt.data) === 'object') {\n\t\t\t\t\t\ttextMsg = evt.textMsg.replace(/\\s+/g, '.');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar completeEventOneMessage = this.createCompleteTraceEventFromEvent(textMsg);\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// it is - are you ?\n\t\t\t\t\t\tthis._onMessage(evt);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\t// unpleasant - but stops this one problem\n\t\t\t\t\t\t// event stopping an unknown number of others.\n\t\t\t\t\t\twindow.app.console.log('Exception ' + e + ' emitting event ' + evt.data);\n\t\t\t\t\t}\n\t\t\t\t\tfinally {\n\t\t\t\t\t\tif (completeEventOneMessage)\n\t\t\t\t\t\t\tcompleteEventOneMessage.finish();\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// Stop emitting, re-start when we async images load.\n\t\t\t\t\tthis._slurpQueue = this._slurpQueue.slice(i, queueLength);\n\t\t\t\t\tcomplete = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tfinally {\n\t\t\tif (completeEventWholeFunction)\n\t\t\t\tcompleteEventWholeFunction.finish();\n\t\t}\n\n\t\tif (complete) // Finished all elements in the queue.\n\t\t\tthis._slurpQueue = [];\n\n\t\tif (this._map) {\n\t\t\tif (this._map._docLayer) {\n\t\t\t\t// Resume with redraw if dirty due to previous _onMessage() calls.\n\t\t\t\tthis._map._docLayer.resumeDrawing(true);\n\t\t\t}\n\t\t\t// Let other layers / overlays catch up.\n\t\t\tthis._map.fire('messagesdone');\n\n\t\t\tthis._renderEventTimerStart = performance.now();\n\t\t}\n\t},\n\n\t// The problem: if we process one websocket message at a time, the\n\t// browser -loves- to trigger a re-render as we hit the main-loop,\n\t// this takes ~200ms on a large screen, and worse we get\n\t// producer/consumer issues that can fill a multi-second long\n\t// buffer of web-socket messages in the client that we can't\n\t// process so - slurp and the emit at idle - its faster to delay!\n\t_slurpMessage: function(e) {\n\t\tif (!this._slurpQueue || !this._slurpQueue.length) {\n\t\t\tthis._queueSlurpEventEmission();\n\t\t\tthis._slurpQueue = [];\n\t\t}\n\t\tthis._extractTextImg(e);\n\t\tthis._slurpQueue.push(e);\n\t},\n\n\t// make profiling easier\n\t_extractCopyObject: function(e) {\n\t\tvar index;\n\n\t\te.imgBytes = new Uint8Array(e.data);\n\n\t\t// search for the first newline which marks the end of the message\n\t\tindex = e.imgBytes.indexOf(10);\n\t\tif (index < 0)\n\t\t\tindex = e.imgBytes.length;\n\n\t\te.textMsg = String.fromCharCode.apply(null, e.imgBytes.subarray(0, index));\n\n\t\te.imgIndex = index + 1;\n\t},\n\n\t// convert to string of bytes without blowing the stack if data is large.\n\t_strFromUint8: function(data) {\n\t\tvar i, chunk = 4096;\n\t\tvar strBytes = '';\n\t\tfor (i = 0; i < data.length; i += chunk)\n\t\t\tstrBytes += String.fromCharCode.apply(null, data.slice(i, i + chunk));\n\t\tstrBytes += String.fromCharCode.apply(null, data.slice(i));\n\t\treturn strBytes;\n\t},\n\n\t_extractImage: function(e) {\n\t\tvar img;\n\t\tif (window.ThisIsTheiOSApp) {\n\t\t\t// In the iOS app, the native code sends us the PNG tile already as a data: URL after the newline\n\t\t\tvar newlineIndex = e.textMsg.indexOf('\\n');\n\t\t\tif (newlineIndex > 0) {\n\t\t\t\timg = e.textMsg.substring(newlineIndex+1);\n\t\t\t\te.textMsg = e.textMsg.substring(0, newlineIndex);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar data = e.imgBytes.subarray(e.imgIndex);\n\t\t\twindow.app.console.assert(data.length == 0 || data[0] != 68 /* D */, 'Socket: got a delta image, not supported !');\n\t\t\timg = 'data:image/png;base64,' + window.btoa(this._strFromUint8(data));\n\t\t\tif (L.Browser.cypressTest && localStorage.getItem('image_validation_test')) {\n\t\t\t\tif (!window.imgDatas)\n\t\t\t\t\twindow.imgDatas = [];\n\t\t\t\twindow.imgDatas.push(img);\n\t\t\t}\n\t\t}\n\t\treturn img;\n\t},\n\n\t_extractTextImg: function (e) {\n\n\t\tif (typeof (e.data) === 'string')\n\t\t\te.textMsg = e.data;\n\t\telse if (typeof (e.data) === 'object')\n\t\t\tthis._extractCopyObject(e);\n\n\t\te.isComplete = function () {\n\t\t\tif (this.image)\n\t\t\t\treturn !!this.imageIsComplete;\n\t\t\treturn true;\n\t\t};\n\n\t\tif (!e.textMsg.startsWith('tile:') &&\n\t\t    !e.textMsg.startsWith('renderfont:') &&\n\t\t    !e.textMsg.startsWith('windowpaint:'))\n\t\t\treturn;\n\n\t\tif (e.textMsg.indexOf(' nopng') !== -1)\n\t\t\treturn;\n\n\t\tvar that = this;\n\t\tvar img = this._extractImage(e);\n\t\te.image = new Image();\n\t\te.image.onload = function() {\n\t\t\te.imageIsComplete = true;\n\t\t\tthat._queueSlurpEventEmission();\n\t\t\tif (e.image.completeTraceEvent)\n\t\t\t\te.image.completeTraceEvent.finish();\n\t\t};\n\t\te.image.onerror = function(err) {\n\t\t\twindow.app.console.log('Failed to load image ' + img + ' fun ' + err);\n\t\t\te.imageIsComplete = true;\n\t\t\tthat._queueSlurpEventEmission();\n\t\t\tif (e.image.completeTraceEvent)\n\t\t\t\te.image.completeTraceEvent.abort();\n\t\t};\n\t\te.image.completeTraceEvent = this.createAsyncTraceEvent('loadTile');\n\t\te.image.src = img;\n\t},\n\n\t_onMessage: function (e) {\n\t\tvar imgBytes, textMsg;\n\n\t\ttextMsg = e.textMsg;\n\t\timgBytes = e.imgBytes;\n\n\t\tthis._logSocket('INCOMING', textMsg);\n\n\t\tvar command = this.parseServerCmd(textMsg);\n\t\tif (textMsg.startsWith('coolserver ')) {\n\t\t\t// This must be the first message, unless we reconnect.\n\t\t\tvar oldId = null;\n\t\t\tvar oldVersion = null;\n\t\t\tvar sameFile = true;\n\t\t\t// Check if we are reconnecting.\n\t\t\tif (this.WSDServer && this.WSDServer.Id) {\n\t\t\t\t// Yes we are reconnecting.\n\t\t\t\t// If server is restarted, we have to refresh the page.\n\t\t\t\t// If our connection was lost and is ready again, we will not need to refresh the page.\n\t\t\t\toldId = this.WSDServer.Id;\n\t\t\t\toldVersion = this.WSDServer.Version;\n\n\t\t\t\twindow.app.console.assert(this._map.options.wopiSrc === window.wopiSrc,\n\t\t\t\t\t'wopiSrc mismatch!: ' + this._map.options.wopiSrc + ' != ' + window.wopiSrc);\n\t\t\t\t// If another file is opened, we will not refresh the page.\n\t\t\t\tif (this._map.options.previousWopiSrc && this._map.options.wopiSrc) {\n\t\t\t\t\tif (this._map.options.previousWopiSrc !== this._map.options.wopiSrc)\n\t\t\t\t\t\tsameFile = false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.WSDServer = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\n\t\t\tif (oldId && oldVersion && sameFile) {\n\t\t\t\tif (this.WSDServer.Id !== oldId || this.WSDServer.Version !== oldVersion) {\n\t\t\t\t\tvar reloadMessage = _('Server is now reachable. We have to refresh the page now.');\n\t\t\t\t\tif (window.mode.isMobile())\n\t\t\t\t\t\treloadMessage = _('Server is now reachable...');\n\n\t\t\t\t\tvar reloadFunc = function() { window.location.reload(); };\n\t\t\t\t\tif (!this._map['wopi'].DisableInactiveMessages)\n\t\t\t\t\t\tthis._map.uiManager.showSnackbar(reloadMessage, _('RELOAD'), reloadFunc);\n\t\t\t\t\telse\n\t\t\t\t\t\tthis._map.fire('postMessage', {msgId: 'Reloading', args: {Reason: 'Reconnected'}});\n\t\t\t\t\tsetTimeout(reloadFunc, 5000);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t$('#coolwsd-version-label').text(_('COOLWSD version:'));\n\t\t\tvar h = this.WSDServer.Hash;\n\t\t\tif (parseInt(h,16).toString(16) === h.toLowerCase().replace(/^0+/, '')) {\n\t\t\t\th = '<a href=\"javascript:void(window.open(\\'https://github.com/CollaboraOnline/online/commits/' + h + '\\'));\">' + h + '</a>';\n\t\t\t\t$('#coolwsd-version').html(this.WSDServer.Version + ' <span>git hash:&nbsp;' + h + this.WSDServer.Options + '</span>');\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$('#coolwsd-version').text(this.WSDServer.Version);\n\t\t\t}\n\n\t\t\tif (!window.ThisIsAMobileApp) {\n\t\t\t\tvar idUri = window.makeHttpUrl('/hosting/discovery');\n\t\t\t\t$('#served-by-label').text(_('Served by:'));\n\t\t\t\t$('#coolwsd-id').html('<a target=\"_blank\" href=\"' + idUri + '\">' + this.WSDServer.Id + '</a>');\n\t\t\t}\n\n\t\t\t// TODO: For now we expect perfect match in protocol versions\n\t\t\tif (this.WSDServer.Protocol !== this.ProtocolVersionNumber) {\n\t\t\t\tthis._map.fire('error', {msg: _('Unsupported server version.')});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('lokitversion ')) {\n\t\t\t$('#lokit-version-label').text(_('LOKit version:'));\n\t\t\tvar lokitVersionObj = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\th = lokitVersionObj.BuildId.substring(0, 7);\n\t\t\tif (parseInt(h,16).toString(16) === h.toLowerCase().replace(/^0+/, '')) {\n\t\t\t\th = '<a href=\"javascript:void(window.open(\\'https://hub.libreoffice.org/git-core/' + h + '\\'));\">' + h + '</a>';\n\t\t\t}\n\t\t\t$('#lokit-version').html(lokitVersionObj.ProductName + ' ' +\n\t\t\t                         lokitVersionObj.ProductVersion + lokitVersionObj.ProductExtension +\n\t\t\t                         '<span> git hash:&nbsp;' + h + '<span>');\n\t\t\tthis.TunnelledDialogImageCacheSize = lokitVersionObj.tunnelled_dialog_image_cache_size;\n\t\t}\n\t\telse if (textMsg.startsWith('enabletraceeventlogging ')) {\n\t\t\tthis.enableTraceEventLogging = true;\n\t\t}\n\t\telse if (textMsg.startsWith('osinfo ')) {\n\t\t\tvar osInfo = textMsg.replace('osinfo ', '');\n\t\t\tvar osInfoElement = document.getElementById('os-info');\n\t\t\tif (osInfoElement)\n\t\t\t\tosInfoElement.innerText = osInfo;\n\t\t}\n\t\telse if (textMsg.startsWith('clipboardkey: ')) {\n\t\t\tvar key = textMsg.substring('clipboardkey: '.length);\n\t\t\tif (this._map._clip)\n\t\t\t\tthis._map._clip.setKey(key);\n\t\t}\n\t\telse if (textMsg.startsWith('perm:')) {\n\t\t\tvar perm = textMsg.substring('perm:'.length).trim();\n\n\t\t\t// Never make the permission more permissive than it originally was.\n\t\t\tif (this._map.options.permission == 'edit')\n\t\t\t{\n\t\t\t\tthis._map.options.permission = perm;\n\t\t\t}\n\n\t\t\tif (this._map._docLayer) {\n\t\t\t\tthis._map.setPermission(this._map.options.permission);\n\t\t\t}\n\n\t\t\tapp.file.disableSidebar = perm !== 'edit';\n\t\t\tapp.file.readOnly = this._map.options.permission === 'readonly';\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('filemode:')) {\n\t\t\tvar json = JSON.parse(textMsg.substring('filemode:'.length).trim());\n\n\t\t\t// Never make the permission more permissive than it originally was.\n\t\t\tif (this._map.options.permission == 'edit' && json.readOnly)\n\t\t\t{\n\t\t\t\tthis._map.options.permission = 'readonly';\n\t\t\t}\n\n\t\t\tif (this._map._docLayer) {\n\t\t\t\tthis._map.setPermission(this._map.options.permission);\n\t\t\t}\n\n\t\t\tapp.file.readOnly = this._map.options.permission === 'readonly';\n\t\t\tapp.file.editComment = json.editComment; // Allowed even in readonly mode.\n\t\t}\n\t\telse if (textMsg.startsWith('lockfailed:')) {\n\t\t\tthis._map.onLockFailed(textMsg.substring('lockfailed:'.length).trim());\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('wopi: ')) {\n\t\t\t// Handle WOPI related messages\n\t\t\tvar wopiInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map.fire('wopiprops', wopiInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('loadstorage: ')) {\n\t\t\tif (textMsg.substring(textMsg.indexOf(':') + 2) === 'failed') {\n\t\t\t\twindow.app.console.debug('Loading document from a storage failed');\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'App_LoadingStatus',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tStatus: 'Failed'\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('lastmodtime: ')) {\n\t\t\tvar time = textMsg.substring(textMsg.indexOf(' ') + 1);\n\t\t\tthis._map.updateModificationIndicator(time);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('commandresult: ')) {\n\t\t\tvar commandresult = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tif (commandresult['command'] === 'savetostorage' || commandresult['command'] === 'save') {\n\t\t\t\tif (commandresult['success']) {\n\t\t\t\t\t// Close any open confirmation dialogs\n\t\t\t\t\tvex.closeAll();\n\t\t\t\t}\n\n\t\t\t\tvar postMessageObj = {\n\t\t\t\t\tsuccess: commandresult['success'],\n\t\t\t\t\tresult: commandresult['result'],\n\t\t\t\t\terrorMsg: commandresult['errorMsg']\n\t\t\t\t};\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Save_Resp', args: postMessageObj});\n\t\t\t} else if (commandresult['command'] === 'load') {\n\t\t\t\tpostMessageObj = {\n\t\t\t\t\tsuccess: commandresult['success'],\n\t\t\t\t\tresult: commandresult['result'],\n\t\t\t\t\terrorMsg: commandresult['errorMsg']\n\t\t\t\t};\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Action_Load_Resp', args: postMessageObj});\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('close: ')) {\n\t\t\ttextMsg = textMsg.substring('close: '.length);\n\t\t\tmsg = '';\n\t\t\tvar postMsgData = {};\n\t\t\tvar showMsgAndReload = false;\n\t\t\t// This is due to document owner terminating the session\n\t\t\tif (textMsg === 'ownertermination') {\n\t\t\t\tmsg = _('Session terminated by document owner');\n\t\t\t\tpostMsgData['Reason'] = 'OwnerTermination';\n\t\t\t}\n\t\t\telse if (textMsg === 'idle' || textMsg === 'oom') {\n\t\t\t\tif (window.mode.isDesktop()) {\n\t\t\t\t\tmsg = _('Idle document - please click to reload and resume editing');\n\t\t\t\t} else {\n\t\t\t\t\tmsg = _('Idle document - please tap to reload and resume editing');\n\t\t\t\t}\n\t\t\t\tthis._map._documentIdle = true;\n\t\t\t\tpostMsgData['Reason'] = 'DocumentIdle';\n\t\t\t\tif (textMsg === 'oom')\n\t\t\t\t\tpostMsgData['Reason'] = 'OOM';\n\t\t\t}\n\t\t\telse if (textMsg === 'shuttingdown') {\n\t\t\t\tmsg = _('Server is shutting down for maintenance (auto-saving)');\n\t\t\t\tpostMsgData['Reason'] = 'ShuttingDown';\n\t\t\t}\n\t\t\telse if (textMsg === 'docdisconnected') {\n\t\t\t\tmsg = _('Oops, there is a problem connecting the document');\n\t\t\t\tpostMsgData['Reason'] = 'DocumentDisconnected';\n\t\t\t}\n\t\t\telse if (textMsg === 'recycling') {\n\t\t\t\tmsg = _('Server is down, restarting automatically. Please wait.');\n\t\t\t\tthis._map._active = false;\n\t\t\t\tthis._map._serverRecycling = true;\n\n\t\t\t\t// Prevent reconnecting the world at the same time.\n\t\t\t\tvar min = 5000;\n\t\t\t\tvar max = 10000;\n\t\t\t\tvar timeoutMs = Math.floor(Math.random() * (max - min) + min);\n\n\t\t\t\tvar socket = this;\n\t\t\t\tmap = this._map;\n\t\t\t\tclearTimeout(vex.timer);\n\t\t\t\tvex.timer = setInterval(function() {\n\t\t\t\t\tif (socket.connected()) {\n\t\t\t\t\t\t// We're connected: cancel timer and dialog.\n\t\t\t\t\t\tclearTimeout(vex.timer);\n\t\t\t\t\t\tvex.closeAll();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\tmap.loadDocument(map);\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot load document.');\n\t\t\t\t\t}\n\t\t\t\t}, timeoutMs);\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('documentconflict')) {\n\t\t\t\tmsg = _('Document has changed in storage. Loading the new document. Your version is available as revision.');\n\t\t\t\tshowMsgAndReload = true;\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('versionrestore:')) {\n\t\t\t\ttextMsg = textMsg.substring('versionrestore:'.length).trim();\n\t\t\t\tif (textMsg === 'prerestore_ack') {\n\t\t\t\t\tmsg = _('Restoring older revision. Any unsaved changes will be available in version history');\n\t\t\t\t\tthis._map.fire('postMessage', {msgId: 'App_VersionRestore', args: {Status: 'Pre_Restore_Ack'}});\n\t\t\t\t\tshowMsgAndReload = true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('reloadafterrename')) {\n\t\t\t\tmsg = _('Reloading the document after rename');\n\t\t\t\tshowMsgAndReload = true;\n\t\t\t}\n\n\t\t\tif (showMsgAndReload) {\n\t\t\t\tif (this._map._docLayer) {\n\t\t\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\t\t}\n\t\t\t\t// Detach all the handlers from current socket, otherwise _onSocketClose tries to reconnect again\n\t\t\t\t// However, we want to reconnect manually here.\n\t\t\t\tthis.close();\n\n\t\t\t\t// Reload the document\n\t\t\t\tthis._map._active = false;\n\t\t\t\tmap = this._map;\n\t\t\t\tclearTimeout(vex.timer);\n\t\t\t\tvex.timer = setInterval(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Activate and cancel timer and dialogs.\n\t\t\t\t\t\tmap._activate();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot activate map');\n\t\t\t\t\t}\n\t\t\t\t}, 3000);\n\t\t\t}\n\n\t\t\t// Close any open dialogs first.\n\t\t\tvex.closeAll();\n\n\t\t\tvar message = '';\n\t\t\tif (!this._map['wopi'].DisableInactiveMessages) {\n\t\t\t\tmessage = msg;\n\t\t\t}\n\n\t\t\tvar dialogOptions = {\n\t\t\t\tmessage: message,\n\t\t\t\tcontentClassName: 'cool-user-idle'\n\t\t\t};\n\n\t\t\tvar restartConnectionFn;\n\t\t\tif (textMsg === 'idle' || textMsg === 'oom') {\n\t\t\t\tvar map = this._map;\n\t\t\t\trestartConnectionFn = function() {\n\t\t\t\t\tif (map._documentIdle)\n\t\t\t\t\t{\n\t\t\t\t\t\twindow.app.console.debug('idleness: reactivating');\n\t\t\t\t\t\tmap._documentIdle = false;\n\t\t\t\t\t\tmap._docLayer._setCursorVisible();\n\t\t\t\t\t\treturn map._activate();\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t};\n\t\t\t\tdialogOptions.afterClose = restartConnectionFn;\n\n\t\t\t\tvar dialogOpened = vex.dialog.open(dialogOptions);\n\t\t\t\tthis._map._textInput.hideCursor();\n\t\t\t\tdialogOpened.contentEl.onclick = restartConnectionFn;\n\t\t\t\t$('.vex-overlay').addClass('cool-user-idle-overlay');\n\n\t\t\t\tif (message === '')\n\t\t\t\t\t$('.cool-user-idle').css('display', 'none');\n\t\t\t}\n\n\t\t\tif (postMsgData['Reason']) {\n\t\t\t\t// Tell WOPI host about it which should handle this situation\n\t\t\t\tthis._map.fire('postMessage', {msgId: 'Session_Closed', args: postMsgData});\n\t\t\t}\n\n\t\t\tif (textMsg === 'ownertermination') {\n\t\t\t\tthis._map.remove();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('error:')\n\t\t\t&& (command.errorCmd === 'storage' || command.errorCmd === 'saveas') || command.errorCmd === 'downloadas')  {\n\n\t\t\tif (command.errorCmd === 'saveas') {\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'Action_Save_Resp',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tsuccess: false,\n\t\t\t\t\t\tresult: command.errorKind\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._map.hideBusy();\n\t\t\tvar storageError;\n\t\t\tif (command.errorKind === 'savediskfull') {\n\t\t\t\tstorageError = errorMessages.storage.savediskfull;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'savefailed') {\n\t\t\t\tstorageError = errorMessages.storage.savefailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'renamefailed') {\n\t\t\t\tstorageError = errorMessages.storage.renamefailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'saveunauthorized') {\n\t\t\t\tstorageError = errorMessages.storage.saveunauthorized;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'saveasfailed') {\n\t\t\t\tstorageError = errorMessages.storage.saveasfailed;\n\t\t\t}\n\t\t\telse if (command.errorKind === 'loadfailed') {\n\t\t\t\tstorageError = errorMessages.storage.loadfailed;\n\t\t\t\t// Since this is a document load failure, wsd will disconnect the socket anyway,\n\t\t\t\t// better we do it first so that another error message doesn't override this one\n\t\t\t\t// upon socket close.\n\t\t\t\tthis.close();\n\t\t\t}\n\t\t\telse if (command.errorKind === 'documentconflict')\n\t\t\t{\n\t\t\t\tvar that = this;\n\t\t\t\tstorageError = errorMessages.storage.documentconflict;\n\n\t\t\t\tvex.closeAll();\n\n\t\t\t\tvar dialogButtons = [\n\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\ttext: _('Discard'),\n\t\t\t\t\t\tclassName: 'vex-dialog-button-secondary',\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tthis.value = 'discard';\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t}}),\n\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\ttext: _('Overwrite'),\n\t\t\t\t\t\tclassName: 'vex-dialog-button-secondary',\n\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\tthis.value = 'overwrite';\n\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t}}),\n\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\ttext: '',\n\t\t\t\t\t\tclassName: 'vex-dialog-button-spacer'\n\t\t\t\t\t})\n\t\t\t\t];\n\n\t\t\t\tif (!that._map['wopi'].UserCanNotWriteRelative) {\n\t\t\t\t\tdialogButtons.push(\n\t\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\t\ttext: _('Save to new file'),\n\t\t\t\t\t\t\tclassName: 'vex-dialog-button-primary',\n\t\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\t\tthis.value = 'saveas';\n\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t}}),\n\t\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t\t\tclassName: 'vex-dialog-button-secondary vex-dialog-button-cancel',\n\t\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\t\tthis.value = 'cancel';\n\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t}})\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tdialogButtons.push(\n\t\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, {\n\t\t\t\t\t\t\ttext: _('Cancel'),\n\t\t\t\t\t\t\tclassName: 'vex-dialog-button-primary vex-dialog-button-cancel',\n\t\t\t\t\t\t\tclick: function() {\n\t\t\t\t\t\t\t\tthis.value = 'cancel';\n\t\t\t\t\t\t\t\tthis.close();\n\t\t\t\t\t\t\t}})\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tvex.dialog.open({\n\t\t\t\t\tunsafeMessage: '<h1 class=\"vex-dialog-title\">' + vex._escapeHtml(_('Document has been changed')) + '</h1><p class=\"vex-dialog-message\">' + vex._escapeHtml(_('Document has been changed in storage. What would you like to do with your unsaved changes?')) + '</p>',\n\t\t\t\t\tescapeButtonCloses: false,\n\t\t\t\t\toverlayClosesOnClick: false,\n\t\t\t\t\tcontentClassName: 'vex-content vex-3btns',\n\t\t\t\t\tbuttons: dialogButtons,\n\t\t\t\t\tshowCloseButton: true,\n\t\t\t\t\tcallback: function(value) {\n\t\t\t\t\t\tif (value === 'discard') {\n\t\t\t\t\t\t\t// They want to refresh the page and load document again for all\n\t\t\t\t\t\t\tthat.sendMessage('closedocument');\n\t\t\t\t\t\t} else if (value === 'overwrite') {\n\t\t\t\t\t\t\t// They want to overwrite\n\t\t\t\t\t\t\tthat.sendMessage('savetostorage force=1');\n\t\t\t\t\t\t} else if (value === 'saveas') {\n\t\t\t\t\t\t\tvar filename = that._map['wopi'].BaseFileName;\n\t\t\t\t\t\t\tif (filename) {\n\t\t\t\t\t\t\t\tfilename = L.LOUtil.generateNewFileName(filename, '_new');\n\t\t\t\t\t\t\t\tthat._map.saveAs(filename);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tafterOpen: function() {\n\t\t\t\t\t\tthis.contentEl.style.width = '600px';\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Skip empty errors (and allow for suppressing errors by making them blank).\n\t\t\tif (storageError && storageError != '') {\n\t\t\t\t// Parse the storage url as link\n\t\t\t\tvar tmpLink = document.createElement('a');\n\t\t\t\ttmpLink.href = this._map.options.doc;\n\t\t\t\t// Insert the storage server address to be more friendly\n\t\t\t\tstorageError = storageError.replace('%storageserver', tmpLink.host);\n\t\t\t\tthis._map.fire('warn', {msg: storageError});\n\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && command.errorCmd === 'internal') {\n\t\t\tthis._map.hideBusy();\n\t\t\tthis._map._fatal = true;\n\t\t\tif (command.errorKind === 'diskfull') {\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.diskfull});\n\t\t\t}\n\t\t\telse if (command.errorKind === 'unauthorized') {\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.unauthorized});\n\t\t\t}\n\n\t\t\tif (this._map._docLayer) {\n\t\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\t}\n\t\t\tthis.close();\n\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && command.errorCmd === 'load') {\n\t\t\tthis._map.hideBusy();\n\t\t\tthis.close();\n\n\t\t\tvar errorKind = command.errorKind;\n\t\t\tvar passwordNeeded = false;\n\t\t\tif (errorKind.startsWith('passwordrequired')) {\n\t\t\t\tpasswordNeeded = true;\n\t\t\t\tvar msg = '';\n\t\t\t\tvar passwordType = errorKind.split(':')[1];\n\t\t\t\tif (passwordType === 'to-view') {\n\t\t\t\t\tmsg += _('Document requires password to view.');\n\t\t\t\t}\n\t\t\t\telse if (passwordType === 'to-modify') {\n\t\t\t\t\tmsg += _('Document requires password to modify.');\n\t\t\t\t\tmsg += ' ';\n\t\t\t\t\tmsg += _('Hit Cancel to open in view-only mode.');\n\t\t\t\t}\n\t\t\t} else if (errorKind.startsWith('wrongpassword')) {\n\t\t\t\tpasswordNeeded = true;\n\t\t\t\tmsg = _('Wrong password provided. Please try again.');\n\t\t\t} else if (errorKind.startsWith('faileddocloading')) {\n\t\t\t\tthis._map._fatal = true;\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.faileddocloading});\n\t\t\t} else if (errorKind.startsWith('docloadtimeout')) {\n\t\t\t\tthis._map._fatal = true;\n\t\t\t\tthis._map.fire('error', {msg: errorMessages.docloadtimeout});\n\t\t\t} else if (errorKind.startsWith('docunloading')) {\n\t\t\t\t// The document is unloading. Have to wait a bit.\n\t\t\t\tthis._map._active = false;\n\n\t\t\t\tclearTimeout(vex.timer);\n\t\t\t\tif (this.ReconnectCount++ >= 10) {\n\t\t\t\t\tthis._map.fire('error', {msg: errorMessages.docunloadinggiveup});\n\t\t\t\t\treturn; // Give up.\n\t\t\t\t}\n\n\t\t\t\tmap = this._map;\n\t\t\t\tvex.timer = setInterval(function() {\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Activate and cancel timer and dialogs.\n\t\t\t\t\t\tmap._activate();\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\twindow.app.console.warn('Cannot activate map');\n\t\t\t\t\t}\n\t\t\t\t// .5, 2, 4.5, 8, 12.5, 18, 24.5, 32, 40.5 seconds\n\t\t\t\t}, 500 * this.ReconnectCount * this.ReconnectCount); // Quadratic back-off.\n\n\t\t\t\tif (this.ReconnectCount > 1) {\n\t\t\t\t\tthis._map.showBusy(errorMessages.docunloadingretry, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (passwordNeeded) {\n\t\t\t\t// Ask the user for password\n\t\t\t\tvex.dialog.open({\n\t\t\t\t\tcontentClassName: 'vex-has-inputs',\n\t\t\t\t\tmessage: msg,\n\t\t\t\t\tinput: '<input name=\"password\" type=\"password\" required />',\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\t$.extend({}, vex.dialog.buttons.YES, { text: _('OK') }),\n\t\t\t\t\t\t$.extend({}, vex.dialog.buttons.NO, { text: _('Cancel') })\n\t\t\t\t\t],\n\t\t\t\t\tcallback: L.bind(function(data) {\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tthis._map._docPassword = data.password;\n\t\t\t\t\t\t\tif (window.ThisIsAMobileApp) {\n\t\t\t\t\t\t\t\twindow.postMobileMessage('loadwithpassword password=' + data.password);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis._map.loadDocument();\n\t\t\t\t\t\t} else if (passwordType === 'to-modify') {\n\t\t\t\t\t\t\tthis._map._docPassword = '';\n\t\t\t\t\t\t\tthis._map.loadDocument();\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._map.fire('postMessage', {msgId: 'UI_Cancel_Password'});\n\t\t\t\t\t\t\tthis._map.hideBusy();\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this)\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('error:') && !this._map._docLayer) {\n\t\t\ttextMsg = textMsg.substring(6);\n\t\t\tif (command.errorKind === 'hardlimitreached') {\n\n\t\t\t\ttextMsg = errorMessages.limitreachedprod;\n\t\t\t\ttextMsg = textMsg.replace(/%0/g, command.params[0]);\n\t\t\t\ttextMsg = textMsg.replace(/%1/g, command.params[1]);\n\t\t\t}\n\t\t\telse if (command.errorKind === 'serviceunavailable') {\n\t\t\t\ttextMsg = errorMessages.serviceunavailable;\n\t\t\t}\n\t\t\tthis._map._fatal = true;\n\t\t\tthis._map._active = false; // Practically disconnected.\n\t\t\tthis._map.fire('error', {msg: textMsg});\n\t\t}\n\t\telse if (textMsg.startsWith('info:') && command.errorCmd === 'socket') {\n\t\t\tif (command.errorKind === 'limitreached' && !this.WasShownLimitDialog) {\n\t\t\t\tthis.WasShownLimitDialog = true;\n\t\t\t\ttextMsg = errorMessages.limitreached;\n\t\t\t\ttextMsg = textMsg.replace(/{docs}/g, command.params[0]);\n\t\t\t\ttextMsg = textMsg.replace(/{connections}/g, command.params[1]);\n\t\t\t\ttextMsg = textMsg.replace(/{productname}/g, (typeof brandProductName !== 'undefined' ?\n\t\t\t\t\tbrandProductName : 'Collabora Online Development Edition'));\n\t\t\t\tvar brandFAQURL = (typeof brandProductFAQURL !== 'undefined') ?\n\t\t\t\t\tbrandProductFAQURL : 'https://collaboraonline.github.io/post/faq/';\n\t\t\t\tthis._map.fire('infobar',\n\t\t\t\t\t{\n\t\t\t\t\t\tmsg: textMsg,\n\t\t\t\t\t\taction: brandFAQURL,\n\t\t\t\t\t\tactionLabel: errorMessages.infoandsupport\n\t\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('pong ') && this._map._docLayer && this._map._docLayer._debug) {\n\t\t\tvar times = this._map._docLayer._debugTimePING;\n\t\t\tvar timeText = this._map._docLayer._debugSetTimes(times, +new Date() - this._map._docLayer._debugPINGQueue.shift());\n\t\t\tthis._map._docLayer._debugData['ping'].setPrefix('Server ping time: ' + timeText +\n\t\t\t\t\t'. Rendered tiles: ' + command.rendercount +\n\t\t\t\t\t', last: ' + (command.rendercount - this._map._docLayer._debugRenderCount));\n\t\t\tthis._map._docLayer._debugRenderCount = command.rendercount;\n\t\t}\n\t\telse if (textMsg.startsWith('saveas:') || textMsg.startsWith('renamefile:')) {\n\t\t\tthis._renameOrSaveAsCallback(textMsg, command);\n\t\t}\n\t\telse if (textMsg.startsWith('warn:')) {\n\t\t\tvar len = 'warn: '.length;\n\t\t\ttextMsg = textMsg.substring(len);\n\t\t\tif (textMsg.startsWith('saveas:')) {\n\t\t\t\tvar userName = command.username ? command.username : _('Someone');\n\t\t\t\tvex.dialog.confirm({\n\t\t\t\t\tmessage: userName +  _(' saved this document as ') + command.filename + _('. Do you want to join?'),\n\t\t\t\t\tcallback: L.bind(function (val) {\n\t\t\t\t\t\tif (val) this._renameOrSaveAsCallback(textMsg, command);\n\t\t\t\t\t}, this)\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('statusindicator:')) {\n\t\t\t//FIXME: We should get statusindicator when saving too, no?\n\t\t\tthis._map.showBusy(window.ThisIsAMobileApp? _('Loading...'): _('Connecting...'), true);\n\t\t\tif (textMsg.startsWith('statusindicator: ready')) {\n\t\t\t\t// We're connected: cancel timer and dialog.\n\t\t\t\tthis.ReconnectCount = 0;\n\t\t\t\tclearTimeout(vex.timer);\n\t\t\t\tvex.closeAll();\n\t\t\t}\n\t\t}\n\t\telse if (window.ThisIsAMobileApp && textMsg.startsWith('mobile:')) {\n\t\t\t// allow passing some events easily from the mobile app\n\t\t\tvar mobileEvent = textMsg.substring('mobile: '.length);\n\t\t\tthis._map.fire(mobileEvent);\n\t\t}\n\t\telse if (textMsg.startsWith('blockui:')) {\n\t\t\ttextMsg = textMsg.substring('blockui:'.length).trim();\n\t\t\tmsg = null;\n\n\t\t\tif (textMsg === 'rename') {\n\t\t\t\tmsg = _('The document is being renamed and will reload shortly');\n\t\t\t}\n\n\t\t\tthis._map.fire('blockUI', {message: msg});\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('unblockui:')) {\n\t\t\tthis._map.fire('unblockUI');\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('featurelock: ')) {\n\t\t\t// Handle feature locking related messages\n\t\t\tvar lockInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map._setLockProps(lockInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('restrictedCommands: ')) {\n\t\t\t// Handle restriction related messages\n\t\t\tvar restrictionInfo = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t\tthis._map._setRestrictions(restrictionInfo);\n\t\t\treturn;\n\t\t}\n\t\telse if (textMsg.startsWith('blockedcommand: ')) {\n\t\t\tvar blockedInfo = app.socket.parseServerCmd(textMsg.substring(16));\n\t\t\tif (blockedInfo.errorKind === 'restricted')\n\t\t\t\twindow.app.console.log('Restricted command \"' + blockedInfo.errorCmd + '\" was blocked');\n\t\t\telse if (blockedInfo.errorKind === 'locked')\n\t\t\t\tthis._map.openUnlockPopup(blockedInfo.errorCmd);\n\t\t\treturn;\n\t\t}\n\t\telse if (!textMsg.startsWith('tile:') && !textMsg.startsWith('renderfont:') && !textMsg.startsWith('windowpaint:')) {\n\n\t\t\tif (imgBytes !== undefined) {\n\t\t\t\ttry {\n\t\t\t\t\t// if it's not a tile, parse the whole message\n\t\t\t\t\ttextMsg = String.fromCharCode.apply(null, imgBytes);\n\t\t\t\t} catch (error) {\n\t\t\t\t\t// big data string\n\t\t\t\t\ttextMsg = this._utf8ToString(imgBytes);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Decode UTF-8 in case it is binary frame\n\t\t\tif (typeof e.data === 'object') {\n\t\t\t\t// FIXME: Not sure what this code is supposed to do. Doesn't\n\t\t\t\t// decodeURIComponent() exactly reverse what window.escape() (which\n\t\t\t\t// is a deprecated equivalent of encodeURIComponent()) does? In what\n\t\t\t\t// case is this code even hit? If somebody figures out what is going\n\t\t\t\t// on here, please replace this comment with an explanation.\n\t\t\t\ttextMsg = decodeURIComponent(window.escape(textMsg));\n\t\t\t}\n\t\t}\n\n\t\tif (textMsg.startsWith('status:')) {\n\t\t\tthis._onStatusMsg(textMsg, command);\n\t\t}\n\n\t\t// These can arrive very early during the startup, and never again.\n\t\tif (textMsg.startsWith('statusindicator')) {\n\t\t\tif (textMsg.startsWith('statusindicatorstart:')) {\n\t\t\t\tvar tokens = textMsg.split(' ');\n\t\t\t\tthis._map.fire('statusindicator', {\n\t\t\t\t\tstatusType : 'start',\n\t\t\t\t\ttext: tokens.length > 1 ? tokens[1] : ''\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('statusindicatorsetvalue:')) {\n\t\t\t\tvar value = textMsg.match(/\\d+/g)[0];\n\t\t\t\tthis._map.fire('statusindicator', {statusType : 'setvalue', value : value});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (textMsg.startsWith('statusindicatorfinish:')) {\n\t\t\t\tthis._map.fire('statusindicator', {statusType : 'finish'});\n\t\t\t\tthis._map._fireInitComplete('statusindicatorfinish');\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\telse if (textMsg.startsWith('jsdialog:')) {\n\t\t\tthis._onJSDialog(textMsg, e.callback);\n\t\t}\n\t\telse if (textMsg.startsWith('hyperlinkclicked:')) {\n\t\t\tthis._onHyperlinkClickedMsg(textMsg);\n\t\t}\n\n\t\tvar msgDelayed = false;\n\t\tif (!this._isReady() || !this._map._docLayer || this._delayedMessages.length || this._handlingDelayedMessages) {\n\t\t\tmsgDelayed = this._tryToDelayMessage(textMsg);\n\t\t}\n\n\t\tif (this._map._docLayer && !msgDelayed) {\n\t\t\tthis._map._docLayer._onMessage(textMsg, e.image);\n\t\t}\n\t},\n\n\t_renameOrSaveAsCallback: function(textMsg, command) {\n\t\tthis._map.hideBusy();\n\t\tif (command !== undefined && command.url !== undefined && command.url !== '') {\n\t\t\tvar url = command.url;\n\n\t\t\t// setup for loading the new document, and trigger the load\n\t\t\tvar docUrl = url.split('?')[0];\n\t\t\tthis._map.options.doc = docUrl;\n\t\t\tthis._map.options.previousWopiSrc = this._map.options.wopiSrc; // After save-as op, we may connect to another server, then code will think that server has restarted. In this case, we don't want to reload the page (detect the file name is different).\n\t\t\tthis._map.options.wopiSrc = encodeURIComponent(docUrl);\n\t\t\twindow.wopiSrc = this._map.options.wopiSrc;\n\n\t\t\tif (textMsg.startsWith('renamefile:')) {\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'File_Rename',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tNewName: command.filename\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else if (textMsg.startsWith('saveas:')) {\n\t\t\t\tvar accessToken = this._getParameterByName(url, 'access_token');\n\t\t\t\tvar accessTokenTtl = this._getParameterByName(url, 'access_token_ttl');\n\n\t\t\t\tif (accessToken !== undefined) {\n\t\t\t\t\tif (accessTokenTtl === undefined) {\n\t\t\t\t\t\taccessTokenTtl = 0;\n\t\t\t\t\t}\n\t\t\t\t\tthis._map.options.docParams = { 'access_token': accessToken, 'access_token_ttl': accessTokenTtl };\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._map.options.docParams = {};\n\t\t\t\t}\n\n\t\t\t\t// if this is save-as, we need to load the document with edit permission\n\t\t\t\t// otherwise the user has to close the doc then re-open it again\n\t\t\t\t// in order to be able to edit.\n\t\t\t\tthis._map.options.permission = 'edit';\n\t\t\t\tthis.close();\n\t\t\t\tthis._map.loadDocument();\n\t\t\t\tthis._map.sendInitUNOCommands();\n\t\t\t\tthis._map.fire('postMessage', {\n\t\t\t\t\tmsgId: 'Action_Save_Resp',\n\t\t\t\t\targs: {\n\t\t\t\t\t\tsuccess: true,\n\t\t\t\t\t\tfileName: decodeURIComponent(command.filename)\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t// var name = command.name; - ignored, we get the new name via the wopi's BaseFileName\n\t},\n\n\t_tryToDelayMessage: function(textMsg) {\n\t\tvar delayed = false;\n\t\tif (textMsg.startsWith('window:') ||\n\t\t\ttextMsg.startsWith('celladdress:') ||\n\t\t\ttextMsg.startsWith('cellviewcursor:') ||\n\t\t\ttextMsg.startsWith('statechanged:') ||\n\t\t\ttextMsg.startsWith('invalidatecursor:') ||\n\t\t\ttextMsg.startsWith('viewinfo:')) {\n\t\t\t//window.app.console.log('_tryToDelayMessage: textMsg: ' + textMsg);\n\t\t\tvar message = {msg: textMsg};\n\t\t\tthis._delayedMessages.push(message);\n\t\t\tdelayed  = true;\n\t\t}\n\n\t\tif (delayed && !this._delayedMsgHandlerTimeoutId) {\n\t\t\tthis._handleDelayedMessages();\n\t\t}\n\t\treturn delayed;\n\t},\n\n\t_handleDelayedMessages: function() {\n\t\tif (!this._isReady() || !this._map._docLayer || this._handlingDelayedMessages) {\n\t\t\tvar that = this;\n\t\t\t// Retry in a bit.\n\t\t\tthis._delayedMsgHandlerTimeoutId = setTimeout(function() {\n\t\t\t\tthat._handleDelayedMessages();\n\t\t\t}, 100);\n\t\t\treturn;\n\t\t}\n\t\tvar messages = [];\n\t\tfor (var i = 0; i < this._delayedMessages.length; ++i) {\n\t\t\tvar message = this._delayedMessages[i];\n\t\t\tif (message)\n\t\t\t\tmessages.push(message.msg);\n\t\t}\n\t\tthis._delayedMessages = [];\n\t\tthis._delayedMsgHandlerTimeoutId = null;\n\t\tthis._handlingDelayedMessages = true;\n\t\tif (this._map._docLayer) {\n\t\t\tfor (var k = 0; k < messages.length; ++k) {\n\t\t\t\ttry {\n\t\t\t\t\tthis._map._docLayer._onMessage(messages[k]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\t// unpleasant - but stops this one problem\n\t\t\t\t\t// event stopping an unknown number of others.\n\t\t\t\t\twindow.app.console.log('Exception ' + e + ' emitting event ' + messages[k]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis._handlingDelayedMessages = false;\n\t},\n\n\t_onStatusMsg: function(textMsg, command) {\n\t\tvar that = this;\n\n\t\tif (!this._isReady()) {\n\t\t\t// Retry in a bit.\n\t\t\tsetTimeout(function() {\n\t\t\t\tthat._onStatusMsg(textMsg, command);\n\t\t\t}, 100);\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._map._docLayer) {\n\t\t\t// first status message, we need to create the document layer\n\t\t\tvar tileWidthTwips = this._map.options.tileWidthTwips;\n\t\t\tvar tileHeightTwips = this._map.options.tileHeightTwips;\n\t\t\tif (this._map.options.zoom !== this._map.options.defaultZoom) {\n\t\t\t\tvar scale = this._map.options.crs.scale(this._map.options.defaultZoom - this._map.options.zoom);\n\t\t\t\ttileWidthTwips = Math.round(tileWidthTwips * scale);\n\t\t\t\ttileHeightTwips = Math.round(tileHeightTwips * scale);\n\t\t\t}\n\n\t\t\tvar docLayer = null;\n\t\t\tif (command.type === 'text') {\n\t\t\t\tdocLayer = new L.WriterTileLayer('', {\n\t\t\t\t\tpermission: this._map.options.permission,\n\t\t\t\t\ttileWidthTwips: tileWidthTwips / app.dpiScale,\n\t\t\t\t\ttileHeightTwips: tileHeightTwips / app.dpiScale,\n\t\t\t\t\tdocType: command.type\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (command.type === 'spreadsheet') {\n\t\t\t\tdocLayer = new L.CalcTileLayer('', {\n\t\t\t\t\tpermission: this._map.options.permission,\n\t\t\t\t\ttileWidthTwips: tileWidthTwips / app.dpiScale,\n\t\t\t\t\ttileHeightTwips: tileHeightTwips / app.dpiScale,\n\t\t\t\t\tdocType: command.type\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (command.type === 'presentation' || command.type === 'drawing') {\n\t\t\t\tdocLayer = new L.ImpressTileLayer('', {\n\t\t\t\t\tpermission: this._map.options.permission,\n\t\t\t\t\ttileWidthTwips: tileWidthTwips / app.dpiScale,\n\t\t\t\t\ttileHeightTwips: tileHeightTwips / app.dpiScale,\n\t\t\t\t\tdocType: command.type\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis._map._docLayer = docLayer;\n\t\t\tthis._map.addLayer(docLayer);\n\t\t\tthis._map.fire('doclayerinit');\n\t\t}\n\t\telse if (this._reconnecting) {\n\t\t\t// we are reconnecting ...\n\t\t\tthis._reconnecting = false;\n\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\tthis._map._docLayer._requestNewTiles();\n\t\t\tthis._map.fire('statusindicator', {statusType: 'reconnected'});\n\t\t\tthis._map._isNotebookbarLoadedOnCore = false;\n\t\t\tvar uiMode = this._map.uiManager.getCurrentMode();\n\t\t\tthis._map.fire('changeuimode', {mode: uiMode, force: true});\n\t\t\tthis._map.setPermission(this._map.options.permission);\n\t\t}\n\n\t\tthis._map.fire('docloaded', {status: true});\n\t\tif (this._map._docLayer) {\n\t\t\tthis._map._docLayer._onMessage(textMsg);\n\t\t}\n\t},\n\n\t// show labels instead of editable fields in message boxes\n\t_preProcessMessageDialog: function(msgData) {\n\t\tfor (var i in msgData.children) {\n\t\t\tvar child = msgData.children[i];\n\t\t\tif (child.type === 'multilineedit')\n\t\t\t\tchild.type = 'fixedtext';\n\t\t\telse if (child.children)\n\t\t\t\tthis._preProcessMessageDialog(child);\n\t\t}\n\t},\n\n\t_onJSDialog: function(textMsg, callback) {\n\t\tvar msgData = JSON.parse(textMsg.substring('jsdialog:'.length + 1));\n\n\t\tif (msgData.children && !L.Util.isArray(msgData.children)) {\n\t\t\twindow.app.console.warn('_onJSDialogMsg: The children\\'s data should be created of array type');\n\t\t\treturn;\n\t\t}\n\n\t\tif (msgData.action) {\n\t\t\tvar that = this;\n\t\t\tvar fireJSDialogEvent = function () {\n\t\t\t\tswitch (msgData.action) {\n\t\t\t\tcase 'update':\n\t\t\t\t\tthat._map.fire('jsdialogupdate', {data: msgData});\n\t\t\t\t\treturn true;\n\n\t\t\t\tcase 'action':\n\t\t\t\t\tthat._map.fire('jsdialogaction', {data: msgData});\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t};\n\n\t\t\tvar isNotebookbarInitialized = (this._map.uiManager && this._map.uiManager.notebookbar);\n\t\t\tif (msgData.jsontype === 'notebookbar' && !isNotebookbarInitialized) {\n\t\t\t\tsetTimeout(fireJSDialogEvent, 1000);\n\t\t\t\treturn;\n\t\t\t} else if (fireJSDialogEvent() === true) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (msgData.type === 'messagebox')\n\t\t\tthis._preProcessMessageDialog(msgData);\n\n\t\t// re/create\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (msgData.type == 'borderwindow')\n\t\t\t\treturn;\n\t\t\tif (msgData.jsontype === 'formulabar') {\n\t\t\t\tthis._map.fire('formulabar', {data: msgData});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (msgData.enabled || msgData.type === 'modalpopup' || msgData.type === 'snackbar') {\n\t\t\t\tthis._map.fire('mobilewizard', {data: msgData, callback: callback});\n\t\t\t} else {\n\t\t\t\tthis._map.fire('closemobilewizard');\n\t\t\t}\n\t\t} else if (msgData.jsontype === 'autofilter') {\n\t\t\tthis._map.fire('autofilterdropdown', msgData);\n\t\t} else if (msgData.jsontype === 'dialog') {\n\t\t\tthis._map.fire('jsdialog', {data: msgData, callback: callback});\n\t\t} else if (msgData.jsontype === 'sidebar') {\n\t\t\tthis._map.fire('sidebar', {data: msgData});\n\t\t} else if (msgData.jsontype === 'formulabar') {\n\t\t\tthis._map.fire('formulabar', {data: msgData});\n\t\t} else if (msgData.jsontype === 'notebookbar') {\n\t\t\tif (msgData.children) {\n\t\t\t\tfor (var i = 0; i < msgData.children.length; i++) {\n\t\t\t\t\tif (msgData.children[i].type === 'control') {\n\t\t\t\t\t\tmsgData.children[i].id = msgData.id;\n\t\t\t\t\t\tthis._map.fire('notebookbar', msgData.children[i]);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t_onHyperlinkClickedMsg: function (textMsg) {\n\t\tvar link = null;\n\t\tvar coords = null;\n\t\tvar hyperlinkMsgStart = 'hyperlinkclicked: ';\n\t\tvar coordinatesMsgStart = ' coordinates: ';\n\n\t\tif (textMsg.indexOf(coordinatesMsgStart) !== -1) {\n\t\t\tvar coordpos = textMsg.indexOf(coordinatesMsgStart);\n\t\t\tlink = textMsg.substring(hyperlinkMsgStart.length, coordpos);\n\t\t\tcoords = textMsg.substring(coordpos+coordinatesMsgStart.length);\n\t\t} else\n\t\t\tlink = textMsg.substring(hyperlinkMsgStart.length);\n\n\t\tthis._map.fire('hyperlinkclicked', {url: link, coordinates: coords});\n\t},\n\n\t_onSocketError: function () {\n\t\twindow.app.console.debug('_onSocketError:');\n\t\tthis._map.hideBusy();\n\t\t// Let onclose (_onSocketClose) report errors.\n\t},\n\n\t_onSocketClose: function () {\n\t\twindow.app.console.debug('_onSocketClose:');\n\t\tif (this.ReconnectCount > 0)\n\t\t\treturn;\n\n\t\tvar isActive = this._map._active;\n\t\tthis._map.hideBusy();\n\t\tthis._map._active = false;\n\n\t\tif (this._map._docLayer) {\n\t\t\tthis._map._docLayer.removeAllViews();\n\t\t\tthis._map._docLayer._resetClientVisArea();\n\t\t\tthis._map._docLayer._graphicSelection = new L.LatLngBounds(new L.LatLng(0, 0), new L.LatLng(0, 0));\n\t\t\tthis._map._docLayer._onUpdateGraphicSelection();\n\t\t}\n\n\t\tif (isActive && this._reconnecting) {\n\t\t\t// Don't show this before first transparently trying to reconnect.\n\t\t\tthis._map.fire('error', {msg: _('Well, this is embarrassing, we cannot connect to your document. Please try again.'), cmd: 'socket', kind: 'closed', id: 4});\n\t\t}\n\n\t\t// Reset wopi's app loaded so that reconnecting again informs outerframe about initialization\n\t\tthis._map['wopi'].resetAppLoaded();\n\t\tthis._map.fire('docloaded', {status: false});\n\n\t\t// We need to make sure that the message slurping processes the\n\t\t// events first, because there could have been a message like\n\t\t// \"close: idle\" from the server.\n\t\t// Without the timeout, we'd immediately reconnect (because the\n\t\t// \"close: idle\" was not processed yet).\n\t\tvar that = this;\n\t\tsetTimeout(function () {\n\t\t\tif (!that._reconnecting) {\n\t\t\t\tthat._reconnecting = true;\n\t\t\t\tif (!that._map._documentIdle)\n\t\t\t\t\tthat._map.showBusy(_('Reconnecting...'), false);\n\t\t\t\tthat._map._activate();\n\t\t\t}\n\t\t}, 1 /* ms */);\n\n\t\tif (!this._map['wopi'].DisableInactiveMessages)\n\t\t\tthis._map.uiManager.showSnackbar(_('The server has been disconnected.'));\n\t},\n\n\tparseServerCmd: function (msg) {\n\t\tvar tokens = msg.split(/[ \\n]+/);\n\t\tvar command = {};\n\t\tfor (var i = 0; i < tokens.length; i++) {\n\t\t\tif (tokens[i].substring(0, 9) === 'tileposx=') {\n\t\t\t\tcommand.x = parseInt(tokens[i].substring(9));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'tileposy=') {\n\t\t\t\tcommand.y = parseInt(tokens[i].substring(9));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 2) === 'x=') {\n\t\t\t\tcommand.x = parseInt(tokens[i].substring(2));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 2) === 'y=') {\n\t\t\t\tcommand.y = parseInt(tokens[i].substring(2));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 10) === 'tilewidth=') {\n\t\t\t\tcommand.tileWidth = parseInt(tokens[i].substring(10));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 11) === 'tileheight=') {\n\t\t\t\tcommand.tileHeight = parseInt(tokens[i].substring(11));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'width=') {\n\t\t\t\tcommand.width = parseInt(tokens[i].substring(6));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'height=') {\n\t\t\t\tcommand.height = parseInt(tokens[i].substring(7));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'part=') {\n\t\t\t\tcommand.part = parseInt(tokens[i].substring(5));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'parts=') {\n\t\t\t\tcommand.parts = parseInt(tokens[i].substring(6));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 8) === 'current=') {\n\t\t\t\tcommand.selectedPart = parseInt(tokens[i].substring(8));\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 3) === 'id=') {\n\t\t\t\t// remove newline characters\n\t\t\t\tcommand.id = tokens[i].substring(3).replace(/(\\r\\n|\\n|\\r)/gm, '');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'type=') {\n\t\t\t\t// remove newline characters\n\t\t\t\tcommand.type = tokens[i].substring(5).replace(/(\\r\\n|\\n|\\r)/gm, '');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'cmd=') {\n\t\t\t\tcommand.errorCmd = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'code=') {\n\t\t\t\tcommand.errorCode = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'kind=') {\n\t\t\t\tcommand.errorKind = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'jail=') {\n\t\t\t\tcommand.jail = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'dir=') {\n\t\t\t\tcommand.dir = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 11) === 'downloadid=') {\n\t\t\t\tcommand.downloadid = tokens[i].substring(11);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'name=') {\n\t\t\t\tcommand.name = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'filename=') {\n\t\t\t\tcommand.filename = tokens[i].substring(9);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'port=') {\n\t\t\t\tcommand.port = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'font=') {\n\t\t\t\tcommand.font = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 5) === 'char=') {\n\t\t\t\tcommand.char = tokens[i].substring(5);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 4) === 'url=') {\n\t\t\t\tcommand.url = tokens[i].substring(4);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'viewid=') {\n\t\t\t\tcommand.viewid = tokens[i].substring(7);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 8) === 'nviewid=') {\n\t\t\t\tcommand.nviewid = tokens[i].substring(8);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 7) === 'params=') {\n\t\t\t\tcommand.params = tokens[i].substring(7).split(',');\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'renderid=') {\n\t\t\t\tcommand.renderid = tokens[i].substring(9);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'rendercount=') {\n\t\t\t\tcommand.rendercount = parseInt(tokens[i].substring(12));\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('wid=')) {\n\t\t\t\tcommand.wireId = this.getParameterValue(tokens[i]);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 6) === 'title=') {\n\t\t\t\tcommand.title = tokens[i].substring(6);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'dialogwidth=') {\n\t\t\t\tcommand.dialogwidth = tokens[i].substring(12);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 13) === 'dialogheight=') {\n\t\t\t\tcommand.dialogheight = tokens[i].substring(13);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 10) === 'rectangle=') {\n\t\t\t\tcommand.rectangle = tokens[i].substring(10);\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 12) === 'hiddenparts=') {\n\t\t\t\tvar hiddenparts = tokens[i].substring(12).split(',');\n\t\t\t\tcommand.hiddenparts = [];\n\t\t\t\thiddenparts.forEach(function (item) {\n\t\t\t\t\tcommand.hiddenparts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('selectedparts=')) {\n\t\t\t\tvar selectedParts = tokens[i].substring(14).split(',');\n\t\t\t\tcommand.selectedParts = [];\n\t\t\t\tselectedParts.forEach(function (item) {\n\t\t\t\t\tcommand.selectedParts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('rtlparts=')) {\n\t\t\t\tvar rtlParts = tokens[i].substring(9).split(',');\n\t\t\t\tcommand.rtlParts = [];\n\t\t\t\trtlParts.forEach(function (item) {\n\t\t\t\t\tcommand.rtlParts.push(parseInt(item));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('hash=')) {\n\t\t\t\tcommand.hash = tokens[i].substring('hash='.length);\n\t\t\t}\n\t\t\telse if (tokens[i] === 'nopng') {\n\t\t\t\tcommand.nopng = true;\n\t\t\t}\n\t\t\telse if (tokens[i].substring(0, 9) === 'username=') {\n\t\t\t\tcommand.username = tokens[i].substring(9);\n\t\t\t}\n\t\t\telse if (tokens[i].startsWith('pagerectangles=')) {\n\t\t\t\tcommand.pageRectangleList = tokens[i].substring(15).split(';');\n\t\t\t\tcommand.pageRectangleList = command.pageRectangleList.map(function(element) {\n\t\t\t\t\telement = element.split(',');\n\t\t\t\t\treturn [parseInt(element[0]), parseInt(element[1]), parseInt(element[2]), parseInt(element[3])];\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\tif (command.tileWidth && command.tileHeight && this._map._docLayer) {\n\t\t\tvar defaultZoom = this._map.options.zoom;\n\t\t\tvar scale = command.tileWidth / this._map._docLayer.options.tileWidthTwips;\n\t\t\t// scale = 1.2 ^ (defaultZoom - zoom)\n\t\t\t// zoom = defaultZoom -log(scale) / log(1.2)\n\t\t\tcommand.zoom = Math.round(defaultZoom - Math.log(scale) / Math.log(1.2));\n\t\t}\n\t\treturn command;\n\t},\n\n\tsetTraceEventLogging: function (enabled) {\n\t\tthis.traceEventRecordingToggle = enabled;\n\t\tthis.sendMessage('traceeventrecording ' + (this.traceEventRecordingToggle ? 'start' : 'stop'));\n\n\t\t// Just as a test, uncomment this to toggle SAL_WARN and\n\t\t// SAL_INFO selection between two states: 1) the default\n\t\t// as directed by the SAL_LOG environment variable, and\n\t\t// 2) all warnings on plus SAL_INFO for sc.\n\t\t//\n\t\t// (Note that coolwsd sets the SAL_LOG environment variable\n\t\t// to \"-WARN-INFO\", i.e. the default is that nothing is\n\t\t// logged from core.)\n\n\t\t// app.socket.sendMessage('sallogoverride ' + (app.socket.traceEventRecordingToggle ? '+WARN+INFO.sc' : 'default'));\n\t},\n\n\ttraceEventRecordingToggle: false,\n\n\t_stringifyArgs: function (args) {\n\t\treturn (args == null ? '' : (' args=' + JSON.stringify(args)));\n\t},\n\n\t// The args parameter, if present, should be an object where both keys and values are strings that don't contain any spaces.\n\temitInstantTraceEvent: function (name, args) {\n\t\tif (this.traceEventRecordingToggle)\n\t\t\tthis.sendMessage('TRACEEVENT name=' + name + ' ph=i ts=' + Math.round(performance.now() * 1000)\n\t\t\t\t\t + this._stringifyArgs(args));\n\t},\n\n\tasyncTraceEventCounter: 0,\n\n\t// simulate a threads per live async event to help the chrome renderer\n\tasyncTracePseudoThread: 1,\n\n\tcreateAsyncTraceEvent: function (name, args) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar result = {};\n\t\tresult.id = this.asyncTraceEventCounter++;\n\t\tresult.tid = this.asyncTracePseudoThread++;\n\t\tresult.active = true;\n\t\tresult.args = args;\n\n\t\tif (this.traceEventRecordingToggle)\n\t\t\tthis.sendMessage('TRACEEVENT name=' + name +\n\t\t\t\t\t ' ph=S ts=' + Math.round(performance.now() * 1000) +\n\t\t\t\t\t ' id=' + result.id + ' tid=' + result.tid +\n\t\t\t\t\t this._stringifyArgs(args));\n\n\t\tvar that = this;\n\t\tresult.finish = function () {\n\t\t\tthat.asyncTracePseudoThread--;\n\t\t\tif (this.active) {\n\t\t\t\tthat.sendMessage('TRACEEVENT name=' + name +\n\t\t\t\t\t\t ' ph=F ts=' + Math.round(performance.now() * 1000) +\n\t\t\t\t\t\t ' id=' + this.id + ' tid=' + this.tid +\n\t\t\t\t\t\t that._stringifyArgs(this.args));\n\t\t\t\tthis.active = false;\n\t\t\t}\n\t\t};\n\t\tresult.abort = function () {\n\t\t\tthat.asyncTracePseudoThread--;\n\t\t\tthis.active = false;\n\t\t};\n\t\treturn result;\n\t},\n\n\tcreateCompleteTraceEvent: function (name, args) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar result = {};\n\t\tresult.active = true;\n\t\tresult.begin = performance.now();\n\t\tresult.args = args;\n\t\tvar that = this;\n\t\tresult.finish = function () {\n\t\t\tif (this.active) {\n\t\t\t\tvar now = performance.now();\n\t\t\t\tthat.sendMessage('TRACEEVENT name=' + name +\n\t\t\t\t\t\t ' ph=X ts=' + Math.round(this.begin * 1000) +\n\t\t\t\t\t\t ' dur=' + Math.round((now - this.begin) * 1000)\n\t\t\t\t\t\t + that._stringifyArgs(args));\n\t\t\t\tthis.active = false;\n\t\t\t}\n\t\t};\n\t\tresult.abort = function () {\n\t\t\tthis.active = false;\n\t\t};\n\t\treturn result;\n\t},\n\n\t// something we can grok quickly in the trace viewer\n\tcreateCompleteTraceEventFromEvent: function(textMsg) {\n\t\tif (!this.traceEventRecordingToggle)\n\t\t\treturn null;\n\n\t\tvar pretty;\n\t\tif (!textMsg)\n\t\t\tpretty = 'blob';\n\t\telse {\n\t\t\tvar idx = textMsg.indexOf(':');\n\t\t\tif (idx > 0)\n\t\t\t\tpretty = textMsg.substring(0,idx);\n\t\t\telse if (textMsg.length < 25)\n\t\t\t\tpretty = textMsg;\n\t\t\telse\n\t\t\t\tpretty = textMsg.substring(0, 25);\n\t\t}\n\t\treturn this.createCompleteTraceEvent(pretty, { message: textMsg });\n\t},\n\n\tthreadLocalLoggingLevelToggle: false\n});\n"]}
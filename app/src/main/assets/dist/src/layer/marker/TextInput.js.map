{"version":3,"file":"TextInput.js","sourceRoot":"","sources":["../../../../../../../../../browser/src/layer/marker/TextInput.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8; fill-column: 100 -*- */\n/*\n * L.TextInput is the hidden textarea, which handles text input events\n *\n * This is made significantly more difficult than expected by such a\n * mess of browser, and mobile IME quirks that it is not possible to\n * follow events, but we have to re-construct input from a browser\n * text area itself.\n */\n\n/* global app isAnyVexDialogActive */\n\nL.TextInput = L.Layer.extend({\n\tinitialize: function() {\n\t\t// Flag to denote the composing state, derived from\n\t\t// compositionstart/compositionend events; unused\n\t\tthis._isComposing = false;\n\n\t\t// We need to detect whether delete or backspace was\n\t\t// pressed sometimes - consider '  foo' -> ' foo'\n\t\tthis._deleteHint = ''; // or 'delete' or 'backspace'\n\n\t\t// We need to detect line break in the tunneled formula\n\t\t// input window for the multiline case.\n\t\tthis._linebreakHint = false;\n\n\t\t// Clearing the area can generate input events\n\t\tthis._ignoreInputCount = 0;\n\n\t\t// If the last focus intended to accept user input.\n\t\t// Signifies whether the keyboard is meant to be visible.\n\t\tthis._setAcceptInput(false);\n\n\t\t// Content\n\t\tthis._lastContent = []; // unicode characters\n\t\tthis._hasWorkingSelectionStart = undefined; // does it work ?\n\t\tthis._ignoreNextBackspace = false;\n\n\t\tthis._preSpaceChar = ' ';\n\t\t// Might need to be \\xa0 in some legacy browsers ?\n\t\tif (L.Browser.android && L.Browser.webkit) {\n\t\t\t// fool GBoard into not auto-capitalizing constantly\n\t\t\tthis._preSpaceChar = '\\xa0';\n\t\t}\n\t\tthis._postSpaceChar = ' ';\n\n\t\t// Debug flag, used in fancyLog(). See the debug() method.\n\t\t//this._isDebugOn = true;\n\t\tthis._isDebugOn = false;\n\n\t\tthis._initLayout();\n\n\t\t// Under-caret orange marker.\n\t\tthis._cursorHandler = L.marker(new L.LatLng(0, 0), {\n\t\t\ticon: L.divIcon({\n\t\t\t\tclassName: 'leaflet-cursor-handler',\n\t\t\t\ticonSize: null\n\t\t\t}),\n\t\t\tdraggable: true\n\t\t}).on('dragend', this._onCursorHandlerDragEnd, this);\n\n\t\t// Auto-correct characters can trigger auto-correction, but\n\t\t// must be sent as key-up/down if we want correction.\n\t\t// cf. SvxAutoCorrect::IsAutoCorrectChar\n\t\tthis._autoCorrectChars = {\n\t\t\t// tab, newline - handled elsewhere\n\t\t\t' ':  [ 32, 0,      0, 1284 ],\n\t\t\t'!':  [ 33, 0,      0, 4353 ],\n\t\t\t'\"':  [ 34, 0,      0, 4353 ],\n\t\t\t'%':  [ 37, 0,      0, 4357 ],\n\t\t\t'\\'': [ 39, 0,      0,  192 ],\n\t\t\t'*':  [ 42, 0,      0, 4360 ],\n\t\t\t',':  [ 44, 0,      0, 1291 ],\n\t\t\t'-':  [ 45, 0,      0, 1288 ],\n\t\t\t'.':  [ 46, 0,      0,  190 ],\n\t\t\t'/':  [ 47, 0,      0,  191 ],\n\t\t\t':':  [ 58, 0,      0, 5413 ],\n\t\t\t';':  [ 59, 0,      0, 1317 ],\n\t\t\t'?':  [ 63, 0,      0, 4287 ],\n\t\t\t'_':  [ 95, 0,      0, 5384 ]\n\t\t};\n\t},\n\n\tonAdd: function() {\n\t\tif (this._container) {\n\t\t\tthis.getPane().appendChild(this._container);\n\t\t\tthis.update();\n\t\t}\n\n\t\tthis._emptyArea();\n\n\t\tthis._map.on('updatepermission', this._onPermission, this);\n\t\tthis._map.on('commandresult', this._onCommandResult, this);\n\t\tL.DomEvent.on(this._textArea, 'focus blur', this._onFocusBlur, this);\n\n\t\t// Do not wait for a 'focus' event to attach events if the\n\t\t// textarea/contenteditable is already focused (due to the autofocus\n\t\t// HTML attribute, the browser focusing it on DOM creation, or whatever)\n\t\tif (document.activeElement === this._textArea) {\n\t\t\tthis._onFocusBlur({ type: 'focus' });\n\t\t}\n\n\t\tif (window.ThisIsTheiOSApp) {\n\t\t\tvar that = this;\n\t\t\twindow.MagicToGetHWKeyboardWorking = function() {\n\t\t\t\tvar that2 = that;\n\t\t\t\twindow.MagicKeyDownHandler = function(e) {\n\t\t\t\t\tthat2._onKeyDown(e);\n\t\t\t\t};\n\t\t\t\twindow.MagicKeyUpHandler = function(e) {\n\t\t\t\t\tthat2._onKeyUp(e);\n\t\t\t\t};\n\t\t\t};\n\t\t\twindow.postMobileMessage('FOCUSIFHWKBD');\n\t\t}\n\n\t\tL.DomEvent.on(this._map.getContainer(), 'mousedown touchstart', this._abortComposition, this);\n\t},\n\n\tonRemove: function() {\n\t\twindow.MagicToGetHWKeyboardWorking = null;\n\t\twindow.MagicKeyDownHandler = null;\n\t\twindow.MagicKeyUpHandler = null;\n\n\t\tif (this._container) {\n\t\t\tthis.getPane().removeChild(this._container);\n\t\t}\n\n\t\tthis._map.off('updatepermission', this._onPermission, this);\n\t\tL.DomEvent.off(this._textArea, 'focus blur', this._onFocusBlur, this);\n\t\tL.DomEvent.off(this._map.getContainer(), 'mousedown touchstart', this._abortComposition, this);\n\n\t\tthis._map.removeLayer(this._cursorHandler);\n\t},\n\n\tdisable: function () {\n\t\tthis._textArea.setAttribute('disabled', true);\n\t},\n\n\tenable: function () {\n\t\tthis._textArea.removeAttribute('disabled');\n\t},\n\n\t_onPermission: function(e) {\n\t\tif (e.perm === 'edit') {\n\t\t\tthis._textArea.removeAttribute('disabled');\n\t\t} else {\n\t\t\tthis._textArea.setAttribute('disabled', true);\n\t\t}\n\t},\n\n\t_onCommandResult: function(e) {\n\t\tif ((e.commandName === '.uno:Undo' || e.commandName === '.uno:Redo') && window.mode.isMobile()) {\n\t\t\t//undoing something on mobile does not trigger any input method\n\t\t\t//this causes problem in mobile working with suggestions\n\t\t\t//i.e: type \"than\" and then select \"thank\" from suggestion\n\t\t\t//now undo and then again select \"thanks\" from suggestions\n\t\t\t//final output is \"thans\"\n\t\t\t//this happens because undo doesn't change the textArea value\n\t\t\t//and no other way to maintain the history\n\t\t\t//So better to clean the textarea so no suggestions appear\n\t\t\tthis._emptyArea();\n\t\t}\n\t},\n\n\t_onFocusBlur: function(ev) {\n\t\tthis._fancyLog(ev.type, '');\n\n\t\tvar onoff = (ev.type == 'focus' ? L.DomEvent.on : L.DomEvent.off).bind(L.DomEvent);\n\n\t\t// Debug - connect first for saner logging.\n\t\tonoff(\n\t\t\tthis._textArea,\n\t\t\t'copy cut compositionstart compositionupdate compositionend select keydown keypress keyup beforeinput textInput textinput input',\n\t\t\tthis._onEvent,\n\t\t\tthis\n\t\t);\n\n\t\tonoff(this._textArea, 'input', this._onInput, this);\n\t\tonoff(this._textArea, 'beforeinput', this._onBeforeInput, this);\n\t\tonoff(this._textArea, 'compositionstart', this._onCompositionStart, this);\n\t\tonoff(this._textArea, 'compositionupdate', this._onCompositionUpdate, this);\n\t\tonoff(this._textArea, 'compositionend', this._onCompositionEnd, this);\n\t\tonoff(this._textArea, 'keydown', this._onKeyDown, this);\n\t\tonoff(this._textArea, 'keyup', this._onKeyUp, this);\n\t\tonoff(this._textArea, 'copy cut paste', this._map._handleDOMEvent, this._map);\n\n\t\tthis._map.notifyActive();\n\n\t\tif (ev.type === 'blur' && this._isComposing) {\n\t\t\tthis._abortComposition(ev);\n\t\t}\n\t},\n\n\t// Focus the textarea/contenteditable\n\t// @acceptInput (only on \"mobile\" (= mobile phone) or on iOS and Android in general) true if we want to\n\t// accept key input, and show the virtual keyboard.\n\tfocus: function(acceptInput) {\n\t\tif (isAnyVexDialogActive())\n\t\t\treturn;\n\t\t// window.app.console.trace('L.TextInput.focus(' + acceptInput + ')');\n\n\t\t// Note that the acceptInput parameter intentionally\n\t\t// is a tri-state boolean: undefined, false, or true.\n\n\t\t// Clicking or otherwise focusing the map should focus on the clipboard\n\t\t// container in order for the user to input text (and on-screen keyboards\n\t\t// to pop-up), unless the document is read only.\n\t\tif (!this._map.isPermissionEdit()) {\n\t\t\tthis._setAcceptInput(false);\n\t\t\t// on clicking focus is important\n\t\t\t// specially in chrome once document loses focus it never gets it back\n\t\t\t// which causes shortcuts to stop working (i.e: print, search etc...)\n\t\t\tthis._map.getContainer().focus();\n\t\t\treturn;\n\t\t}\n\n\t\t// Trick to avoid showing the software keyboard: Set the textarea\n\t\t// read-only before focus() and reset it again after the blur()\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook()) {\n\t\t\tif ((window.ThisIsAMobileApp || window.mode.isMobile()) && acceptInput !== true)\n\t\t\t\tthis._textArea.setAttribute('readonly', true);\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone') {\n\t\t\tthis._textArea.focus();\n\t\t} else if (acceptInput === true) {\n\t\t\t// On the iPhone, only call the textarea's focus() when we get an explicit\n\t\t\t// true parameter. On the other hand, never call the textarea's blur().\n\n\t\t\t// Calling blur() leads to so confusing behaviour with the keyboard not\n\t\t\t// showing up when we want. Better to have it show up a bit too long that\n\t\t\t// strictly needed.\n\n\t\t\t// Probably whether the calls to the textarea's focus() and blur() functions\n\t\t\t// actually do anything or not might depend on whether the call stack\n\t\t\t// originates in a user input event handler or not, for security reasons.\n\n\t\t\t// To investigate, uncomment the call to console.trace() at the start of\n\t\t\t// this function, and check when the topmost slot in the stack trace is\n\t\t\t// \"(anonymous function)\" in hammer.js (an event handler), and when it is\n\t\t\t// _onMessage (the WebSocket message handler in Socket.js).\n\n\t\t\tthis._textArea.focus();\n\t\t}\n\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook()) {\n\t\t\tif ((window.ThisIsAMobileApp || window.mode.isMobile()) && acceptInput !== true) {\n\t\t\t\tthis._setAcceptInput(false);\n\t\t\t\tthis._textArea.blur();\n\t\t\t\tthis._textArea.removeAttribute('readonly');\n\t\t\t} else {\n\t\t\t\tthis._setAcceptInput(true);\n\t\t\t}\n\t\t} else if (acceptInput !== false) {\n\t\t\tthis._setAcceptInput(true);\n\t\t} else {\n\t\t\tthis._setAcceptInput(false);\n\t\t}\n\t},\n\n\tblur: function() {\n\t\tthis._setAcceptInput(false);\n\t\tif (!window.ThisIsTheiOSApp && navigator.platform !== 'iPhone' && !window.mode.isChromebook())\n\t\t\tthis._textArea.blur();\n\t},\n\n\t// Returns true if the last focus was to accept input.\n\t// Used to restore the keyboard.\n\tcanAcceptKeyboardInput: function() {\n\t\treturn this._acceptInput;\n\t},\n\n\t// Marks the content of the textarea/contenteditable as selected,\n\t// for system clipboard interaction.\n\tselect: function() {\n\t\tthis._textArea.select();\n\t},\n\n\tgetValue: function() {\n\t\tvar value = this._textArea.value;\n\t\treturn value;\n\t},\n\n\t// Convert an array of Unicode code points to a string of UTF-16 code units. Workaround\n\t// for String.fromCodePoint() that is missing in IE.\n\tcodePointsToString: function(codePoints) {\n\t\tvar result = '';\n\t\tfor (var i = 0; i < codePoints.length; ++i) {\n\t\t\tif (codePoints[i] <= 0xFFFF)\n\t\t\t\tresult = (result +\n\t\t\t\t\t  String.fromCharCode(codePoints[i]));\n\t\t\telse\n\t\t\t\tresult = (result +\n\t\t\t\t\t  String.fromCharCode(((codePoints[i] - 0x10000) >> 10) + 0xD800) +\n\t\t\t\t\t  String.fromCharCode(((codePoints[i] - 0x10000) % 0x400) + 0xDC00));\n\t\t}\n\t\treturn result;\n\t},\n\n\t// As the name says, this returns this._textArea.value as an array of numbers that are\n\t// Unicode code points. *Not* UTF-16 code units.\n\tgetValueAsCodePoints: function() {\n\t\tvar value = this.getValue();\n\t\tif (false) {\n\t\t\tvar s = '[';\n\t\t\tfor (var ii = 0; ii < value.length; ++ii) {\n\t\t\t\tif (ii > 0)\n\t\t\t\t\ts = s + ',';\n\t\t\t\ts = s + '0x' + value.charCodeAt(ii).toString(16);\n\t\t\t}\n\t\t\ts = s + ']';\n\t\t\twindow.app.console.log('L.TextInput.getValueAsCodePoints: ' + s);\n\t\t}\n\t\tvar arr = [];\n\t\tvar code;\n\t\tfor (var i = 0; i < value.length; ++i)\n\t\t{\n\t\t\tcode = value.charCodeAt(i);\n\n\t\t\t// if it were not for IE11: \"for (code of value)\" does the job.\n\t\t\tif (code >= 0xd800 && code <= 0xdbff) // handle UTF16 pairs.\n\t\t\t{\n\t\t\t\t// TESTME: harder ...\n\t\t\t\tvar high = (code - 0xd800) << 10;\n\t\t\t\tcode = value.charCodeAt(++i);\n\t\t\t\tcode = high + code - 0xdc00 + 0x10000;\n\t\t\t}\n\t\t\tarr.push(code);\n\t\t}\n\t\treturn arr;\n\t},\n\n\tupdate: function() {\n\t\tif (this._container && this._map && this._latlng) {\n\t\t\tvar position = this._map.latLngToLayerPoint(this._latlng).round();\n\t\t\tthis._setPos(position);\n\t\t}\n\t},\n\n\t_initLayout: function() {\n\t\tthis._container = L.DomUtil.create('div', 'clipboard-container');\n\t\tthis._container.id = 'doc-clipboard-container';\n\n\t\t// The textarea allows the keyboard to pop up and so on.\n\t\t// Note that the contents of the textarea are NOT deleted on each composed\n\t\t// word, in order to make\n\t\tthis._textArea = L.DomUtil.create('textarea', 'clipboard', this._container);\n\t\tthis._textArea.id = 'clipboard-area';\n\t\tthis._textArea.setAttribute('autocapitalize', 'off');\n\t\tthis._textArea.setAttribute('autofocus', 'true');\n\t\tthis._textArea.setAttribute('autocorrect', 'off');\n\t\tthis._textArea.setAttribute('autocomplete', 'off');\n\t\tthis._textArea.setAttribute('spellcheck', 'false');\n\n\t\tthis._textAreaLabel = L.DomUtil.create('label', 'visuallyhidden', this._container);\n\t\tthis._textAreaLabel.setAttribute('for', 'clipboard-area');\n\t\tthis._textAreaLabel.innerHTML = 'clipboard area';\n\n\t\t// Prevent automatic line breaks in the textarea. Without this,\n\t\t// chromium/blink will trigger input/insertLineBreak events by\n\t\t// just adding whitespace.\n\t\t// See https://developer.mozilla.org/en-US/docs/Web/HTML/Element/textarea#attr-wrap\n\t\tthis._textArea.setAttribute('wrap', 'off');\n\n\t\t// Prevent autofocus\n\t\tthis._textArea.setAttribute('disabled', true);\n\n\t\tthis._setupStyles();\n\n\t\tthis._emptyArea();\n\t},\n\n\t_setupStyles: function() {\n\t\tif (this._isDebugOn) {\n\t\t\t// Style for debugging\n\t\t\tthis._container.style.opacity = 0.5;\n\t\t\tthis._textArea.style.cssText = 'border:1px solid red !important';\n\t\t\tthis._textArea.style.width = '120px';\n\t\t\tthis._textArea.style.height = '50px';\n\t\t\tthis._textArea.style.overflow = 'display';\n\n\t\t\tthis._textArea.style.fontSize = '30px';\n\t\t\tthis._textArea.style.position = 'relative';\n\t\t\tthis._textArea.style.left = '10px';\n\t\t} else {\n\t\t\tthis._container.style.opacity = 0;\n\t\t\tthis._textArea.style.width = '1px';\n\t\t\tthis._textArea.style.height = '1px';\n\t\t\tthis._textArea.style.caretColor = 'transparent';\n\t\t\tthis._textArea.style.resize = 'none';\n\t\t}\n\t},\n\n\tdebug: function(debugOn) {\n\t\tthis._isDebugOn = !!debugOn;\n\t\tthis._setupStyles();\n\t},\n\n\tactiveElement: function() {\n\t\treturn this._textArea;\n\t},\n\n\t// Displays the caret and the under-caret marker.\n\t// Fetches the coordinates of the caret from the map's doclayer.\n\tshowCursor: function() {\n\t\tif (!this._map._docLayer._cursorMarker) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Fetch top and bottom coords of caret\n\t\tvar top = this._map._docLayer._visibleCursor.getNorthWest();\n\t\tvar bottom = this._map._docLayer._visibleCursor.getSouthWest();\n\n\t\tif (!this._map._docLayer._cursorMarker.isDomAttached()) {\n\t\t\t// Display caret\n\t\t\tthis._map._docLayer._cursorMarker.add();\n\t\t}\n\t\tthis._map._docLayer._cursorMarker.setMouseCursor();\n\n\t\t// Move and display under-caret marker\n\t\tif (L.Browser.touch) {\n\t\t\tif (this._map._docLayer._textCSelections.empty()) {\n\t\t\t\tthis._cursorHandler.setLatLng(bottom).addTo(this._map);\n\t\t\t} else {\n\t\t\t\tthis._map.removeLayer(this._cursorHandler);\n\t\t\t}\n\t\t}\n\n\t\t// Move the hidden text area with the cursor\n\t\tthis._latlng = L.latLng(top);\n\t\tthis.update();\n\t\t// shape handlers hidden (if selected)\n\t\tthis._map.fire('handlerstatus', {hidden: true});\n\t\tif (this._map._docLoaded && this._map.getDocType() === 'spreadsheet')\n\t\t\tthis._map.onFormulaBarFocus();\n\t},\n\n\t// Hides the caret and the under-caret marker.\n\thideCursor: function() {\n\t\tif (!this._map._docLayer._cursorMarker) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._map._docLayer._cursorMarker.isDomAttached())\n\t\t\tthis._map._docLayer._cursorMarker.remove();\n\t\tthis._map.removeLayer(this._cursorHandler);\n\t\t// shape handlers visible again (if selected)\n\t\tthis._map.fire('handlerstatus', {hidden: false});\n\t},\n\n\t_setPos: function(pos) {\n\t\tL.DomUtil.setPosition(this._container, pos);\n\t},\n\n\t// Generic handle attached to most text area events, just for debugging purposes.\n\t_onEvent: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\t\tvar msg = {\n\t\t\tinputType: ev.inputType,\n\t\t\tdata: ev.data,\n\t\t\tkey: ev.key,\n\t\t\tisComposing: ev.isComposing\n\t\t};\n\n\t\tif ('key' in ev) {\n\t\t\tmsg.key = ev.key;\n\t\t\tmsg.keyCode = ev.keyCode;\n\t\t\tmsg.code = ev.code;\n\t\t\tmsg.which = ev.which;\n\t\t}\n\t\tthis._fancyLog(ev.type, msg);\n\t},\n\n\t_fancyLog: function(type, payload) {\n\t\t// Avoid unhelpful exceptions\n\t\tif (payload === undefined)\n\t\t\tpayload = 'undefined';\n\t\telse if (payload === null)\n\t\t\tpayload = 'null';\n\n\t\t// Save to downloadable log\n\t\tL.Log.log(payload.toString(), 'INPUT');\n\n\t\t// Pretty-print on console (but only if \"tile layer debug mode\" is active)\n\t\tif (this._isDebugOn) {\n\t\t\tvar state = this._isComposing ? 'C' : 'N';\n\t\t\tstate += this._hasWorkingSelectionStart ? 'S' : '-';\n\t\t\tstate += this._ignoreNextBackspace ? 'I' : '-';\n\t\t\tstate += ' ';\n\n\t\t\tvar textSel = this._textArea.selectionStart + '!' + this._textArea.selectionEnd;\n\t\t\tstate += textSel + ' ';\n\n\t\t\tvar sel = window.getSelection();\n\t\t\tvar content = this.getValue();\n\t\t\tif (sel === null)\n\t\t\t\tstate += '-1';\n\t\t\telse\n\t\t\t{\n\t\t\t\tstate += sel.rangeCount;\n\n\t\t\t\tstate += ' ';\n\t\t\t\tvar cursorPos = -1;\n\t\t\t\tfor (var i = 0; i < sel.rangeCount; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar range = sel.getRangeAt(i);\n\t\t\t\t\tstate += range.startOffset + '-' + range.endOffset + ' ';\n\t\t\t\t\tif (cursorPos < 0)\n\t\t\t\t\t\tcursorPos = range.startOffset;\n\t\t\t\t}\n\t\t\t\tif (sel.toString() !== '')\n\t\t\t\t\tstate += ': \"' + sel.toString() + '\" ';\n\n\t\t\t\t// inject probable cursor\n\t\t\t\tif (cursorPos >= 0)\n\t\t\t\t\tcontent = content.slice(0, cursorPos) + '|' + content.slice(cursorPos);\n\t\t\t}\n\n\t\t\tstate += '[' + this._deleteHint + '] ';\n\n\t\t\twindow.app.console.log(\n\t\t\t\t+ new Date() + ' %cINPUT%c: ' + state\n\t\t\t\t+ '\"' + content + '\" ' + type + '%c ',\n\t\t\t\t'background:#bfb;color:black',\n\t\t\t\t'color:green',\n\t\t\t\t'color:black',\n\t\t\t\tJSON.stringify(payload)\n\t\t\t);\n\t\t}\n\t},\n\n\t// Backspaces and deletes at the beginning / end are filtered out, so\n\t// we get a beforeinput, but no input for them. Sometimes we can end up\n\t// in a state where we lost our leading / terminal chars and can't recover\n\t_onBeforeInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tthis._ignoreNextBackspace = false;\n\t\tif (this._hasWorkingSelectionStart) {\n\t\t\tvar value = this._textArea.value;\n\t\t\tif (value.length == 2 && value === this._preSpaceChar + this._postSpaceChar &&\n\t\t\t    this._textArea.selectionStart === 0)\n\t\t\t{\n\t\t\t\t// It seems some inputs eg. GBoard can magically move the cursor from \" | \" to \"|  \"\n\t\t\t\twindow.app.console.log('Oh dear, gboard sabotaged our cursor position, fixing');\n\t\t\t\t// But when we detect the problem only emit a delete when we have one.\n\t\t\t\tif (ev.inputType && ev.inputType === 'deleteContentBackward')\n\t\t\t\t{\n\t\t\t\t\tthis._removeTextContent(1, 0);\n\t\t\t\t\t// Having mended it we now get a real backspace on input (sometimes)\n\t\t\t\t\tthis._ignoreNextBackspace = true;\n\t\t\t\t}\n\t\t\t\tthis._emptyArea();\n\t\t\t}\n\t\t}\n\t},\n\n\t// Fired when text has been inputed, *during* and after composing/spellchecking\n\t_onInput: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tthis._map.notifyActive();\n\n\t\tif (this._ignoreInputCount > 0) {\n\t\t\twindow.app.console.log('ignoring synthetic input ' + this._ignoreInputCount);\n\t\t\treturn;\n\t\t}\n\n\t\tif (ev.inputType) {\n\t\t\tif (ev.inputType == 'deleteContentForward')\n\t\t\t\tthis._deleteHint = 'delete';\n\t\t\telse if (ev.inputType == 'deleteContentBackward')\n\t\t\t\tthis._deleteHint = 'backspace';\n\t\t\telse\n\t\t\t\tthis._deleteHint = '';\n\t\t}\n\n\t\tvar ignoreBackspace = this._ignoreNextBackspace;\n\t\tthis._ignoreNextBackspace = false;\n\n\t\tvar content = this.getValueAsCodePoints();\n\t\t// Note that content is an array of Unicode code points\n\n\t\tvar preSpaceChar = this._preSpaceChar.charCodeAt(0);\n\t\tvar postSpaceChar = this._postSpaceChar.charCodeAt(0);\n\n\t\t// We use a different leading and terminal space character\n\t\t// to differentiate backspace from delete, then replace the character.\n\t\tif (content.length < 1 || content[0] !== preSpaceChar) { // missing initial space\n\t\t\twindow.app.console.log('Sending backspace');\n\t\t\tif (!ignoreBackspace)\n\t\t\t\tthis._removeTextContent(1, 0);\n\t\t\tthis._emptyArea();\n\t\t\treturn;\n\t\t}\n\t\tif (content[content.length-1] !== postSpaceChar) { // missing trailing space.\n\t\t\twindow.app.console.log('Sending delete');\n\t\t\tthis._removeTextContent(0, 1);\n\t\t\tthis._emptyArea();\n\t\t\treturn;\n\t\t}\n\t\tif (content.length < 2) {\n\t\t\twindow.app.console.log('Missing terminal nodes: ' + this._deleteHint);\n\t\t\tif (this._deleteHint == 'backspace' ||\n\t\t\t    this._textArea.selectionStart === 0)\n\t\t\t{\n\t\t\t\tif (!ignoreBackspace)\n\t\t\t\t\tthis._removeTextContent(1, 0);\n\t\t\t}\n\t\t\telse if (this._deleteHint == 'delete' ||\n\t\t\t\t this._textArea.selectionStart === 1)\n\t\t\t\tthis._removeTextContent(0, 1);\n\t\t\telse\n\t\t\t\twindow.app.console.log('Cant detect delete or backspace');\n\t\t\tthis._emptyArea();\n\t\t\treturn;\n\t\t}\n\n\t\t// remove leading & tailing spaces.\n\t\tcontent = content.slice(1, -1);\n\n\t\t// In the android keyboard when you try to erase in an empty area\n\t\t// and then enter some character,\n\t\t// The first character will likely travel with the cursor,\n\t\t// And that is caused because after entering the first character\n\t\t// cursor position is never updated by keyboard (I know it is strange)\n\t\t// so here we manually correct the position\n\t\tif (content.length === 1 && this._lastContent.length === 0)\n\t\t\tthis._setCursorPosition(2);\n\n\t\tvar matchTo = 0;\n\t\tvar sharedLength = Math.min(content.length, this._lastContent.length);\n\t\twhile (matchTo < sharedLength && content[matchTo] === this._lastContent[matchTo])\n\t\t\tmatchTo++;\n\n\t\twindow.app.console.log('Comparison matchAt ' + matchTo + '\\n' +\n\t\t\t    '\\tnew \"' + this.codePointsToString(content) + '\" (' + content.length + ')' + '\\n' +\n\t\t\t    '\\told \"' + this.codePointsToString(this._lastContent) + '\" (' + this._lastContent.length + ')');\n\n\t\tvar removeBefore = this._lastContent.length - matchTo;\n\t\tvar removeAfter = 0;\n\n\t\tif (this._lastContent.length > content.length)\n\t\t{\n\t\t\t// Pressing '<space><delete>' can delete our terminal space\n\t\t\t// such that subsequent deletes will do nothing; need to\n\t\t\t// detect and reset in this case.\n\t\t\tif (this._deleteHint === 'delete')\n\t\t\t{\n\t\t\t\tremoveBefore--;\n\t\t\t\tremoveAfter++;\n\t\t\t}\n\t\t}\n\n\t\tif (removeBefore > 0 || removeAfter > 0)\n\t\t\tthis._removeTextContent(removeBefore, removeAfter);\n\n\t\tvar newText = content;\n\t\tif (matchTo > 0)\n\t\t\tnewText = newText.slice(matchTo);\n\n\t\tthis._lastContent = content;\n\n\t\tif (newText.length > 0) {\n\t\t\tthis._sendText(this.codePointsToString(newText));\n\t\t}\n\n\t\t// was a 'delete' and we need to reset world.\n\t\tif (removeAfter > 0)\n\t\t\tthis._emptyArea();\n\t},\n\n\t// Sends the given (UTF-8) string of text to coolwsd, as IME (text composition)\n\t// messages\n\t_sendText: function(text) {\n\t\tif (false) {\n\t\t\tvar s = '[';\n\t\t\tfor (var ii = 0; ii < text.length; ++ii) {\n\t\t\t\tif (ii > 0)\n\t\t\t\t\ts = s + ',';\n\t\t\t\ts = s + '0x' + text.charCodeAt(ii).toString(16);\n\t\t\t}\n\t\t\ts = s + ']';\n\t\t\twindow.app.console.log('L.TextInput._sendText: ' + s);\n\t\t}\n\t\tthis._fancyLog('send-text-to-coolwsd', text);\n\n\t\t// MSIE/Edge cannot compare a string to \"\\n\" for whatever reason,\n\t\t// so compare charcode as well\n\t\tif (text === '\\n' || (text.length === 1 && text.charCodeAt(0) === 13)) {\n\t\t\t// The composition messages doesn't play well with just a line break,\n\t\t\t// therefore send a keystroke.\n\t\t\tvar unoKeyCode = this._linebreakHint ? 5376 : 1280;\n\t\t\tthis._sendKeyEvent(13, unoKeyCode);\n\t\t\tthis._emptyArea();\n\t\t} else {\n\t\t\t// The composition messages doesn't play well with line breaks inside\n\t\t\t// the composed word (e.g. word and a newline are queued client-side\n\t\t\t// and are sent together), therefore split and send keystrokes accordingly.\n\n\t\t\tvar parts = text.split(/[\\n\\r]/);\n\t\t\tvar l = parts.length;\n\t\t\tfor (var i = 0; i < l; i++) {\n\t\t\t\tif (i !== 0) {\n\t\t\t\t\tthis._sendKeyEvent(13, 1280);\n\t\t\t\t\tthis._emptyArea();\n\t\t\t\t}\n\t\t\t\tif (parts[i].length > 0) {\n\t\t\t\t\tthis._sendCompositionEvent(parts[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t// Empties the textarea / contenteditable element.\n\t// If the browser supports the 'inputType' property on 'input' events, then\n\t// add empty spaces to the textarea / contenteditable, in order to\n\t// always catch deleteContentBackward/deleteContentForward input events\n\t// (some combination of browser + input method don't fire those on an\n\t// empty contenteditable).\n\t_emptyArea: function(noSelect) {\n\t\tthis._fancyLog('empty-area');\n\n\t\tthis._ignoreInputCount++;\n\t\t// Note: 0xA0 is 160, which is the character code for non-breaking space:\n\t\t// https://www.fileformat.info/info/unicode/char/00a0/index.htm\n\n\t\t// Using normal spaces would make FFX/Gecko collapse them into an\n\t\t// empty string.\n\t\t// FIXME: is that true !? ...\n\n\t\t// window.app.console.log('Set old/lastContent to empty');\n\t\tthis._lastContent = [];\n\n\t\tthis._textArea.value = this._preSpaceChar + this._postSpaceChar;\n\n\t\t// avoid setting the focus keyboard\n\t\tif (!noSelect) {\n\t\t\tthis._setCursorPosition(1);\n\n\t\t\tif (this._hasWorkingSelectionStart === undefined)\n\t\t\t\tthis._hasWorkingSelectionStart = (this._textArea.selectionStart === 1);\n\t\t}\n\n\t\tthis._fancyLog('empty-area-end');\n\n\t\tthis._ignoreInputCount--;\n\t},\n\n\t_onCompositionStart: function(/*ev*/) {\n\t\tthis._isComposing = true;\n\t},\n\n\t// Handled only in legacy situations ('input' events with an inputType\n\t// property are preferred).\n\t_onCompositionUpdate: function(ev) {\n\t\tthis._map.notifyActive();\n\t\tthis._onInput(ev);\n\t},\n\n\t// Chrome doesn't fire any \"input/insertCompositionText\" with \"isComposing\" set to false.\n\t// Instead , it fires non-standard \"textInput\" events, but those can be tricky\n\t// to handle since Chrome also fires \"input/insertText\" events.\n\t// The approach here is to use \"compositionend\" events *only in Chrome* to mark\n\t// the composing text as committed to the text area.\n\t_onCompositionEnd: function(ev) {\n\t\tthis._map.notifyActive();\n\t\tthis._isComposing = false;\n\t\tthis._onInput(ev);\n\t},\n\n\t// Called when the user goes back to a word to spellcheck or replace it,\n\t// on a timeout.\n\t// Very difficult to handle right now, so the strategy is to panic and\n\t// empty the text area.\n\t_abortComposition: function(ev) {\n\t\tthis._fancyLog('abort-composition', ev.type);\n\t\tif (this._isComposing)\n\t\t\tthis._isComposing = false;\n\t\tthis._emptyArea(document.activeElement !== this._textArea);\n\t},\n\n\t_onKeyDown: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tif (ev.keyCode === 8)\n\t\t\tthis._deleteHint = 'backspace';\n\t\telse if (ev.keyCode === 46)\n\t\t\tthis._deleteHint = 'delete';\n\t\telse {\n\t\t\tthis._deleteHint = '';\n\t\t\tthis._linebreakHint = ev.keyCode === 13 && ev.shiftKey;\n\t\t}\n\t},\n\n\t// Check arrow keys on 'keyup' event; using 'ArrowLeft' or 'ArrowRight'\n\t// shall empty the textarea, to prevent FFX/Gecko from ever not having\n\t// whitespace around the caret.\n\t// Across browsers, arrow up/down / home / end would move the caret to\n\t// the beginning/end of the textarea/contenteditable.\n\t_onKeyUp: function(ev) {\n\t\tif (this._map.uiManager.isUIBlocked())\n\t\t\treturn;\n\n\t\tthis._map.notifyActive();\n\t\tif (ev.key === 'ArrowLeft' || ev.key === 'ArrowRight' ||\n\t\t    ev.key === 'ArrowUp' || ev.key === 'ArrowDown' ||\n\t\t    ev.key === 'Home' || ev.key === 'End' ||\n\t\t    ev.key === 'PageUp' || ev.key === 'PageDown'\n\t\t) {\n\t\t\tthis._emptyArea();\n\t\t}\n\t},\n\n\t// Used in the deleteContentBackward for deleting multiple characters with a single\n\t// message.\n\t// Will remove characters from the queue first, if there are any.\n\t_removeTextContent: function(before, after) {\n\t\twindow.app.console.log('Remove ' + before + ' before, and ' + after + ' after');\n\n\t\t/// TODO: rename the event to 'removetextcontent' as soon as coolwsd supports it\n\t\t/// TODO: Ask Marco about it\n\t\tapp.socket.sendMessage(\n\t\t\t'removetextcontext id=' +\n\t\t\tthis._map.getWinId() +\n\t\t\t' before=' + before +\n\t\t\t' after=' + after\n\t\t);\n\t},\n\n\t// Tiny helper - encapsulates sending a 'textinput' websocket message.\n\t// sends a pair of \"input\" for a composition update paird with an \"end\"\n\t_sendCompositionEvent: function(text) {\n\t\tif (false) {\n\t\t\tvar s = '[';\n\t\t\tfor (var ii = 0; ii < text.length; ++ii) {\n\t\t\t\tif (ii > 0)\n\t\t\t\t\ts = s + ',';\n\t\t\t\ts = s + '0x' + text.charCodeAt(ii).toString(16);\n\t\t\t}\n\t\t\ts = s + ']';\n\t\t\twindow.app.console.log('L.TextInput._sendCompositionEvent: ' + s);\n\t\t}\n\n\t\t// We want to trigger auto-correction, but not if we may\n\t\t// have to delete a count of characters in the future,\n\t\t// which is specific to crazy mobile keyboard / IMEs:\n\t\tif (!window.mode.isMobile() && !window.mode.isTablet() &&\n\t\t    this._autoCorrectChars[text])\n\t\t{\n\t\t\tvar codes = this._autoCorrectChars[text];\n\t\t\tthis._sendKeyEvent(codes[0], codes[1], 'input');\n\t\t\tthis._sendKeyEvent(codes[2], codes[3], 'up');\n\t\t}\n\t\telse\n\t\t{\n\t\t\tvar encodedText = encodeURIComponent(text);\n\t\t\tvar winId = this._map.getWinId();\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'textinput id=' + winId + ' text=' + encodedText);\n\t\t}\n\t},\n\n\t// Tiny helper - encapsulates sending a 'key' or 'windowkey' websocket message\n\t// \"type\" can be \"input\" (default) or \"up\"\n\t_sendKeyEvent: function(charCode, unoKeyCode, type) {\n\t\tif (!type) {\n\t\t\ttype = 'input';\n\t\t}\n\t\tif (this._map.editorHasFocus()) {\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'key type=' + type + ' char=' + charCode + ' key=' + unoKeyCode + '\\n'\n\t\t\t);\n\t\t} else {\n\t\t\tapp.socket.sendMessage(\n\t\t\t\t'windowkey id=' +\n\t\t\t\t\tthis._map.getWinId() +\n\t\t\t\t\t' type=' +\n\t\t\t\t\ttype +\n\t\t\t\t\t' char=' +\n\t\t\t\t\tcharCode +\n\t\t\t\t\t' key=' +\n\t\t\t\t\tunoKeyCode +\n\t\t\t\t\t'\\n'\n\t\t\t);\n\t\t}\n\t},\n\n\t_onCursorHandlerDragEnd: function(ev) {\n\t\tvar cursorPos = this._map._docLayer._latLngToTwips(ev.target.getLatLng());\n\t\tthis._map._docLayer._postMouseEvent('buttondown', cursorPos.x, cursorPos.y, 1, 1, 0);\n\t\tthis._map._docLayer._postMouseEvent('buttonup', cursorPos.x, cursorPos.y, 1, 1, 0);\n\t},\n\n\t_setCursorPosition: function(pos) {\n\t\ttry {\n\t\t\tthis._textArea.setSelectionRange(pos, pos);\n\t\t} catch (err) {\n\t\t\t// old firefox throws an exception on start.\n\t\t}\n\t},\n\n\t_setAcceptInput: function(accept) {\n\t\tif (L.Browser.cypressTest && this._textArea) {\n\t\t\t// This is used to track whether we *intended*\n\t\t\t// the keyboard to be visible or hidden.\n\t\t\t// There is no way track the keyboard state\n\t\t\t// programmatically, so the next best thing\n\t\t\t// is to track what we intended to do.\n\t\t\tthis._textArea.setAttribute('data-accept-input', accept);\n\t\t}\n\t\tthis._acceptInput = accept;\n\t}\n});\n\nL.textInput = function() {\n\treturn new L.TextInput();\n};\n"]}
{"version":3,"file":"ImpressTileLayer.js","sourceRoot":"","sources":["../../../../../../../../../browser/src/layer/tile/ImpressTileLayer.js"],"names":[],"mappings":"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","sourcesContent":["/* -*- js-indent-level: 8 -*- */\n/*\n * Impress tile layer is used to display a presentation document\n */\n\n/* global app $ L isAnyVexDialogActive */\n\nL.ImpressTileLayer = L.CanvasTileLayer.extend({\n\n\tinitialize: function (url, options) {\n\t\tL.CanvasTileLayer.prototype.initialize.call(this, url, options);\n\t\t// If this is mobile view, we we'll change the layout position of 'presentation-controls-wrapper'.\n\t\tif (window.mode.isMobile()) {\n\t\t\tthis._putPCWOutsideFlex();\n\t\t}\n\n\t\tthis._preview = L.control.partsPreview();\n\t\tthis._partHashes = null;\n\t\tif (window.mode.isMobile()) {\n\t\t\tthis._addButton = L.control.mobileSlide();\n\t\t\tL.DomUtil.addClass(L.DomUtil.get('mobile-edit-button'), 'impress');\n\t\t}\n\t\tthis._spaceBetweenParts = 300; // In twips. This is used when all parts of an Impress or Draw document is shown in one view (like a Writer file). This mode is used when document is read only.\n\n\t\t// app.file variable should exist, this is a precaution.\n\t\tif (!app.file)\n\t\t\tapp.file = {};\n\n\t\t// Before this instance is created, app.file.readOnly and app.file.editComments variables are set.\n\t\t// If document is on read only mode, we will draw all parts at once.\n\t\t// Let's call default view the \"part based view\" and new view the \"file based view\".\n\t\tif (app.file.readOnly)\n\t\t\tapp.file.fileBasedView = true;\n\t\telse\n\t\t\tapp.file.partBasedView = true; // For Writer and Calc, this one should always be \"true\".\n\n\t\tthis._partHeightTwips = 0; // Single part's height.\n\t\tthis._partWidthTwips = 0; // Single part's width. These values are equal to _docWidthTwips & _docHeightTwips when app.file.partBasedView is true.\n\t},\n\n\t_isPCWInsideFlex: function () {\n\t\tvar PCW = document.getElementById('main-document-content').querySelector('#presentation-controls-wrapper');\n\t\treturn PCW ? true: false;\n\t},\n\n\t_putPCWOutsideFlex: function () {\n\t\tif (this._isPCWInsideFlex()) {\n\t\t\tvar pcw = document.getElementById('presentation-controls-wrapper');\n\t\t\tif (pcw) {\n\t\t\t\tvar frc = document.getElementById('main-document-content');\n\t\t\t\tfrc.removeChild(pcw);\n\n\t\t\t\tfrc.parentNode.insertBefore(pcw, frc.nextSibling);\n\t\t\t}\n\t\t}\n\t},\n\n\t_putPCWInsideFlex: function () {\n\t\tif (!this._isPCWInsideFlex()) {\n\t\t\tvar pcw = document.getElementById('presentation-controls-wrapper');\n\t\t\tif (pcw) {\n\t\t\t\tvar frc = document.getElementById('main-document-content');\n\t\t\t\tdocument.body.removeChild(pcw);\n\n\t\t\t\tdocument.getElementById('document-container').parentNode.insertBefore(pcw, frc.children[0]);\n\t\t\t}\n\t\t}\n\t},\n\n\tnewAnnotation: function (comment) {\n\t\tvar ratio = this._tileWidthTwips / this._tileSize;\n\t\tvar docTopLeft = app.sectionContainer.getDocumentTopLeft();\n\t\tdocTopLeft = [docTopLeft[0] * ratio, docTopLeft[1] * ratio];\n\t\tcomment.anchorPos = [docTopLeft[0], docTopLeft[1]];\n\t\tcomment.rectangle = [docTopLeft[0], docTopLeft[1], 566, 566];\n\n\t\tcomment.parthash = this._partHashes[this._selectedPart];\n\t\tvar commentListSection = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\tif (commentListSection) {\n\t\t\tvar annotation = commentListSection.add(comment);\n\t\t\tcommentListSection.modify(annotation);\n\t\t}\n\t},\n\n\tbeforeAdd: function (map) {\n\t\tthis._map = map;\n\t\tmap.addControl(this._preview);\n\t\tmap.on('updateparts', this.onUpdateParts, this);\n\t\tmap.on('updatepermission', this.onUpdatePermission, this);\n\n\t\tif (!map._docPreviews)\n\t\t\tmap._docPreviews = {};\n\n\t\tmap.uiManager.initializeSpecializedUI(this._docType);\n\t\tif (window.mode.isMobile()) {\n\t\t\tL.Control.MobileWizard.mergeOptions({maxHeight: '55vh'});\n\t\t\tvar mobileWizard = L.DomUtil.get('mobile-wizard');\n\t\t\tvar container = L.DomUtil.createWithId('div', 'mobile-wizard-header', mobileWizard);\n\t\t\tvar preview = L.DomUtil.createWithId('div', 'mobile-slide-sorter', container);\n\t\t\tL.DomUtil.toBack(container);\n\t\t\tmap.addControl(L.control.partsPreview(container, preview, {\n\t\t\t\tfetchThumbnail: false,\n\t\t\t\tallowOrientation: false,\n\t\t\t\taxis: 'x',\n\t\t\t\timageClass: 'preview-img-portrait',\n\t\t\t\tframeClass: 'preview-frame-portrait'\n\t\t\t}));\n\t\t}\n\t},\n\n\tonResizeImpress: function () {\n\t\tL.DomUtil.updateElementsOrientation(['presentation-controls-wrapper', 'document-container', 'slide-sorter']);\n\n\t\tvar mobileEditButton = document.getElementById('mobile-edit-button');\n\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (L.DomUtil.isPortrait()) {\n\t\t\t\tthis._putPCWOutsideFlex();\n\t\t\t\tif (mobileEditButton)\n\t\t\t\t\tmobileEditButton.classList.add('portrait');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis._putPCWInsideFlex();\n\t\t\t\tif (mobileEditButton)\n\t\t\t\t\tmobileEditButton.classList.remove('portrait');\n\t\t\t}\n\t\t}\n\t},\n\n\tonRemove: function () {\n\t\tclearTimeout(this._previewInvalidator);\n\t},\n\n\t_openMobileWizard: function(data) {\n\t\tL.CanvasTileLayer.prototype._openMobileWizard.call(this, data);\n\t},\n\n\tonUpdateParts: function () {\n\t\tif (isAnyVexDialogActive()) // Need this check else vex loses focus\n\t\t\treturn;\n\n\t\tvar section = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\tif (section)\n\t\t\tsection.onPartChange();\n\t},\n\n\tonUpdatePermission: function (e) {\n\t\tif (window.mode.isMobile()) {\n\t\t\tif (e.perm === 'edit') {\n\t\t\t\tthis._addButton.addTo(this._map);\n\t\t\t} else {\n\t\t\t\tthis._addButton.remove();\n\t\t\t}\n\t\t}\n\t},\n\n\t_onCommandValuesMsg: function (textMsg) {\n\t\ttry {\n\t\t\tvar values = JSON.parse(textMsg.substring(textMsg.indexOf('{')));\n\t\t} catch (e) {\n\t\t\t// One such case is 'commandvalues: ' for draw documents in response to .uno:AcceptTrackedChanges\n\t\t\tvalues = null;\n\t\t}\n\n\t\tif (!values) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (values.comments) {\n\t\t\tvar commentListSection = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\t\tif (commentListSection) {\n\t\t\t\tcommentListSection.clearList();\n\t\t\t\tcommentListSection.importComments(values.comments);\n\t\t\t}\n\t\t} else {\n\t\t\tL.CanvasTileLayer.prototype._onCommandValuesMsg.call(this, textMsg);\n\t\t}\n\t},\n\n\t_onInvalidateTilesMsg: function (textMsg) {\n\t\tvar command = app.socket.parseServerCmd(textMsg);\n\t\tif (command.x === undefined || command.y === undefined || command.part === undefined) {\n\t\t\tvar strTwips = textMsg.match(/\\d+/g);\n\t\t\tcommand.x = parseInt(strTwips[0]);\n\t\t\tcommand.y = parseInt(strTwips[1]);\n\t\t\tcommand.width = parseInt(strTwips[2]);\n\t\t\tcommand.height = parseInt(strTwips[3]);\n\t\t\tcommand.part = this._selectedPart;\n\t\t}\n\t\tvar topLeftTwips = new L.Point(command.x, command.y);\n\t\tvar offset = new L.Point(command.width, command.height);\n\t\tvar bottomRightTwips = topLeftTwips.add(offset);\n\t\tif (this._debug) {\n\t\t\tthis._debugAddInvalidationRectangle(topLeftTwips, bottomRightTwips, textMsg);\n\t\t}\n\t\tvar invalidBounds = new L.Bounds(topLeftTwips, bottomRightTwips);\n\t\tvar visibleTopLeft = this._latLngToTwips(this._map.getBounds().getNorthWest());\n\t\tvar visibleBottomRight = this._latLngToTwips(this._map.getBounds().getSouthEast());\n\t\tvar visibleArea = new L.Bounds(visibleTopLeft, visibleBottomRight);\n\t\tvar needsNewTiles = false;\n\t\tfor (var key in this._tiles) {\n\t\t\tvar coords = this._tiles[key].coords;\n\t\t\tvar bounds = this._coordsToTileBounds(coords);\n\t\t\tif (coords.part === command.part && invalidBounds.intersects(bounds)) {\n\t\t\t\tif (this._tiles[key]._invalidCount) {\n\t\t\t\t\tthis._tiles[key]._invalidCount += 1;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis._tiles[key]._invalidCount = 1;\n\t\t\t\t}\n\t\t\t\tif (visibleArea.intersects(bounds)) {\n\t\t\t\t\tneedsNewTiles = true;\n\t\t\t\t\tif (this._debug) {\n\t\t\t\t\t\tthis._debugAddInvalidationData(this._tiles[key]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (!app.file.fileBasedView || !this._tiles[key].current) {\n\t\t\t\t\t// tile outside of the visible area, just remove it\n\t\t\t\t\tthis._removeTile(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (needsNewTiles && command.part === this._selectedPart && this._debug)\n\t\t{\n\t\t\tthis._debugAddInvalidationMessage(textMsg);\n\t\t}\n\n\t\tfor (key in this._tileCache) {\n\t\t\t// compute the rectangle that each tile covers in the document based\n\t\t\t// on the zoom level\n\t\t\tcoords = this._keyToTileCoords(key);\n\t\t\tif (coords.part !== command.part) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tbounds = this._coordsToTileBounds(coords);\n\t\t\tif (invalidBounds.intersects(bounds)) {\n\t\t\t\tdelete this._tileCache[key];\n\t\t\t}\n\t\t}\n\t\tif (command.part === this._selectedPart &&\n\t\t\tcommand.part !== this._lastValidPart) {\n\t\t\tthis._map.fire('updatepart', {part: this._lastValidPart, docType: this._docType});\n\t\t\tthis._lastValidPart = command.part;\n\t\t\tthis._map.fire('updatepart', {part: command.part, docType: this._docType});\n\t\t}\n\n\t\tvar preview = this._map._docPreviews ? this._map._docPreviews[command.part] : null;\n\t\tif (preview) {\n\t\t\tpreview.invalid = true;\n\t\t}\n\t\tthis._previewInvalidations.push(invalidBounds);\n\t\t// 1s after the last invalidation, update the preview\n\t\tclearTimeout(this._previewInvalidator);\n\t\tthis._previewInvalidator = setTimeout(L.bind(this._invalidatePreviews, this), this.options.previewInvalidationTimeout);\n\t},\n\n\t_onSetPartMsg: function (textMsg) {\n\t\tvar part = parseInt(textMsg.match(/\\d+/g)[0]);\n\t\tif (part !== this._selectedPart) {\n\t\t\tthis._map.setPart(part, true);\n\t\t\tthis._map.fire('setpart', {selectedPart: this._selectedPart});\n\t\t}\n\t},\n\n\t_onStatusMsg: function (textMsg) {\n\t\tvar command = app.socket.parseServerCmd(textMsg);\n\t\t// Since we have two status commands, remove them so we store and compare payloads only.\n\t\ttextMsg = textMsg.replace('status: ', '');\n\t\ttextMsg = textMsg.replace('statusupdate: ', '');\n\t\tif (command.width && command.height && this._documentInfo !== textMsg) {\n\t\t\tthis._docWidthTwips = command.width;\n\t\t\tthis._docHeightTwips = command.height;\n\t\t\tthis._docType = command.type;\n\t\t\tif (this._docType === 'drawing') {\n\t\t\t\tL.DomUtil.addClass(L.DomUtil.get('presentation-controls-wrapper'), 'drawing');\n\t\t\t}\n\t\t\tthis._parts = command.parts;\n\t\t\tthis._partHeightTwips = this._docHeightTwips;\n\t\t\tthis._partWidthTwips = this._docWidthTwips;\n\n\t\t\tif (app.file.fileBasedView) {\n\t\t\t\tvar totalHeight = this._parts * this._docHeightTwips; // Total height in twips.\n\t\t\t\ttotalHeight += (this._parts) * this._spaceBetweenParts; // Space between parts.\n\t\t\t\tthis._docHeightTwips = totalHeight;\n\t\t\t}\n\n\t\t\tapp.file.size.twips = [this._docWidthTwips, this._docHeightTwips];\n\t\t\tapp.file.size.pixels = [Math.round(this._tileSize * (this._docWidthTwips / this._tileWidthTwips)), Math.round(this._tileSize * (this._docHeightTwips / this._tileHeightTwips))];\n\t\t\tapp.view.size.pixels = app.file.size.pixels.slice();\n\n\t\t\tthis._updateMaxBounds(true);\n\t\t\tthis._documentInfo = textMsg;\n\t\t\tthis._viewId = parseInt(command.viewid);\n\t\t\tthis._selectedPart = command.selectedPart;\n\t\t\tthis._selectedParts = command.selectedParts || [command.selectedPart];\n\t\t\tthis._resetPreFetching(true);\n\t\t\tthis._update();\n\t\t\tvar partMatch = textMsg.match(/[^\\r\\n]+/g);\n\t\t\t// only get the last matches\n\t\t\tthis._partHashes = partMatch.slice(partMatch.length - this._parts);\n\t\t\tthis._map.fire('updateparts', {\n\t\t\t\tselectedPart: this._selectedPart,\n\t\t\t\tselectedParts: this._selectedParts,\n\t\t\t\tparts: this._parts,\n\t\t\t\tdocType: this._docType,\n\t\t\t\tpartNames: this._partHashes\n\t\t\t});\n\t\t}\n\n\t\tif (app.file.fileBasedView)\n\t\t\tthis._updateFileBasedView();\n\t},\n\n\t_addHighlightSelectedWizardComment: function(annotation) {\n\t\tif (this.lastWizardCommentHighlight) {\n\t\t\tthis.lastWizardCommentHighlight.removeClass('impress-comment-highlight');\n\t\t}\n\t\tif (annotation._annotationMarker) {\n\t\t\tthis.lastWizardCommentHighlight = $(this._map._layers[annotation._annotationMarker._leaflet_id]._icon);\n\t\t\tthis.lastWizardCommentHighlight.addClass('impress-comment-highlight');\n\t\t}\n\t},\n\n\t_removeHighlightSelectedWizardComment: function() {\n\t\tif (this.lastWizardCommentHighlight)\n\t\t\tthis.lastWizardCommentHighlight.removeClass('impress-comment-highlight');\n\t}\n});\n"]}
{"version":3,"file":"CommentListSection.js","sourceRoot":"","sources":["../../../../../../../../../browser/src/layer/tile/CommentListSection.ts"],"names":[],"mappings":"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","sourcesContent":["/* See CanvasSectionContainer.ts for explanations. */\n\nL.Map.include({\n\tinsertComment: function() {\n\t\tvar avatar = undefined;\n\t\tvar author = this.getViewName(this._docLayer._viewId);\n\t\tif (author in this._viewInfoByUserName) {\n\t\t\tavatar = this._viewInfoByUserName[author].userextrainfo.avatar;\n\t\t}\n\t\tthis._docLayer.newAnnotation({\n\t\t\ttext: '',\n\t\t\ttextrange: '',\n\t\t\tauthor: author,\n\t\t\tdateTime: new Date().toDateString(),\n\t\t\tid: 'new', // 'new' only when added by us\n\t\t\tavatar: avatar\n\t\t});\n\t},\n\n\tshowResolvedComments: function(on: any) {\n\t\tvar unoCommand = '.uno:ShowResolvedAnnotations';\n\t\tthis.sendUnoCommand(unoCommand);\n\t\tvar section = app.sectionContainer.getSectionWithName(L.CSections.CommentList.name);\n\t\tif (section)\n\t\t\tsection.setViewResolved(on);\n\t\tthis.uiManager.setSavedState('ShowResolved', on ? true : false);\n\t}\n});\n\n\ndeclare var L: any;\ndeclare var app: any;\ndeclare var vex: any;\ndeclare var $: any;\ndeclare var _: any;\n\napp.definitions.CommentSection =\nclass CommentSection {\n\tcontext: CanvasRenderingContext2D = null;\n\tmyTopLeft: Array<number> = null;\n\tdocumentTopLeft: Array<number> = null;\n\tcontainerObject: any = null;\n\tdpiScale: number = null;\n\tname: string = L.CSections.CommentList.name;\n\tbackgroundColor: string = app.sectionContainer.clearColor;\n\tborderColor: string = null;\n\tboundToSection: string = null;\n\tanchor: Array<any> = new Array(0);\n\tdocumentObject: boolean = false;\n\tposition: Array<number> = [0, 0];\n\tisCollapsed: boolean = false;\n\tsize: Array<number> = [0, 0];\n\texpand: Array<string> = ['bottom'];\n\tisLocated: boolean = false;\n\tshowSection: boolean = true;\n\tprocessingOrder: number = L.CSections.CommentList.processingOrder;\n\tdrawingOrder: number = L.CSections.CommentList.drawingOrder;\n\tzIndex: number = L.CSections.CommentList.zIndex;\n\tinteractable: boolean = false;\n\tsectionProperties: any = {};\n\n\t// Implemented by section container.\n\tstopPropagating: () => void;\n\n\t// Implemented by section container. Document objects only.\n\tsetPosition: (x: number, y: number) => void;\n\tmap: any;\n\n\t// To associate comment id with its index in commentList array.\n\tprivate idIndexMap: Map<any, number>;\n\n\tconstructor () {\n\t\tthis.map = L.Map.THIS;\n\t\tthis.anchor = ['top', 'right'];\n\t\tthis.sectionProperties.docLayer = this.map._docLayer;\n\t\tthis.sectionProperties.commentList = new Array(0);\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.sectionProperties.arrow = null;\n\t\tthis.sectionProperties.initialLayoutData = null;\n\t\tthis.sectionProperties.showResolved = null;\n\t\tthis.sectionProperties.marginY = 10 * app.dpiScale;\n\t\tthis.sectionProperties.offset = 5 * app.dpiScale;\n\t\tthis.sectionProperties.layoutTimer = null;\n\t\tthis.sectionProperties.width = Math.round(1 * app.dpiScale); // Configurable variable.\n\t\tthis.sectionProperties.scrollAnnotation = null; // For impress, when 1 or more comments exist.\n\t\tthis.idIndexMap = new Map<any, number>();\n\t}\n\n\tpublic onInitialize () {\n\t\tthis.setExpanded();\n\n\t\tthis.map.on('RedlineAccept', this.onRedlineAccept, this);\n\t\tthis.map.on('RedlineReject', this.onRedlineReject, this);\n\t\tthis.map.on('updateparts', this.showHideComments, this);\n\t\tthis.map.on('AnnotationScrollUp', this.onAnnotationScrollUp, this);\n\t\tthis.map.on('AnnotationScrollDown', this.onAnnotationScrollDown, this);\n\n\t\tthis.map.on('commandstatechanged', function (event: any) {\n\t\t\tif (event.commandName === '.uno:ShowResolvedAnnotations')\n\t\t\t\tthis.setViewResolved(event.state === 'true');\n\t\t}, this);\n\n\t\tthis.map.on('zoomend', function() {\n\t\t\tthis.map.fire('mobilewizardpopupclose');\n\t\t\tthis.checkCollapseState();\n\t\t\tthis.layout(true);\n\t\t}, this);\n\n\t\tthis.backgroundColor = this.containerObject.getClearColor();\n\t\tthis.initializeContextMenus();\n\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tthis.showSection = false;\n\t\t\tthis.size[0] = 0;\n\t\t}\n\n\t\t// For setting some css styles.\n\t\tif (app.file.fileBasedView && (<any>window).mode.isMobile()) {\n\t\t\tthis.map.uiManager.mobileWizard._hideSlideSorter();\n\t\t}\n\t}\n\n\tprivate checkCollapseState() {\n\t\tif (this.shouldCollapse())\n\t\t\tthis.setCollapsed();\n\t\telse\n\t\t\tthis.setExpanded();\n\t}\n\n\tprivate findNextPartWithComment (currentPart: number) {\n\t\tfor (var i = 0;  i < this.sectionProperties.commentList.length; i++) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.partIndex > currentPart) {\n\t\t\t\treturn this.sectionProperties.commentList[i].sectionProperties.partIndex;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tprivate findPreviousPartWithComment (currentPart: number) {\n\t\tfor (var i = this.sectionProperties.commentList.length - 1;  i > -1; i--) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.partIndex < currentPart) {\n\t\t\t\treturn this.sectionProperties.commentList[i].sectionProperties.partIndex;\n\t\t\t}\n\t\t}\n\t\treturn -1;\n\t}\n\n\tpublic onAnnotationScrollDown () {\n\t\tvar index = this.findNextPartWithComment(this.sectionProperties.docLayer._selectedPart);\n\t\tif (index >= 0) {\n\t\t\tthis.map.setPart(index);\n\t\t}\n\t}\n\n\tpublic onAnnotationScrollUp () {\n\t\tvar index = this.findPreviousPartWithComment(this.sectionProperties.docLayer._selectedPart);\n\t\tif (index >= 0) {\n\t\t\tthis.map.setPart(index);\n\t\t}\n\t}\n\n\tprivate hideCommentListPanel () {\n\t\tif (this.size[0] !== 0) {\n\t\t\tthis.size[0] = 0;\n\n\t\t\tthis.containerObject.reNewAllSections(true);\n\t\t\tthis.sectionProperties.docLayer._syncTileContainerSize();\n\n\t\t\tapp.sectionContainer.requestReDraw();\n\t\t}\n\t}\n\n\tprivate showCommentListPanel () {\n\t\tif (this.size[0] !== this.sectionProperties.width) {\n\t\t\tthis.size[0] = this.sectionProperties.width;\n\n\t\t\tthis.containerObject.reNewAllSections(true);\n\t\t\tthis.sectionProperties.docLayer._syncTileContainerSize();\n\n\t\t\tapp.sectionContainer.requestReDraw();\n\t\t}\n\t}\n\n\tprivate checkSize () {\n\t\t// When there is no comment || file is a spreadsheet || view type is mobile, we set this section's size to [0, 0].\n\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet' || (<any>window).mode.isMobile() || this.sectionProperties.commentList.length === 0)\n\t\t{\n\t\t\tif (this.sectionProperties.docLayer._docType === 'presentation' && this.sectionProperties.scrollAnnotation) {\n\t\t\t\tthis.map.removeControl(this.sectionProperties.scrollAnnotation);\n\t\t\t\tthis.sectionProperties.scrollAnnotation = null;\n\t\t\t}\n\n\t\t\tthis.hideCommentListPanel();\n\t\t}\n\t\telse if (this.sectionProperties.docLayer._docType === 'presentation') { // If there are comments but none of them are on the selected part.\n\t\t\tif (!this.sectionProperties.scrollAnnotation) {\n\t\t\t\tthis.sectionProperties.scrollAnnotation = L.control.scrollannotation();\n\t\t\t\tthis.sectionProperties.scrollAnnotation.addTo(this.map);\n\t\t\t}\n\n\t\t\tvar hide = true;\n\t\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\t\tif (comment.sectionProperties.partIndex === this.sectionProperties.docLayer._selectedPart) {\n\t\t\t\t\thide = false;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (hide) {\n\t\t\t\tthis.hideCommentListPanel();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.showCommentListPanel();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.showCommentListPanel();\n\t\t}\n\t}\n\n\tpublic setCollapsed() {\n\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\treturn;\n\n\t\tthis.isCollapsed = true;\n\t\tthis.removeHighlighters();\n\t\tthis.unselect();\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.data.id !== 'new')\n\t\t\t\tthis.sectionProperties.commentList[i].setCollapsed();\n\t\t}\n\n\t\tif ((<any>window).mode.isMobile()\n\t\t\t|| this.sectionProperties.docLayer._docType === 'spreadsheet'\n\t\t\t|| this.sectionProperties.commentList.length === 0)\n\t\t\treturn;\n\t}\n\n\tpublic setExpanded() {\n\t\tthis.isCollapsed = false;\n\t\tthis.removeHighlighters();\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.sectionProperties.commentList[i].setExpanded();\n\t\t}\n\n\t\tif ((<any>window).mode.isMobile()\n\t\t\t|| this.sectionProperties.docLayer._docType === 'spreadsheet'\n\t\t\t|| this.sectionProperties.commentList.length === 0)\n\t\t\treturn;\n\t}\n\n\tpublic shouldCollapse () {\n\t\tif (!this.containerObject.getDocumentAnchorSection())\n\t\t\treturn false;\n\n\t\tvar commentWidth = 300;\n\t\tvar availableSpace = this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pixels[0];\n\t\treturn availableSpace < commentWidth * 2;\n\t}\n\n\tpublic hideAllComments () {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.sectionProperties.commentList[i].hide();\n\t\t\tvar part = this.sectionProperties.docLayer._selectedPart;\n\t\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet') {\n\t\t\t\t// Change drawing order so they don't prevent each other from being shown.\n\t\t\t\tif (parseInt(this.sectionProperties.commentList[i].sectionProperties.data.tab) === part) {\n\t\t\t\t\tthis.sectionProperties.commentList[i].drawingOrder = 2;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.sectionProperties.commentList[i].drawingOrder = 1;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.containerObject.applyDrawingOrders();\n\t}\n\n\tprivate createCommentStructureWriter (menuStructure: any, threadOnly: any) {\n\t\tvar rootComment, lastChild, comment;\n\t\tvar commentList = this.sectionProperties.commentList;\n\t\tvar showResolved = this.sectionProperties.showResolved;\n\n\t\tif (threadOnly) {\n\t\t\tif (!threadOnly.sectionProperties.data.trackchange && threadOnly.sectionProperties.data.parent !== '0')\n\t\t\t\tthreadOnly = commentList[this.getIndexOf(threadOnly.sectionProperties.data.parent)];\n\t\t}\n\n\t\tfor (var i = 0; i < commentList.length; i++) {\n\t\t\tif (commentList[i].sectionProperties.data.parent === '0' || commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tlastChild = this.getLastChildIndexOf(commentList[i].sectionProperties.data.id);\n\t\t\t\tvar commentThread = [];\n\t\t\t\twhile (true) {\n\t\t\t\t\tcomment = {\n\t\t\t\t\t\tid: 'comment' + commentList[lastChild].sectionProperties.data.id,\n\t\t\t\t\t\tenable: true,\n\t\t\t\t\t\tdata: commentList[lastChild].sectionProperties.data,\n\t\t\t\t\t\ttype: 'comment',\n\t\t\t\t\t\ttext: commentList[lastChild].sectionProperties.data.text,\n\t\t\t\t\t\tannotation: commentList[lastChild],\n\t\t\t\t\t\tchildren: []\n\t\t\t\t\t};\n\n\t\t\t\t\tif (showResolved || comment.data.resolved !== 'true') {\n\t\t\t\t\t\tcommentThread.unshift(comment);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (commentList[lastChild].sectionProperties.data.parent === '0' || commentList[lastChild].sectionProperties.data.trackchange)\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tlastChild = this.getIndexOf(commentList[lastChild].sectionProperties.data.parent);\n\t\t\t\t}\n\n\t\t\t\tif (commentThread.length > 0)\n\t\t\t\t{\n\t\t\t\t\trootComment = {\n\t\t\t\t\t\tid: commentThread[0].id,\n\t\t\t\t\t\tenable: true,\n\t\t\t\t\t\tdata: commentThread[0].data,\n\t\t\t\t\t\ttype: 'rootcomment',\n\t\t\t\t\t\ttext: commentThread[0].data.text,\n\t\t\t\t\t\tannotation: commentThread[0].annotation,\n\t\t\t\t\t\tchildren: commentThread\n\t\t\t\t\t};\n\n\t\t\t\t\tvar matchingThread = threadOnly && threadOnly.sectionProperties.data.id === commentThread[0].data.id;\n\t\t\t\t\tif (matchingThread)\n\t\t\t\t\t\tmenuStructure['children'] = commentThread;\n\t\t\t\t\telse if (!threadOnly)\n\t\t\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic createCommentStructureImpress (menuStructure: any, threadOnly: any) {\n\t\tvar rootComment;\n\n\t\tfor (var i in this.sectionProperties.commentList) {\n\t\t\tvar matchingThread = !threadOnly || (threadOnly && threadOnly.sectionProperties.data.id === this.sectionProperties.commentList[i].sectionProperties.data.id);\n\t\t\tif (matchingThread && (this.sectionProperties.commentList[i].sectionProperties.partIndex === this.sectionProperties.docLayer._selectedPart || app.file.fileBasedView)) {\n\t\t\t\trootComment = {\n\t\t\t\t\tid: 'comment' + this.sectionProperties.commentList[i].sectionProperties.data.id,\n\t\t\t\t\tenable: true,\n\t\t\t\t\tdata: this.sectionProperties.commentList[i].sectionProperties.data,\n\t\t\t\t\ttype: threadOnly ? 'comment' : 'rootcomment',\n\t\t\t\t\ttext: this.sectionProperties.commentList[i].sectionProperties.data.text,\n\t\t\t\t\tannotation: this.sectionProperties.commentList[i],\n\t\t\t\t\tchildren: []\n\t\t\t\t};\n\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic createCommentStructureCalc (menuStructure: any, threadOnly: any) {\n\t\tvar rootComment;\n\t\tvar commentList = this.sectionProperties.commentList;\n\t\tvar selectedTab = this.sectionProperties.docLayer._selectedPart;\n\n\t\tfor (var i: number = 0; i < commentList.length; i++) {\n\t\t\tvar matchingThread = !threadOnly || (threadOnly && threadOnly.sectionProperties.data.id === commentList[i].sectionProperties.data.id);\n\t\t\tif (parseInt(commentList[i].sectionProperties.data.tab) === selectedTab && matchingThread) {\n\t\t\t\trootComment = {\n\t\t\t\t\tid: 'comment' + commentList[i].sectionProperties.data.id,\n\t\t\t\t\tenable: true,\n\t\t\t\t\tdata: commentList[i].sectionProperties.data,\n\t\t\t\t\ttype: threadOnly ? 'comment' : 'rootcomment',\n\t\t\t\t\ttext: commentList[i].sectionProperties.data.text,\n\t\t\t\t\tannotation: commentList[i],\n\t\t\t\t\tchildren: []\n\t\t\t\t};\n\t\t\t\tmenuStructure['children'].push(rootComment);\n\t\t\t}\n\t\t}\n\t}\n\n\t// threadOnly - takes annotation indicating which thread will be generated\n\tpublic createCommentStructure (menuStructure: any, threadOnly: any) {\n\t\tif (this.sectionProperties.docLayer._docType === 'text') {\n\t\t\tthis.createCommentStructureWriter(menuStructure, threadOnly);\n\t\t}\n\t\telse if (this.sectionProperties.docLayer._docType === 'presentation' || this.sectionProperties.docLayer._docType === 'drawing') {\n\t\t\tthis.createCommentStructureImpress(menuStructure, threadOnly);\n\t\t}\n\t\telse if (this.sectionProperties.docLayer._docType === 'spreadsheet') {\n\t\t\tthis.createCommentStructureCalc(menuStructure, threadOnly);\n\t\t}\n\t}\n\n\tpublic newAnnotationVex (comment: any, addCommentFn: any, isMod: any) {\n\t\tvar commentData = comment.sectionProperties.data;\n\n\t\tvar dialog = vex.dialog.open({\n\t\t\tcontentClassName: 'vex-has-inputs',\n\t\t\tmessage: '',\n\t\t\tinput: [\n\t\t\t\t'<textarea name=\"comment\" id=\"new-mobile-comment-input-area\" class=\"cool-annotation-textarea\" required>' + (commentData.text && isMod ? commentData.text: '') + '</textarea>'\n\t\t\t].join(''),\n\t\t\tbuttons: [\n\t\t\t\t$.extend({}, vex.dialog.buttons.YES, { text: _('Save') }),\n\t\t\t\t$.extend({}, vex.dialog.buttons.NO, { text: _('Cancel') })\n\t\t\t],\n\t\t\tcallback: function (data: any) {\n\t\t\t\tif (data) {\n\t\t\t\t\tvar annotation = comment;\n\n\t\t\t\t\tannotation.sectionProperties.data.text = data.comment;\n\t\t\t\t\tcomment.text = data.comment;\n\n\t\t\t\t\taddCommentFn.call(annotation, annotation, comment);\n\t\t\t\t\tif (!isMod)\n\t\t\t\t\t\tthis.containerObject.removeSection(annotation);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.cancel(comment);\n\t\t\t\t}\n\t\t\t}.bind(this)\n\t\t});\n\n\t\tvar tagTd = 'td',\n\t\tempty = '',\n\t\ttagDiv = 'div';\n\t\tvar author = L.DomUtil.create('table', 'cool-annotation-table');\n\t\tvar tbody = L.DomUtil.create('tbody', empty, author);\n\t\tvar tr = L.DomUtil.create('tr', empty, tbody);\n\t\tvar tdImg = L.DomUtil.create(tagTd, 'cool-annotation-img', tr);\n\t\tvar tdAuthor = L.DomUtil.create(tagTd, 'cool-annotation-author', tr);\n\t\tvar imgAuthor = L.DomUtil.create('img', 'avatar-img', tdImg);\n\t\timgAuthor.setAttribute('src', L.LOUtil.getImageURL('user.svg'));\n\t\timgAuthor.setAttribute('width', 32);\n\t\timgAuthor.setAttribute('height', 32);\n\t\tvar authorAvatarImg = imgAuthor;\n\t\tvar contentAuthor = L.DomUtil.create(tagDiv, 'cool-annotation-content-author', tdAuthor);\n\t\tvar contentDate = L.DomUtil.create(tagDiv, 'cool-annotation-date', tdAuthor);\n\n\t\t$(contentAuthor).text(commentData.author);\n\t\t$(authorAvatarImg).attr('src', commentData.avatar);\n\t\tvar user = this.map.getViewId(commentData.author);\n\t\tif (user >= 0) {\n\t\t\tvar color = L.LOUtil.rgbToHex(this.map.getViewColor(user));\n\t\t\t$(authorAvatarImg).css('border-color', color);\n\t\t}\n\n\t\tif (commentData.dateTime) {\n\t\t\tvar d = new Date(commentData.dateTime.replace(/,.*/, 'Z'));\n\t\t\tvar dateOptions = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric' };\n\t\t\t$(contentDate).text(isNaN(d.getTime()) ? comment.dateTime: d.toLocaleDateString((<any>String).locale, <any>dateOptions));\n\t\t}\n\n\t\tdialog.contentEl.insertBefore(author, dialog.contentEl.childNodes[0]);\n\n\t\t$(dialog.contentEl).find('textarea').focus();\n\t}\n\n\tpublic hightlightComment (comment: any) {\n\t\tthis.removeHighlighters();\n\n\t\tvar commentList = this.sectionProperties.commentList;\n\n\t\tvar lastChild: any = this.getLastChildIndexOf(comment.sectionProperties.data.id);\n\n\t\twhile (true && lastChild >= 0) {\n\t\t\tcommentList[lastChild].highlight();\n\n\t\t\tif (commentList[lastChild].sectionProperties.data.parent === '0')\n\t\t\t\tbreak;\n\n\t\t\tlastChild = this.getIndexOf(commentList[lastChild].sectionProperties.data.parent);\n\t\t}\n\t}\n\n\tpublic removeHighlighters () {\n\t\tvar commentList = this.sectionProperties.commentList;\n\t\tfor (var i: number = 0; i < commentList.length; i++) {\n\t\t\tif (commentList[i].sectionProperties.isHighlighted) {\n\t\t\t\tcommentList[i].removeHighlight();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic removeItem (id: any) {\n\t\tvar annotation;\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tannotation = this.sectionProperties.commentList[i];\n\t\t\tif (annotation.sectionProperties.data.id === id) {\n\t\t\t\tthis.containerObject.removeSection(annotation.name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t\tthis.updateIdIndexMap();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tthis.checkSize();\n\t}\n\n\tpublic click (annotation: any) {\n\t\tthis.select(annotation);\n\t}\n\n\tpublic save (annotation: any) {\n\t\tvar comment;\n\t\tif (annotation.sectionProperties.data.id === 'new') {\n\t\t\tcomment = {\n\t\t\t\tText: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t},\n\t\t\t\tAuthor: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.author\n\t\t\t\t}\n\t\t\t};\n\t\t\tif (app.file.fileBasedView) {\n\t\t\t\tthis.map.setPart(this.sectionProperties.docLayer._selectedPart, false);\n\t\t\t\tthis.map.sendUnoCommand('.uno:InsertAnnotation', comment);\n\t\t\t\tthis.map.setPart(0, false);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.map.sendUnoCommand('.uno:InsertAnnotation', comment);\n\t\t\t}\n\n\t\t\tthis.removeItem(annotation.sectionProperties.data.id);\n\t\t} else if (annotation.sectionProperties.data.trackchange) {\n\t\t\tcomment = {\n\t\t\t\tChangeTrackingId: {\n\t\t\t\t\ttype: 'long',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.index\n\t\t\t\t},\n\t\t\t\tText: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:CommentChangeTracking', comment);\n\t\t} else {\n\t\t\tcomment = {\n\t\t\t\tId: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t\t},\n\t\t\t\tText: {\n\t\t\t\t\ttype: 'string',\n\t\t\t\t\tvalue: annotation.sectionProperties.data.text\n\t\t\t\t}\n\t\t\t};\n\t\t\tthis.map.sendUnoCommand('.uno:EditAnnotation', comment);\n\t\t}\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic reply (annotation: any) {\n\t\tif ((<any>window).mode.isMobile() || (<any>window).mode.isTablet()) {\n\t\t\tvar avatar = undefined;\n\t\t\tvar author = this.map.getViewName(this.sectionProperties.docLayer._viewId);\n\t\t\tif (author in this.map._viewInfoByUserName) {\n\t\t\t\tavatar = this.map._viewInfoByUserName[author].userextrainfo.avatar;\n\t\t\t}\n\n\t\t\tif (this.sectionProperties.docLayer._docType === 'presentation' || this.sectionProperties.docLayer._docType === 'drawing') {\n\t\t\t\tthis.newAnnotationVex(annotation, annotation.onReplyClick, /* isMod */ false);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar replyAnnotation = {\n\t\t\t\t\ttext: '',\n\t\t\t\t\ttextrange: '',\n\t\t\t\t\tauthor: author,\n\t\t\t\t\tdateTime: new Date().toDateString(),\n\t\t\t\t\tid: annotation.sectionProperties.data.id,\n\t\t\t\t\tavatar: avatar,\n\t\t\t\t\tparent: annotation.sectionProperties.data.parent,\n\t\t\t\t\tanchorPos: [annotation.sectionProperties.data.anchorPos[0], annotation.sectionProperties.data.anchorPos[1]],\n\t\t\t\t};\n\n\t\t\t\tvar replyAnnotationSection = new app.definitions.Comment(replyAnnotation, replyAnnotation.id === 'new' ? {noMenu: true} : {}, this);\n\t\t\t\treplyAnnotationSection.name += '-reply';\n\n\t\t\t\tthis.newAnnotationVex(replyAnnotationSection, annotation.onReplyClick, /* isMod */ false);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tthis.unselect();\n\t\t\tannotation.reply();\n\t\t\tthis.select(annotation);\n\t\t\tannotation.focus();\n\t\t\tif (this.isCollapsed)\n\t\t\t\tthis.map.fire('mobilewizardpopupresize');\n\t\t}\n\t}\n\n\tpublic modify (annotation: any) {\n\t\tvar newAnnotationInCollapsedMode = this.isCollapsed && annotation.isCollapsed;\n\t\tif ((<any>window).mode.isMobile() || (<any>window).mode.isTablet() || newAnnotationInCollapsedMode) {\n\t\t\tthis.newAnnotationVex(annotation, function(annotation: any) {\n\t\t\t\tthis.save(annotation);\n\t\t\t}.bind(this), /* isMod */ true);\n\t\t} else {\n\t\t\tthis.unselect();\n\t\t\tannotation.edit();\n\t\t\tthis.select(annotation);\n\t\t\tannotation.focus();\n\t\t\tif (this.isCollapsed)\n\t\t\t\tthis.map.fire('mobilewizardpopupresize');\n\t\t}\n\t}\n\n\tpublic select (annotation: any) {\n\t\tif (annotation && annotation !== this.sectionProperties.selectedComment) {\n\t\t\t// Select the root comment\n\t\t\tvar idx = this.getRootIndexOf(annotation.sectionProperties.data.id);\n\n\t\t\tif (this.sectionProperties.selectedComment && $(this.sectionProperties.selectedComment.sectionProperties.container).hasClass('annotation-active'))\n\t\t\t\t$(this.sectionProperties.selectedComment.sectionProperties.container).removeClass('annotation-active');\n\n\t\t\tthis.sectionProperties.selectedComment = this.sectionProperties.commentList[idx];\n\n\t\t\tif (this.sectionProperties.selectedComment && !$(this.sectionProperties.selectedComment.sectionProperties.container).hasClass('annotation-active')) {\n\t\t\t\t$(this.sectionProperties.selectedComment.sectionProperties.container).addClass('annotation-active');\n\t\t\t\tif (this.sectionProperties.docLayer._docType === 'text') {\n\t\t\t\t\t// check it is visible in the screen and not a new comment\n\t\t\t\t\tconst id = this.sectionProperties.selectedComment.sectionProperties.data.id;\n\t\t\t\t\tif (id.indexOf('new') < 0 && !this.isInViewPort(this.sectionProperties.selectedComment)) {\n\t\t\t\t\t\tconst scrollToPos = this.sectionProperties.selectedComment.position[1];\n\t\t\t\t\t\tthis.map.scrollTop(scrollToPos < 0 ? 0 : scrollToPos);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.update();\n\n\t\t\tif (!(<any>window).mode.isMobile() && annotation.isCollapsed && this.sectionProperties.docLayer._docType !== 'spreadsheet')\n\t\t\t\tthis.openMobileWizardPopup(annotation);\n\t\t}\n\t}\n\n\tprivate isInViewPort(annotation: any) {\n\t\tconst rect = annotation.sectionProperties.container.getBoundingClientRect();\n\t\tconst scrollSection = app.sectionContainer.getSectionWithName(L.CSections.Scroll.name);\n\t\tconst screenTop = scrollSection.containerObject.getDocumentTopLeft()[1];\n\t\tconst screenBottom = screenTop + (window.innerHeight || document.documentElement.clientHeight);\n\t\tconst annotationTop = annotation.position[1];\n\t\tconst annotationBottom = annotation.position[1] + rect.bottom - rect.top;\n\n\t\treturn (\n\t\t\tscreenTop <= annotationTop &&\n\t\t\tscreenBottom >= annotationBottom\n\t\t);\n\t}\n\n\tpublic unselect () {\n\t\tif (this.sectionProperties.selectedComment) {\n\t\t\tif (this.sectionProperties.selectedComment && $(this.sectionProperties.selectedComment.sectionProperties.container).hasClass('annotation-active'))\n\t\t\t\t$(this.sectionProperties.selectedComment.sectionProperties.container).removeClass('annotation-active');\n\n\t\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\t\tthis.sectionProperties.selectedComment.hide();\n\n\t\t\tthis.sectionProperties.selectedComment = null;\n\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tpublic saveReply (annotation: any) {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t},\n\t\t\tText: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.reply\n\t\t\t}\n\t\t};\n\n\t\tif (this.sectionProperties.docLayer._docType === 'text' || this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\tthis.map.sendUnoCommand('.uno:ReplyComment', comment);\n\t\telse if (this.sectionProperties.docLayer._docType === 'presentation')\n\t\t\tthis.map.sendUnoCommand('.uno:ReplyToAnnotation', comment);\n\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic cancel (annotation: any) {\n\t\tif (annotation.sectionProperties.data.id === 'new') {\n\t\t\tthis.removeItem(annotation.sectionProperties.data.id);\n\t\t}\n\t\tif (this.sectionProperties.selectedComment === annotation) {\n\t\t\tthis.unselect();\n\t\t} else {\n\t\t\tthis.update();\n\t\t}\n\t\tthis.map.focus();\n\t}\n\n\tpublic onRedlineAccept (e: any) {\n\t\tvar command = {\n\t\t\tAcceptTrackedChange: {\n\t\t\t\ttype: 'unsigned short',\n\t\t\t\tvalue: e.id.substring('change-'.length)\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:AcceptTrackedChange', command);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic onRedlineReject (e: any) {\n\t\tvar command = {\n\t\t\tRejectTrackedChange: {\n\t\t\t\ttype: 'unsigned short',\n\t\t\t\tvalue: e.id.substring('change-'.length)\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:RejectTrackedChange', command);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic remove (id: any) {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: id\n\t\t\t}\n\t\t};\n\n\t\tif (app.file.fileBasedView) // We have to set the part from which the comment will be removed as selected part before the process.\n\t\t\tthis.map.setPart(this.sectionProperties.docLayer._selectedPart, false);\n\n\t\tif (this.sectionProperties.docLayer._docType === 'text')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteComment', comment);\n\t\telse if (this.sectionProperties.docLayer._docType === 'presentation' || this.sectionProperties.docLayer._docType === 'drawing')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteAnnotation', comment);\n\t\telse if (this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\tthis.map.sendUnoCommand('.uno:DeleteNote', comment);\n\n\t\tif (app.file.fileBasedView)\n\t\t\tthis.map.setPart(0, false);\n\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic removeThread (id: any) {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:DeleteCommentThread', comment);\n\t\tthis.unselect();\n\t\tthis.map.focus();\n\t}\n\n\tpublic resolve (annotation: any) {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:ResolveComment', comment);\n\t}\n\n\tpublic resolveThread (annotation: any) {\n\t\tvar comment = {\n\t\t\tId: {\n\t\t\t\ttype: 'string',\n\t\t\t\tvalue: annotation.sectionProperties.data.id\n\t\t\t}\n\t\t};\n\t\tthis.map.sendUnoCommand('.uno:ResolveCommentThread', comment);\n\t}\n\n\tpublic getIndexOf (id: any): number {\n\t\tconst index = this.idIndexMap.get(id);\n\t\treturn (index === undefined) ? -1 : index;\n\t}\n\n\tpublic isThreadResolved (annotation: any) {\n\t\tvar lastChild = this.getLastChildIndexOf(annotation.sectionProperties.data.id);\n\n\t\twhile (this.sectionProperties.commentList[lastChild].sectionProperties.data.parent !== '0') {\n\t\t\tif (this.sectionProperties.commentList[lastChild].sectionProperties.data.resolved === 'false')\n\t\t\t\treturn false;\n\t\t\tlastChild = this.getIndexOf(this.sectionProperties.commentList[lastChild].sectionProperties.data.parent);\n\t\t}\n\t\tif (this.sectionProperties.commentList[lastChild].sectionProperties.data.resolved === 'false')\n\t\t\treturn false;\n\t\treturn true;\n\t}\n\n\tprivate initializeContextMenus () {\n\t\tvar docLayer = this.sectionProperties.docLayer;\n\t\tL.installContextMenu({\n\t\t\tselector: '.cool-annotation-menu',\n\t\t\ttrigger: 'none',\n\t\t\tclassName: 'cool-font',\n\t\t\tbuild: function ($trigger: any) {\n\t\t\t\treturn {\n\t\t\t\t\titems: {\n\t\t\t\t\t\tmodify: {\n\t\t\t\t\t\t\tname: _('Modify'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.modify.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\treply: (docLayer._docType !== 'text' && docLayer._docType !== 'presentation') ? undefined : {\n\t\t\t\t\t\t\tname: _('Reply'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.reply.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremove: {\n\t\t\t\t\t\t\tname: _('Remove'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.remove.call(this, options.$trigger[0].annotation.sectionProperties.data.id);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tremoveThread: docLayer._docType !== 'text' || $trigger[0].isRoot === true ? undefined : {\n\t\t\t\t\t\t\tname: _('Remove Thread'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.removeThread.call(this, options.$trigger[0].annotation.sectionProperties.data.id);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresolve: docLayer._docType !== 'text' ? undefined : {\n\t\t\t\t\t\t\tname: $trigger[0].annotation.sectionProperties.data.resolved === 'false' ? _('Resolve') : _('Unresolve'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.resolve.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresolveThread: docLayer._docType !== 'text' || $trigger[0].isRoot === true ? undefined : {\n\t\t\t\t\t\t\tname: this.isThreadResolved($trigger[0].annotation) ? _('Unresolve Thread') : _('Resolve Thread'),\n\t\t\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\t\t\tthis.resolveThread.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t\t\t}.bind(this)\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}.bind(this),\n\t\t\tevents: {\n\t\t\t\tshow: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = true;\n\t\t\t\t},\n\t\t\t\thide: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tL.installContextMenu({\n\t\t\tselector: '.cool-annotation-menu-redline',\n\t\t\ttrigger: 'none',\n\t\t\tclassName: 'cool-font',\n\t\t\titems: {\n\t\t\t\tmodify: {\n\t\t\t\t\tname: _('Comment'),\n\t\t\t\t\tcallback: function (key: any, options: any) {\n\t\t\t\t\t\tthis.modify.call(this, options.$trigger[0].annotation);\n\t\t\t\t\t}.bind(this)\n\t\t\t\t}\n\t\t\t},\n\t\t\tevents: {\n\t\t\t\tshow: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = true;\n\t\t\t\t},\n\t\t\t\thide: function (options: any) {\n\t\t\t\t\toptions.$trigger[0].annotation.sectionProperties.contextMenu = false;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic onResize () {\n\t\tthis.checkCollapseState();\n\t\tthis.update();\n\t\t// When window is resized, it may mean that comment wizard is closed. So we hide the highlights.\n\t\tthis.removeHighlighters();\n\t\tthis.containerObject.requestReDraw();\n\t}\n\n\tpublic onDraw () {\n\t\treturn;\n\t}\n\n\tpublic onMouseMove (point: Array<number>, dragDistance: Array<number>, e: MouseEvent) {\n\t\treturn;\n\t}\n\n\tpublic onNewDocumentTopLeft () {\n\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet') {\n\t\t\tif (this.sectionProperties.selectedComment)\n\t\t\t\tthis.sectionProperties.selectedComment.hide();\n\t\t}\n\n\t\tthis.update();\n\t}\n\n\tprivate showHideComments () {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.showHideComment(this.sectionProperties.commentList[i]);\n\t\t}\n\t}\n\n\tpublic showHideComment (annotation: any) {\n\t\t// This manually shows/hides comments\n\t\tif (!this.sectionProperties.showResolved && this.sectionProperties.docLayer._docType === 'text') {\n\t\t\tif (annotation.isContainerVisible() && annotation.sectionProperties.data.resolved === 'true') {\n\t\t\t\tif (this.sectionProperties.selectedComment == annotation) {\n\t\t\t\t\tthis.unselect();\n\t\t\t\t}\n\t\t\t\tannotation.hide();\n\t\t\t\tannotation.update();\n\t\t\t} else if (!annotation.isContainerVisible() && annotation.sectionProperties.data.resolved === 'false') {\n\t\t\t\tannotation.show();\n\t\t\t\tannotation.update();\n\t\t\t}\n\t\t\tthis.update();\n\t\t}\n\t\telse if (this.sectionProperties.docLayer._docType === 'presentation' || this.sectionProperties.docLayer._docType === 'drawing') {\n\t\t\tif (annotation.sectionProperties.partIndex === this.sectionProperties.docLayer._selectedPart || app.file.fileBasedView) {\n\t\t\t\tif (!annotation.isContainerVisible()) {\n\t\t\t\t\tannotation.show();\n\t\t\t\t\tannotation.update();\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tannotation.hide();\n\t\t\t\tannotation.update();\n\t\t\t\tthis.update();\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic add (comment: any, mobileReply: boolean = false) {\n\t\tvar annotation = new app.definitions.Comment(comment, comment.id === 'new' ? {noMenu: true} : {}, this);\n\t\tif (mobileReply)\n\t\t\tannotation.name += '-reply'; // Section name.\n\n\t\tif (comment.parent && comment.parent > '0') {\n\t\t\tvar parentIdx = this.getIndexOf(comment.parent);\n\n\t\t\tif (!this.containerObject.addSection(annotation))\n\t\t\t\treturn;\n\t\t\tthis.sectionProperties.commentList.splice(parentIdx + 1, 0, annotation);\n\t\t\tthis.updateIdIndexMap();\n\n\t\t\tthis.updateResolvedState(annotation);\n\t\t\tthis.showHideComment(annotation);\n\t\t}\n\t\telse {\n\t\t\tif (!this.containerObject.addSection(annotation))\n\t\t\t\treturn;\n\t\t\tthis.sectionProperties.commentList.push(annotation);\n\t\t}\n\n\t\tthis.orderCommentList();\n\t\tthis.checkSize();\n\n\t\tif (this.isCollapsed)\n\t\t\tannotation.setCollapsed();\n\n\t\t// check if we are the author\n\t\t// then select it so it does not get lost in a long list of comments and replies.\n\t\tconst authorName = this.map.getViewName(this.sectionProperties.docLayer._viewId);\n\t\tconst newComment = annotation.sectionProperties.data.id === 'new';\n\t\tif (!newComment && (authorName === annotation.sectionProperties.data.author)) {\n\t\t\tthis.unselect();\n\t\t\tthis.select(annotation);\n\t\t}\n\n\t\treturn annotation;\n\t}\n\n\tpublic adjustRedLine (redline: any) {\n\t\t// All sane values ?\n\t\tif (!redline.textRange) {\n\t\t\tconsole.warn('Redline received has invalid textRange');\n\t\t\treturn false;\n\t\t}\n\n\t\t// transform change tracking index into an id\n\t\tredline.id = 'change-' + redline.index;\n\t\tredline.anchorPos = this.stringToRectangles(redline.textRange)[0];\n\t\tredline.anchorPix = this.numberArrayToCorePixFromTwips(redline.anchorPos, 0, 2);\n\t\tredline.trackchange = true;\n\t\tredline.text = redline.comment;\n\t\tvar rectangles = L.PolyUtil.rectanglesToPolygons(L.LOUtil.stringToRectangles(redline.textRange), this.sectionProperties.docLayer);\n\t\tif (rectangles.length > 0) {\n\t\t\tredline.textSelected = L.polygon(rectangles, {\n\t\t\t\tpointerEvents: 'all',\n\t\t\t\tinteractive: false,\n\t\t\t\tfillOpacity: 0,\n\t\t\t\topacity: 0\n\t\t\t});\n\t\t\tredline.textSelected.addEventParent(this.map);\n\t\t\tredline.textSelected.on('click', function() {\n\t\t\t\tthis.selectById(redline.id);\n\t\t\t}, this);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic getComment (id: any) {\n\t\tconst index = this.getIndexOf(id);\n\t\treturn index == -1 ? null : this.sectionProperties.commentList[index];\n\t}\n\n\t// Adjust parent-child relationship, if required, after `comment` is added\n\tpublic adjustParentAdd (comment: any) {\n\t\tif (comment.parent && comment.parent > '0') {\n\t\t\tvar parentIdx = this.getIndexOf(comment.parent);\n\t\t\tif (parentIdx === -1) {\n\t\t\t\tconsole.warn('adjustParentAdd: No parent comment to attach received comment to. ' +\n\t\t\t\t             'Parent comment ID sought is :' + comment.parent + ' for current comment with ID : ' + comment.id);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (this.sectionProperties.commentList[parentIdx + 1] && this.sectionProperties.commentList[parentIdx + 1].sectionProperties.data.parent === this.sectionProperties.commentList[parentIdx].sectionProperties.data.id) {\n\t\t\t\tthis.sectionProperties.commentList[parentIdx + 1].sectionProperties.data.parent = comment.id;\n\t\t\t}\n\t\t}\n\t}\n\n\t// Adjust parent-child relationship, if required, after `comment` is removed\n\tpublic adjustParentRemove (comment: any) {\n\t\tvar newId = '0';\n\t\tvar parentIdx = this.getIndexOf(comment.sectionProperties.data.parent);\n\t\tif (parentIdx >= 0) {\n\t\t\tnewId = this.sectionProperties.commentList[parentIdx].sectionProperties.data.id;\n\t\t}\n\t\tvar currentIdx = this.getIndexOf(comment.sectionProperties.data.id);\n\t\tif (this.sectionProperties.commentList[currentIdx + 1] && this.sectionProperties.commentList[currentIdx].parentOf(this.sectionProperties.commentList[currentIdx + 1])) {\n\t\t\tthis.sectionProperties.commentList[currentIdx + 1].sectionProperties.data.parent = newId;\n\t\t}\n\t}\n\n\tpublic onACKComment (obj: any) {\n\t\tvar id;\n\t\tvar changetrack = obj.redline ? true : false;\n\t\tvar dataroot = changetrack ? 'redline' : 'comment';\n\t\tif (changetrack) {\n\t\t\tobj.redline.id = 'change-' + obj.redline.index;\n\t\t}\n\t\tvar action = changetrack ? obj.redline.action : obj.comment.action;\n\n\t\tif (changetrack && obj.redline.author in this.map._viewInfoByUserName) {\n\t\t\tobj.redline.avatar = this.map._viewInfoByUserName[obj.redline.author].userextrainfo.avatar;\n\t\t}\n\t\telse if (!changetrack && obj.comment.author in this.map._viewInfoByUserName) {\n\t\t\tobj.comment.avatar = this.map._viewInfoByUserName[obj.comment.author].userextrainfo.avatar;\n\t\t}\n\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tvar annotation = this.sectionProperties.commentList[this.getRootIndexOf(obj[dataroot].id)];\n\t\t\tif (!annotation)\n\t\t\t\tannotation = this.sectionProperties.commentList[this.getRootIndexOf(obj[dataroot].parent)]; //this is required for reload after reply in writer\n\t\t}\n\t\tif (action === 'Add') {\n\t\t\tif (changetrack) {\n\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.add(obj.redline);\n\t\t\t} else {\n\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\tthis.adjustParentAdd(obj.comment);\n\t\t\t\tthis.add(obj.comment);\n\t\t\t}\n\t\t\tif (this.sectionProperties.selectedComment && !this.sectionProperties.selectedComment.isEdit()) {\n\t\t\t\tthis.map.focus();\n\t\t\t}\n\t\t\tannotation = this.sectionProperties.commentList[this.getRootIndexOf(obj[dataroot].id)];\n\t\t\tif (!(<any>window).mode.isMobile()) {\n\t\t\t\tthis.update();\n\t\t\t\tvar newAnnotation = this.sectionProperties.commentList[this.getIndexOf(obj[dataroot].id)];\n\t\t\t\tif (newAnnotation.sectionProperties.data.parent !== '0' && this.isCollapsed)\n\t\t\t\t\tthis.openMobileWizardPopup(annotation);\n\t\t\t}\n\t\t} else if (action === 'Remove') {\n\t\t\tif ((<any>window).mode.isMobile() && obj[dataroot].id === annotation.sectionProperties.data.id) {\n\t\t\t\tvar child = this.sectionProperties.commentList[this.getIndexOf(obj[dataroot].id) + 1];\n\t\t\t\tif (child && child.sectionProperties.data.parent === annotation.sectionProperties.data.id)\n\t\t\t\t\tannotation = child;\n\t\t\t\telse\n\t\t\t\t\tannotation = undefined;\n\t\t\t}\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar removed = this.getComment(id);\n\t\t\tif (removed) {\n\t\t\t\tvar parent = this.sectionProperties.commentList[this.getRootIndexOf(removed.sectionProperties.data.id)];\n\t\t\t\tthis.adjustParentRemove(removed);\n\t\t\t\tthis.removeItem(id);\n\t\t\t\tif (this.sectionProperties.selectedComment === removed) {\n\t\t\t\t\tthis.unselect();\n\t\t\t\t} else {\n\t\t\t\t\tthis.update();\n\t\t\t\t}\n\t\t\t\tif (!(<any>window).mode.isMobile() && this.isCollapsed) {\n\t\t\t\t\tthis.openMobileWizardPopup(parent);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (action === 'Modify') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar modified = this.getComment(id);\n\t\t\tif (modified) {\n\t\t\t\tvar modifiedObj;\n\t\t\t\tif (changetrack) {\n\t\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tmodifiedObj = obj.redline;\n\t\t\t\t} else {\n\t\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\t\tmodifiedObj = obj.comment;\n\t\t\t\t}\n\t\t\t\tmodified.setData(modifiedObj);\n\t\t\t\tmodified.update();\n\t\t\t\tthis.update();\n\t\t\t\tif (!(<any>window).mode.isMobile() && this.isCollapsed && this.sectionProperties.selectedComment) {\n\t\t\t\t\tvar parent = this.sectionProperties.commentList[this.getRootIndexOf(modified.sectionProperties.data.id)];\n\t\t\t\t\tthis.openMobileWizardPopup(parent);\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (action === 'Resolve') {\n\t\t\tid = obj[dataroot].id;\n\t\t\tvar resolved = this.getComment(id);\n\t\t\tif (resolved) {\n\t\t\t\tvar parent = this.sectionProperties.commentList[this.getRootIndexOf(resolved.sectionProperties.data.id)];\n\t\t\t\tvar resolvedObj;\n\t\t\t\tif (changetrack) {\n\t\t\t\t\tif (!this.adjustRedLine(obj.redline)) {\n\t\t\t\t\t\t// something wrong in this redline\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tresolvedObj = obj.redline;\n\t\t\t\t} else {\n\t\t\t\t\tthis.adjustComment(obj.comment);\n\t\t\t\t\tresolvedObj = obj.comment;\n\t\t\t\t}\n\t\t\t\tresolved.setData(resolvedObj);\n\t\t\t\tresolved.update();\n\t\t\t\tthis.showHideComment(resolved);\n\t\t\t\tthis.update();\n\t\t\t\tif (!(<any>window).mode.isMobile() && this.isCollapsed) {\n\t\t\t\t\tthis.openMobileWizardPopup(parent);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif ((<any>window).mode.isMobile()) {\n\t\t\tvar shouldOpenWizard = false;\n\t\t\tvar wePerformedAction = obj.comment.author === this.map.getViewName(this.sectionProperties.docLayer._viewId);\n\n\t\t\tif ((<any>window).commentWizard || (action === 'Add' && wePerformedAction))\n\t\t\t\tshouldOpenWizard = true;\n\n\t\t\tif (shouldOpenWizard) {\n\t\t\t\tthis.sectionProperties.docLayer._openCommentWizard(annotation);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic selectById (commentId: any) {\n\t\tvar idx = this.getRootIndexOf(commentId);\n\t\tvar annotation = this.sectionProperties.commentList[idx];\n\t\tvar justOpened = annotation !== this.sectionProperties.selectedComment;\n\t\tthis.sectionProperties.selectedComment = annotation;\n\t\tthis.update();\n\n\t\tif (justOpened && !(<any>window).mode.isMobile() && annotation.isCollapsed &&\n\t\t\tthis.sectionProperties.docLayer._docType !== 'spreadsheet') {\n\t\t\tthis.openMobileWizardPopup(annotation);\n\t\t}\n\t}\n\n\tpublic stringToRectangles (str: string) {\n\t\tvar matches = str.match(/\\d+/g);\n\t\tvar rectangles = [];\n\t\tif (matches !== null) {\n\t\t\tfor (var i: number = 0; i < matches.length; i += 4) {\n\t\t\t\trectangles.push([parseInt(matches[i]), parseInt(matches[i + 1]), parseInt(matches[i + 2]), parseInt(matches[i + 3])]);\n\t\t\t}\n\t\t}\n\t\treturn rectangles;\n\t}\n\n\tpublic onPartChange () {\n\t\tfor (var i: number = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tthis.showHideComment(this.sectionProperties.commentList[i]);\n\t\t}\n\t\tif (this.sectionProperties.selectedComment)\n\t\t\tthis.sectionProperties.selectedComment.onCancelClick(null);\n\n\t\tthis.checkSize();\n\t}\n\n\t// This converts the specified number of values into core pixels from twips.\n\t// Returns a new array with the length of specified numbers.\n\tprivate numberArrayToCorePixFromTwips (numberArray: Array<number>, startIndex: number = 0, length: number = null): Array<number> {\n\t\tif (!length)\n\t\t\tlength = numberArray.length;\n\n\t\tif (startIndex < 0)\n\t\t\tstartIndex = 0;\n\n\t\tif (length < 0)\n\t\t\tlength = 0;\n\n\t\tif (startIndex + length > numberArray.length)\n\t\t\tlength = numberArray.length - startIndex;\n\n\t\tvar result = new Array(length);\n\t\tvar ratio: number = (app.tile.size.pixels[0] / app.tile.size.twips[0]);\n\n\t\tfor (var i = startIndex; i < length; i++) {\n\t\t\tresult[i] = Math.round(numberArray[i] * ratio);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\t// In file based view, we need to move comments to their part's position.\n\t// Because all parts are drawn on the screen. Core side doesn't have this feature.\n\t// Core side sends the information in part coordinates.\n\t// When a coordinate like [0, 0] is inside 2nd part for example, that coordinate should correspond to a value like (just guessing) [0, 45646].\n\t// See that y value is different. Because there is 1st part above the 2nd one in the view.\n\t// We will add their part's position to comment's variables.\n\t// When we are saving their position, we will remove the additions before sending the information.\n\tprivate adjustCommentFileBasedView (comment: any) {\n\t\t// Below calculations are the same with the ones we do while drawing tiles in fileBasedView.\n\t\tvar partHeightTwips = this.sectionProperties.docLayer._partHeightTwips + this.sectionProperties.docLayer._spaceBetweenParts;\n\t\tvar index = this.sectionProperties.docLayer._partHashes.indexOf(String(comment.parthash));\n\t\tvar yAddition = index * partHeightTwips;\n\t\tcomment.yAddition = yAddition; // We'll use this while we save the new position of the comment.\n\n\t\tcomment.trackchange = false;\n\n\t\tcomment.rectangles = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle); // Simple array of point arrays [x1, y1, x2, y2].\n\t\tcomment.rectangles[0][1] += yAddition; // There is only one rectangle for our case.\n\n\t\tcomment.rectanglesOriginal = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle); // This unmodified version will be kept for re-calculations.\n\t\tcomment.rectanglesOriginal[0][1] += yAddition;\n\n\t\tcomment.anchorPos = this.stringToRectangles(comment.anchorPos || comment.rectangle)[0];\n\t\tcomment.anchorPos[1] += yAddition;\n\n\t\tif (comment.rectangle) {\n\t\t\tcomment.rectangle = this.stringToRectangles(comment.rectangle)[0]; // This is the position of the marker.\n\t\t\tcomment.rectangle[1] += yAddition;\n\t\t}\n\n\t\tcomment.anchorPix = this.numberArrayToCorePixFromTwips(comment.anchorPos, 0, 2);\n\n\t\tcomment.parthash = comment.parthash ? comment.parthash: null;\n\n\t\tvar viewId = this.map.getViewId(comment.author);\n\t\tvar color = viewId >= 0 ? L.LOUtil.rgbToHex(this.map.getViewColor(viewId)) : '#43ACE8';\n\t\tcomment.color = color;\n\t}\n\n\t// Normally, a comment's position information is the same with the desktop version.\n\t// So we can use it directly.\n\tprivate adjustCommentNormal (comment: any) {\n\t\tcomment.trackchange = false;\n\t\tcomment.rectangles = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle || comment.cellPos); // Simple array of point arrays [x1, y1, x2, y2].\n\t\tcomment.rectanglesOriginal = this.stringToRectangles(comment.textRange || comment.anchorPos || comment.rectangle || comment.cellPos); // This unmodified version will be kept for re-calculations.\n\t\tcomment.anchorPos = this.stringToRectangles(comment.anchorPos || comment.rectangle || comment.cellPos)[0];\n\t\tcomment.anchorPix = this.numberArrayToCorePixFromTwips(comment.anchorPos, 0, 2);\n\t\tcomment.parthash = comment.parthash ? comment.parthash: null;\n\t\tcomment.tab = (comment.tab || comment.tab === 0) ? comment.tab: null;\n\n\t\tif (comment.rectangle) {\n\t\t\tcomment.rectangle = this.stringToRectangles(comment.rectangle)[0]; // This is the position of the marker (Impress & Draw).\n\t\t}\n\t\telse if (comment.cellPos) {\n\t\t\tcomment.cellPos = this.stringToRectangles(comment.cellPos)[0]; // Calc.\n\t\t}\n\n\t\tvar viewId = this.map.getViewId(comment.author);\n\t\tvar color = viewId >= 0 ? L.LOUtil.rgbToHex(this.map.getViewColor(viewId)) : '#43ACE8';\n\t\tcomment.color = color;\n\t}\n\n\tprivate adjustComment (comment: any) {\n\t\tif (!app.file.fileBasedView)\n\t\t\tthis.adjustCommentNormal(comment);\n\t\telse\n\t\t\tthis.adjustCommentFileBasedView(comment);\n\t}\n\n\tprivate getScaleFactor () {\n\t\tvar scaleFactor = 1.0 / this.map.getZoomScale(this.map.options.zoom, this.map.getZoom());\n\t\tif (scaleFactor < 0.4)\n\t\t\tscaleFactor = 0.4;\n\t\telse if (scaleFactor < 0.6)\n\t\t\tscaleFactor = 0.6 - (0.6 - scaleFactor) / 2.0;\n\t\telse if (scaleFactor < 0.8)\n\t\t\tscaleFactor = 0.8;\n\t\telse if (scaleFactor <= 2)\n\t\t\tscaleFactor = 1;\n\t\telse if (scaleFactor > 2) {\n\t\t\tscaleFactor = 1 + (scaleFactor - 1) / 10.0;\n\t\t\tif (scaleFactor > 1.5)\n\t\t\t\tscaleFactor = 1.5;\n\t\t}\n\t\treturn scaleFactor;\n\t}\n\n\t// Returns the last comment id of comment thread containing the given id\n\tprivate getLastChildIndexOf (id: any) {\n\t\tvar index = this.getIndexOf(id);\n\t\tif (index < 0)\n\t\t\treturn undefined;\n\t\tfor (var idx = index + 1;\n\t\t     idx < this.sectionProperties.commentList.length && this.sectionProperties.commentList[idx].sectionProperties.data.parent === this.sectionProperties.commentList[idx - 1].sectionProperties.data.id;\n\t\t     idx++)\n\t\t{\n\t\t\tindex = idx;\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tprivate updateScaling () {\n\t\tif ((<any>window).mode.isDesktop() || this.sectionProperties.commentList.length === 0)\n\t\t\treturn;\n\n\t\tvar contentWrapperClassName, menuClassName;\n\t\tif (this.sectionProperties.commentList[0].sectionProperties.data.trackchange) {\n\t\t\tcontentWrapperClassName = '.cool-annotation-redline-content-wrapper';\n\t\t\tmenuClassName = '.cool-annotation-menu-redline';\n\t\t} else {\n\t\t\tcontentWrapperClassName = '.cool-annotation-content-wrapper';\n\t\t\tmenuClassName = '.cool-annotation-menu';\n\t\t}\n\n\t\tvar initNeeded = (this.sectionProperties.initialLayoutData === null);\n\t\tvar contentWrapperClass = $(contentWrapperClassName);\n\n\t\tif (initNeeded) {\n\t\t\tvar contentAuthor = $('.cool-annotation-content-author');\n\t\t\tvar dateClass = $('.cool-annotation-date');\n\n\t\t\tthis.sectionProperties.initialLayoutData = {\n\t\t\t\twrapperWidth: parseInt(contentWrapperClass.css('width')),\n\t\t\t\twrapperFontSize: parseInt(contentWrapperClass.css('font-size')),\n\t\t\t\tauthorContentHeight: parseInt(contentAuthor.css('height')),\n\t\t\t\tdateFontSize: parseInt(dateClass.css('font-size')),\n\t\t\t};\n\t\t}\n\n\t\tvar menuClass = $(menuClassName);\n\t\tif ((this.sectionProperties.initialLayoutData.menuWidth === undefined) && menuClass.length > 0) {\n\t\t\tthis.sectionProperties.initialLayoutData.menuWidth = parseInt(menuClass.css('width'));\n\t\t\tthis.sectionProperties.initialLayoutData.menuHeight = parseInt(menuClass.css('height'));\n\t\t}\n\n\t\tvar scaleFactor = this.getScaleFactor();\n\t\tvar idx;\n\t\tif (this.sectionProperties.selectedComment) {\n\t\t\tvar selectIndexFirst = this.getRootIndexOf(this.sectionProperties.selectedComment.sectionProperties.data.id);\n\t\t\tvar selectIndexLast = this.getLastChildIndexOf(this.sectionProperties.selectedComment.sectionProperties.data.id);\n\t\t\tfor (idx = 0; idx < this.sectionProperties.commentList.length; idx++) {\n\t\t\t\tif (idx < selectIndexFirst || idx >  selectIndexLast) {\n\t\t\t\t\tthis.sectionProperties.commentList[idx].updateScaling(scaleFactor, this.sectionProperties.initialLayoutData);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthis.sectionProperties.commentList[idx].updateScaling(1, this.sectionProperties.initialLayoutData);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfor (idx = 0; idx < this.sectionProperties.commentList.length; idx++) {\n\t\t\t\tthis.sectionProperties.commentList[idx].updateScaling(scaleFactor, this.sectionProperties.initialLayoutData);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate twipsToCorePixels (twips: any) {\n\t\treturn [twips.x / this.sectionProperties.docLayer._tileWidthTwips * this.sectionProperties.docLayer._tileSize, twips.y / this.sectionProperties.docLayer._tileHeightTwips * this.sectionProperties.docLayer._tileSize];\n\t}\n\n\t// If the file type is presentation or drawing then we shall check the selected part in order to hide comments from other parts.\n\t// But if file is in fileBasedView, then we will not hide any comments from not-selected/viewed parts.\n\tprivate mustCheckSelectedPart () {\n\t\treturn (this.sectionProperties.docLayer._docType === 'presentation' || this.sectionProperties.docLayer._docType === 'drawing') && !app.file.fileBasedView;\n\t}\n\n\tprivate layoutUp (subList: any, actualPosition: Array<number>, lastY: number) {\n\t\tvar height: number;\n\t\tfor (var i = 0; i < subList.length; i++) {\n\t\t\theight = subList[i].sectionProperties.container.getBoundingClientRect().height;\n\t\t\tlastY = subList[i].sectionProperties.data.anchorPix[1] + height < lastY ? subList[i].sectionProperties.data.anchorPix[1]: lastY - height;\n\t\t\t(new L.PosAnimation()).run(subList[i].sectionProperties.container, {x: Math.round(actualPosition[0] / app.dpiScale), y: Math.round(lastY / app.dpiScale)});\n\t\t\tsubList[i].show();\n\t\t}\n\t\treturn lastY;\n\t}\n\n\tprivate loopUp (startIndex: number, x: number, startY: number) {\n\t\tvar tmpIdx = 0;\n\t\tvar checkSelectedPart: boolean = this.mustCheckSelectedPart();\n\t\tstartY -= this.sectionProperties.marginY;\n\t\t// Pass over all comments present\n\t\tfor (var i = startIndex; i > -1;) {\n\t\t\tvar subList = [];\n\t\t\ttmpIdx = i;\n\t\t\tdo {\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix[1] -= this.documentTopLeft[1];\n\t\t\t\t// Add this item to the list of comments.\n\t\t\t\tif (this.sectionProperties.commentList[tmpIdx].sectionProperties.data.resolved !== 'true' || this.sectionProperties.showResolved) {\n\t\t\t\t\tif (!checkSelectedPart || this.sectionProperties.docLayer._selectedPart === this.sectionProperties.commentList[tmpIdx].sectionProperties.partIndex)\n\t\t\t\t\t\tsubList.push(this.sectionProperties.commentList[tmpIdx]);\n\t\t\t\t}\n\t\t\t\ttmpIdx = tmpIdx - 1;\n\t\t\t\t// Continue this loop, until we reach the last item, or an item which is not a direct descendant of the previous item.\n\t\t\t} while (tmpIdx > -1 && this.sectionProperties.commentList[tmpIdx].sectionProperties.data.parent === this.sectionProperties.commentList[tmpIdx + 1].sectionProperties.data.id);\n\n\t\t\tif (subList.length > 0) {\n\t\t\t\tstartY = this.layoutUp(subList, [x, subList[0].sectionProperties.data.anchorPix[1]], startY);\n\t\t\t\ti = i - subList.length;\n\t\t\t} else {\n\t\t\t\ti = tmpIdx;\n\t\t\t}\n\t\t\tstartY -= this.sectionProperties.marginY;\n\t\t}\n\t\treturn startY;\n\t}\n\n\tprivate layoutDown (subList: any, actualPosition: Array<number>, lastY: number) {\n\t\tvar selectedComment = subList[0] === this.sectionProperties.selectedComment;\n\t\tfor (var i = 0; i < subList.length; i++) {\n\t\t\tlastY = subList[i].sectionProperties.data.anchorPix[1] > lastY ? subList[i].sectionProperties.data.anchorPix[1]: lastY;\n\n\t\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\n\t\t\tif (selectedComment && !this.sectionProperties.selectedComment.isCollapsed)\n\t\t\t\t(new L.PosAnimation()).run(subList[i].sectionProperties.container, {x: Math.round(actualPosition[0] / app.dpiScale) - 60 * (isRTL ? -1 : 1), y: Math.round(lastY / app.dpiScale)});\n\t\t\telse\n\t\t\t\t(new L.PosAnimation()).run(subList[i].sectionProperties.container, {x: Math.round(actualPosition[0] / app.dpiScale), y: Math.round(lastY / app.dpiScale)});\n\n\t\t\tlastY += (subList[i].sectionProperties.container.getBoundingClientRect().height * app.dpiScale);\n\t\t\tif (!subList[i].isEdit())\n\t\t\t\tsubList[i].show();\n\t\t}\n\t\treturn lastY;\n\t}\n\n\tprivate loopDown (startIndex: number, x: number, startY: number) {\n\t\tvar tmpIdx = 0;\n\t\tvar checkSelectedPart: boolean = this.mustCheckSelectedPart();\n\t\t// Pass over all comments present\n\t\tfor (var i = startIndex; i < this.sectionProperties.commentList.length;) {\n\t\t\tvar subList = [];\n\t\t\ttmpIdx = i;\n\t\t\tdo {\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[tmpIdx].sectionProperties.data.anchorPix[1] -= this.documentTopLeft[1];\n\t\t\t\t// Add this item to the list of comments.\n\t\t\t\tif (this.sectionProperties.commentList[tmpIdx].sectionProperties.data.resolved !== 'true' || this.sectionProperties.showResolved) {\n\t\t\t\t\tif (!checkSelectedPart || this.sectionProperties.docLayer._selectedPart === this.sectionProperties.commentList[tmpIdx].sectionProperties.partIndex)\n\t\t\t\t\t\tsubList.push(this.sectionProperties.commentList[tmpIdx]);\n\t\t\t\t}\n\t\t\t\ttmpIdx = tmpIdx + 1;\n\t\t\t\t// Continue this loop, until we reach the last item, or an item which is not a direct descendant of the previous item.\n\t\t\t} while (tmpIdx < this.sectionProperties.commentList.length && this.sectionProperties.commentList[tmpIdx].sectionProperties.data.parent === this.sectionProperties.commentList[tmpIdx - 1].sectionProperties.data.id);\n\n\t\t\tif (subList.length > 0) {\n\t\t\t\tstartY = this.layoutDown(subList, [x, subList[0].sectionProperties.data.anchorPix[1]], startY);\n\t\t\t\ti = i + subList.length;\n\t\t\t} else {\n\t\t\t\ti = tmpIdx;\n\t\t\t}\n\t\t\tstartY += this.sectionProperties.marginY;\n\t\t}\n\t\treturn startY;\n\t}\n\n\tpublic hideArrow () {\n\t\tif (this.sectionProperties.arrow) {\n\t\t\tdocument.getElementById('document-container').removeChild(this.sectionProperties.arrow);\n\t\t\tthis.sectionProperties.arrow = null;\n\t\t}\n\t}\n\n\tprivate showArrow (startPoint: Array<number>, endPoint: Array<number>) {\n\t\tvar anchorSection = this.containerObject.getDocumentAnchorSection();\n\t\tstartPoint[0] -= anchorSection.myTopLeft[0] + this.documentTopLeft[0];\n\t\tstartPoint[1] -= anchorSection.myTopLeft[1] + this.documentTopLeft[1];\n\t\tendPoint[1] -= anchorSection.myTopLeft[1] + this.documentTopLeft[1];\n\n\t\tstartPoint[0] = Math.floor(startPoint[0] / app.dpiScale);\n\t\tstartPoint[1] = Math.floor(startPoint[1] / app.dpiScale);\n\t\tendPoint[0] = Math.floor(endPoint[0] / app.dpiScale);\n\t\tendPoint[1] = Math.floor(endPoint[1] / app.dpiScale);\n\n\t\tif (this.sectionProperties.arrow !== null) {\n\t\t\tvar line: SVGLineElement = <SVGLineElement>(<any>document.getElementById('comment-arrow-line'));\n\t\t\tline.setAttribute('x1', String(startPoint[0]));\n\t\t\tline.setAttribute('y1', String(startPoint[1]));\n\t\t\tline.setAttribute('x2', String(endPoint[0]));\n\t\t\tline.setAttribute('y2', String(endPoint[1]));\n\t\t}\n\t\telse {\n\t\t\tvar svg: SVGElement = (<any>document.createElementNS('http://www.w3.org/2000/svg', 'svg'));\n\t\t\tsvg.setAttribute('version', '1.1');\n\t\t\tsvg.style.zIndex = '9';\n\t\t\tsvg.id = 'comment-arrow-container';\n\t\t\tsvg.style.position = 'absolute';\n\t\t\tsvg.style.top = svg.style.left = svg.style.right = svg.style.bottom = '0';\n\t\t\tsvg.setAttribute('width', String(this.context.canvas.width));\n\t\t\tsvg.setAttribute('height', String(this.context.canvas.height));\n\t\t\tvar line  = document.createElementNS('http://www.w3.org/2000/svg','line');\n\t\t\tline.id = 'comment-arrow-line';\n\t\t\tline.setAttribute('x1', String(startPoint[0]));\n\t\t\tline.setAttribute('y1', String(startPoint[1]));\n\t\t\tline.setAttribute('x2', String(endPoint[0]));\n\t\t\tline.setAttribute('y2', String(endPoint[1]));\n\t\t\tline.setAttribute('stroke', 'darkblue');\n\t\t\tline.setAttribute('stroke-width', '1');\n\t\t\tsvg.appendChild(line);\n\t\t\tdocument.getElementById('document-container').appendChild(svg);\n\t\t\tthis.sectionProperties.arrow = svg;\n\t\t}\n\t}\n\n\tprivate doLayout () {\n\t\tif ((<any>window).mode.isMobile() || this.sectionProperties.docLayer._docType === 'spreadsheet') {\n\t\t\tif (this.sectionProperties.commentList.length > 0)\n\t\t\t\tthis.orderCommentList();\n\t\t\treturn; // No adjustments for Calc, since only one comment can be shown at a time and that comment is shown at its belonging cell.\n\t\t}\n\n\t\tif (this.sectionProperties.commentList.length > 0) {\n\t\t\tthis.orderCommentList();\n\n\t\t\tthis.updateScaling();\n\n\t\t\tvar isRTL = document.documentElement.dir === 'rtl';\n\n\t\t\tvar topRight: Array<number> = [this.myTopLeft[0], this.myTopLeft[1] + this.sectionProperties.marginY - this.documentTopLeft[1]];\n\t\t\tvar yOrigin = null;\n\t\t\tvar selectedIndex = null;\n\t\t\tvar x = isRTL ? 0 : topRight[0];\n\t\t\tvar commentWidth = this.isCollapsed ? 70 : 300;\n\t\t\tvar availableSpace = this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pixels[0];\n\n\t\t\tif (availableSpace > commentWidth) {\n\t\t\t\tif (isRTL)\n\t\t\t\t\tx = Math.round((this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pixels[0]) * 0.5) - this.containerObject.getDocumentAnchorSection().size[0];\n\t\t\t\telse\n\t\t\t\t\tx = topRight[0] - Math.round((this.containerObject.getDocumentAnchorSection().size[0] - app.file.size.pixels[0]) * 0.5);\n\t\t\t} else if (isRTL)\n\t\t\t\tx = -this.containerObject.getDocumentAnchorSection().size[0];\n\t\t\telse\n\t\t\t\tx -= commentWidth;\n\n\t\t\tif (this.sectionProperties.selectedComment) {\n\t\t\t\tselectedIndex = this.getRootIndexOf(this.sectionProperties.selectedComment.sectionProperties.data.id);\n\t\t\t\tthis.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix = this.numberArrayToCorePixFromTwips(this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPos, 0, 2);\n\t\t\t\tthis.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix[1];\n\t\t\t\tyOrigin = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix[1] - this.documentTopLeft[1];\n\t\t\t\tvar tempCrd: Array<number> = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.anchorPix;\n\t\t\t\tvar resolved:string = this.sectionProperties.commentList[selectedIndex].sectionProperties.data.resolved;\n\t\t\t\tif (!resolved || resolved === 'false' || this.sectionProperties.showResolved) {\n\t\t\t\t\tvar posX = isRTL ? (this.containerObject.getDocumentAnchorSection().size[0] + x + 15) : x;\n\t\t\t\t\tthis.showArrow([tempCrd[0], tempCrd[1]], [posX, tempCrd[1]]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.hideArrow();\n\t\t\t\tapp.sectionContainer.requestReDraw();\n\t\t\t}\n\n\t\t\tvar lastY = 0;\n\t\t\tif (selectedIndex) {\n\t\t\t\tthis.loopUp(selectedIndex - 1, x, yOrigin);\n\t\t\t\tlastY = this.loopDown(selectedIndex, x, yOrigin);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlastY = this.loopDown(0, x, topRight[1]);\n\t\t\t}\n\t\t}\n\n\t\tlastY += this.containerObject.documentTopLeft[1];\n\t\tif (lastY > app.file.size.pixels[1])\n\t\t\tapp.view.size.pixels[1] = lastY;\n\t\telse\n\t\t\tapp.view.size.pixels[1] = app.file.size.pixels[1];\n\t}\n\n\tprivate layout (zoom: any = null) {\n\t\tif (zoom)\n\t\t\tthis.doLayout();\n\t\telse if (!this.sectionProperties.layoutTimer) {\n\t\t\tthis.sectionProperties.layoutTimer = setTimeout(function() {\n\t\t\t\tdelete this.sectionProperties.layoutTimer;\n\t\t\t\tthis.doLayout();\n\t\t\t}.bind(this), 10 /* ms */);\n\t\t} // else - avoid excessive re-layout\n\t}\n\n\tprivate update () {\n\t\tthis.updateReplyCount();\n\t\tthis.layout();\n\t}\n\n\tprivate openMobileWizardPopup (annotation: any) {\n\t\tif (!annotation) {\n\t\t\tthis.map.fire('mobilewizardpopupclose');\n\t\t\treturn;\n\t\t}\n\n\t\tvar commentsData = this.map._docLayer.getCommentWizardStructure(undefined, annotation); // thread only\n\t\tif (commentsData.children.length) {\n\t\t\tcommentsData.popupParent = annotation.sectionProperties.container.id;\n\t\t\tthis.map.fire('mobilewizardpopup', {data: commentsData});\n\t\t} else {\n\t\t\tthis.map.fire('mobilewizardpopupclose');\n\t\t}\n\t}\n\n\tprivate updateReplyCount() {\n\t\tfor (var i = 0; i < this.sectionProperties.commentList.length; i++) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tvar replyCount = 0;\n\n\t\t\tfor (var j = 0; j < this.sectionProperties.commentList.length; j++) {\n\t\t\t\tvar anotherComment = this.sectionProperties.commentList[j];\n\t\t\t\tif (this.getRootIndexOf(anotherComment.sectionProperties.data.id) === i\n\t\t\t\t\t&& anotherComment.sectionProperties.data.resolved !== 'true')\n\t\t\t\t\treplyCount++;\n\t\t\t}\n\n\t\t\tif (replyCount > 1) {\n\t\t\t\tcomment.sectionProperties.replyCountNode.innerText = replyCount;\n\t\t\t\tcomment.sectionProperties.replyCountNode.style.display = '';\n\t\t\t} else {\n\t\t\t\tcomment.sectionProperties.replyCountNode.innerText = '';\n\t\t\t\tcomment.sectionProperties.replyCountNode.style.display = 'none';\n\t\t\t}\n\t\t}\n\t}\n\n\t// Returns the root comment index of given id\n\tprivate getRootIndexOf (id: any) {\n\t\tvar index = this.getIndexOf(id);\n\t\tfor (var idx = index - 1;\n\t\t\t     idx >=0 &&\n\t\t\t\t this.sectionProperties.commentList[idx] &&\n\t\t\t\t this.sectionProperties.commentList[idx + 1] &&\n\t\t\t\t this.sectionProperties.commentList[idx].sectionProperties.data.id === this.sectionProperties.commentList[idx + 1].sectionProperties.data.parent;\n\t\t\t     idx--)\n\t\t{\n\t\t\tindex = idx;\n\t\t}\n\n\t\treturn index;\n\t}\n\n\tpublic setViewResolved (state: any) {\n\t\tthis.sectionProperties.showResolved = state;\n\n\t\tfor (var idx = 0; idx < this.sectionProperties.commentList.length;idx++) {\n\t\t\tif (this.sectionProperties.commentList[idx].sectionProperties.data.resolved === 'true') {\n\t\t\t\tif (state==false) {\n\t\t\t\t\tif (this.sectionProperties.selectedComment == this.sectionProperties.commentList[idx]) {\n\t\t\t\t\t\tthis.unselect();\n\t\t\t\t\t}\n\t\t\t\t\tthis.sectionProperties.commentList[idx].hide();\n\t\t\t\t} else {\n\t\t\t\t\tthis.sectionProperties.commentList[idx].show();\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.sectionProperties.commentList[idx].update();\n\t\t}\n\t\tthis.update();\n\t}\n\n\tprivate updateResolvedState (comment: any) {\n\t\tvar threadIndexFirst = this.getRootIndexOf(comment.sectionProperties.data.id);\n\t\tif (this.sectionProperties.commentList[threadIndexFirst].sectionProperties.data.resolved !== comment.sectionProperties.data.resolved) {\n\t\t\tcomment.sectionProperties.data.resolved = this.sectionProperties.commentList[threadIndexFirst].sectionProperties.data.resolved;\n\t\t\tcomment.update();\n\t\t\tthis.update();\n\t\t}\n\t}\n\n\tprivate orderCommentList () {\n\t\tthis.sectionProperties.commentList.sort(function(a: any, b: any) {\n\t\t\treturn Math.abs(a.sectionProperties.data.anchorPos[1]) - Math.abs(b.sectionProperties.data.anchorPos[1]) ||\n\t\t\t\tMath.abs(a.sectionProperties.data.anchorPos[0]) - Math.abs(b.sectionProperties.data.anchorPos[0]);\n\t\t});\n\n\t\t// idIndexMap is now invalid, update it.\n\t\tthis.updateIdIndexMap();\n\t}\n\n\tprivate updateIdIndexMap() {\n\t\tthis.idIndexMap.clear();\n\t\tconst commentList = this.sectionProperties.commentList;\n\t\tfor (var idx = 0; idx < commentList.length; idx++) {\n\t\t\tconst comment = commentList[idx];\n\t\t\tconsole.assert(comment.sectionProperties && comment.sectionProperties.data, 'no sectionProperties.data!');\n\t\t\tthis.idIndexMap.set(comment.sectionProperties.data.id, idx);\n\t\t}\n\t}\n\n\tprivate turnIntoAList (commentList: any) {\n\t\tvar newArray;\n\t\tif (!Array.isArray(commentList)) {\n\t\t\tnewArray = new Array(0);\n\t\t\tfor (var prop in commentList) {\n\t\t\t\tif (Object.prototype.hasOwnProperty.call(commentList, prop)) {\n\t\t\t\t\tnewArray.push(commentList[prop]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tnewArray = commentList;\n\t\t}\n\t\treturn newArray;\n\t}\n\n\tpublic importComments (commentList: any) {\n\t\tvar comment;\n\t\tthis.clearList();\n\t\tcommentList = this.turnIntoAList(commentList);\n\n\t\tif (commentList.length > 0) {\n\t\t\tfor (var i = 0; i < commentList.length; i++) {\n\t\t\t\tcomment = commentList[i];\n\t\t\t\tthis.adjustComment(comment);\n\t\t\t\tif (comment.author in this.map._viewInfoByUserName) {\n\t\t\t\t\tcomment.avatar = this.map._viewInfoByUserName[comment.author].userextrainfo.avatar;\n\t\t\t\t}\n\t\t\t\tvar commentSection = new app.definitions.Comment(comment, {}, this);\n\t\t\t\tif (!this.containerObject.addSection(commentSection))\n\t\t\t\t\tcontinue;\n\t\t\t\tthis.sectionProperties.commentList.push(commentSection);\n\t\t\t\tthis.idIndexMap.set(commentSection.sectionProperties.data.id, i);\n\t\t\t\tthis.updateResolvedState(this.sectionProperties.commentList[i]);\n\t\t\t}\n\n\t\t\tthis.orderCommentList();\n\t\t\tthis.checkSize();\n\t\t\tthis.update();\n\t\t}\n\n\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideAllComments(); // Apply drawing orders.\n\t}\n\n\t// Accepts redlines/changes comments.\n\tpublic importChanges (changesList: any) {\n\t\tvar changeComment;\n\t\tthis.clearChanges();\n\t\tchangesList = this.turnIntoAList(changesList);\n\n\t\tif (changesList.length > 0) {\n\t\t\tfor (var i = 0; i < changesList.length; i++) {\n\t\t\t\tchangeComment = changesList[i];\n\t\t\t\tif (!this.adjustRedLine(changeComment))\n\t\t\t\t\t// something wrong in this redline, skip this one\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (changeComment.author in this.map._viewInfoByUserName) {\n\t\t\t\t\tchangeComment.avatar = this.map._viewInfoByUserName[changeComment.author].userextrainfo.avatar;\n\t\t\t\t}\n\t\t\t\tvar commentSection = new app.definitions.Comment(changeComment, {}, this);\n\t\t\t\tif (!this.containerObject.addSection(commentSection))\n\t\t\t\t\tcontinue;\n\t\t\t\tthis.sectionProperties.commentList.push(commentSection);\n\t\t\t}\n\n\t\t\tthis.orderCommentList();\n\t\t\tthis.checkSize();\n\t\t\tthis.update();\n\t\t}\n\n\t\tif (this.sectionProperties.docLayer._docType === 'spreadsheet')\n\t\t\tthis.hideAllComments(); // Apply drawing orders.\n\t}\n\n\t// Remove redline comments.\n\tprivate clearChanges() {\n\t\tthis.containerObject.pauseDrawing();\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tif (this.sectionProperties.commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tthis.containerObject.removeSection(this.sectionProperties.commentList[i].name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tthis.updateIdIndexMap();\n\t\tthis.containerObject.resumeDrawing();\n\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.checkSize();\n\t}\n\n\t// Remove only text comments from the document (excluding change tracking comments)\n\tprivate clearList () {\n\t\tthis.containerObject.pauseDrawing();\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tif (!this.sectionProperties.commentList[i].sectionProperties.data.trackchange) {\n\t\t\t\tthis.containerObject.removeSection(this.sectionProperties.commentList[i].name);\n\t\t\t\tthis.sectionProperties.commentList.splice(i, 1);\n\t\t\t}\n\t\t}\n\t\tthis.updateIdIndexMap();\n\t\tthis.containerObject.resumeDrawing();\n\n\t\tthis.sectionProperties.selectedComment = null;\n\t\tthis.checkSize();\n\t}\n\n\tpublic onCommentsDataUpdate() {\n\t\tfor (var i: number = this.sectionProperties.commentList.length -1; i > -1; i--) {\n\t\t\tvar comment = this.sectionProperties.commentList[i];\n\t\t\tif (!comment.valid) {\n\t\t\t\tcomment.sectionProperties.commentListSection.removeItem(comment.sectionProperties.data.id);\n\t\t\t}\n\t\t\tcomment.onCommentDataUpdate();\n\t\t}\n\t}\n\n\tpublic onMouseUp () { return; }\n\tpublic onMouseDown () { return; }\n\tpublic onMouseEnter () { return; }\n\tpublic onMouseLeave () { return; }\n\tpublic onMouseWheel () { return; }\n\tpublic onClick () { return; }\n\tpublic onDoubleClick () { return; }\n\tpublic onContextMenu () { return; }\n\tpublic onLongPress () { return; }\n\tpublic onMultiTouchStart () { return; }\n\tpublic onMultiTouchMove () { return; }\n\tpublic onMultiTouchEnd () { return; }\n};\n"]}
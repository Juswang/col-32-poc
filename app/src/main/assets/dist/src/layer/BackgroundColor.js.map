{"version":3,"file":"BackgroundColor.js","sourceRoot":"","sources":["../../../../../../../../browser/src/layer/BackgroundColor.js"],"names":[],"mappings":"AAAA;;;;;;GAMG;AAEH,CAAC,CAAC,eAAe,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC;IAClC,OAAO,EAAE;QACR;;;;;;WAMG;QACH,KAAK,EAAE,SAAS;KAChB;IAED,KAAK,EAAE;QACN,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM,EAAE;QACP,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;IACnC,CAAC;IAED;;;OAGG;IACH,QAAQ,EAAE,UAAS,QAAQ;QAC1B,IAAI,CAAC,OAAO,CAAC,KAAK,GAAG,QAAQ,CAAC;QAC9B,IAAI,IAAI,CAAC,IAAI,EAAE;YACd,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;SACrD;QACD,OAAO,IAAI,CAAC;IACb,CAAC;CACD,CAAC,CAAC;AAEH,8CAA8C;AAE9C;;;GAGG;AACH,CAAC,CAAC,cAAc,GAAG,CAAC,CAAC,eAAe,CAAC,MAAM,CAAC;IAC3C,KAAK,EAAE,UAAS,GAAG;QAClB,GAAG,CAAC,EAAE,CAAC,qBAAqB,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;QAC1D,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IAC1C,CAAC;IAED,MAAM,EAAE;QACP,OAAO,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,UAAU,CAAC;QAClC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,qBAAqB,EAAE,IAAI,CAAC,eAAe,EAAE,IAAI,CAAC,CAAC;IAClE,CAAC;IAED,iEAAiE;IACjE,WAAW,EAAE,IAAI;IAEjB,eAAe,EAAE,UAAS,EAAE;QAC3B,gFAAgF;QAChF,gFAAgF;QAChF,oFAAoF;QACpF,mCAAmC;QACnC,2EAA2E;QAC3E,iBAAiB;QACjB,wEAAwE;QACxE,iFAAiF;QACjF,wEAAwE;QAExE,IAAI,EAAE,CAAC,WAAW,KAAK,mBAAmB,EAAE;YAC3C,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;YACxB,OAAO;SACP;QACD,IAAI,EAAE,CAAC,WAAW,KAAK,qBAAqB,EAAE;YAC7C,IAAI,CAAC,WAAW,GAAG,EAAE,CAAC,KAAK,KAAK,qCAAqC,CAAC;YACtE,OAAO;SACP;QACD,IAAI,EAAE,CAAC,WAAW,KAAK,sBAAsB,EAAE;YAC9C,OAAO;SACP;QAED,6DAA6D;QAC7D,+DAA+D;QAC/D,iFAAiF;QACjF,IAAI,KAAK,CAAC;QACV,IAAI,EAAE,CAAC,KAAK,KAAK,IAAI,EAAE;YACtB,KAAK,GAAG,OAAO,CAAC;SAChB;aAAM;YACN,KAAK;gBACJ,GAAG;oBACH,QAAQ,CAAC,EAAE,CAAC,KAAK,CAAC;yBAChB,QAAQ,CAAC,EAAE,CAAC;yBACZ,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;SACpB;QAED,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;IACtB,CAAC;CACD,CAAC,CAAC","sourcesContent":["/*\n * A Leaflet layer that just sets the background colour of the map.\n *\n * This just changes the map container's style, and does not\n * implement pane positioning - adding two instances of this\n * layer to a map at a time will conflict.\n */\n\nL.BackgroundColor = L.Layer.extend({\n\toptions: {\n\t\t/*\n\t\t * The background color that the map shall take when this layer is\n\t\t * added to it. Must be a string containing a CSS color value, as per\n\t\t * https://developer.mozilla.org/en-US/docs/Web/CSS/color_value\n\t\t *\n\t\t * The default is Leaflet's default grey.\n\t\t */\n\t\tcolor: '#dfdfdf'\n\t},\n\n\tonAdd: function() {\n\t\treturn this.setColor(this.options.color);\n\t},\n\n\tremove: function() {\n\t\tdelete this._map.style.background;\n\t},\n\n\t/*\n\t * Expects a CSS color value. Sets the map background to that color, and\n\t * resets the 'color' option of this layer.\n\t */\n\tsetColor: function(cssColor) {\n\t\tthis.options.color = cssColor;\n\t\tif (this._map) {\n\t\t\tthis._map.getContainer().style.background = cssColor;\n\t\t}\n\t\treturn this;\n\t}\n});\n\n// LibreOffice-specific functionality follows.\n\n/*\n * A L.BackgroundColor that automatically resets its color\n * based on 'statechange' messages from coolwsd.\n */\nL.CalcBackground = L.BackgroundColor.extend({\n\tonAdd: function(map) {\n\t\tmap.on('commandstatechanged', this._onStateChanged, this);\n\t\treturn this.setColor(this.options.color);\n\t},\n\n\tremove: function() {\n\t\tdelete this._map.style.background;\n\t\tthis._map.off('commandstatechanged', this._onStateChanged, this);\n\t},\n\n\t// State flag for the heuristic algorithm used in _onStateChanged\n\t_bgCanBeSet: true,\n\n\t_onStateChanged: function(ev) {\n\t\t// There are lots of statechange events - but there is no indication of what the\n\t\t// background color of a Calc sheet is. In order to discern the background color\n\t\t// there is a heuristic method which uses three statechange events: BackgroundColor,\n\t\t// RowColSelCount and StatusPosDoc.\n\t\t// A BackgroundColor statechange will be regarded as a change of background\n\t\t// color only if:\n\t\t// - There has been no previous RowColSelCount statechange (first load),\n\t\t// - There has been a StatusPosDoc (sheet change) before the last RowColSelCount,\n\t\t// - The last RowColSelCount affected all the sheet (re-applying color).\n\n\t\tif (ev.commandName === '.uno:StatusDocPos') {\n\t\t\tthis._bgCanBeSet = true;\n\t\t\treturn;\n\t\t}\n\t\tif (ev.commandName === '.uno:RowColSelCount') {\n\t\t\tthis._bgCanBeSet = ev.state === '1048576 rows, 1024 columns selected';\n\t\t\treturn;\n\t\t}\n\t\tif (ev.commandName !== '.uno:BackgroundColor') {\n\t\t\treturn;\n\t\t}\n\n\t\t// Given an integer coming from a websocket message from UNO,\n\t\t// calculate a '#RRGGBB' string for the corresponding CSS color\n\t\t// Special value: -1 means 'no fill' which translates to white background in Calc\n\t\tvar color;\n\t\tif (ev.state === '-1') {\n\t\t\tcolor = 'white';\n\t\t} else {\n\t\t\tcolor =\n\t\t\t\t'#' +\n\t\t\t\tparseInt(ev.state)\n\t\t\t\t\t.toString(16)\n\t\t\t\t\t.padStart(6, '0');\n\t\t}\n\n\t\tthis.setColor(color);\n\t}\n});\n"]}